From 2fd728ea1560e98fbe4ecf12d66b107f179dbc46 Mon Sep 17 00:00:00 2001
From: Andrew Bays <abays@redhat.com>
Date: Wed, 13 Dec 2017 09:39:59 -0500
Subject: [PATCH 01/60] procevent plugin initial commit

---
 AUTHORS               |    3 +
 Makefile.am           |    7 +
 README                |    3 +
 configure.ac          | 8432 +++++++++++++++++++++--------------------
 src/collectd.conf.in  |    1 +
 src/collectd.conf.pod |   34 +
 src/procevent.c       |  899 +++++
 src/types.db          |    1 +
 8 files changed, 5166 insertions(+), 4214 deletions(-)
 create mode 100644 src/procevent.c

diff --git a/AUTHORS b/AUTHORS
index d05b86f0..15e57faa 100644
--- a/AUTHORS
+++ b/AUTHORS
@@ -56,6 +56,9 @@ Amit Gupta <amit.gupta221 at gmail.com>
 Andreas Henriksson <andreas at fatal.se>
  - libmnl support in the netlink plugin.
 
+Andrew Bays <abays at redhat.com>
+ - procevent plugin.
+
 Andy Parkins <andyp at fussylogic.co.uk>
  - battery plugin: sysfs code.
 
diff --git a/Makefile.am b/Makefile.am
index 0821283b..0246bc87 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -1630,6 +1630,13 @@ processes_la_LIBADD += libtaskstats.la
 endif
 endif
 
+if BUILD_PLUGIN_PROCEVENT
+pkglib_LTLIBRARIES += procevent.la
+procevent_la_SOURCES = src/procevent.c
+procevent_la_CFLAGS = $(AM_CFLAGS)
+procevent_la_LDFLAGS = $(PLUGIN_LDFLAGS)
+endif
+
 if BUILD_PLUGIN_PROTOCOLS
 pkglib_LTLIBRARIES += protocols.la
 protocols_la_SOURCES = src/protocols.c
diff --git a/README b/README
index f28d4992..03d83d41 100644
--- a/README
+++ b/README
@@ -347,6 +347,9 @@ Features
     - processes
       Process counts: Number of running, sleeping, zombie, ... processes.
 
+    - procevent
+      Listens for process starts and exits via netlink.
+
     - protocols
       Counts various aspects of network protocols such as IP, TCP, UDP, etc.
 
diff --git a/configure.ac b/configure.ac
index 7454fb4c..92720492 100644
--- a/configure.ac
+++ b/configure.ac
@@ -25,7 +25,7 @@ AC_SYS_LARGEFILE
 # Checks for programs.
 #
 AC_PROG_CC_C99([],
-  [AC_MSG_ERROR([No compiler found that supports C99])]
+[AC_MSG_ERROR([No compiler found that supports C99])]
 )
 
 AX_COMPILER_VENDOR
@@ -49,21 +49,21 @@ m4_pattern_forbid([^_?PKG_[A-Z_]+$],[*** pkg.m4 missing, please install pkg-conf
 PKG_PROG_PKG_CONFIG
 
 AC_CACHE_CHECK([if Bison is the parser generator],
-  [collectd_cv_prog_bison],
-  [
-    AS_IF([$YACC --version 2>/dev/null | $EGREP -q '^bison '],
-      [collectd_cv_prog_bison=yes],
-      [collectd_cv_prog_bison=no]
-    )
-  ]
+[collectd_cv_prog_bison],
+[
+  AS_IF([$YACC --version 2>/dev/null | $EGREP -q '^bison '],
+    [collectd_cv_prog_bison=yes],
+    [collectd_cv_prog_bison=no]
+  )
+]
 )
 
 if test "x$collectd_cv_prog_bison" = "xno" && test ! -f "${srcdir}/src/liboconfig/parser.c"; then
-  AC_MSG_ERROR([bison is missing and you do not have ${srcdir}/src/liboconfig/parser.c. Please install bison])
+AC_MSG_ERROR([bison is missing and you do not have ${srcdir}/src/liboconfig/parser.c. Please install bison])
 fi
 
 if test "x$lt_cv_dlopen" = "xno"; then
-  AC_MSG_ERROR([Your system does not support dlopen])
+AC_MSG_ERROR([Your system does not support dlopen])
 fi
 
 AC_SUBST([DLOPEN_LIBS], [$lt_cv_dlopen_libs])
@@ -71,41 +71,41 @@ AC_SUBST([DLOPEN_LIBS], [$lt_cv_dlopen_libs])
 
 AC_MSG_CHECKING([for kernel type ($host_os)])
 case $host_os in
-  *aix*)
-    AC_DEFINE([KERNEL_AIX], [1], [True if program is to be compiled for a AIX kernel])
-    ac_system="AIX"
-    ;;
-  *darwin*)
-    AC_DEFINE([KERNEL_DARWIN], [1], [True if program is to be compiled for a Darwin kernel])
-    ac_system="Darwin"
-    ;;
-  *freebsd*)
-    AC_DEFINE([KERNEL_FREEBSD], [1], [True if program is to be compiled for a FreeBSD kernel])
-    ac_system="FreeBSD"
-    ;;
-  *linux*)
-    AC_DEFINE([KERNEL_LINUX], [1], [True if program is to be compiled for a Linux kernel])
-    ac_system="Linux"
-    ;;
-  *netbsd*)
-    AC_DEFINE([KERNEL_NETBSD], [1], [True if program is to be compiled for a NetBSD kernel])
-    ac_system="NetBSD"
-    ;;
-  *openbsd*)
-    AC_DEFINE([KERNEL_OPENBSD], [1], [True if program is to be compiled for an OpenBSD kernel])
-    ac_system="OpenBSD"
-    ;;
-  *solaris*)
-    AC_DEFINE([KERNEL_SOLARIS], [1], [True if program is to be compiled for a Solaris kernel])
-    ac_system="Solaris"
-    ;;
-  *mingw32*)
-    AC_DEFINE([KERNEL_WIN32], [1], [True if program is to be compiled for a Windows kernel])
-    ac_system="Windows"
-    ;;
-  *)
-    ac_system="unknown"
-    ;;
+*aix*)
+  AC_DEFINE([KERNEL_AIX], [1], [True if program is to be compiled for a AIX kernel])
+  ac_system="AIX"
+  ;;
+*darwin*)
+  AC_DEFINE([KERNEL_DARWIN], [1], [True if program is to be compiled for a Darwin kernel])
+  ac_system="Darwin"
+  ;;
+*freebsd*)
+  AC_DEFINE([KERNEL_FREEBSD], [1], [True if program is to be compiled for a FreeBSD kernel])
+  ac_system="FreeBSD"
+  ;;
+*linux*)
+  AC_DEFINE([KERNEL_LINUX], [1], [True if program is to be compiled for a Linux kernel])
+  ac_system="Linux"
+  ;;
+*netbsd*)
+  AC_DEFINE([KERNEL_NETBSD], [1], [True if program is to be compiled for a NetBSD kernel])
+  ac_system="NetBSD"
+  ;;
+*openbsd*)
+  AC_DEFINE([KERNEL_OPENBSD], [1], [True if program is to be compiled for an OpenBSD kernel])
+  ac_system="OpenBSD"
+  ;;
+*solaris*)
+  AC_DEFINE([KERNEL_SOLARIS], [1], [True if program is to be compiled for a Solaris kernel])
+  ac_system="Solaris"
+  ;;
+*mingw32*)
+  AC_DEFINE([KERNEL_WIN32], [1], [True if program is to be compiled for a Windows kernel])
+  ac_system="Windows"
+  ;;
+*)
+  ac_system="unknown"
+  ;;
 esac
 AC_MSG_RESULT([$ac_system])
 
@@ -118,30 +118,30 @@ AM_CONDITIONAL([BUILD_SOLARIS], [test "x$ac_system" = "xSolaris"])
 AM_CONDITIONAL([BUILD_WIN32], [test "x$ac_system" = "xWindows"])
 
 if test "x$ac_system" = "xSolaris"; then
-  AC_DEFINE([_POSIX_PTHREAD_SEMANTICS], [1], [Define to enforce POSIX thread semantics under Solaris.])
-  AC_DEFINE([_REENTRANT], [1], [Define to enable reentrancy interfaces.])
+AC_DEFINE([_POSIX_PTHREAD_SEMANTICS], [1], [Define to enforce POSIX thread semantics under Solaris.])
+AC_DEFINE([_REENTRANT], [1], [Define to enable reentrancy interfaces.])
 
-  AC_MSG_CHECKING([whether compiler builds 64bit binaries])
-  AC_COMPILE_IFELSE(
-    [
-      AC_LANG_PROGRAM(
-        [
-          #ifndef _LP64
-          # error "Compiler not in 64bit mode."
-          #endif
-        ]
-      )
-    ],
-    [AC_MSG_RESULT([yes])],
-    [
-      AC_MSG_RESULT([no])
-      AC_MSG_NOTICE([Solaris detected. Please consider building a 64-bit binary.])
-    ]
-  )
+AC_MSG_CHECKING([whether compiler builds 64bit binaries])
+AC_COMPILE_IFELSE(
+  [
+    AC_LANG_PROGRAM(
+      [
+        #ifndef _LP64
+        # error "Compiler not in 64bit mode."
+        #endif
+      ]
+    )
+  ],
+  [AC_MSG_RESULT([yes])],
+  [
+    AC_MSG_RESULT([no])
+    AC_MSG_NOTICE([Solaris detected. Please consider building a 64-bit binary.])
+  ]
+)
 fi
 
 if test "x$ac_system" = "xAIX"; then
-  AC_DEFINE([_THREAD_SAFE_ERRNO], [1], [Define to use the thread-safe version of errno under AIX.])
+AC_DEFINE([_THREAD_SAFE_ERRNO], [1], [Define to use the thread-safe version of errno under AIX.])
 fi
 
 # Where to install .pc files.
@@ -155,415 +155,415 @@ AC_HEADER_SYS_WAIT
 AC_HEADER_DIRENT
 
 AC_CHECK_HEADERS_ONCE([ \
-  arpa/inet.h \
-  endian.h \
-  fcntl.h \
-  fnmatch.h \
-  fs_info.h \
-  fshelp.h \
-  grp.h \
-  kstat.h \
-  kvm.h \
-  libgen.h \
-  mntent.h \
-  mnttab.h \
-  netdb.h \
-  paths.h \
-  poll.h \
-  pthread_np.h \
-  pwd.h \
-  regex.h \
-  sys/endian.h \
-  sys/fs_types.h \
-  sys/fstyp.h \
-  sys/ioctl.h \
-  sys/isa_defs.h \
-  sys/mntent.h \
-  sys/mnttab.h \
-  sys/param.h \
-  sys/resource.h \
-  sys/select.h \
-  sys/socket.h \
-  sys/statfs.h \
-  sys/statvfs.h \
-  sys/types.h \
-  sys/un.h \
-  sys/vfs.h \
-  sys/vfstab.h \
-  sys/vmmeter.h \
-  syslog.h \
-  wordexp.h
+arpa/inet.h \
+endian.h \
+fcntl.h \
+fnmatch.h \
+fs_info.h \
+fshelp.h \
+grp.h \
+kstat.h \
+kvm.h \
+libgen.h \
+mntent.h \
+mnttab.h \
+netdb.h \
+paths.h \
+poll.h \
+pthread_np.h \
+pwd.h \
+regex.h \
+sys/endian.h \
+sys/fs_types.h \
+sys/fstyp.h \
+sys/ioctl.h \
+sys/isa_defs.h \
+sys/mntent.h \
+sys/mnttab.h \
+sys/param.h \
+sys/resource.h \
+sys/select.h \
+sys/socket.h \
+sys/statfs.h \
+sys/statvfs.h \
+sys/types.h \
+sys/un.h \
+sys/vfs.h \
+sys/vfstab.h \
+sys/vmmeter.h \
+syslog.h \
+wordexp.h
 ])
 
 if test "x$ac_system" = "xNetBSD"; then
-  # For entropy plugin on newer NetBSD
-  AC_CHECK_HEADERS([sys/rndio.h], [], [],
-    [[
-      #if HAVE_SYS_TYPES_H
-      # include <sys/types.h>
-      #endif
-      #if HAVE_SYS_IOCTL_H
-      # include <sys/ioctl.h>
-      #endif
-      #if HAVE_SYS_PARAM_H
-      # include <sys/param.h>
-      #endif
-    ]]
-  )
-fi
-
-# For ping library
-AC_CHECK_HEADERS([netinet/in_systm.h], [], [],
+# For entropy plugin on newer NetBSD
+AC_CHECK_HEADERS([sys/rndio.h], [], [],
   [[
-    #include <stdint.h>
     #if HAVE_SYS_TYPES_H
     # include <sys/types.h>
     #endif
+    #if HAVE_SYS_IOCTL_H
+    # include <sys/ioctl.h>
+    #endif
+    #if HAVE_SYS_PARAM_H
+    # include <sys/param.h>
+    #endif
   ]]
 )
+fi
+
+# For ping library
+AC_CHECK_HEADERS([netinet/in_systm.h], [], [],
+[[
+  #include <stdint.h>
+  #if HAVE_SYS_TYPES_H
+  # include <sys/types.h>
+  #endif
+]]
+)
 
 AC_CHECK_HEADERS([netinet/in.h], [], [],
-  [[
-    #include <stdint.h>
-    #if HAVE_SYS_TYPES_H
-    # include <sys/types.h>
-    #endif
-    #if HAVE_NETINET_IN_SYSTM_H
-    # include <netinet/in_systm.h>
-    #endif
-  ]]
+[[
+  #include <stdint.h>
+  #if HAVE_SYS_TYPES_H
+  # include <sys/types.h>
+  #endif
+  #if HAVE_NETINET_IN_SYSTM_H
+  # include <netinet/in_systm.h>
+  #endif
+]]
 )
 
 AC_CHECK_HEADERS([netinet/ip.h], [], [],
+[[
+  #include <stdint.h>
+  #if HAVE_SYS_TYPES_H
+  # include <sys/types.h>
+  #endif
+  #if HAVE_NETINET_IN_SYSTM_H
+  # include <netinet/in_systm.h>
+  #endif
+  #if HAVE_NETINET_IN_H
+  # include <netinet/in.h>
+  #endif
+]]
+)
+
+AC_CHECK_HEADERS([netinet/ip_icmp.h], [], [],
+[[
+  #include <stdint.h>
+  #if HAVE_SYS_TYPES_H
+  # include <sys/types.h>
+  #endif
+  #if HAVE_NETINET_IN_SYSTM_H
+  # include <netinet/in_systm.h>
+  #endif
+  #if HAVE_NETINET_IN_H
+  # include <netinet/in.h>
+  #endif
+  #if HAVE_NETINET_IP_H
+  # include <netinet/ip.h>
+  #endif
+]]
+)
+
+AC_CHECK_HEADERS([netinet/ip_var.h], [], [],
+[[
+  #include <stdint.h>
+  #if HAVE_SYS_TYPES_H
+  # include <sys/types.h>
+  #endif
+  #if HAVE_NETINET_IN_SYSTM_H
+  # include <netinet/in_systm.h>
+  #endif
+  #if HAVE_NETINET_IN_H
+  # include <netinet/in.h>
+  #endif
+  #if HAVE_NETINET_IP_H
+  # include <netinet/ip.h>
+  #endif
+]]
+)
+
+AC_CHECK_HEADERS([netinet/ip6.h], [], [],
+[[
+  #include <stdint.h>
+  #if HAVE_SYS_TYPES_H
+  # include <sys/types.h>
+  #endif
+  #if HAVE_NETINET_IN_SYSTM_H
+  # include <netinet/in_systm.h>
+  #endif
+  #if HAVE_NETINET_IN_H
+  # include <netinet/in.h>
+  #endif
+]]
+)
+
+AC_CHECK_HEADERS([netinet/icmp6.h], [], [],
+[[
+  #include <stdint.h>
+  #if HAVE_SYS_TYPES_H
+  # include <sys/types.h>
+  #endif
+  #if HAVE_NETINET_IN_SYSTM_H
+  # include <netinet/in_systm.h>
+  #endif
+  #if HAVE_NETINET_IN_H
+  # include <netinet/in.h>
+  #endif
+  #if HAVE_NETINET_IP6_H
+  # include <netinet/ip6.h>
+  #endif
+]]
+)
+
+AC_CHECK_HEADERS([netinet/tcp.h], [], [],
+[[
+  #include <stdint.h>
+  #if HAVE_SYS_TYPES_H
+  # include <sys/types.h>
+  #endif
+  #if HAVE_NETINET_IN_SYSTM_H
+  # include <netinet/in_systm.h>
+  #endif
+  #if HAVE_NETINET_IN_H
+  # include <netinet/in.h>
+  #endif
+  #if HAVE_NETINET_IP_H
+  # include <netinet/ip.h>
+  #endif
+]]
+)
+
+AC_CHECK_HEADERS([netinet/udp.h], [], [],
+[[
+  #include <stdint.h>
+  #if HAVE_SYS_TYPES_H
+  # include <sys/types.h>
+  #endif
+  #if HAVE_NETINET_IN_SYSTM_H
+  # include <netinet/in_systm.h>
+  #endif
+  #if HAVE_NETINET_IN_H
+  # include <netinet/in.h>
+  #endif
+  #if HAVE_NETINET_IP_H
+  # include <netinet/ip.h>
+  #endif
+]]
+)
+
+# For cpu modules
+AC_CHECK_HEADERS([sys/dkstat.h])
+if test "x$ac_system" = "xDarwin"; then
+AC_CHECK_HEADERS(
+  [ \
+    mach/mach_init.h \
+    mach/host_priv.h \
+    mach/mach_error.h \
+    mach/mach_host.h \
+    mach/mach_port.h \
+    mach/mach_types.h \
+    mach/message.h \
+    mach/processor_set.h \
+    mach/processor.h \
+    mach/processor_info.h \
+    mach/task.h \
+    mach/thread_act.h \
+    mach/vm_region.h \
+    mach/vm_map.h \
+    mach/vm_prot.h \
+    mach/vm_statistics.h \
+    mach/kern_return.h \
+    CoreFoundation/CoreFoundation.h \
+    IOKit/IOKitLib.h \
+    IOKit/IOTypes.h \
+    IOKit/ps/IOPSKeys.h \
+    IOKit/IOBSD.h \
+    IOKit/storage/IOBlockStorageDriver.h
+  ]
+)
+
+# For the battery plugin
+AC_CHECK_HEADERS([IOKit/ps/IOPowerSources.h], [], [],
   [[
-    #include <stdint.h>
-    #if HAVE_SYS_TYPES_H
-    # include <sys/types.h>
-    #endif
-    #if HAVE_NETINET_IN_SYSTM_H
-    # include <netinet/in_systm.h>
+    #if HAVE_IOKIT_IOKITLIB_H
+    #  include <IOKit/IOKitLib.h>
     #endif
-    #if HAVE_NETINET_IN_H
-    # include <netinet/in.h>
+    #if HAVE_IOKIT_IOTYPES_H
+    #  include <IOKit/IOTypes.h>
     #endif
   ]]
 )
+fi
 
-AC_CHECK_HEADERS([netinet/ip_icmp.h], [], [],
+AC_CHECK_HEADERS([sys/sysctl.h], [], [],
+[[
+  #if HAVE_SYS_TYPES_H
+  #  include <sys/types.h>
+  #endif
+  #if HAVE_SYS_PARAM_H
+  # include <sys/param.h>
+  #endif
+]]
+)
+
+# For interface plugin
+AC_CHECK_HEADERS([ifaddrs.h])
+AC_CHECK_HEADERS([net/if.h], [], [],
+[[
+  #if HAVE_SYS_TYPES_H
+  #  include <sys/types.h>
+  #endif
+  #if HAVE_SYS_SOCKET_H
+  #  include <sys/socket.h>
+  #endif
+]]
+)
+
+if test "x$ac_system" = "xLinux"; then
+# For hddtemp module
+AC_CHECK_HEADERS([linux/major.h])
+
+# For md module (Linux only)
+AC_CHECK_HEADERS([linux/raid/md_u.h],
+  [have_linux_raid_md_u_h="yes"],
+  [have_linux_raid_md_u_h="no"],
   [[
-    #include <stdint.h>
-    #if HAVE_SYS_TYPES_H
-    # include <sys/types.h>
-    #endif
-    #if HAVE_NETINET_IN_SYSTM_H
-    # include <netinet/in_systm.h>
-    #endif
-    #if HAVE_NETINET_IN_H
-    # include <netinet/in.h>
-    #endif
-    #if HAVE_NETINET_IP_H
-    # include <netinet/ip.h>
-    #endif
+    #include <sys/ioctl.h>
+    #include <linux/major.h>
+    #include <linux/types.h>
   ]]
 )
+AC_CHECK_HEADERS([sys/sysmacros.h])
 
-AC_CHECK_HEADERS([netinet/ip_var.h], [], [],
+AC_CHECK_HEADERS([linux/wireless.h],
+  [have_linux_wireless_h="yes"],
+  [have_linux_wireless_h="no"],
   [[
-    #include <stdint.h>
-    #if HAVE_SYS_TYPES_H
-    # include <sys/types.h>
-    #endif
-    #if HAVE_NETINET_IN_SYSTM_H
-    # include <netinet/in_systm.h>
-    #endif
-    #if HAVE_NETINET_IN_H
-    # include <netinet/in.h>
-    #endif
-    #if HAVE_NETINET_IP_H
-    # include <netinet/ip.h>
-    #endif
+    #include <dirent.h>
+    #include <sys/ioctl.h>
+    #include <sys/socket.h>
   ]]
 )
 
-AC_CHECK_HEADERS([netinet/ip6.h], [], [],
+AC_CHECK_HEADERS([linux/if.h], [], [],
   [[
-    #include <stdint.h>
     #if HAVE_SYS_TYPES_H
-    # include <sys/types.h>
-    #endif
-    #if HAVE_NETINET_IN_SYSTM_H
-    # include <netinet/in_systm.h>
+    #  include <sys/types.h>
     #endif
-    #if HAVE_NETINET_IN_H
-    # include <netinet/in.h>
+    #if HAVE_SYS_SOCKET_H
+    #  include <sys/socket.h>
     #endif
   ]]
 )
 
-AC_CHECK_HEADERS([netinet/icmp6.h], [], [],
+AC_CHECK_HEADERS([linux/inet_diag.h], [], [],
   [[
-    #include <stdint.h>
     #if HAVE_SYS_TYPES_H
-    # include <sys/types.h>
-    #endif
-    #if HAVE_NETINET_IN_SYSTM_H
-    # include <netinet/in_systm.h>
-    #endif
-    #if HAVE_NETINET_IN_H
-    # include <netinet/in.h>
+    #  include <sys/types.h>
     #endif
-    #if HAVE_NETINET_IP6_H
-    # include <netinet/ip6.h>
+    #if HAVE_SYS_SOCKET_H
+    #  include <sys/socket.h>
     #endif
   ]]
 )
 
-AC_CHECK_HEADERS([netinet/tcp.h], [], [],
+AC_CHECK_HEADERS([linux/netdevice.h], [], [],
   [[
-    #include <stdint.h>
     #if HAVE_SYS_TYPES_H
-    # include <sys/types.h>
-    #endif
-    #if HAVE_NETINET_IN_SYSTM_H
-    # include <netinet/in_systm.h>
+    #  include <sys/types.h>
     #endif
-    #if HAVE_NETINET_IN_H
-    # include <netinet/in.h>
+    #if HAVE_SYS_SOCKET_H
+    #  include <sys/socket.h>
     #endif
-    #if HAVE_NETINET_IP_H
-    # include <netinet/ip.h>
+    #if HAVE_LINUX_IF_H
+    # include <linux/if.h>
     #endif
   ]]
 )
 
-AC_CHECK_HEADERS([netinet/udp.h], [], [],
+# For ethstat module
+AC_CHECK_HEADERS([linux/sockios.h],
+  [have_linux_sockios_h="yes"],
+  [have_linux_sockios_h="no"],
   [[
-    #include <stdint.h>
-    #if HAVE_SYS_TYPES_H
-    # include <sys/types.h>
-    #endif
-    #if HAVE_NETINET_IN_SYSTM_H
-    # include <netinet/in_systm.h>
-    #endif
-    #if HAVE_NETINET_IN_H
-    # include <netinet/in.h>
+    #if HAVE_SYS_IOCTL_H
+    # include <sys/ioctl.h>
     #endif
-    #if HAVE_NETINET_IP_H
-    # include <netinet/ip.h>
+    #if HAVE_NET_IF_H
+    # include <net/if.h>
     #endif
   ]]
 )
 
-# For cpu modules
-AC_CHECK_HEADERS([sys/dkstat.h])
-if test "x$ac_system" = "xDarwin"; then
-  AC_CHECK_HEADERS(
-    [ \
-      mach/mach_init.h \
-      mach/host_priv.h \
-      mach/mach_error.h \
-      mach/mach_host.h \
-      mach/mach_port.h \
-      mach/mach_types.h \
-      mach/message.h \
-      mach/processor_set.h \
-      mach/processor.h \
-      mach/processor_info.h \
-      mach/task.h \
-      mach/thread_act.h \
-      mach/vm_region.h \
-      mach/vm_map.h \
-      mach/vm_prot.h \
-      mach/vm_statistics.h \
-      mach/kern_return.h \
-      CoreFoundation/CoreFoundation.h \
-      IOKit/IOKitLib.h \
-      IOKit/IOTypes.h \
-      IOKit/ps/IOPSKeys.h \
-      IOKit/IOBSD.h \
-      IOKit/storage/IOBlockStorageDriver.h
-    ]
-  )
-
-  # For the battery plugin
-  AC_CHECK_HEADERS([IOKit/ps/IOPowerSources.h], [], [],
-    [[
-      #if HAVE_IOKIT_IOKITLIB_H
-      #  include <IOKit/IOKitLib.h>
-      #endif
-      #if HAVE_IOKIT_IOTYPES_H
-      #  include <IOKit/IOTypes.h>
-      #endif
-    ]]
-  )
-fi
-
-AC_CHECK_HEADERS([sys/sysctl.h], [], [],
+AC_CHECK_HEADERS([linux/ethtool.h],
+  [have_linux_ethtool_h="yes"],
+  [have_linux_ethtool_h="no"],
   [[
-    #if HAVE_SYS_TYPES_H
-    #  include <sys/types.h>
+    #if HAVE_SYS_IOCTL_H
+    # include <sys/ioctl.h>
     #endif
-    #if HAVE_SYS_PARAM_H
-    # include <sys/param.h>
+    #if HAVE_NET_IF_H
+    # include <net/if.h>
+    #endif
+    #if HAVE_LINUX_SOCKIOS_H
+    # include <linux/sockios.h>
     #endif
   ]]
 )
 
-# For interface plugin
-AC_CHECK_HEADERS([ifaddrs.h])
-AC_CHECK_HEADERS([net/if.h], [], [],
+# For ipvs module
+AC_CHECK_HEADERS_ONCE([linux/ip_vs.h])
+
+# For the email plugin
+AC_CHECK_HEADERS([linux/un.h], [], [],
   [[
-    #if HAVE_SYS_TYPES_H
-    #  include <sys/types.h>
-    #endif
     #if HAVE_SYS_SOCKET_H
     #  include <sys/socket.h>
     #endif
   ]]
 )
+# For the turbostat plugin
+AC_CHECK_HEADERS([cpuid.h],
+  [have_cpuid_h="yes"],
+  [have_cpuid_h="no (cpuid.h not found)"]
+)
 
-if test "x$ac_system" = "xLinux"; then
-  # For hddtemp module
-  AC_CHECK_HEADERS([linux/major.h])
-
-  # For md module (Linux only)
-  AC_CHECK_HEADERS([linux/raid/md_u.h],
-    [have_linux_raid_md_u_h="yes"],
-    [have_linux_raid_md_u_h="no"],
-    [[
-      #include <sys/ioctl.h>
-      #include <linux/major.h>
-      #include <linux/types.h>
-    ]]
-  )
-  AC_CHECK_HEADERS([sys/sysmacros.h])
-
-  AC_CHECK_HEADERS([linux/wireless.h],
-    [have_linux_wireless_h="yes"],
-    [have_linux_wireless_h="no"],
-    [[
-      #include <dirent.h>
-      #include <sys/ioctl.h>
-      #include <sys/socket.h>
-    ]]
-  )
-
-  AC_CHECK_HEADERS([linux/if.h], [], [],
-    [[
-      #if HAVE_SYS_TYPES_H
-      #  include <sys/types.h>
-      #endif
-      #if HAVE_SYS_SOCKET_H
-      #  include <sys/socket.h>
-      #endif
-    ]]
-  )
-
-  AC_CHECK_HEADERS([linux/inet_diag.h], [], [],
-    [[
-      #if HAVE_SYS_TYPES_H
-      #  include <sys/types.h>
-      #endif
-      #if HAVE_SYS_SOCKET_H
-      #  include <sys/socket.h>
-      #endif
-    ]]
-  )
-
-  AC_CHECK_HEADERS([linux/netdevice.h], [], [],
-    [[
-      #if HAVE_SYS_TYPES_H
-      #  include <sys/types.h>
-      #endif
-      #if HAVE_SYS_SOCKET_H
-      #  include <sys/socket.h>
-      #endif
-      #if HAVE_LINUX_IF_H
-      # include <linux/if.h>
-      #endif
-    ]]
-  )
-
-  # For ethstat module
-  AC_CHECK_HEADERS([linux/sockios.h],
-    [have_linux_sockios_h="yes"],
-    [have_linux_sockios_h="no"],
-    [[
-      #if HAVE_SYS_IOCTL_H
-      # include <sys/ioctl.h>
-      #endif
-      #if HAVE_NET_IF_H
-      # include <net/if.h>
-      #endif
-    ]]
-  )
-
-  AC_CHECK_HEADERS([linux/ethtool.h],
-    [have_linux_ethtool_h="yes"],
-    [have_linux_ethtool_h="no"],
-    [[
-      #if HAVE_SYS_IOCTL_H
-      # include <sys/ioctl.h>
-      #endif
-      #if HAVE_NET_IF_H
-      # include <net/if.h>
-      #endif
-      #if HAVE_LINUX_SOCKIOS_H
-      # include <linux/sockios.h>
-      #endif
-    ]]
-  )
-
-  # For ipvs module
-  AC_CHECK_HEADERS_ONCE([linux/ip_vs.h])
+AC_CHECK_HEADERS([sys/capability.h],
+  [have_capability="yes"],
+  [have_capability="no (<sys/capability.h> not found)"]
+)
 
-  # For the email plugin
-  AC_CHECK_HEADERS([linux/un.h], [], [],
-    [[
-      #if HAVE_SYS_SOCKET_H
-      #  include <sys/socket.h>
-      #endif
-    ]]
-  )
-  # For the turbostat plugin
-  AC_CHECK_HEADERS([cpuid.h],
-    [have_cpuid_h="yes"],
-    [have_cpuid_h="no (cpuid.h not found)"]
+if test "x$have_capability" = "xyes"; then
+  AC_CHECK_LIB([cap], [cap_get_proc],
+    [have_capability="yes"],
+    [have_capability="no (cap_get_proc() not found)"]
   )
+fi
 
-  AC_CHECK_HEADERS([sys/capability.h],
+if test "x$have_capability" = "xyes"; then
+  AC_CHECK_DECL([CAP_IS_SUPPORTED],
     [have_capability="yes"],
-    [have_capability="no (<sys/capability.h> not found)"]
+    [have_capability="no (CAP_IS_SUPPORTED not found)"],
+    [[#include <sys/capability.h>]]
   )
+fi
 
-  if test "x$have_capability" = "xyes"; then
-    AC_CHECK_LIB([cap], [cap_get_proc],
-      [have_capability="yes"],
-      [have_capability="no (cap_get_proc() not found)"]
-    )
-  fi
-
-  if test "x$have_capability" = "xyes"; then
-    AC_CHECK_DECL([CAP_IS_SUPPORTED],
-      [have_capability="yes"],
-      [have_capability="no (CAP_IS_SUPPORTED not found)"],
-      [[#include <sys/capability.h>]]
-    )
-  fi
-
-  if test "x$have_capability" = "xyes"; then
-    AC_DEFINE([HAVE_CAPABILITY], [1], [Define to 1 if you have cap_get_proc() (-lcap).])
-  fi
+if test "x$have_capability" = "xyes"; then
+  AC_DEFINE([HAVE_CAPABILITY], [1], [Define to 1 if you have cap_get_proc() (-lcap).])
+fi
 
-  # For pcie_errors plugin
-  AC_CHECK_HEADERS([linux/pci_regs.h],
-    [have_pci_regs_h="yes"],
-    [have_pci_regs_h="no (linux/pci_regs.h not found)"]
-  )
+# For pcie_errors plugin
+AC_CHECK_HEADERS([linux/pci_regs.h],
+  [have_pci_regs_h="yes"],
+  [have_pci_regs_h="no (linux/pci_regs.h not found)"]
+)
 
 else
-  have_linux_raid_md_u_h="no"
-  have_linux_wireless_h="no"
+have_linux_raid_md_u_h="no"
+have_linux_wireless_h="no"
 fi
 
 AM_CONDITIONAL([BUILD_WITH_CAPABILITY], [test "x$have_capability" = "xyes"])
@@ -571,18 +571,18 @@ AM_CONDITIONAL([BUILD_WITH_CAPABILITY], [test "x$have_capability" = "xyes"])
 # For the swap module
 have_sys_swap_h="yes"
 AC_CHECK_HEADERS([sys/swap.h vm/anon.h],
-  [],
-  [have_sys_swap_h="no"],
-  [[
-    #undef _FILE_OFFSET_BITS
-    #undef _LARGEFILE64_SOURCE
-    #if HAVE_SYS_TYPES_H
-    #  include <sys/types.h>
-    #endif
-    #if HAVE_SYS_PARAM_H
-    # include <sys/param.h>
-    #endif
-  ]]
+[],
+[have_sys_swap_h="no"],
+[[
+  #undef _FILE_OFFSET_BITS
+  #undef _LARGEFILE64_SOURCE
+  #if HAVE_SYS_TYPES_H
+  #  include <sys/types.h>
+  #endif
+  #if HAVE_SYS_PARAM_H
+  # include <sys/param.h>
+  #endif
+]]
 )
 
 # For load module
@@ -592,45 +592,45 @@ AC_CHECK_HEADERS([sys/loadavg.h linux/config.h utmp.h utmpx.h])
 
 # For quota module
 AC_CHECK_HEADERS([sys/ucred.h], [], [],
-  [[
-    #if HAVE_SYS_TYPES_H
-    #  include <sys/types.h>
-    #endif
-    #if HAVE_SYS_PARAM_H
-    # include <sys/param.h>
-    #endif
-  ]]
+[[
+  #if HAVE_SYS_TYPES_H
+  #  include <sys/types.h>
+  #endif
+  #if HAVE_SYS_PARAM_H
+  # include <sys/param.h>
+  #endif
+]]
 )
 
 # For mount interface
 AC_CHECK_HEADERS([sys/mount.h], [], [],
-  [[
-    #if HAVE_SYS_TYPES_H
-    #  include <sys/types.h>
-    #endif
-    #if HAVE_SYS_PARAM_H
-    # include <sys/param.h>
-    #endif
-  ]]
+[[
+  #if HAVE_SYS_TYPES_H
+  #  include <sys/types.h>
+  #endif
+  #if HAVE_SYS_PARAM_H
+  # include <sys/param.h>
+  #endif
+]]
 )
 
 # --enable-xfs {{{
 AC_ARG_ENABLE([xfs],
-  [AS_HELP_STRING([--enable-xfs], [xfs support in df plugin @<:@default=yes@:>@])],
-  [],
-  [enable_xfs="auto"]
+[AS_HELP_STRING([--enable-xfs], [xfs support in df plugin @<:@default=yes@:>@])],
+[],
+[enable_xfs="auto"]
 )
 
 if test "x$enable_xfs" != "xno"; then
-  AC_CHECK_HEADERS([xfs/xqm.h],
-    [],
-    [
-      if test "x$enable_xfs" = "xyes"; then
-        AC_MSG_ERROR([xfs/xqm.h not found])
-      fi
-    ],
-    [[#define _GNU_SOURCE]]
-  )
+AC_CHECK_HEADERS([xfs/xqm.h],
+  [],
+  [
+    if test "x$enable_xfs" = "xyes"; then
+      AC_MSG_ERROR([xfs/xqm.h not found])
+    fi
+  ],
+  [[#define _GNU_SOURCE]]
+)
 fi
 
 # }}}
@@ -638,91 +638,91 @@ fi
 # For the dns plugin
 AC_CHECK_HEADERS([arpa/nameser.h])
 AC_CHECK_HEADERS([arpa/nameser_compat.h], [], [],
-  [[
-    #if HAVE_ARPA_NAMESER_H
-    # include <arpa/nameser.h>
-    #endif
-  ]]
+[[
+  #if HAVE_ARPA_NAMESER_H
+  # include <arpa/nameser.h>
+  #endif
+]]
 )
 
 AC_CHECK_HEADERS([net/if_arp.h], [], [],
-  [[
-    #if HAVE_SYS_SOCKET_H
-    # include <sys/socket.h>
-    #endif
-  ]]
+[[
+  #if HAVE_SYS_SOCKET_H
+  # include <sys/socket.h>
+  #endif
+]]
 )
 
 AC_CHECK_HEADERS([net/ppp_defs.h])
 AC_CHECK_HEADERS([net/if_ppp.h], [], [],
-  [[
-    #if HAVE_NET_PPP_DEFS_H
-    # include <net/ppp_defs.h>
-    #endif
-  ]]
+[[
+  #if HAVE_NET_PPP_DEFS_H
+  # include <net/ppp_defs.h>
+  #endif
+]]
 )
 
 AC_CHECK_HEADERS([netinet/if_ether.h], [], [],
-  [[
-    #include <stdint.h>
-    #if HAVE_SYS_TYPES_H
-    # include <sys/types.h>
-    #endif
-    #if HAVE_SYS_SOCKET_H
-    # include <sys/socket.h>
-    #endif
-    #if HAVE_NET_IF_H
-    # include <net/if.h>
-    #endif
-    #if HAVE_NETINET_IN_H
-    # include <netinet/in.h>
-    #endif
-  ]]
+[[
+  #include <stdint.h>
+  #if HAVE_SYS_TYPES_H
+  # include <sys/types.h>
+  #endif
+  #if HAVE_SYS_SOCKET_H
+  # include <sys/socket.h>
+  #endif
+  #if HAVE_NET_IF_H
+  # include <net/if.h>
+  #endif
+  #if HAVE_NETINET_IN_H
+  # include <netinet/in.h>
+  #endif
+]]
 )
 
 AC_CHECK_HEADERS([net/pfvar.h],
-  [have_net_pfvar_h="yes"],
-  [have_net_pfvar_h="no"],
-  [[
-    #if HAVE_SYS_IOCTL_H
-    # include <sys/ioctl.h>
-    #endif
-    #if HAVE_SYS_SOCKET_H
-    # include <sys/socket.h>
-    #endif
-    #if HAVE_NET_IF_H
-    # include <net/if.h>
-    #endif
-    #if HAVE_NETINET_IN_H
-    # include <netinet/in.h>
-    #endif
-  ]]
+[have_net_pfvar_h="yes"],
+[have_net_pfvar_h="no"],
+[[
+  #if HAVE_SYS_IOCTL_H
+  # include <sys/ioctl.h>
+  #endif
+  #if HAVE_SYS_SOCKET_H
+  # include <sys/socket.h>
+  #endif
+  #if HAVE_NET_IF_H
+  # include <net/if.h>
+  #endif
+  #if HAVE_NETINET_IN_H
+  # include <netinet/in.h>
+  #endif
+]]
 )
 
 # For the multimeter plugin
 AC_CHECK_HEADERS([termios.h],
-  [have_termios_h="yes"],
-  [have_termios_h="no"]
+[have_termios_h="yes"],
+[have_termios_h="no"]
 )
 
 # For cpusleep plugin
 AC_CACHE_CHECK([whether clock_boottime and clock_monotonic are supported],
-  [c_cv_have_clock_boottime_monotonic],
-  [
-    AC_COMPILE_IFELSE(
-      [AC_LANG_PROGRAM(
-        [[#include <time.h>]],
-        [[
-          struct timespec b, m;
-          clock_gettime(CLOCK_BOOTTIME, &b );
-          clock_gettime(CLOCK_MONOTONIC, &m );
-        ]]
-      )
-      ],
-      [c_cv_have_clock_boottime_monotonic="yes"],
-      [c_cv_have_clock_boottime_monotonic="no"]
+[c_cv_have_clock_boottime_monotonic],
+[
+  AC_COMPILE_IFELSE(
+    [AC_LANG_PROGRAM(
+      [[#include <time.h>]],
+      [[
+        struct timespec b, m;
+        clock_gettime(CLOCK_BOOTTIME, &b );
+        clock_gettime(CLOCK_MONOTONIC, &m );
+      ]]
     )
-  ]
+    ],
+    [c_cv_have_clock_boottime_monotonic="yes"],
+    [c_cv_have_clock_boottime_monotonic="no"]
+  )
+]
 )
 
 
@@ -736,43 +736,43 @@ AC_TYPE_UID_T
 AC_HEADER_TIME
 
 test_cxx_flags() {
-  AC_LANG_PUSH([C++])
-  AC_LANG_CONFTEST(
-    [AC_LANG_SOURCE([[int main(void){}]]) ]
-  )
-  $CXX -c conftest.cpp $CXXFLAGS $@ > /dev/null 2> /dev/null
-  ret=$?
-  rm -f conftest.o
-  AC_LANG_POP([C++])
-  return $ret
+AC_LANG_PUSH([C++])
+AC_LANG_CONFTEST(
+  [AC_LANG_SOURCE([[int main(void){}]]) ]
+)
+$CXX -c conftest.cpp $CXXFLAGS $@ > /dev/null 2> /dev/null
+ret=$?
+rm -f conftest.o
+AC_LANG_POP([C++])
+return $ret
 }
 
 #
 # Checks for library functions.
 #
 AC_CHECK_FUNCS_ONCE([ \
-    asprintf \
-    closelog \
-    getaddrinfo \
-    getgrnam_r \
-    getnameinfo \
-    getpwnam \
-    getpwnam_r \
-    gettimeofday \
-    if_indextoname \
-    openlog \
-    regcomp \
-    regerror \
-    regexec \
-    regfree \
-    select \
-    setenv \
-    setgroups \
-    strcasecmp \
-    strdup \
-    strncasecmp \
-    sysconf
-  ]
+  asprintf \
+  closelog \
+  getaddrinfo \
+  getgrnam_r \
+  getnameinfo \
+  getpwnam \
+  getpwnam_r \
+  gettimeofday \
+  if_indextoname \
+  openlog \
+  regcomp \
+  regerror \
+  regexec \
+  regfree \
+  select \
+  setenv \
+  setgroups \
+  strcasecmp \
+  strdup \
+  strncasecmp \
+  sysconf
+]
 )
 
 AC_FUNC_STRERROR_R
@@ -782,12 +782,48 @@ CFLAGS="-Wall -Werror"
 SAVE_LDFLAGS="$LDFLAGS"
 LDFLAGS=""
 if test "x$ac_system" = "xWindows"; then
-  # This is exported from build.sh
-  LDFLAGS="$LDFLAGS -L${GNULIB_DIR}"
+# This is exported from build.sh
+LDFLAGS="$LDFLAGS -L${GNULIB_DIR}"
 fi
 
 AC_CACHE_CHECK([for strtok_r],
-  [c_cv_have_strtok_r_default],
+[c_cv_have_strtok_r_default],
+[
+  AC_LINK_IFELSE(
+    [
+      AC_LANG_PROGRAM(
+        [[
+          #include <stdlib.h>
+          #include <stdio.h>
+          #include <string.h>
+        ]],
+        [[
+          char buffer[] = "foo,bar,baz";
+          char *token;
+          char *dummy;
+          char *saveptr;
+
+          dummy = buffer;
+          saveptr = NULL;
+          while ((token = strtok_r (dummy, ",", &saveptr)) != NULL)
+          {
+            dummy = NULL;
+            printf ("token = %s;\n", token);
+          }
+        ]]
+      )
+    ],
+    [c_cv_have_strtok_r_default="yes"],
+    [c_cv_have_strtok_r_default="no"]
+  )
+]
+)
+
+if test "x$c_cv_have_strtok_r_default" = "xno"; then
+CFLAGS="$CFLAGS -D_REENTRANT=1"
+
+AC_CACHE_CHECK([if strtok_r needs _REENTRANT],
+  [c_cv_have_strtok_r_reentrant],
   [
     AC_LINK_IFELSE(
       [
@@ -813,110 +849,74 @@ AC_CACHE_CHECK([for strtok_r],
           ]]
         )
       ],
-      [c_cv_have_strtok_r_default="yes"],
-      [c_cv_have_strtok_r_default="no"]
+      [c_cv_have_strtok_r_reentrant="yes"],
+      [AC_MSG_FAILURE([strtok_r is not available. Please file a bugreport!])]
     )
   ]
 )
-
-if test "x$c_cv_have_strtok_r_default" = "xno"; then
-  CFLAGS="$CFLAGS -D_REENTRANT=1"
-
-  AC_CACHE_CHECK([if strtok_r needs _REENTRANT],
-    [c_cv_have_strtok_r_reentrant],
-    [
-      AC_LINK_IFELSE(
-        [
-          AC_LANG_PROGRAM(
-            [[
-              #include <stdlib.h>
-              #include <stdio.h>
-              #include <string.h>
-            ]],
-            [[
-              char buffer[] = "foo,bar,baz";
-              char *token;
-              char *dummy;
-              char *saveptr;
-
-              dummy = buffer;
-              saveptr = NULL;
-              while ((token = strtok_r (dummy, ",", &saveptr)) != NULL)
-              {
-                dummy = NULL;
-                printf ("token = %s;\n", token);
-              }
-            ]]
-          )
-        ],
-        [c_cv_have_strtok_r_reentrant="yes"],
-        [AC_MSG_FAILURE([strtok_r is not available. Please file a bugreport!])]
-      )
-    ]
-  )
 fi
 
 CFLAGS="$SAVE_CFLAGS"
 LDFLAGS="$SAVE_LDFLAGS"
 if test "x$c_cv_have_strtok_r_reentrant" = "xyes"; then
-  CFLAGS="$CFLAGS -D_REENTRANT=1"
+CFLAGS="$CFLAGS -D_REENTRANT=1"
 fi
 
 AC_CHECK_FUNCS([socket],
-  [],
-  [
-    AC_CHECK_LIB([socket], [socket],
-      [socket_needs_socket="yes"],
-      [
-        AC_CHECK_LIB([gnu], [rpl_socket],
-          [socket_needs_gnulib="yes"],
-          [AC_MSG_ERROR([cannot find socket() in libsocket])]
-        )
-      ]
-    )
-  ]
+[],
+[
+  AC_CHECK_LIB([socket], [socket],
+    [socket_needs_socket="yes"],
+    [
+      AC_CHECK_LIB([gnu], [rpl_socket],
+        [socket_needs_gnulib="yes"],
+        [AC_MSG_ERROR([cannot find socket() in libsocket])]
+      )
+    ]
+  )
+]
 )
 AM_CONDITIONAL([BUILD_WITH_LIBSOCKET], [test "x$socket_needs_socket" = "xyes"])
 AM_CONDITIONAL([BUILD_WITH_GNULIB], [test "x$socket_needs_gnulib" = "xyes"])
 
 clock_gettime_needs_posix4="no"
 AC_CHECK_FUNCS([clock_gettime],
-  [have_clock_gettime="yes"],
-  [have_clock_gettime="no"]
+[have_clock_gettime="yes"],
+[have_clock_gettime="no"]
 )
 
 if test "x$have_clock_gettime" = "xno"; then
-  AC_CHECK_LIB([rt], [clock_gettime],
-    [
-      clock_gettime_needs_rt="yes"
-      have_clock_gettime="yes"
-    ]
-  )
+AC_CHECK_LIB([rt], [clock_gettime],
+  [
+    clock_gettime_needs_rt="yes"
+    have_clock_gettime="yes"
+  ]
+)
 fi
 
 if test "x$have_clock_gettime" = "xno"; then
-  AC_CHECK_LIB([posix4], [clock_gettime],
-    [
-      clock_gettime_needs_posix4="yes"
-      have_clock_gettime="yes"
-    ]
-  )
+AC_CHECK_LIB([posix4], [clock_gettime],
+  [
+    clock_gettime_needs_posix4="yes"
+    have_clock_gettime="yes"
+  ]
+)
 fi
 
 if test "x$have_clock_gettime" = "xyes"; then
-  AC_DEFINE([HAVE_CLOCK_GETTIME], [1], [Define if the clock_gettime(2) function is available.])
+AC_DEFINE([HAVE_CLOCK_GETTIME], [1], [Define if the clock_gettime(2) function is available.])
 fi
 
 AC_CHECK_FUNCS([nanosleep], [],
-  AC_CHECK_LIB([rt], [nanosleep],
-    [nanosleep_needs_rt="yes"],
-    [
-      AC_CHECK_LIB([posix4], [nanosleep],
-        [nanosleep_needs_posix4="yes"],
-        [AC_MSG_ERROR([cannot find nanosleep])]
-      )
-    ]
-  )
+AC_CHECK_LIB([rt], [nanosleep],
+  [nanosleep_needs_rt="yes"],
+  [
+    AC_CHECK_LIB([posix4], [nanosleep],
+      [nanosleep_needs_posix4="yes"],
+      [AC_MSG_ERROR([cannot find nanosleep])]
+    )
+  ]
+)
 )
 
 AM_CONDITIONAL([BUILD_WITH_LIBRT], [test "x$clock_gettime_needs_rt" = "xyes" || test "x$nanosleep_needs_rt" = "xyes"])
@@ -937,73 +937,73 @@ AC_CHECK_FUNCS([thread_info], [have_thread_info="yes"], [have_thread_info="no"])
 
 # Check for strptime {{{
 if test "x$GCC" = "xyes"; then
-  SAVE_CFLAGS="$CFLAGS"
-  CFLAGS="$CFLAGS -Wall -Wextra -Werror"
+SAVE_CFLAGS="$CFLAGS"
+CFLAGS="$CFLAGS -Wall -Wextra -Werror"
 fi
 
 AC_CHECK_FUNCS([strptime], [have_strptime="yes"], [have_strptime="no"])
 if test "x$have_strptime" = "xyes"; then
-  AC_CACHE_CHECK([whether strptime is exported by default],
-    [c_cv_have_strptime_default],
-    [
-      AC_COMPILE_IFELSE(
-        [
-          AC_LANG_PROGRAM(
-            [[#include <time.h>]],
-            [[
-              struct tm stm;
-              (void)strptime ("2010-12-30%13:42:42", "%Y-%m-%dT%T", &stm);
-            ]]
-          )
-        ],
-        [c_cv_have_strptime_default="yes"],
-        [c_cv_have_strptime_default="no"])
-    ]
-  )
+AC_CACHE_CHECK([whether strptime is exported by default],
+  [c_cv_have_strptime_default],
+  [
+    AC_COMPILE_IFELSE(
+      [
+        AC_LANG_PROGRAM(
+          [[#include <time.h>]],
+          [[
+            struct tm stm;
+            (void)strptime ("2010-12-30%13:42:42", "%Y-%m-%dT%T", &stm);
+          ]]
+        )
+      ],
+      [c_cv_have_strptime_default="yes"],
+      [c_cv_have_strptime_default="no"])
+  ]
+)
 fi
 
 if test "x$have_strptime" = "xyes" && test "x$c_cv_have_strptime_default" = "xno"; then
-  AC_CACHE_CHECK([whether strptime needs standards mode],
-    [c_cv_have_strptime_standards],
-    [
-      AC_COMPILE_IFELSE(
-        [
-          AC_LANG_PROGRAM(
-            [[
-              #ifndef _ISOC99_SOURCE
-              # define _ISOC99_SOURCE 1
-              #endif
-              #ifndef _POSIX_C_SOURCE
-              # define _POSIX_C_SOURCE 200112L
-              #endif
-              #ifndef _XOPEN_SOURCE
-              # define _XOPEN_SOURCE 500
-              #endif
-              #include <time.h>
-            ]],
-            [[
-              struct tm stm;
-              (void)strptime ("2010-12-30%13:42:42", "%Y-%m-%dT%T", &stm);
-            ]]
-          )
-        ],
-        [c_cv_have_strptime_standards="yes"],
-        [c_cv_have_strptime_standards="no"]
-      )
-    ]
-  )
-
-  if test "x$c_cv_have_strptime_standards" = "xyes"; then
-    AC_DEFINE([STRPTIME_NEEDS_STANDARDS], [1],
-      [Set to true if strptime is only exported in X/Open mode (GNU libc).]
+AC_CACHE_CHECK([whether strptime needs standards mode],
+  [c_cv_have_strptime_standards],
+  [
+    AC_COMPILE_IFELSE(
+      [
+        AC_LANG_PROGRAM(
+          [[
+            #ifndef _ISOC99_SOURCE
+            # define _ISOC99_SOURCE 1
+            #endif
+            #ifndef _POSIX_C_SOURCE
+            # define _POSIX_C_SOURCE 200112L
+            #endif
+            #ifndef _XOPEN_SOURCE
+            # define _XOPEN_SOURCE 500
+            #endif
+            #include <time.h>
+          ]],
+          [[
+            struct tm stm;
+            (void)strptime ("2010-12-30%13:42:42", "%Y-%m-%dT%T", &stm);
+          ]]
+        )
+      ],
+      [c_cv_have_strptime_standards="yes"],
+      [c_cv_have_strptime_standards="no"]
     )
-  else
-    have_strptime="no"
-  fi
+  ]
+)
+
+if test "x$c_cv_have_strptime_standards" = "xyes"; then
+  AC_DEFINE([STRPTIME_NEEDS_STANDARDS], [1],
+    [Set to true if strptime is only exported in X/Open mode (GNU libc).]
+  )
+else
+  have_strptime="no"
+fi
 fi
 
 if test "x$GCC" = "xyes"; then
-  CFLAGS="$SAVE_CFLAGS"
+CFLAGS="$SAVE_CFLAGS"
 fi
 # }}} Check for strptime
 
@@ -1015,9 +1015,9 @@ SAVE_CFLAGS="$CFLAGS"
 CFLAGS="$CFLAGS -Werror"
 
 AC_CACHE_CHECK([for timegm],
-  [c_cv_have_timegm],
-  AC_LINK_IFELSE(
-    [AC_LANG_PROGRAM(
+[c_cv_have_timegm],
+AC_LINK_IFELSE(
+  [AC_LANG_PROGRAM(
 [[[
 #if STRPTIME_NEEDS_STANDARDS
 # ifndef _ISOC99_SOURCE
@@ -1033,23 +1033,23 @@ AC_CACHE_CHECK([for timegm],
 #include <time.h>
 ]]],
 [[[
- time_t t = timegm(&(struct tm){0});
- if (t == ((time_t) -1)) {
-   return 1;
- }
+time_t t = timegm(&(struct tm){0});
+if (t == ((time_t) -1)) {
+  return 1;
+}
 ]]]
-    )],
-    [c_cv_have_timegm="yes"],
-    [c_cv_have_timegm="no"]
-  )
+  )],
+  [c_cv_have_timegm="yes"],
+  [c_cv_have_timegm="no"]
+)
 )
 
 if test "x$c_cv_have_timegm" != "xyes"
 then
-  AC_CACHE_CHECK([for timegm with _BSD_SOURCE],
-    [c_cv_have_timegm_bsd],
-    AC_LINK_IFELSE(
-      [AC_LANG_PROGRAM(
+AC_CACHE_CHECK([for timegm with _BSD_SOURCE],
+  [c_cv_have_timegm_bsd],
+  AC_LINK_IFELSE(
+    [AC_LANG_PROGRAM(
 [[[
 #if STRPTIME_NEEDS_STANDARDS
 # ifndef _ISOC99_SOURCE
@@ -1068,26 +1068,26 @@ then
 #include <time.h>
 ]]],
 [[[
- time_t t = timegm(&(struct tm){0});
- if (t == ((time_t) -1)) {
-   return 1;
- }
+time_t t = timegm(&(struct tm){0});
+if (t == ((time_t) -1)) {
+  return 1;
+}
 ]]]
-      )],
-      [c_cv_have_timegm_bsd="yes"
-       c_cv_have_timegm="yes"],
-      [c_cv_have_timegm_bsd="no"]
-    )
+    )],
+    [c_cv_have_timegm_bsd="yes"
+      c_cv_have_timegm="yes"],
+    [c_cv_have_timegm_bsd="no"]
   )
+)
 fi
 
 if test "x$c_cv_have_timegm" = "xyes"
 then
-  AC_DEFINE(HAVE_TIMEGM, 1, [Define if the timegm(3) function is available.])
-  if test "x$c_cv_have_timegm_bsd" = "xyes"
-  then
-    AC_DEFINE(TIMEGM_NEEDS_BSD, 1, [Set to true if timegm is only exported in BSD mode.])
-  fi
+AC_DEFINE(HAVE_TIMEGM, 1, [Define if the timegm(3) function is available.])
+if test "x$c_cv_have_timegm_bsd" = "xyes"
+then
+  AC_DEFINE(TIMEGM_NEEDS_BSD, 1, [Set to true if timegm is only exported in BSD mode.])
+fi
 fi
 
 CFLAGS="$SAVE_CFLAGS"
@@ -1095,457 +1095,457 @@ CFLAGS="$SAVE_CFLAGS"
 
 AC_MSG_CHECKING([for sysctl kern.cp_times])
 if test -x /sbin/sysctl; then
-  /sbin/sysctl kern.cp_times >/dev/null 2>&1
-  if test $? -eq 0; then
-    AC_MSG_RESULT([yes])
-    AC_DEFINE([HAVE_SYSCTL_KERN_CP_TIMES], [1], [Define if sysctl supports kern.cp_times])
-  else
-    AC_MSG_RESULT([no])
-  fi
+/sbin/sysctl kern.cp_times >/dev/null 2>&1
+if test $? -eq 0; then
+  AC_MSG_RESULT([yes])
+  AC_DEFINE([HAVE_SYSCTL_KERN_CP_TIMES], [1], [Define if sysctl supports kern.cp_times])
 else
   AC_MSG_RESULT([no])
 fi
+else
+AC_MSG_RESULT([no])
+fi
 
 AC_MSG_CHECKING([for sysctl kern.cp_time])
 if test -x /sbin/sysctl; then
-  /sbin/sysctl kern.cp_time >/dev/null 2>&1
-  if test $? -eq 0
-  then
-    AC_MSG_RESULT([yes])
-    AC_DEFINE([HAVE_SYSCTL_KERN_CP_TIME], [1], [Define if sysctl supports kern.cp_time])
-  else
-    AC_MSG_RESULT([no])
-  fi
+/sbin/sysctl kern.cp_time >/dev/null 2>&1
+if test $? -eq 0
+then
+  AC_MSG_RESULT([yes])
+  AC_DEFINE([HAVE_SYSCTL_KERN_CP_TIME], [1], [Define if sysctl supports kern.cp_time])
 else
   AC_MSG_RESULT([no])
 fi
+else
+AC_MSG_RESULT([no])
+fi
 
 AC_CHECK_FUNCS([swapctl], [have_swapctl="yes"], [have_swapctl="no"])
 if test "x$have_swapctl" = "xyes"; then
-  AC_CACHE_CHECK([whether swapctl takes two arguments],
-    [c_cv_have_swapctl_two_args],
-    [
-      AC_COMPILE_IFELSE(
-        [
-          AC_LANG_PROGRAM(
-            [[
-              #if HAVE_SYS_SWAP_H && !defined(_LP64) && _FILE_OFFSET_BITS == 64
-              #  undef _FILE_OFFSET_BITS
-              #  undef _LARGEFILE64_SOURCE
-              #endif
-              #include <sys/stat.h>
-              #include <sys/param.h>
-              #include <sys/swap.h>
-              #include <unistd.h>
-            ]],
-            [[int num = swapctl(0, NULL);]]
-          )
-        ],
-        [c_cv_have_swapctl_two_args="yes"],
-        [c_cv_have_swapctl_two_args="no"]
-      )
-    ]
-  )
+AC_CACHE_CHECK([whether swapctl takes two arguments],
+  [c_cv_have_swapctl_two_args],
+  [
+    AC_COMPILE_IFELSE(
+      [
+        AC_LANG_PROGRAM(
+          [[
+            #if HAVE_SYS_SWAP_H && !defined(_LP64) && _FILE_OFFSET_BITS == 64
+            #  undef _FILE_OFFSET_BITS
+            #  undef _LARGEFILE64_SOURCE
+            #endif
+            #include <sys/stat.h>
+            #include <sys/param.h>
+            #include <sys/swap.h>
+            #include <unistd.h>
+          ]],
+          [[int num = swapctl(0, NULL);]]
+        )
+      ],
+      [c_cv_have_swapctl_two_args="yes"],
+      [c_cv_have_swapctl_two_args="no"]
+    )
+  ]
+)
 
-  AC_CACHE_CHECK([whether swapctl takes three arguments],
-    [c_cv_have_swapctl_three_args],
-    [
-      AC_COMPILE_IFELSE(
-        [
-          AC_LANG_PROGRAM(
-            [[
-              #if HAVE_SYS_SWAP_H && !defined(_LP64) && _FILE_OFFSET_BITS == 64
-              #  undef _FILE_OFFSET_BITS
-              #  undef _LARGEFILE64_SOURCE
-              #endif
-              #include <sys/stat.h>
-              #include <sys/param.h>
-              #include <sys/swap.h>
-              #include <unistd.h>
-            ]],
-            [[int num = swapctl(0, NULL, 0);]]
-          )
-        ],
-        [c_cv_have_swapctl_three_args="yes"],
-        [c_cv_have_swapctl_three_args="no"]
-      )
-    ]
-  )
+AC_CACHE_CHECK([whether swapctl takes three arguments],
+  [c_cv_have_swapctl_three_args],
+  [
+    AC_COMPILE_IFELSE(
+      [
+        AC_LANG_PROGRAM(
+          [[
+            #if HAVE_SYS_SWAP_H && !defined(_LP64) && _FILE_OFFSET_BITS == 64
+            #  undef _FILE_OFFSET_BITS
+            #  undef _LARGEFILE64_SOURCE
+            #endif
+            #include <sys/stat.h>
+            #include <sys/param.h>
+            #include <sys/swap.h>
+            #include <unistd.h>
+          ]],
+          [[int num = swapctl(0, NULL, 0);]]
+        )
+      ],
+      [c_cv_have_swapctl_three_args="yes"],
+      [c_cv_have_swapctl_three_args="no"]
+    )
+  ]
+)
 fi
 
 # Check for different versions of `swapctl' here..
 if test "x$have_swapctl" = "xyes"; then
-  if test "x$c_cv_have_swapctl_two_args" = "xyes"; then
-    AC_DEFINE([HAVE_SWAPCTL_TWO_ARGS], [1], [Define if the function swapctl exists and takes two arguments.])
-  fi
+if test "x$c_cv_have_swapctl_two_args" = "xyes"; then
+  AC_DEFINE([HAVE_SWAPCTL_TWO_ARGS], [1], [Define if the function swapctl exists and takes two arguments.])
+fi
 
-  if test "x$c_cv_have_swapctl_three_args" = "xyes"; then
-    AC_DEFINE([HAVE_SWAPCTL_THREE_ARGS], [1], [Define if the function swapctl exists and takes three arguments.])
-  fi
+if test "x$c_cv_have_swapctl_three_args" = "xyes"; then
+  AC_DEFINE([HAVE_SWAPCTL_THREE_ARGS], [1], [Define if the function swapctl exists and takes three arguments.])
+fi
 fi
 
 # Check for NAN
 AC_ARG_WITH([nan-emulation],
-  [AS_HELP_STRING([--with-nan-emulation], [use emulated NAN. For crosscompiling only.])],
-  [
-    if test "x$withval" = "xno"; then
-      nan_type="none"
-    else if test "x$withval" = "xyes"; then
-      nan_type="zero"
-    else
-      nan_type="$withval"
-    fi; fi
-  ],
-  [nan_type="none"]
+[AS_HELP_STRING([--with-nan-emulation], [use emulated NAN. For crosscompiling only.])],
+[
+  if test "x$withval" = "xno"; then
+    nan_type="none"
+  else if test "x$withval" = "xyes"; then
+    nan_type="zero"
+  else
+    nan_type="$withval"
+  fi; fi
+],
+[nan_type="none"]
 )
 
 if test "x$nan_type" = "xnone"; then
-  AC_CACHE_CHECK([whether NAN is defined by default],
-    [c_cv_have_nan_default],
-    [
-      AC_COMPILE_IFELSE(
-        [
-          AC_LANG_PROGRAM(
-            [[
-              #include <stdlib.h>
-              #include <math.h>
-              static double foo = NAN;
-            ]],
-            [[
-              if (isnan (foo))
-                return 0;
-              return 1;
-            ]]
-          )
-        ],
-        [c_cv_have_nan_default="yes"],
-        [c_cv_have_nan_default="no"]
-      )
-    ]
-  )
+AC_CACHE_CHECK([whether NAN is defined by default],
+  [c_cv_have_nan_default],
+  [
+    AC_COMPILE_IFELSE(
+      [
+        AC_LANG_PROGRAM(
+          [[
+            #include <stdlib.h>
+            #include <math.h>
+            static double foo = NAN;
+          ]],
+          [[
+            if (isnan (foo))
+              return 0;
+            return 1;
+          ]]
+        )
+      ],
+      [c_cv_have_nan_default="yes"],
+      [c_cv_have_nan_default="no"]
+    )
+  ]
+)
 fi
 
 if test "x$c_cv_have_nan_default" = "xyes"; then
-  nan_type="default"
+nan_type="default"
 fi
 
 if test "x$nan_type" = "xnone"; then
-  AC_CACHE_CHECK([whether NAN is defined by __USE_ISOC99],
-    [c_cv_have_nan_isoc],
-    [
-      AC_COMPILE_IFELSE(
-        [
-          AC_LANG_PROGRAM(
-            [[
-              #include <stdlib.h>
-              #define __USE_ISOC99 1
-              #include <math.h>
-              static double foo = NAN;
-            ]],
-            [[
-              if (isnan (foo))
-                return 0;
-              return 1;
-            ]]
-          )
-        ],
-        [c_cv_have_nan_isoc="yes"],
-        [c_cv_have_nan_isoc="no"]
-      )
-    ]
-  )
+AC_CACHE_CHECK([whether NAN is defined by __USE_ISOC99],
+  [c_cv_have_nan_isoc],
+  [
+    AC_COMPILE_IFELSE(
+      [
+        AC_LANG_PROGRAM(
+          [[
+            #include <stdlib.h>
+            #define __USE_ISOC99 1
+            #include <math.h>
+            static double foo = NAN;
+          ]],
+          [[
+            if (isnan (foo))
+              return 0;
+            return 1;
+          ]]
+        )
+      ],
+      [c_cv_have_nan_isoc="yes"],
+      [c_cv_have_nan_isoc="no"]
+    )
+  ]
+)
 fi
 
 if test "x$c_cv_have_nan_isoc" = "xyes"; then
-  nan_type="isoc99"
+nan_type="isoc99"
 fi
 
 if test "x$nan_type" = "xnone"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS -lm"
-  AC_CACHE_CHECK([whether NAN can be defined by 0/0],
-    [c_cv_have_nan_zero],
-    [
-      AC_RUN_IFELSE(
-        [
-          AC_LANG_PROGRAM(
-            [[
-              #include <stdlib.h>
-              #include <math.h>
-              #ifdef NAN
-              # undef NAN
-              #endif
-              #define NAN (0.0 / 0.0)
-              #ifndef isnan
-              # define isnan(f) ((f) != (f))
-              #endif
-              static double foo = NAN;
-            ]],
-            [[
-              if (isnan (foo))
-                return 0;
-              return 1;
-            ]]
-          )
-        ],
-        [c_cv_have_nan_zero="yes"],
-        [c_cv_have_nan_zero="no"]
-      )
-    ]
-  )
-  LDFLAGS=$SAVE_LDFLAGS
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS -lm"
+AC_CACHE_CHECK([whether NAN can be defined by 0/0],
+  [c_cv_have_nan_zero],
+  [
+    AC_RUN_IFELSE(
+      [
+        AC_LANG_PROGRAM(
+          [[
+            #include <stdlib.h>
+            #include <math.h>
+            #ifdef NAN
+            # undef NAN
+            #endif
+            #define NAN (0.0 / 0.0)
+            #ifndef isnan
+            # define isnan(f) ((f) != (f))
+            #endif
+            static double foo = NAN;
+          ]],
+          [[
+            if (isnan (foo))
+              return 0;
+            return 1;
+          ]]
+        )
+      ],
+      [c_cv_have_nan_zero="yes"],
+      [c_cv_have_nan_zero="no"]
+    )
+  ]
+)
+LDFLAGS=$SAVE_LDFLAGS
 fi
 
 if test "x$c_cv_have_nan_zero" = "xyes"; then
-  nan_type="zero"
+nan_type="zero"
 fi
 
 if test "x$nan_type" = "xdefault"; then
-  AC_DEFINE([NAN_STATIC_DEFAULT], [1],
-    [Define if NAN is defined by default and can initialize static variables.]
-  )
+AC_DEFINE([NAN_STATIC_DEFAULT], [1],
+  [Define if NAN is defined by default and can initialize static variables.]
+)
 else if test "x$nan_type" = "xisoc99"; then
-  AC_DEFINE([NAN_STATIC_ISOC], [1],
-    [Define if NAN is defined by __USE_ISOC99 and can initialize static variables.]
-  )
+AC_DEFINE([NAN_STATIC_ISOC], [1],
+  [Define if NAN is defined by __USE_ISOC99 and can initialize static variables.]
+)
 else if test "x$nan_type" = "xzero"; then
-  AC_DEFINE([NAN_ZERO_ZERO], [1],
-    [Define if NAN can be defined as (0.0 / 0.0)]
-  )
+AC_DEFINE([NAN_ZERO_ZERO], [1],
+  [Define if NAN can be defined as (0.0 / 0.0)]
+)
 else
-  AC_MSG_ERROR([Didn't find out how to statically initialize variables to NAN. Sorry.])
+AC_MSG_ERROR([Didn't find out how to statically initialize variables to NAN. Sorry.])
 fi; fi; fi
 
 AC_ARG_WITH([fp-layout],
-  [
-    AS_HELP_STRING([--with-fp-layout],
-      [set the memory layout of doubles. For crosscompiling only.]
-    )
-  ],
-  [
-    if test "x$withval" = "xnothing"; then
-      fp_layout_type="nothing"
-    else if test "x$withval" = "xendianflip"; then
-      fp_layout_type="endianflip"
-    else if test "x$withval" = "xintswap"; then
-      fp_layout_type="intswap"
-    else
-      AC_MSG_ERROR([Invalid argument for --with-fp-layout. Valid arguments are: nothing, endianflip, intswap]);
-    fi; fi; fi
-  ],
-  [fp_layout_type="unknown"]
+[
+  AS_HELP_STRING([--with-fp-layout],
+    [set the memory layout of doubles. For crosscompiling only.]
+  )
+],
+[
+  if test "x$withval" = "xnothing"; then
+    fp_layout_type="nothing"
+  else if test "x$withval" = "xendianflip"; then
+    fp_layout_type="endianflip"
+  else if test "x$withval" = "xintswap"; then
+    fp_layout_type="intswap"
+  else
+    AC_MSG_ERROR([Invalid argument for --with-fp-layout. Valid arguments are: nothing, endianflip, intswap]);
+  fi; fi; fi
+],
+[fp_layout_type="unknown"]
 )
 
 if test "x$fp_layout_type" = "xunknown"; then
-  AC_CACHE_CHECK([if doubles are stored in x86 representation],
-    [c_cv_fp_layout_need_nothing],
-    [
-      AC_RUN_IFELSE(
-        [
-          AC_LANG_PROGRAM(
-            [[
-              #include <stdlib.h>
-              #include <stdio.h>
-              #include <string.h>
-              #include <stdint.h>
-              #include <inttypes.h>
-              #include <stdbool.h>
-            ]],
-            [[
-              uint64_t i0;
-              uint64_t i1;
-              uint8_t c[8];
-              double d;
-
-              d = 8.642135e130;
-              memcpy ((void *) &i0, (void *) &d, 8);
-
-              i1 = i0;
-              memcpy ((void *) c, (void *) &i1, 8);
-
-              if ((c[0] == 0x2f) && (c[1] == 0x25)
-                  && (c[2] == 0xc0) && (c[3] == 0xc7)
-                  && (c[4] == 0x43) && (c[5] == 0x2b)
-                  && (c[6] == 0x1f) && (c[7] == 0x5b))
-                return 0;
-              return 1;
-            ]]
-          )
-        ],
-        [c_cv_fp_layout_need_nothing="yes"],
-        [c_cv_fp_layout_need_nothing="no"]
-      )
-    ]
-  )
+AC_CACHE_CHECK([if doubles are stored in x86 representation],
+  [c_cv_fp_layout_need_nothing],
+  [
+    AC_RUN_IFELSE(
+      [
+        AC_LANG_PROGRAM(
+          [[
+            #include <stdlib.h>
+            #include <stdio.h>
+            #include <string.h>
+            #include <stdint.h>
+            #include <inttypes.h>
+            #include <stdbool.h>
+          ]],
+          [[
+            uint64_t i0;
+            uint64_t i1;
+            uint8_t c[8];
+            double d;
+
+            d = 8.642135e130;
+            memcpy ((void *) &i0, (void *) &d, 8);
+
+            i1 = i0;
+            memcpy ((void *) c, (void *) &i1, 8);
+
+            if ((c[0] == 0x2f) && (c[1] == 0x25)
+                && (c[2] == 0xc0) && (c[3] == 0xc7)
+                && (c[4] == 0x43) && (c[5] == 0x2b)
+                && (c[6] == 0x1f) && (c[7] == 0x5b))
+              return 0;
+            return 1;
+          ]]
+        )
+      ],
+      [c_cv_fp_layout_need_nothing="yes"],
+      [c_cv_fp_layout_need_nothing="no"]
+    )
+  ]
+)
 fi
 
 if test "x$c_cv_fp_layout_need_nothing" = "xyes"; then
-  fp_layout_type="nothing"
+fp_layout_type="nothing"
 fi
 
 if test "x$fp_layout_type" = "xunknown"; then
-  AC_CACHE_CHECK([if endianflip converts to x86 representation],
-    [c_cv_fp_layout_need_endianflip],
-    [
-      AC_RUN_IFELSE(
-        [
-          AC_LANG_PROGRAM(
-            [[
-              #include <stdlib.h>
-              #include <stdio.h>
-              #include <string.h>
-              #include <stdint.h>
-              #include <inttypes.h>
-              #include <stdbool.h>
-              #define endianflip(A) ((((uint64_t)(A) & 0xff00000000000000LL) >> 56) | \
-                                     (((uint64_t)(A) & 0x00ff000000000000LL) >> 40) | \
-                                     (((uint64_t)(A) & 0x0000ff0000000000LL) >> 24) | \
-                                     (((uint64_t)(A) & 0x000000ff00000000LL) >> 8)  | \
-                                     (((uint64_t)(A) & 0x00000000ff000000LL) << 8)  | \
-                                     (((uint64_t)(A) & 0x0000000000ff0000LL) << 24) | \
-                                     (((uint64_t)(A) & 0x000000000000ff00LL) << 40) | \
-                                     (((uint64_t)(A) & 0x00000000000000ffLL) << 56))
-            ]],
-            [[
-              uint64_t i0;
-              uint64_t i1;
-              uint8_t c[8];
-              double d;
-
-              d = 8.642135e130;
-              memcpy ((void *) &i0, (void *) &d, 8);
-
-              i1 = endianflip (i0);
-              memcpy ((void *) c, (void *) &i1, 8);
-
-              if ((c[0] == 0x2f) && (c[1] == 0x25)
-                  && (c[2] == 0xc0) && (c[3] == 0xc7)
-                  && (c[4] == 0x43) && (c[5] == 0x2b)
-                  && (c[6] == 0x1f) && (c[7] == 0x5b))
-                return 0;
-              return 1;
-            ]]
-          )
-        ],
-        [c_cv_fp_layout_need_endianflip="yes"],
-        [c_cv_fp_layout_need_endianflip="no"]
-      ]
-    )
+AC_CACHE_CHECK([if endianflip converts to x86 representation],
+  [c_cv_fp_layout_need_endianflip],
+  [
+    AC_RUN_IFELSE(
+      [
+        AC_LANG_PROGRAM(
+          [[
+            #include <stdlib.h>
+            #include <stdio.h>
+            #include <string.h>
+            #include <stdint.h>
+            #include <inttypes.h>
+            #include <stdbool.h>
+            #define endianflip(A) ((((uint64_t)(A) & 0xff00000000000000LL) >> 56) | \
+                                    (((uint64_t)(A) & 0x00ff000000000000LL) >> 40) | \
+                                    (((uint64_t)(A) & 0x0000ff0000000000LL) >> 24) | \
+                                    (((uint64_t)(A) & 0x000000ff00000000LL) >> 8)  | \
+                                    (((uint64_t)(A) & 0x00000000ff000000LL) << 8)  | \
+                                    (((uint64_t)(A) & 0x0000000000ff0000LL) << 24) | \
+                                    (((uint64_t)(A) & 0x000000000000ff00LL) << 40) | \
+                                    (((uint64_t)(A) & 0x00000000000000ffLL) << 56))
+          ]],
+          [[
+            uint64_t i0;
+            uint64_t i1;
+            uint8_t c[8];
+            double d;
+
+            d = 8.642135e130;
+            memcpy ((void *) &i0, (void *) &d, 8);
+
+            i1 = endianflip (i0);
+            memcpy ((void *) c, (void *) &i1, 8);
+
+            if ((c[0] == 0x2f) && (c[1] == 0x25)
+                && (c[2] == 0xc0) && (c[3] == 0xc7)
+                && (c[4] == 0x43) && (c[5] == 0x2b)
+                && (c[6] == 0x1f) && (c[7] == 0x5b))
+              return 0;
+            return 1;
+          ]]
+        )
+      ],
+      [c_cv_fp_layout_need_endianflip="yes"],
+      [c_cv_fp_layout_need_endianflip="no"]
+    ]
   )
+)
 fi
 
 if test "x$c_cv_fp_layout_need_endianflip" = "xyes"; then
-  fp_layout_type="endianflip"
+fp_layout_type="endianflip"
 fi
 
 if test "x$fp_layout_type" = "xunknown"; then
-  AC_CACHE_CHECK([if intswap converts to x86 representation],
-    [c_cv_fp_layout_need_intswap],
-    [
-      AC_RUN_IFELSE(
-        [
-          AC_LANG_PROGRAM(
-            [[
-              #include <stdlib.h>
-              #include <stdio.h>
-              #include <string.h>
-              #include <stdint.h>
-              #include <inttypes.h>
-              #include <stdbool.h>
-              #define intswap(A)    ((((uint64_t)(A) & 0xffffffff00000000LL) >> 32) | \
-                                     (((uint64_t)(A) & 0x00000000ffffffffLL) << 32))
-            ]],
-            [[
-              uint64_t i0;
-              uint64_t i1;
-              uint8_t c[8];
-              double d;
-
-              d = 8.642135e130;
-              memcpy ((void *) &i0, (void *) &d, 8);
-
-              i1 = intswap (i0);
-              memcpy ((void *) c, (void *) &i1, 8);
-
-              if ((c[0] == 0x2f) && (c[1] == 0x25)
-                  && (c[2] == 0xc0) && (c[3] == 0xc7)
-                  && (c[4] == 0x43) && (c[5] == 0x2b)
-                  && (c[6] == 0x1f) && (c[7] == 0x5b))
-                return 0;
-              return 1;
-            ]]
-          )
-        ],
-        [c_cv_fp_layout_need_intswap="yes"],
-        [c_cv_fp_layout_need_intswap="no"]
-      )
-    ]
-  )
+AC_CACHE_CHECK([if intswap converts to x86 representation],
+  [c_cv_fp_layout_need_intswap],
+  [
+    AC_RUN_IFELSE(
+      [
+        AC_LANG_PROGRAM(
+          [[
+            #include <stdlib.h>
+            #include <stdio.h>
+            #include <string.h>
+            #include <stdint.h>
+            #include <inttypes.h>
+            #include <stdbool.h>
+            #define intswap(A)    ((((uint64_t)(A) & 0xffffffff00000000LL) >> 32) | \
+                                    (((uint64_t)(A) & 0x00000000ffffffffLL) << 32))
+          ]],
+          [[
+            uint64_t i0;
+            uint64_t i1;
+            uint8_t c[8];
+            double d;
+
+            d = 8.642135e130;
+            memcpy ((void *) &i0, (void *) &d, 8);
+
+            i1 = intswap (i0);
+            memcpy ((void *) c, (void *) &i1, 8);
+
+            if ((c[0] == 0x2f) && (c[1] == 0x25)
+                && (c[2] == 0xc0) && (c[3] == 0xc7)
+                && (c[4] == 0x43) && (c[5] == 0x2b)
+                && (c[6] == 0x1f) && (c[7] == 0x5b))
+              return 0;
+            return 1;
+          ]]
+        )
+      ],
+      [c_cv_fp_layout_need_intswap="yes"],
+      [c_cv_fp_layout_need_intswap="no"]
+    )
+  ]
+)
 fi
 
 if test "x$c_cv_fp_layout_need_intswap" = "xyes"; then
-  fp_layout_type="intswap"
+fp_layout_type="intswap"
 fi
 
 if test "x$fp_layout_type" = "xnothing"; then
-  AC_DEFINE([FP_LAYOUT_NEED_NOTHING], [1],
-    [Define if doubles are stored in x86 representation.]
-  )
+AC_DEFINE([FP_LAYOUT_NEED_NOTHING], [1],
+  [Define if doubles are stored in x86 representation.]
+)
 else if test "x$fp_layout_type" = "xendianflip"; then
-  AC_DEFINE([FP_LAYOUT_NEED_ENDIANFLIP], [1],
-    [Define if endianflip is needed to convert to x86 representation.]
-  )
+AC_DEFINE([FP_LAYOUT_NEED_ENDIANFLIP], [1],
+  [Define if endianflip is needed to convert to x86 representation.]
+)
 else if test "x$fp_layout_type" = "xintswap"; then
-  AC_DEFINE([FP_LAYOUT_NEED_INTSWAP], [1],
-    [Define if intswap is needed to convert to x86 representation.]
-  )
+AC_DEFINE([FP_LAYOUT_NEED_INTSWAP], [1],
+  [Define if intswap is needed to convert to x86 representation.]
+)
 else
-  AC_MSG_ERROR([Didn't find out how doubles are stored in memory. Sorry.])
+AC_MSG_ERROR([Didn't find out how doubles are stored in memory. Sorry.])
 fi; fi; fi
 
 # For cpusleep plugin
 AC_CACHE_CHECK([whether clock_boottime and clock_monotonic are supported],
-  [c_cv_have_clock_boottime_monotonic],
-  [
-    AC_COMPILE_IFELSE(
-      [AC_LANG_PROGRAM(
-        [[#include <time.h>]],
-        [[
-          struct timespec b, m;
-          clock_gettime(CLOCK_BOOTTIME, &b );
-          clock_gettime(CLOCK_MONOTONIC, &m );
-        ]]
-      )
-      ],
-      [c_cv_have_clock_boottime_monotonic="yes"],
-      [c_cv_have_clock_boottime_monotonic="no"]
+[c_cv_have_clock_boottime_monotonic],
+[
+  AC_COMPILE_IFELSE(
+    [AC_LANG_PROGRAM(
+      [[#include <time.h>]],
+      [[
+        struct timespec b, m;
+        clock_gettime(CLOCK_BOOTTIME, &b );
+        clock_gettime(CLOCK_MONOTONIC, &m );
+      ]]
     )
-  ]
+    ],
+    [c_cv_have_clock_boottime_monotonic="yes"],
+    [c_cv_have_clock_boottime_monotonic="no"]
+  )
+]
 )
 
 # --with-useragent {{{
 AC_ARG_WITH([useragent],
-  [AS_HELP_STRING([--with-useragent@<:@=AGENT@:>@], [User agent to use on http requests])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      AC_DEFINE_UNQUOTED([COLLECTD_USERAGENT], ["$withval"], [User agent for http requests])
-    fi
-  ]
+[AS_HELP_STRING([--with-useragent@<:@=AGENT@:>@], [User agent to use on http requests])],
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    AC_DEFINE_UNQUOTED([COLLECTD_USERAGENT], ["$withval"], [User agent for http requests])
+  fi
+]
 )
 
 # }}}
 
 # --with-data-max-name-len {{{
 AC_ARG_WITH([data-max-name-len],
-  [AS_HELP_STRING([--with-data-max-name-len@<:@=VALUE@:>@], [Maximum length of data buffers])],
-  [
-    if test "x$withval" != "x" && test $withval -gt 0; then
-      AC_DEFINE_UNQUOTED([DATA_MAX_NAME_LEN], [$withval], [Maximum length of data buffers])
-    else
-      AC_MSG_ERROR([DATA_MAX_NAME_LEN must be a positive integer -- $withval given])
-    fi
-  ],
-  [AC_DEFINE([DATA_MAX_NAME_LEN], [128], [Maximum length of data buffers])]
+[AS_HELP_STRING([--with-data-max-name-len@<:@=VALUE@:>@], [Maximum length of data buffers])],
+[
+  if test "x$withval" != "x" && test $withval -gt 0; then
+    AC_DEFINE_UNQUOTED([DATA_MAX_NAME_LEN], [$withval], [Maximum length of data buffers])
+  else
+    AC_MSG_ERROR([DATA_MAX_NAME_LEN must be a positive integer -- $withval given])
+  fi
+],
+[AC_DEFINE([DATA_MAX_NAME_LEN], [128], [Maximum length of data buffers])]
 )
 # }}}
 
@@ -1556,256 +1556,256 @@ AC_CHECK_FUNCS(getmntent_r, [have_getmntent_r="yes"], [have_getmntent_r="no"])
 
 AC_CHECK_FUNCS(getmntent, [have_getmntent="libc"], [have_getmntent="no"])
 if test "x$have_getmntent" = "xno"; then
-  AC_CHECK_LIB([sun], [getmntent],
-    [have_getmntent="sun"],
-    [have_gemntent="no"]
-  )
+AC_CHECK_LIB([sun], [getmntent],
+  [have_getmntent="sun"],
+  [have_gemntent="no"]
+)
 fi
 
 if test "x$have_getmntent" = "xno"; then
-  AC_CHECK_LIB([seq], [getmntent],
-    [have_getmntent="seq"],
-    [have_getmntent="no"]
-  )
+AC_CHECK_LIB([seq], [getmntent],
+  [have_getmntent="seq"],
+  [have_getmntent="no"]
+)
+fi
+
+if test "x$have_getmntent" = "xno"; then
+AC_CHECK_LIB([gen], [getmntent],
+  [have_getmntent="gen"],
+  [have_getmntent="no"]
+)
 fi
 
-if test "x$have_getmntent" = "xno"; then
-  AC_CHECK_LIB([gen], [getmntent],
-    [have_getmntent="gen"],
-    [have_getmntent="no"]
-  )
+if test "x$have_getmntent" = "xlibc"; then
+AC_CACHE_CHECK([whether getmntent takes one argument],
+  [c_cv_have_one_getmntent],
+  [
+    AC_COMPILE_IFELSE(
+      [
+        AC_LANG_PROGRAM(
+          [[#include "$srcdir/src/utils/mount/mount.h"]],
+          [[
+            FILE *fh;
+            struct mntent *me;
+            fh = setmntent ("/etc/mtab", "r");
+            me = getmntent (fh);
+            return me->mnt_passno;
+          ]]
+        )
+      ],
+      [c_cv_have_one_getmntent="yes"],
+      [c_cv_have_one_getmntent="no"]
+    )
+  ]
+)
+
+AC_CACHE_CHECK([whether getmntent takes two arguments],
+  [c_cv_have_two_getmntent],
+  [
+    AC_COMPILE_IFELSE(
+      [
+        AC_LANG_PROGRAM(
+          [[#include "$srcdir/src/utils/mount/mount.h"]],
+          [[
+            FILE *fh;
+            struct mnttab mt;
+            int status;
+            fh = fopen ("/etc/mnttab", "r");
+            status = getmntent (fh, &mt);
+            return status;
+          ]]
+        )
+      ],
+      [c_cv_have_two_getmntent="yes"],
+      [c_cv_have_two_getmntent="no"]
+    )
+  ]
+)
 fi
 
+# Check for different versions of `getmntent' here..
+
 if test "x$have_getmntent" = "xlibc"; then
-  AC_CACHE_CHECK([whether getmntent takes one argument],
-    [c_cv_have_one_getmntent],
-    [
-      AC_COMPILE_IFELSE(
-        [
-          AC_LANG_PROGRAM(
-            [[#include "$srcdir/src/utils/mount/mount.h"]],
-            [[
-              FILE *fh;
-              struct mntent *me;
-              fh = setmntent ("/etc/mtab", "r");
-              me = getmntent (fh);
-              return me->mnt_passno;
-            ]]
-          )
-        ],
-        [c_cv_have_one_getmntent="yes"],
-        [c_cv_have_one_getmntent="no"]
-      )
-    ]
+if test "x$c_cv_have_one_getmntent" = "xyes"; then
+  AC_DEFINE([HAVE_ONE_GETMNTENT], [1],
+    [Define if the function getmntent exists and takes one argument.]
   )
+fi
 
-  AC_CACHE_CHECK([whether getmntent takes two arguments],
-    [c_cv_have_two_getmntent],
-    [
-      AC_COMPILE_IFELSE(
-        [
-          AC_LANG_PROGRAM(
-            [[#include "$srcdir/src/utils/mount/mount.h"]],
-            [[
-              FILE *fh;
-              struct mnttab mt;
-              int status;
-              fh = fopen ("/etc/mnttab", "r");
-              status = getmntent (fh, &mt);
-              return status;
-            ]]
-          )
-        ],
-        [c_cv_have_two_getmntent="yes"],
-        [c_cv_have_two_getmntent="no"]
-      )
-    ]
+if test "x$c_cv_have_two_getmntent" = "xyes"; then
+  AC_DEFINE([HAVE_TWO_GETMNTENT], [1],
+    [Define if the function getmntent exists and takes two arguments.]
   )
 fi
-
-# Check for different versions of `getmntent' here..
-
-if test "x$have_getmntent" = "xlibc"; then
-  if test "x$c_cv_have_one_getmntent" = "xyes"; then
-    AC_DEFINE([HAVE_ONE_GETMNTENT], [1],
-      [Define if the function getmntent exists and takes one argument.]
-    )
-  fi
-
-  if test "x$c_cv_have_two_getmntent" = "xyes"; then
-    AC_DEFINE([HAVE_TWO_GETMNTENT], [1],
-      [Define if the function getmntent exists and takes two arguments.]
-    )
-  fi
 fi
 
 if test "x$have_getmntent" = "xsun"; then
-  AC_DEFINE([HAVE_SUN_GETMNTENT], [1],
-    [Define if the function getmntent exists. It is the version from libsun.]
-  )
+AC_DEFINE([HAVE_SUN_GETMNTENT], [1],
+  [Define if the function getmntent exists. It is the version from libsun.]
+)
 fi
 
 if test "x$have_getmntent" = "xgen"; then
-  AC_DEFINE([HAVE_GEN_GETMNTENT], [1],
-    [Define if the function getmntent exists. It is the version from libgen.]
-  )
+AC_DEFINE([HAVE_GEN_GETMNTENT], [1],
+  [Define if the function getmntent exists. It is the version from libgen.]
+)
 fi
 
 # Check for htonll
 AC_CACHE_CHECK([whether htonll is defined],
-  [c_cv_have_htonll],
-  [
-    AC_LINK_IFELSE(
-      [
-        AC_LANG_PROGRAM(
-          [[
-            #include <inttypes.h>
-            #include <sys/types.h>
-            #include <netinet/in.h>
-          ]],
-          [[return htonll(0);]]
-        )
-      ],
-      [c_cv_have_htonll="yes"],
-      [c_cv_have_htonll="no"]
-    )
-  ]
+[c_cv_have_htonll],
+[
+  AC_LINK_IFELSE(
+    [
+      AC_LANG_PROGRAM(
+        [[
+          #include <inttypes.h>
+          #include <sys/types.h>
+          #include <netinet/in.h>
+        ]],
+        [[return htonll(0);]]
+      )
+    ],
+    [c_cv_have_htonll="yes"],
+    [c_cv_have_htonll="no"]
+  )
+]
 )
 
 if test "x$c_cv_have_htonll" = "xyes"; then
-  AC_DEFINE([HAVE_HTONLL], [1], [Define if the function htonll exists.])
+AC_DEFINE([HAVE_HTONLL], [1], [Define if the function htonll exists.])
 fi
 
 # Check for structures
 AC_CHECK_MEMBERS([struct if_data.ifi_ibytes, struct if_data.ifi_opackets, struct if_data.ifi_ierrors],
-  [AC_DEFINE([HAVE_STRUCT_IF_DATA], [1], [Define if struct if_data exists and is usable.])],
-  [],
-  [[
-    #include <sys/types.h>
-    #include <sys/socket.h>
-    #include <net/if.h>
-  ]]
+[AC_DEFINE([HAVE_STRUCT_IF_DATA], [1], [Define if struct if_data exists and is usable.])],
+[],
+[[
+  #include <sys/types.h>
+  #include <sys/socket.h>
+  #include <net/if.h>
+]]
 )
 
 AC_CHECK_MEMBERS([struct net_device_stats.rx_bytes, struct net_device_stats.tx_packets, struct net_device_stats.rx_errors],
-  [AC_DEFINE([HAVE_STRUCT_NET_DEVICE_STATS], [1], [Define if struct net_device_stats exists and is usable.])],
-  [],
-  [[
-    #include <sys/types.h>
-    #include <sys/socket.h>
-    #include <linux/if.h>
-    #include <linux/netdevice.h>
-  ]]
+[AC_DEFINE([HAVE_STRUCT_NET_DEVICE_STATS], [1], [Define if struct net_device_stats exists and is usable.])],
+[],
+[[
+  #include <sys/types.h>
+  #include <sys/socket.h>
+  #include <linux/if.h>
+  #include <linux/netdevice.h>
+]]
 )
 
 AC_CHECK_MEMBERS([struct inet_diag_req.id, struct inet_diag_req.idiag_states],
-  [AC_DEFINE([HAVE_STRUCT_LINUX_INET_DIAG_REQ], [1], [Define if struct inet_diag_req exists and is usable.])],
-  [],
-  [[#include <linux/inet_diag.h>]]
+[AC_DEFINE([HAVE_STRUCT_LINUX_INET_DIAG_REQ], [1], [Define if struct inet_diag_req exists and is usable.])],
+[],
+[[#include <linux/inet_diag.h>]]
 )
 
 AC_CHECK_MEMBERS([struct ip_mreqn.imr_ifindex], [],
-  [],
-  [[
-    #include <netinet/in.h>
-    #include <net/if.h>
-  ]]
+[],
+[[
+  #include <netinet/in.h>
+  #include <net/if.h>
+]]
 )
 
 AC_CHECK_MEMBERS([struct kinfo_proc.ki_pid, struct kinfo_proc.ki_rssize, struct kinfo_proc.ki_rusage],
-  [
-    AC_DEFINE([HAVE_STRUCT_KINFO_PROC_FREEBSD], [1], [Define if struct kinfo_proc exists in the FreeBSD variant.])
-    have_struct_kinfo_proc_freebsd="yes"
-  ],
-  [],
-  [[
-    #include <kvm.h>
-    #include <sys/param.h>
-    #include <sys/sysctl.h>
-    #include <sys/user.h>
-  ]]
+[
+  AC_DEFINE([HAVE_STRUCT_KINFO_PROC_FREEBSD], [1], [Define if struct kinfo_proc exists in the FreeBSD variant.])
+  have_struct_kinfo_proc_freebsd="yes"
+],
+[],
+[[
+  #include <kvm.h>
+  #include <sys/param.h>
+  #include <sys/sysctl.h>
+  #include <sys/user.h>
+]]
 )
 
 AC_CHECK_MEMBERS([struct kinfo_proc.p_pid, struct kinfo_proc.p_vm_rssize],
-  [
-    AC_DEFINE([HAVE_STRUCT_KINFO_PROC_OPENBSD], [1], [Define if struct kinfo_proc exists in the OpenBSD variant.])
-    have_struct_kinfo_proc_openbsd="yes"
-  ],
-  [],
-  [[
-    #include <sys/param.h>
-    #include <sys/sysctl.h>
-    #include <kvm.h>
-  ]]
+[
+  AC_DEFINE([HAVE_STRUCT_KINFO_PROC_OPENBSD], [1], [Define if struct kinfo_proc exists in the OpenBSD variant.])
+  have_struct_kinfo_proc_openbsd="yes"
+],
+[],
+[[
+  #include <sys/param.h>
+  #include <sys/sysctl.h>
+  #include <kvm.h>
+]]
 )
 
 AC_CHECK_MEMBERS([struct kinfo_proc2.p_pid, struct kinfo_proc2.p_uru_maxrss],
-  [
-    AC_DEFINE([HAVE_STRUCT_KINFO_PROC2_NETBSD], [1], [Define if struct kinfo_proc2 exists in the NetBSD variant.])
-    have_struct_kinfo_proc2_netbsd="yes"
-  ],
-  [],
-  [[
-    #include <sys/param.h>
-    #include <sys/sysctl.h>
-    #include <kvm.h>
-  ]]
+[
+  AC_DEFINE([HAVE_STRUCT_KINFO_PROC2_NETBSD], [1], [Define if struct kinfo_proc2 exists in the NetBSD variant.])
+  have_struct_kinfo_proc2_netbsd="yes"
+],
+[],
+[[
+  #include <sys/param.h>
+  #include <sys/sysctl.h>
+  #include <kvm.h>
+]]
 )
 
 AC_CHECK_MEMBERS([struct udphdr.uh_dport, struct udphdr.uh_sport],
-  [],
-  [],
-  [[
-    #define _BSD_SOURCE
-    #define _DEFAULT_SOURCE
-    #include <stdint.h>
-    #if HAVE_SYS_TYPES_H
-    # include <sys/types.h>
-    #endif
-    #if HAVE_NETINET_IN_SYSTM_H
-    # include <netinet/in_systm.h>
-    #endif
-    #if HAVE_NETINET_IN_H
-    # include <netinet/in.h>
-    #endif
-    #if HAVE_NETINET_IP_H
-    # include <netinet/ip.h>
-    #endif
-    #if HAVE_NETINET_UDP_H
-    # include <netinet/udp.h>
-    #endif
-  ]]
+[],
+[],
+[[
+  #define _BSD_SOURCE
+  #define _DEFAULT_SOURCE
+  #include <stdint.h>
+  #if HAVE_SYS_TYPES_H
+  # include <sys/types.h>
+  #endif
+  #if HAVE_NETINET_IN_SYSTM_H
+  # include <netinet/in_systm.h>
+  #endif
+  #if HAVE_NETINET_IN_H
+  # include <netinet/in.h>
+  #endif
+  #if HAVE_NETINET_IP_H
+  # include <netinet/ip.h>
+  #endif
+  #if HAVE_NETINET_UDP_H
+  # include <netinet/udp.h>
+  #endif
+]]
 )
 
 AC_CHECK_MEMBERS([struct udphdr.dest, struct udphdr.source],
-  [],
-  [],
-  [[
-    #define _BSD_SOURCE
-    #define _DEFAULT_SOURCE
-    #include <stdint.h>
-    #if HAVE_SYS_TYPES_H
-    # include <sys/types.h>
-    #endif
-    #if HAVE_NETINET_IN_SYSTM_H
-    # include <netinet/in_systm.h>
-    #endif
-    #if HAVE_NETINET_IN_H
-    # include <netinet/in.h>
-    #endif
-    #if HAVE_NETINET_IP_H
-    # include <netinet/ip.h>
-    #endif
-    #if HAVE_NETINET_UDP_H
-    # include <netinet/udp.h>
-    #endif
-  ]]
+[],
+[],
+[[
+  #define _BSD_SOURCE
+  #define _DEFAULT_SOURCE
+  #include <stdint.h>
+  #if HAVE_SYS_TYPES_H
+  # include <sys/types.h>
+  #endif
+  #if HAVE_NETINET_IN_SYSTM_H
+  # include <netinet/in_systm.h>
+  #endif
+  #if HAVE_NETINET_IN_H
+  # include <netinet/in.h>
+  #endif
+  #if HAVE_NETINET_IP_H
+  # include <netinet/ip.h>
+  #endif
+  #if HAVE_NETINET_UDP_H
+  # include <netinet/udp.h>
+  #endif
+]]
 )
 
 AC_CHECK_MEMBERS([kstat_io_t.nwritten, kstat_io_t.writes, kstat_io_t.nwrites, kstat_io_t.wtime],
-  [],
-  [],
-  [[# include <kstat.h>]]
+[],
+[],
+[[# include <kstat.h>]]
 )
 
 # check for pthread_setname_np
@@ -1815,19 +1815,19 @@ LDFLAGS="$LDFLAGS -lpthread"
 AC_MSG_CHECKING([for pthread_setname_np])
 have_pthread_setname_np="no"
 AC_LINK_IFELSE(
-  [
-    AC_LANG_PROGRAM(
-      [[
-        #define _GNU_SOURCE
-        #include <pthread.h>
-      ]],
-      [[pthread_setname_np((pthread_t) {0}, "conftest");]]
-    )
-  ],
-  [
-    have_pthread_setname_np="yes"
-    AC_DEFINE(HAVE_PTHREAD_SETNAME_NP, 1, [pthread_setname_np() is available.])
-  ]
+[
+  AC_LANG_PROGRAM(
+    [[
+      #define _GNU_SOURCE
+      #include <pthread.h>
+    ]],
+    [[pthread_setname_np((pthread_t) {0}, "conftest");]]
+  )
+],
+[
+  have_pthread_setname_np="yes"
+  AC_DEFINE(HAVE_PTHREAD_SETNAME_NP, 1, [pthread_setname_np() is available.])
+]
 )
 
 AC_MSG_RESULT([$have_pthread_setname_np])
@@ -1836,23 +1836,46 @@ AC_MSG_RESULT([$have_pthread_setname_np])
 AC_MSG_CHECKING([for pthread_set_name_np])
 have_pthread_set_name_np="no"
 AC_LINK_IFELSE(
-  [
-    AC_LANG_PROGRAM(
-      [[#include <pthread_np.h>]],
-      [[pthread_set_name_np((pthread_t) {0}, "conftest");]]
-    )
-   ],
-  [
-    have_pthread_set_name_np="yes"
-    AC_DEFINE(HAVE_PTHREAD_SET_NAME_NP, 1, [pthread_set_name_np() is available.])
-  ]
+[
+  AC_LANG_PROGRAM(
+    [[#include <pthread_np.h>]],
+    [[pthread_set_name_np((pthread_t) {0}, "conftest");]]
+  )
+  ],
+[
+  have_pthread_set_name_np="yes"
+  AC_DEFINE(HAVE_PTHREAD_SET_NAME_NP, 1, [pthread_set_name_np() is available.])
+]
 )
 AC_MSG_RESULT([$have_pthread_set_name_np])
 
 LDFLAGS="$SAVE_LDFLAGS"
 
 AC_CHECK_TYPES([struct ip6_ext],
-  [have_ip6_ext="yes"],
+[have_ip6_ext="yes"],
+[have_ip6_ext="no"],
+[[
+  #include <stdint.h>
+  #if HAVE_SYS_TYPES_H
+  # include <sys/types.h>
+  #endif
+  #if HAVE_NETINET_IN_SYSTM_H
+  # include <netinet/in_systm.h>
+  #endif
+  #if HAVE_NETINET_IN_H
+  # include <netinet/in.h>
+  #endif
+  #if HAVE_NETINET_IP6_H
+  # include <netinet/ip6.h>
+  #endif
+]]
+)
+
+if test "x$have_ip6_ext" = "xno"; then
+SAVE_CFLAGS="$CFLAGS"
+CFLAGS="$CFLAGS -DSOLARIS2=8"
+AC_CHECK_TYPES([struct ip6_ext],
+  [have_ip6_ext="yes, with -DSOLARIS2=8"],
   [have_ip6_ext="no"],
   [[
     #include <stdint.h>
@@ -1870,55 +1893,32 @@ AC_CHECK_TYPES([struct ip6_ext],
     #endif
   ]]
 )
-
 if test "x$have_ip6_ext" = "xno"; then
-  SAVE_CFLAGS="$CFLAGS"
-  CFLAGS="$CFLAGS -DSOLARIS2=8"
-  AC_CHECK_TYPES([struct ip6_ext],
-    [have_ip6_ext="yes, with -DSOLARIS2=8"],
-    [have_ip6_ext="no"],
-    [[
-      #include <stdint.h>
-      #if HAVE_SYS_TYPES_H
-      # include <sys/types.h>
-      #endif
-      #if HAVE_NETINET_IN_SYSTM_H
-      # include <netinet/in_systm.h>
-      #endif
-      #if HAVE_NETINET_IN_H
-      # include <netinet/in.h>
-      #endif
-      #if HAVE_NETINET_IP6_H
-      # include <netinet/ip6.h>
-      #endif
-    ]]
-  )
-  if test "x$have_ip6_ext" = "xno"; then
-    CFLAGS="$SAVE_CFLAGS"
-  fi
+  CFLAGS="$SAVE_CFLAGS"
+fi
 fi
 
 # libi2c-dev
 if test "x$ac_system" = "xLinux"; then
-  with_libi2c_libs=""
-  AC_CHECK_HEADERS([i2c/smbus.h],
-    [with_libi2c_libs="-li2c"]
-  )
-  AC_CHECK_DECL([i2c_smbus_read_i2c_block_data],
-    [with_libi2c="yes"],
-    [with_libi2c="no (symbol i2c_smbus_read_i2c_block_data not found - have you installed libi2c-dev ?)"],
-    [[
-      #include <stdlib.h>
-      #include <linux/i2c-dev.h>
-      #if HAVE_I2C_SMBUS_H
-      # include <i2c/smbus.h>
-      #endif
-    ]]
-  )
-  BUILD_WITH_LIBI2C_LIBS="$with_libi2c_libs"
-  AC_SUBST([BUILD_WITH_LIBI2C_LIBS])
+with_libi2c_libs=""
+AC_CHECK_HEADERS([i2c/smbus.h],
+  [with_libi2c_libs="-li2c"]
+)
+AC_CHECK_DECL([i2c_smbus_read_i2c_block_data],
+  [with_libi2c="yes"],
+  [with_libi2c="no (symbol i2c_smbus_read_i2c_block_data not found - have you installed libi2c-dev ?)"],
+  [[
+    #include <stdlib.h>
+    #include <linux/i2c-dev.h>
+    #if HAVE_I2C_SMBUS_H
+    # include <i2c/smbus.h>
+    #endif
+  ]]
+)
+BUILD_WITH_LIBI2C_LIBS="$with_libi2c_libs"
+AC_SUBST([BUILD_WITH_LIBI2C_LIBS])
 else
-  with_libi2c="no (Linux only)"
+with_libi2c="no (Linux only)"
 fi
 
 #
@@ -1928,183 +1928,183 @@ fi
 # Check for libpthread
 SAVE_LIBS="$LIBS"
 AC_CHECK_LIB([pthread],
-  [pthread_create],
-  [],
-  [AC_MSG_ERROR([Symbol 'pthread_create' not found in libpthread])],
-  []
+[pthread_create],
+[],
+[AC_MSG_ERROR([Symbol 'pthread_create' not found in libpthread])],
+[]
 )
 PTHREAD_LIBS="$LIBS"
 LIBS="$SAVE_LIBS"
 AC_SUBST([PTHREAD_LIBS])
 
 AC_CHECK_HEADERS([pthread.h],
-  [],
-  [AC_MSG_ERROR([pthread.h not found])]
+[],
+[AC_MSG_ERROR([pthread.h not found])]
 )
 
 m4_divert_once([HELP_WITH], [
 Collectd additional packages:])
 
 if test "x$ac_system" = "xAIX"; then
-  with_perfstat="yes"
-  with_procinfo="yes"
+with_perfstat="yes"
+with_procinfo="yes"
 else
-  with_perfstat="no (AIX only)"
-  with_procinfo="no (AIX only)"
+with_perfstat="no (AIX only)"
+with_procinfo="no (AIX only)"
 fi
 
 if test "x$with_perfstat" = "xyes"; then
-  AC_CHECK_LIB([perfstat], [perfstat_reset],
-    [with_perfstat="yes"],
-    [with_perfstat="no (perfstat not found)"]
-  )
+AC_CHECK_LIB([perfstat], [perfstat_reset],
+  [with_perfstat="yes"],
+  [with_perfstat="no (perfstat not found)"]
+)
 fi
 
 if test "x$with_perfstat" = "xyes"; then
-  AC_DEFINE([HAVE_PERFSTAT], [1], [Define to 1 if you have the 'perfstat' library (-lperfstat)])
-  # struct members pertaining to donation have been added to libperfstat somewhere between AIX5.3ML5 and AIX5.3ML9
-  AC_CHECK_MEMBER([perfstat_partition_type_t.b.donate_enabled],
-    [],
-    [],
-    [[#include <libperfstat.h]]
-  )
-  if test "x$av_cv_member_perfstat_partition_type_t_b_donate_enabled" = "xyes"; then
-    AC_DEFINE([PERFSTAT_SUPPORTS_DONATION], [1], [Define to 1 if your version of the 'perfstat' library supports donation])
-  fi
+AC_DEFINE([HAVE_PERFSTAT], [1], [Define to 1 if you have the 'perfstat' library (-lperfstat)])
+# struct members pertaining to donation have been added to libperfstat somewhere between AIX5.3ML5 and AIX5.3ML9
+AC_CHECK_MEMBER([perfstat_partition_type_t.b.donate_enabled],
+  [],
+  [],
+  [[#include <libperfstat.h]]
+)
+if test "x$av_cv_member_perfstat_partition_type_t_b_donate_enabled" = "xyes"; then
+  AC_DEFINE([PERFSTAT_SUPPORTS_DONATION], [1], [Define to 1 if your version of the 'perfstat' library supports donation])
+fi
 fi
 AM_CONDITIONAL([BUILD_WITH_PERFSTAT], [test "x$with_perfstat" = "xyes"])
 
 # Processes plugin under AIX.
 if test "x$with_procinfo" = "xyes"; then
-  AC_CHECK_HEADERS([procinfo.h],
-    [AC_DEFINE([HAVE_PROCINFO_H], [1], [Define to 1 if you have the procinfo.h])],
-    [with_procinfo="no (procinfo.h not found)"]
-  )
+AC_CHECK_HEADERS([procinfo.h],
+  [AC_DEFINE([HAVE_PROCINFO_H], [1], [Define to 1 if you have the procinfo.h])],
+  [with_procinfo="no (procinfo.h not found)"]
+)
 fi
 
 if test "x$ac_system" = "xSolaris"; then
-  with_kstat="yes"
-  with_devinfo="yes"
+with_kstat="yes"
+with_devinfo="yes"
 else
-  with_kstat="no (Solaris only)"
-  with_devinfo="no (Solaris only)"
+with_kstat="no (Solaris only)"
+with_devinfo="no (Solaris only)"
 fi
 
 if test "x$with_kstat" = "xyes"; then
-  AC_CHECK_LIB([kstat], [kstat_open],
-    [with_kstat="yes"],
-    [with_kstat="no (libkstat not found)"]
-  )
+AC_CHECK_LIB([kstat], [kstat_open],
+  [with_kstat="yes"],
+  [with_kstat="no (libkstat not found)"]
+)
 fi
 
 if test "x$with_kstat" = "xyes"; then
-  AC_CHECK_LIB([devinfo], [di_init],
-    [with_devinfo="yes"],
-    [with_devinfo="no (not found)"]
-  )
-  AC_CHECK_HEADERS([kstat.h],
-    [AC_DEFINE(HAVE_LIBKSTAT, [1], [Define to 1 if you have the 'kstat' library (-lkstat)])],
-    [with_kstat="no (kstat.h not found)"]
-  )
+AC_CHECK_LIB([devinfo], [di_init],
+  [with_devinfo="yes"],
+  [with_devinfo="no (not found)"]
+)
+AC_CHECK_HEADERS([kstat.h],
+  [AC_DEFINE(HAVE_LIBKSTAT, [1], [Define to 1 if you have the 'kstat' library (-lkstat)])],
+  [with_kstat="no (kstat.h not found)"]
+)
 fi
 
 AM_CONDITIONAL([BUILD_WITH_LIBDEVINFO], [test "x$with_devinfo" = "xyes"])
 AM_CONDITIONAL([BUILD_WITH_LIBKSTAT], [test "x$with_kstat" = "xyes"])
 
 if test "x$ac_system" = "xDarwin"; then
-  with_libiokit="yes"
+with_libiokit="yes"
 else
-  with_libiokit="no"
+with_libiokit="no"
 fi
 AM_CONDITIONAL([BUILD_WITH_LIBIOKIT], [test "x$with_libiokit" = "xyes"])
 
 with_libkvm="no"
 AC_CHECK_LIB([kvm], [kvm_getprocs],
-  [with_kvm_getprocs="yes"],
-  [with_kvm_getprocs="no"]
+[with_kvm_getprocs="yes"],
+[with_kvm_getprocs="no"]
 )
 
 if test "x$with_kvm_getprocs" = "xyes"; then
-  AC_DEFINE([HAVE_LIBKVM_GETPROCS], [1],
-    [Define to 1 if you have the 'kvm' library with the 'kvm_getprocs' symbol (-lkvm)]
-  )
-  with_libkvm="yes"
+AC_DEFINE([HAVE_LIBKVM_GETPROCS], [1],
+  [Define to 1 if you have the 'kvm' library with the 'kvm_getprocs' symbol (-lkvm)]
+)
+with_libkvm="yes"
 fi
 
 AM_CONDITIONAL([BUILD_WITH_LIBKVM_GETPROCS], [test "x$with_kvm_getprocs" = "xyes"])
 
 AC_CHECK_LIB([kvm], [kvm_getswapinfo],
-  [with_kvm_getswapinfo="yes"],
-  [with_kvm_getswapinfo="no"]
+[with_kvm_getswapinfo="yes"],
+[with_kvm_getswapinfo="no"]
 )
 
 if test "x$with_kvm_getswapinfo" = "xyes"; then
-  AC_DEFINE([HAVE_LIBKVM_GETSWAPINFO], [1],
-    [Define to 1 if you have the 'kvm' library with the 'kvm_getswapinfo' symbol (-lkvm)]
-  )
-  with_libkvm="yes"
+AC_DEFINE([HAVE_LIBKVM_GETSWAPINFO], [1],
+  [Define to 1 if you have the 'kvm' library with the 'kvm_getswapinfo' symbol (-lkvm)]
+)
+with_libkvm="yes"
 fi
 
 AM_CONDITIONAL([BUILD_WITH_LIBKVM_GETSWAPINFO], [test "x$with_kvm_getswapinfo" = "xyes"])
 
 AC_CHECK_LIB([kvm], [kvm_nlist],
-  [with_kvm_nlist="yes"],
-  [with_kvm_nlist="no"]
+[with_kvm_nlist="yes"],
+[with_kvm_nlist="no"]
 )
 
 if test "x$with_kvm_nlist" = "xyes"; then
-  AC_CHECK_HEADERS([bsd/nlist.h nlist.h])
-  AC_DEFINE([HAVE_LIBKVM_NLIST], [1],
-    [Define to 1 if you have the 'kvm' library with the 'kvm_nlist' symbol (-lkvm)]
-  )
-  with_libkvm="yes"
+AC_CHECK_HEADERS([bsd/nlist.h nlist.h])
+AC_DEFINE([HAVE_LIBKVM_NLIST], [1],
+  [Define to 1 if you have the 'kvm' library with the 'kvm_nlist' symbol (-lkvm)]
+)
+with_libkvm="yes"
 fi
 
 AM_CONDITIONAL([BUILD_WITH_LIBKVM_NLIST], [test "x$with_kvm_nlist" = "xyes"])
 
 AC_CHECK_LIB([kvm], [kvm_openfiles],
-  [with_kvm_openfiles="yes"],
-  [with_kvm_openfiles="no"]
+[with_kvm_openfiles="yes"],
+[with_kvm_openfiles="no"]
 )
 
 if test "x$with_kvm_openfiles" = "xyes"; then
-  AC_DEFINE([HAVE_LIBKVM_NLIST], [1],
-    [Define to 1 if you have the 'kvm' library with the 'kvm_openfiles' symbol (-lkvm)]
-  )
-  with_libkvm="yes"
+AC_DEFINE([HAVE_LIBKVM_NLIST], [1],
+  [Define to 1 if you have the 'kvm' library with the 'kvm_openfiles' symbol (-lkvm)]
+)
+with_libkvm="yes"
 fi
 
 # --with-cuda {{{
 AC_ARG_WITH([cuda],
-  [AS_HELP_STRING([--with-cuda@<:@=PREFIX@:>@], [Path to cuda.])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      with_cuda_cppflags="-I$withval/include"
-      with_cuda_ldflags="-I$withval/lib"
-      with_cuda="yes"
-    else
-      with_cuda="$withval"
-    fi
-  ],
-  [with_cuda="no"]
+[AS_HELP_STRING([--with-cuda@<:@=PREFIX@:>@], [Path to cuda.])],
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    with_cuda_cppflags="-I$withval/include"
+    with_cuda_ldflags="-I$withval/lib"
+    with_cuda="yes"
+  else
+    with_cuda="$withval"
+  fi
+],
+[with_cuda="no"]
 )
 
 if test "x$with_cuda" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_cuda_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_cuda_cppflags"
 
-  AC_CHECK_HEADERS([nvml.h],
-    [with_cuda="yes"],
-    [with_cuda="no (nvml.h not found)"]
-  )
+AC_CHECK_HEADERS([nvml.h],
+  [with_cuda="yes"],
+  [with_cuda="no (nvml.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_cuda" = "xyes"; then
-  BUILD_WITH_CUDA_CPPFLAGS="$CUDA_CPPFLAGS"
-  BUILD_WITH_CUDA_LDFLAGS="$CUDA_LDFLAGS"
-  BUILD_WITH_CUDA_LIBS="-lnvidia-ml"
+BUILD_WITH_CUDA_CPPFLAGS="$CUDA_CPPFLAGS"
+BUILD_WITH_CUDA_LDFLAGS="$CUDA_LDFLAGS"
+BUILD_WITH_CUDA_LIBS="-lnvidia-ml"
 fi
 
 AC_SUBST([BUILD_WITH_CUDA_CPPFLAGS])
@@ -2115,19 +2115,19 @@ AC_SUBST([BUILD_WITH_CUDA_LIBS])
 
 # --with-libaquaero5 {{{
 AC_ARG_WITH([libaquaero5],
-  [AS_HELP_STRING([--with-libaquaero5@<:@=PREFIX@:>@], [Path to aquatools-ng source code.])],
-  [
-    if test "x$withval" = "xyes"; then
-      with_libaquaero5="yes"
-    else if test "x$withval" = "xno"; then
-      with_libaquaero5="no"
-    else
-      with_libaquaero5="yes"
-      LIBAQUAERO5_CFLAGS="$LIBAQUAERO5_CFLAGS -I$withval/src"
-      LIBAQUAERO5_LDFLAGS="$LIBAQUAERO5_LDFLAGS -L$withval/obj"
-    fi; fi
-  ],
-  [with_libaquaero5="yes"]
+[AS_HELP_STRING([--with-libaquaero5@<:@=PREFIX@:>@], [Path to aquatools-ng source code.])],
+[
+  if test "x$withval" = "xyes"; then
+    with_libaquaero5="yes"
+  else if test "x$withval" = "xno"; then
+    with_libaquaero5="no"
+  else
+    with_libaquaero5="yes"
+    LIBAQUAERO5_CFLAGS="$LIBAQUAERO5_CFLAGS -I$withval/src"
+    LIBAQUAERO5_LDFLAGS="$LIBAQUAERO5_LDFLAGS -L$withval/obj"
+  fi; fi
+],
+[with_libaquaero5="yes"]
 )
 
 SAVE_CPPFLAGS="$CPPFLAGS"
@@ -2136,25 +2136,25 @@ CPPFLAGS="$CPPFLAGS $LIBAQUAERO5_CFLAGS"
 LDFLAGS="$LDFLAGS $LIBAQUAERO5_LDFLAGS"
 
 if test "x$with_libaquaero5" = "xyes"; then
-  AC_CHECK_HEADERS([libaquaero5.h],
-    [with_libaquaero5="yes"],
-    [with_libaquaero5="no (libaquaero5.h not found)"]
-  )
+AC_CHECK_HEADERS([libaquaero5.h],
+  [with_libaquaero5="yes"],
+  [with_libaquaero5="no (libaquaero5.h not found)"]
+)
 fi
 
 if test "x$with_libaquaero5" = "xyes"; then
-  AC_CHECK_LIB([aquaero5], libaquaero5_poll,
-    [with_libaquaero5="yes"],
-    [with_libaquaero5="no (symbol 'libaquaero5_poll' not found)"]
-  )
+AC_CHECK_LIB([aquaero5], libaquaero5_poll,
+  [with_libaquaero5="yes"],
+  [with_libaquaero5="no (symbol 'libaquaero5_poll' not found)"]
+)
 fi
 
 CPPFLAGS="$SAVE_CPPFLAGS"
 LDFLAGS="$SAVE_LDFLAGS"
 
 if test "x$with_libaquaero5" = "xyes"; then
-  BUILD_WITH_LIBAQUAERO5_CFLAGS="$LIBAQUAERO5_CFLAGS"
-  BUILD_WITH_LIBAQUAERO5_LDFLAGS="$LIBAQUAERO5_LDFLAGS"
+BUILD_WITH_LIBAQUAERO5_CFLAGS="$LIBAQUAERO5_CFLAGS"
+BUILD_WITH_LIBAQUAERO5_LDFLAGS="$LIBAQUAERO5_LDFLAGS"
 fi
 AC_SUBST([BUILD_WITH_LIBAQUAERO5_CFLAGS])
 AC_SUBST([BUILD_WITH_LIBAQUAERO5_LDFLAGS])
@@ -2162,19 +2162,19 @@ AC_SUBST([BUILD_WITH_LIBAQUAERO5_LDFLAGS])
 
 # --with-libhiredis {{{
 AC_ARG_WITH([libhiredis],
-  [AS_HELP_STRING([--with-libhiredis@<:@=PREFIX@:>@], [Path to libhiredis.])],
-  [
-    if test "x$withval" = "xyes"; then
-      with_libhiredis="yes"
-    else if test "x$withval" = "xno"; then
-      with_libhiredis="no"
-    else
-      with_libhiredis="yes"
-      LIBHIREDIS_CPPFLAGS="$LIBHIREDIS_CPPFLAGS -I$withval/include"
-      LIBHIREDIS_LDFLAGS="$LIBHIREDIS_LDFLAGS -L$withval/lib"
-    fi; fi
-  ],
-  [with_libhiredis="yes"]
+[AS_HELP_STRING([--with-libhiredis@<:@=PREFIX@:>@], [Path to libhiredis.])],
+[
+  if test "x$withval" = "xyes"; then
+    with_libhiredis="yes"
+  else if test "x$withval" = "xno"; then
+    with_libhiredis="no"
+  else
+    with_libhiredis="yes"
+    LIBHIREDIS_CPPFLAGS="$LIBHIREDIS_CPPFLAGS -I$withval/include"
+    LIBHIREDIS_LDFLAGS="$LIBHIREDIS_LDFLAGS -L$withval/lib"
+  fi; fi
+],
+[with_libhiredis="yes"]
 )
 
 SAVE_CPPFLAGS="$CPPFLAGS"
@@ -2183,25 +2183,25 @@ CPPFLAGS="$CPPFLAGS $LIBHIREDIS_CPPFLAGS"
 LDFLAGS="$LDFLAGS $LIBHIREDIS_LDFLAGS"
 
 if test "x$with_libhiredis" = "xyes"; then
-  AC_CHECK_HEADERS([hiredis/hiredis.h],
-    [with_libhiredis="yes"],
-    [with_libhiredis="no (hiredis.h not found)"]
-  )
+AC_CHECK_HEADERS([hiredis/hiredis.h],
+  [with_libhiredis="yes"],
+  [with_libhiredis="no (hiredis.h not found)"]
+)
 fi
 
 if test "x$with_libhiredis" = "xyes"; then
-  AC_CHECK_LIB([hiredis], [redisCommand],
-    [with_libhiredis="yes"],
-    [with_libhiredis="no (symbol 'redisCommand' not found)"]
-  )
+AC_CHECK_LIB([hiredis], [redisCommand],
+  [with_libhiredis="yes"],
+  [with_libhiredis="no (symbol 'redisCommand' not found)"]
+)
 fi
 
 CPPFLAGS="$SAVE_CPPFLAGS"
 LDFLAGS="$SAVE_LDFLAGS"
 
 if test "x$with_libhiredis" = "xyes"; then
-  BUILD_WITH_LIBHIREDIS_CPPFLAGS="$LIBHIREDIS_CPPFLAGS"
-  BUILD_WITH_LIBHIREDIS_LDFLAGS="$LIBHIREDIS_LDFLAGS"
+BUILD_WITH_LIBHIREDIS_CPPFLAGS="$LIBHIREDIS_CPPFLAGS"
+BUILD_WITH_LIBHIREDIS_LDFLAGS="$LIBHIREDIS_LDFLAGS"
 fi
 
 AC_SUBST([BUILD_WITH_LIBHIREDIS_CPPFLAGS])
@@ -2213,120 +2213,120 @@ with_curl_config="curl-config"
 with_curl_cflags=""
 with_curl_libs=""
 AC_ARG_WITH(libcurl,
-  [AS_HELP_STRING([--with-libcurl@<:@=PREFIX@:>@], [Path to libcurl.])],
-  [
-    if test "x$withval" = "xno"; then
-      with_libcurl="no"
-    else if test "x$withval" = "xyes"; then
+[AS_HELP_STRING([--with-libcurl@<:@=PREFIX@:>@], [Path to libcurl.])],
+[
+  if test "x$withval" = "xno"; then
+    with_libcurl="no"
+  else if test "x$withval" = "xyes"; then
+    with_libcurl="yes"
+  else
+    if test -f "$withval" && test -x "$withval"; then
+      with_curl_config="$withval"
       with_libcurl="yes"
-    else
-      if test -f "$withval" && test -x "$withval"; then
-        with_curl_config="$withval"
-        with_libcurl="yes"
-      else if test -x "$withval/bin/curl-config"; then
-        with_curl_config="$withval/bin/curl-config"
-        with_libcurl="yes"
-      fi; fi
+    else if test -x "$withval/bin/curl-config"; then
+      with_curl_config="$withval/bin/curl-config"
       with_libcurl="yes"
     fi; fi
-  ],
-  [with_libcurl="yes"]
+    with_libcurl="yes"
+  fi; fi
+],
+[with_libcurl="yes"]
 )
 
 if test "x$with_libcurl" = "xyes"; then
-  with_curl_cflags=`$with_curl_config --cflags 2>/dev/null`
-  curl_config_status=$?
+with_curl_cflags=`$with_curl_config --cflags 2>/dev/null`
+curl_config_status=$?
 
-  if test $curl_config_status -ne 0; then
-    with_libcurl="no ($with_curl_config failed)"
-  else
-    SAVE_CPPFLAGS="$CPPFLAGS"
-    CPPFLAGS="$CPPFLAGS $with_curl_cflags"
+if test $curl_config_status -ne 0; then
+  with_libcurl="no ($with_curl_config failed)"
+else
+  SAVE_CPPFLAGS="$CPPFLAGS"
+  CPPFLAGS="$CPPFLAGS $with_curl_cflags"
 
-    AC_CHECK_HEADERS([curl/curl.h],
-      [with_libcurl="yes"],
-      [with_libcurl="no (curl/curl.h not found)"]
-    )
+  AC_CHECK_HEADERS([curl/curl.h],
+    [with_libcurl="yes"],
+    [with_libcurl="no (curl/curl.h not found)"]
+  )
 
-    CPPFLAGS="$SAVE_CPPFLAGS"
-  fi
+  CPPFLAGS="$SAVE_CPPFLAGS"
+fi
 fi
 
 if test "x$with_libcurl" = "xyes"; then
-  with_curl_libs=`$with_curl_config --libs 2>/dev/null`
-  curl_config_status=$?
+with_curl_libs=`$with_curl_config --libs 2>/dev/null`
+curl_config_status=$?
 
-  if test $curl_config_status -ne 0; then
-    with_libcurl="no ($with_curl_config failed)"
-  else
-    AC_CHECK_LIB([curl], [curl_easy_init],
-      [with_libcurl="yes"],
-      [with_libcurl="no (symbol 'curl_easy_init' not found)"],
-      [$with_curl_libs]
-    )
+if test $curl_config_status -ne 0; then
+  with_libcurl="no ($with_curl_config failed)"
+else
+  AC_CHECK_LIB([curl], [curl_easy_init],
+    [with_libcurl="yes"],
+    [with_libcurl="no (symbol 'curl_easy_init' not found)"],
+    [$with_curl_libs]
+  )
 
-    AC_CHECK_DECL([CURLOPT_USERNAME],
-      [have_curlopt_username="yes"],
-      [have_curlopt_username="no"],
-      [[#include <curl/curl.h>]]
-    )
+  AC_CHECK_DECL([CURLOPT_USERNAME],
+    [have_curlopt_username="yes"],
+    [have_curlopt_username="no"],
+    [[#include <curl/curl.h>]]
+  )
 
-    AC_CHECK_DECL(CURLOPT_TIMEOUT_MS,
-      [have_curlopt_timeout="yes"],
-      [have_curlopt_timeout="no"],
-      [[#include <curl/curl.h>]]
-    )
-  fi
+  AC_CHECK_DECL(CURLOPT_TIMEOUT_MS,
+    [have_curlopt_timeout="yes"],
+    [have_curlopt_timeout="no"],
+    [[#include <curl/curl.h>]]
+  )
+fi
 fi
 
 if test "x$with_libcurl" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  SAVE_LDFLAGS="$LDFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_curl_cflags"
-  LDFLAGS="$LDFLAGS $with_curl_libs"
-  AC_CACHE_CHECK([for CURLINFO_APPCONNECT_TIME],
-    [c_cv_have_curlinfo_appconnect_time],
-    [
-      AC_LINK_IFELSE(
-        [
-          AC_LANG_PROGRAM(
-            [[#include <curl/curl.h>]],
-            [[
-              int val = CURLINFO_APPCONNECT_TIME;
-              return val;
-            ]]
-          )
-        ],
-        [c_cv_have_curlinfo_appconnect_time="yes"],
-        [c_cv_have_curlinfo_appconnect_time="no"]
-      )
-    ]
-  )
-  CPPFLAGS="$SAVE_CPPFLAGS"
-  LDFLAGS="$SAVE_LDFLAGS"
+SAVE_CPPFLAGS="$CPPFLAGS"
+SAVE_LDFLAGS="$LDFLAGS"
+CPPFLAGS="$CPPFLAGS $with_curl_cflags"
+LDFLAGS="$LDFLAGS $with_curl_libs"
+AC_CACHE_CHECK([for CURLINFO_APPCONNECT_TIME],
+  [c_cv_have_curlinfo_appconnect_time],
+  [
+    AC_LINK_IFELSE(
+      [
+        AC_LANG_PROGRAM(
+          [[#include <curl/curl.h>]],
+          [[
+            int val = CURLINFO_APPCONNECT_TIME;
+            return val;
+          ]]
+        )
+      ],
+      [c_cv_have_curlinfo_appconnect_time="yes"],
+      [c_cv_have_curlinfo_appconnect_time="no"]
+    )
+  ]
+)
+CPPFLAGS="$SAVE_CPPFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$c_cv_have_curlinfo_appconnect_time" = "xyes"; then
-  AC_DEFINE([HAVE_CURLINFO_APPCONNECT_TIME], [1],
-    [Define if curl.h defines CURLINFO_APPCONNECT_TIME.]
-  )
+AC_DEFINE([HAVE_CURLINFO_APPCONNECT_TIME], [1],
+  [Define if curl.h defines CURLINFO_APPCONNECT_TIME.]
+)
 fi
 
 if test "x$with_libcurl" = "xyes"; then
-  BUILD_WITH_LIBCURL_CFLAGS="$with_curl_cflags"
-  BUILD_WITH_LIBCURL_LIBS="$with_curl_libs"
+BUILD_WITH_LIBCURL_CFLAGS="$with_curl_cflags"
+BUILD_WITH_LIBCURL_LIBS="$with_curl_libs"
 
-  if test "x$have_curlopt_username" = "xyes"; then
-    AC_DEFINE([HAVE_CURLOPT_USERNAME], [1],
-      [Define if libcurl supports CURLOPT_USERNAME option.]
-    )
-  fi
+if test "x$have_curlopt_username" = "xyes"; then
+  AC_DEFINE([HAVE_CURLOPT_USERNAME], [1],
+    [Define if libcurl supports CURLOPT_USERNAME option.]
+  )
+fi
 
-  if test "x$have_curlopt_timeout" = "xyes"; then
-    AC_DEFINE([HAVE_CURLOPT_TIMEOUT_MS], [1],
-      [Define if libcurl supports CURLOPT_TIMEOUT_MS option.]
-    )
-  fi
+if test "x$have_curlopt_timeout" = "xyes"; then
+  AC_DEFINE([HAVE_CURLOPT_TIMEOUT_MS], [1],
+    [Define if libcurl supports CURLOPT_TIMEOUT_MS option.]
+  )
+fi
 fi
 
 AC_SUBST(BUILD_WITH_LIBCURL_CFLAGS)
@@ -2337,41 +2337,41 @@ AM_CONDITIONAL([BUILD_WITH_LIBCURL], [test "x$with_libcurl" = "xyes"])
 
 # --with-libdbi {{{
 AC_ARG_WITH([libdbi],
-  [AS_HELP_STRING([--with-libdbi@<:@=PREFIX@:>@], [Path to libdbi.])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      with_libdbi_cppflags="-I$withval/include"
-      with_libdbi_ldflags="-L$withval/lib"
-      with_libdbi="yes"
-    else
-      with_libdbi="$withval"
-    fi
-  ],
-  [with_libdbi="yes"]
+[AS_HELP_STRING([--with-libdbi@<:@=PREFIX@:>@], [Path to libdbi.])],
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    with_libdbi_cppflags="-I$withval/include"
+    with_libdbi_ldflags="-L$withval/lib"
+    with_libdbi="yes"
+  else
+    with_libdbi="$withval"
+  fi
+],
+[with_libdbi="yes"]
 )
 
 if test "x$with_libdbi" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libdbi_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libdbi_cppflags"
 
-  AC_CHECK_HEADERS([dbi/dbi.h],
-    [with_libdbi="yes"],
-    [with_libdbi="no (dbi/dbi.h not found)"]
-  )
+AC_CHECK_HEADERS([dbi/dbi.h],
+  [with_libdbi="yes"],
+  [with_libdbi="no (dbi/dbi.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libdbi" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_libdbi_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_libdbi_ldflags"
 
-  AC_CHECK_LIB([dbi], [dbi_initialize],
-    [with_libdbi="yes"],
-    [with_libdbi="no (Symbol 'dbi_initialize' not found)"]
-  )
+AC_CHECK_LIB([dbi], [dbi_initialize],
+  [with_libdbi="yes"],
+  [with_libdbi="no (Symbol 'dbi_initialize' not found)"]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 BUILD_WITH_LIBDBI_CPPFLAGS="$with_libdbi_cppflags"
@@ -2389,122 +2389,122 @@ AC_ARG_VAR([LIBDPDK_LDFLAGS], [Linker flags for libdpdk])
 AC_ARG_VAR([LIBDPDK_LIBS], [Libraries to link for libdpdk])
 
 AC_ARG_WITH([libdpdk],
-  [AS_HELP_STRING([--without-libdpdk], [Disable libdpdk.])],
-  [with_libdpdk="$withval"],
-  [with_libdpdk="yes"]
+[AS_HELP_STRING([--without-libdpdk], [Disable libdpdk.])],
+[with_libdpdk="$withval"],
+[with_libdpdk="yes"]
 )
 
 if test "x$with_libdpdk" != "xno"; then
-  PKG_CHECK_MODULES([DPDK], [libdpdk], [],
-    [AC_MSG_NOTICE([no DPDK pkg-config, using defaults])])
-  if test "x$LIBDPDK_CPPFLAGS" = "x"; then
-    LIBDPDK_CPPFLAGS="-I/usr/include/dpdk"
-  fi
-  if test "x$LIBDPDK_CFLAGS" = "x"; then
-    LIBDPDK_CFLAGS="$DPDK_CFLAGS"
-    LIBDPDK_CPPFLAGS="$LIBDPDK_CPPFLAGS $DPDK_CFLAGS"
-  fi
-  if test "x$LIBDPDK_LIBS" = "x"; then
-    if test "x$DPDK_LIBS" != "x"; then
-      LIBDPDK_LIBS="$DPDK_LIBS"
-    else
-      LIBDPDK_LIBS="-ldpdk"
-    fi
+PKG_CHECK_MODULES([DPDK], [libdpdk], [],
+  [AC_MSG_NOTICE([no DPDK pkg-config, using defaults])])
+if test "x$LIBDPDK_CPPFLAGS" = "x"; then
+  LIBDPDK_CPPFLAGS="-I/usr/include/dpdk"
+fi
+if test "x$LIBDPDK_CFLAGS" = "x"; then
+  LIBDPDK_CFLAGS="$DPDK_CFLAGS"
+  LIBDPDK_CPPFLAGS="$LIBDPDK_CPPFLAGS $DPDK_CFLAGS"
+fi
+if test "x$LIBDPDK_LIBS" = "x"; then
+  if test "x$DPDK_LIBS" != "x"; then
+    LIBDPDK_LIBS="$DPDK_LIBS"
+  else
+    LIBDPDK_LIBS="-ldpdk"
   fi
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$LIBDPDK_CPPFLAGS $CPPFLAGS"
-  SAVE_CFLAGS="$CFLAGS"
-  CFLAGS="$LIBDPDK_CFLAGS $CFLAGS"
-  AC_CHECK_HEADERS([rte_config.h],
-    [
-      with_libdpdk="yes"
-      AC_PREPROC_IFELSE(
-        [
-          AC_LANG_SOURCE(
-            [[
-              #include <rte_version.h>
-              #if RTE_VERSION < RTE_VERSION_NUM(16,7,0,0)
-              #error "required DPDK >= 16.07"
-              #endif
-            ]]
-          )
-        ],
-        [dpdk_keepalive="yes"],
-        [dpdk_keepalive="no (DPDK version < 16.07)"]
-      )
-    ],
-    [with_libdpdk="no (rte_config.h not found)"]
-  )
-  CPPFLAGS="$SAVE_CPPFLAGS"
-  CFLAGS="$SAVE_CFLAGS"
+fi
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$LIBDPDK_CPPFLAGS $CPPFLAGS"
+SAVE_CFLAGS="$CFLAGS"
+CFLAGS="$LIBDPDK_CFLAGS $CFLAGS"
+AC_CHECK_HEADERS([rte_config.h],
+  [
+    with_libdpdk="yes"
+    AC_PREPROC_IFELSE(
+      [
+        AC_LANG_SOURCE(
+          [[
+            #include <rte_version.h>
+            #if RTE_VERSION < RTE_VERSION_NUM(16,7,0,0)
+            #error "required DPDK >= 16.07"
+            #endif
+          ]]
+        )
+      ],
+      [dpdk_keepalive="yes"],
+      [dpdk_keepalive="no (DPDK version < 16.07)"]
+    )
+  ],
+  [with_libdpdk="no (rte_config.h not found)"]
+)
+CPPFLAGS="$SAVE_CPPFLAGS"
+CFLAGS="$SAVE_CFLAGS"
 fi
 
 if test "x$with_libdpdk" = "xyes"; then
-  SAVE_LIBS="$LIBS"
-  LIBS="$LIBDPDK_LIBS $LIBS"
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LIBDPDK_LDFLAGS $LDFLAGS"
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$LIBDPDK_CPPFLAGS $CPPFLAGS"
-  SAVE_CFLAGS="$CFLAGS"
-  CFLAGS="$LIBDPDK_CFLAGS $CFLAGS"
-  AC_LINK_IFELSE(
-    [
-      AC_LANG_PROGRAM(
-        [[
-          #include <rte_eal.h>
-        ]],
-        [[return rte_eal_init(0, NULL);]]
-      )
-    ],
-    [with_libdpdk="yes"],
-    [with_libdpdk="no (symbol 'rte_eal_init' not found)"]
-  )
-  LIBS="$SAVE_LIBS"
-  LDFLAGS="$SAVE_LDFLAGS"
-  CPPFLAGS="$SAVE_CPPFLAGS"
-  CFLAGS="$SAVE_CFLAGS"
+SAVE_LIBS="$LIBS"
+LIBS="$LIBDPDK_LIBS $LIBS"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LIBDPDK_LDFLAGS $LDFLAGS"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$LIBDPDK_CPPFLAGS $CPPFLAGS"
+SAVE_CFLAGS="$CFLAGS"
+CFLAGS="$LIBDPDK_CFLAGS $CFLAGS"
+AC_LINK_IFELSE(
+  [
+    AC_LANG_PROGRAM(
+      [[
+        #include <rte_eal.h>
+      ]],
+      [[return rte_eal_init(0, NULL);]]
+    )
+  ],
+  [with_libdpdk="yes"],
+  [with_libdpdk="no (symbol 'rte_eal_init' not found)"]
+)
+LIBS="$SAVE_LIBS"
+LDFLAGS="$SAVE_LDFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
+CFLAGS="$SAVE_CFLAGS"
 fi
 
 # }}}
 
 # --with-libesmtp {{{
 AC_ARG_WITH([libesmtp],
-  [AS_HELP_STRING([--with-libesmtp@<:@=PREFIX@:>@], [Path to libesmtp.])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      with_libesmtp_cppflags="-I$withval/include"
-      with_libesmtp_ldflags="-L$withval/lib"
-      with_libesmtp="yes"
-    else
-      with_libesmtp="$withval"
-    fi
-  ],
-  [with_libesmtp="yes"]
+[AS_HELP_STRING([--with-libesmtp@<:@=PREFIX@:>@], [Path to libesmtp.])],
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    with_libesmtp_cppflags="-I$withval/include"
+    with_libesmtp_ldflags="-L$withval/lib"
+    with_libesmtp="yes"
+  else
+    with_libesmtp="$withval"
+  fi
+],
+[with_libesmtp="yes"]
 )
 
 if test "x$with_libesmtp" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libesmtp_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libesmtp_cppflags"
 
-  AC_CHECK_HEADERS([libesmtp.h],
-    [with_libesmtp="yes"],
-    [with_libesmtp="no (libesmtp.h not found)"]
-  )
+AC_CHECK_HEADERS([libesmtp.h],
+  [with_libesmtp="yes"],
+  [with_libesmtp="no (libesmtp.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libesmtp" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_esmtp_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_esmtp_ldflags"
 
-  AC_CHECK_LIB([esmtp], [smtp_create_session],
-    [with_libesmtp="yes"],
-    [with_libesmtp="no (Symbol 'smtp_create_session' not found)"]
-  )
+AC_CHECK_LIB([esmtp], [smtp_create_session],
+  [with_libesmtp="yes"],
+  [with_libesmtp="no (Symbol 'smtp_create_session' not found)"]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 BUILD_WITH_LIBESMTP_CPPFLAGS="$with_libesmtp_cppflags"
@@ -2517,41 +2517,41 @@ AC_SUBST(BUILD_WITH_LIBESMTP_LIBS)
 
 # --with-libganglia {{{
 AC_ARG_WITH([libganglia],
-  [AS_HELP_STRING([--with-libganglia@<:@=PREFIX@:>@], [Path to libganglia.])],
-  [
-    if test -f "$withval" && test -x "$withval"; then
-      with_libganglia_config="$withval"
-      with_libganglia="yes"
-    else if test -f "$withval/bin/ganglia-config" && test -x "$withval/bin/ganglia-config"; then
-      with_libganglia_config="$withval/bin/ganglia-config"
-      with_libganglia="yes"
-    else if test -d "$withval"; then
-      GANGLIA_CPPFLAGS="-I$withval/include"
-      GANGLIA_LDFLAGS="-L$withval/lib"
-      with_libganglia="yes"
-    else
-      with_libganglia="$withval"
-    fi; fi; fi
-  ],
-  [with_libganglia="yes"]
+[AS_HELP_STRING([--with-libganglia@<:@=PREFIX@:>@], [Path to libganglia.])],
+[
+  if test -f "$withval" && test -x "$withval"; then
+    with_libganglia_config="$withval"
+    with_libganglia="yes"
+  else if test -f "$withval/bin/ganglia-config" && test -x "$withval/bin/ganglia-config"; then
+    with_libganglia_config="$withval/bin/ganglia-config"
+    with_libganglia="yes"
+  else if test -d "$withval"; then
+    GANGLIA_CPPFLAGS="-I$withval/include"
+    GANGLIA_LDFLAGS="-L$withval/lib"
+    with_libganglia="yes"
+  else
+    with_libganglia="$withval"
+  fi; fi; fi
+],
+[with_libganglia="yes"]
 )
 
 if test "x$with_libganglia" = "xyes"; then
-  if test "x$with_libganglia_config" != "x"; then
-    if test "x$GANGLIA_CPPFLAGS" = "x"; then
-      GANGLIA_CPPFLAGS=`"$with_libganglia_config" --cflags 2>/dev/null`
-    fi
+if test "x$with_libganglia_config" != "x"; then
+  if test "x$GANGLIA_CPPFLAGS" = "x"; then
+    GANGLIA_CPPFLAGS=`"$with_libganglia_config" --cflags 2>/dev/null`
+  fi
 
-    if test "x$GANGLIA_LDFLAGS" = "x"; then
-      GANGLIA_LDFLAGS=`"$with_libganglia_config" --ldflags 2>/dev/null`
-    fi
+  if test "x$GANGLIA_LDFLAGS" = "x"; then
+    GANGLIA_LDFLAGS=`"$with_libganglia_config" --ldflags 2>/dev/null`
+  fi
 
-    if test "x$GANGLIA_LIBS" = "x"; then
-      GANGLIA_LIBS=`"$with_libganglia_config" --libs 2>/dev/null`
-    fi
-  else
-    GANGLIA_LIBS="-lganglia"
+  if test "x$GANGLIA_LIBS" = "x"; then
+    GANGLIA_LIBS=`"$with_libganglia_config" --libs 2>/dev/null`
   fi
+else
+  GANGLIA_LIBS="-lganglia"
+fi
 fi
 
 SAVE_CPPFLAGS="$CPPFLAGS"
@@ -2560,17 +2560,17 @@ CPPFLAGS="$CPPFLAGS $GANGLIA_CPPFLAGS"
 LDFLAGS="$LDFLAGS $GANGLIA_LDFLAGS"
 
 if test "x$with_libganglia" = "xyes"; then
-  AC_CHECK_HEADERS([gm_protocol.h],
-    [with_libganglia="yes"],
-    [with_libganglia="no (gm_protocol.h not found)"]
-  )
+AC_CHECK_HEADERS([gm_protocol.h],
+  [with_libganglia="yes"],
+  [with_libganglia="no (gm_protocol.h not found)"]
+)
 fi
 
 if test "x$with_libganglia" = "xyes"; then
-  AC_CHECK_LIB([ganglia], [xdr_Ganglia_value_msg],
-    [with_libganglia="yes"],
-    [with_libganglia="no (symbol xdr_Ganglia_value_msg not found)"]
-  )
+AC_CHECK_LIB([ganglia], [xdr_Ganglia_value_msg],
+  [with_libganglia="yes"],
+  [with_libganglia="no (symbol xdr_Ganglia_value_msg not found)"]
+)
 fi
 
 CPPFLAGS="$SAVE_CPPFLAGS"
@@ -2586,37 +2586,37 @@ GCRYPT_CPPFLAGS="$GCRYPT_CPPFLAGS"
 GCRYPT_LDFLAGS="$GCRYPT_LDFLAGS"
 GCRYPT_LIBS="$GCRYPT_LIBS"
 AC_ARG_WITH([libgcrypt],
-  [AS_HELP_STRING([--with-libgcrypt@<:@=PREFIX@:>@], [Path to libgcrypt.])],
-  [
-    if test -f "$withval" && test -x "$withval"; then
-      with_libgcrypt_config="$withval"
-      with_libgcrypt="yes"
-    else if test -f "$withval/bin/gcrypt-config" && test -x "$withval/bin/gcrypt-config"; then
-      with_libgcrypt_config="$withval/bin/gcrypt-config"
-      with_libgcrypt="yes"
-    else if test -d "$withval"; then
-      GCRYPT_CPPFLAGS="$GCRYPT_CPPFLAGS -I$withval/include"
-      GCRYPT_LDFLAGS="$GCRYPT_LDFLAGS -L$withval/lib"
-      with_libgcrypt="yes"
-    else
-      with_libgcrypt_config="gcrypt-config"
-      with_libgcrypt="$withval"
-    fi; fi; fi
-  ],
-  [
-    with_libgcrypt_config="libgcrypt-config"
+[AS_HELP_STRING([--with-libgcrypt@<:@=PREFIX@:>@], [Path to libgcrypt.])],
+[
+  if test -f "$withval" && test -x "$withval"; then
+    with_libgcrypt_config="$withval"
     with_libgcrypt="yes"
-  ]
+  else if test -f "$withval/bin/gcrypt-config" && test -x "$withval/bin/gcrypt-config"; then
+    with_libgcrypt_config="$withval/bin/gcrypt-config"
+    with_libgcrypt="yes"
+  else if test -d "$withval"; then
+    GCRYPT_CPPFLAGS="$GCRYPT_CPPFLAGS -I$withval/include"
+    GCRYPT_LDFLAGS="$GCRYPT_LDFLAGS -L$withval/lib"
+    with_libgcrypt="yes"
+  else
+    with_libgcrypt_config="gcrypt-config"
+    with_libgcrypt="$withval"
+  fi; fi; fi
+],
+[
+  with_libgcrypt_config="libgcrypt-config"
+  with_libgcrypt="yes"
+]
 )
 
 if test "x$with_libgcrypt" = "xyes" && test "x$with_libgcrypt_config" != "x"; then
-  if test "x$GCRYPT_CPPFLAGS" = "x"; then
-    GCRYPT_CPPFLAGS=`"$with_libgcrypt_config" --cflags 2>/dev/null`
-  fi
+if test "x$GCRYPT_CPPFLAGS" = "x"; then
+  GCRYPT_CPPFLAGS=`"$with_libgcrypt_config" --cflags 2>/dev/null`
+fi
 
-  if test "x$GCRYPT_LIBS" = "x"; then
-    GCRYPT_LIBS=`"$with_libgcrypt_config" --libs 2>/dev/null`
-  fi
+if test "x$GCRYPT_LIBS" = "x"; then
+  GCRYPT_LIBS=`"$with_libgcrypt_config" --libs 2>/dev/null`
+fi
 fi
 
 SAVE_CPPFLAGS="$CPPFLAGS"
@@ -2627,17 +2627,17 @@ LDFLAGS="$LDFLAGS $GCRYPT_LDFLAGS"
 LIBS="$LIBS $GCRYPT_LIBS"
 
 if test "x$with_libgcrypt" = "xyes"; then
-  AC_CHECK_HEADERS([gcrypt.h],
-    [with_libgcrypt="yes"],
-    [with_libgcrypt="no (gcrypt.h not found)"]
-  )
+AC_CHECK_HEADERS([gcrypt.h],
+  [with_libgcrypt="yes"],
+  [with_libgcrypt="no (gcrypt.h not found)"]
+)
 fi
 
 if test "x$with_libgcrypt" = "xyes"; then
-  AC_CHECK_LIB(gcrypt, gcry_md_hash_buffer,
-    [with_libgcrypt="yes"],
-    [with_libgcrypt="no (symbol gcry_md_hash_buffer not found)"]
-  )
+AC_CHECK_LIB(gcrypt, gcry_md_hash_buffer,
+  [with_libgcrypt="yes"],
+  [with_libgcrypt="no (symbol gcry_md_hash_buffer not found)"]
+)
 fi
 
 CPPFLAGS="$SAVE_CPPFLAGS"
@@ -2652,47 +2652,47 @@ AM_CONDITIONAL([BUILD_WITH_LIBGCRYPT], [test "x$with_libgcrypt" = "xyes"])
 
 # --with-libgps {{{
 AC_ARG_WITH([libgps],
-  [AS_HELP_STRING([--with-libgps@<:@=PREFIX@:>@], [Path to libgps.])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      with_libgps_cflags="-I$withval/include"
-      with_libgps_ldflags="-L$withval/lib"
-      with_libgps="yes"
-    else
-      with_libgps="$withval"
-    fi
-  ],
-  [with_libgps="yes"]
+[AS_HELP_STRING([--with-libgps@<:@=PREFIX@:>@], [Path to libgps.])],
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    with_libgps_cflags="-I$withval/include"
+    with_libgps_ldflags="-L$withval/lib"
+    with_libgps="yes"
+  else
+    with_libgps="$withval"
+  fi
+],
+[with_libgps="yes"]
 )
 
 if test "x$with_libgps" = "xyes"; then
-  SAVE_CFLAGS="$CFLAGS"
-  CFLAGS="$CFLAGS $with_libgps_cflags"
+SAVE_CFLAGS="$CFLAGS"
+CFLAGS="$CFLAGS $with_libgps_cflags"
 
-  AC_CHECK_HEADERS([gps.h],
-    [with_libgps="yes"],
-    [with_libgps="no (gps.h not found)"]
-  )
+AC_CHECK_HEADERS([gps.h],
+  [with_libgps="yes"],
+  [with_libgps="no (gps.h not found)"]
+)
 
-  CFLAGS="$SAVE_CFLAGS"
+CFLAGS="$SAVE_CFLAGS"
 fi
 
 if test "x$with_libgps" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_libgps_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_libgps_ldflags"
 
-  AC_CHECK_LIB([gps], [gps_open],
-    [with_libgps="yes"],
-    [with_libgps="no (symbol gps_open not found)"]
-  )
+AC_CHECK_LIB([gps], [gps_open],
+  [with_libgps="yes"],
+  [with_libgps="no (symbol gps_open not found)"]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libgps" = "xyes"; then
-  BUILD_WITH_LIBGPS_CFLAGS="$with_libgps_cflags"
-  BUILD_WITH_LIBGPS_LDFLAGS="$with_libgps_ldflags"
-  BUILD_WITH_LIBGPS_LIBS="-lgps"
+BUILD_WITH_LIBGPS_CFLAGS="$with_libgps_cflags"
+BUILD_WITH_LIBGPS_LDFLAGS="$with_libgps_ldflags"
+BUILD_WITH_LIBGPS_LIBS="-lgps"
 fi
 
 AC_SUBST([BUILD_WITH_LIBGPS_CFLAGS])
@@ -2703,81 +2703,81 @@ AC_SUBST([BUILD_WITH_LIBGPS_LIBS])
 
 # --with-libgrpc++ {{{
 AC_ARG_WITH([libgrpc++],
-  [AS_HELP_STRING([--with-libgrpc++@<:@=PREFIX@:>@], [Path to libgrpc++.])],
-  [
-    with_grpcpp="$withval"
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      with_libgrpcpp_cppflags="-I$withval/include"
-      with_libgrpcpp_ldflags="-L$withval/lib"
-      with_libgrpcpp_bin="$withval/bin"
-      with_libgrpcpp="yes"
-    fi
-    if test "x$withval" = "xno"; then
-      with_libgrpcpp="no (disabled on command line)"
-    fi
-  ],
-  [withval="yes"]
+[AS_HELP_STRING([--with-libgrpc++@<:@=PREFIX@:>@], [Path to libgrpc++.])],
+[
+  with_grpcpp="$withval"
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    with_libgrpcpp_cppflags="-I$withval/include"
+    with_libgrpcpp_ldflags="-L$withval/lib"
+    with_libgrpcpp_bin="$withval/bin"
+    with_libgrpcpp="yes"
+  fi
+  if test "x$withval" = "xno"; then
+    with_libgrpcpp="no (disabled on command line)"
+  fi
+],
+[withval="yes"]
 )
 if test "x$withval" = "xyes"; then
 PKG_CHECK_MODULES([GRPCPP], [grpc++],
-  [with_libgrpcpp="yes"],
-  [with_libgrpcpp="no (pkg-config could not find libgrpc++)"]
+[with_libgrpcpp="yes"],
+[with_libgrpcpp="no (pkg-config could not find libgrpc++)"]
 )
 fi
 
 if test "x$withval" != "xno"; then
-  AC_MSG_CHECKING([whether $CXX accepts -std=c++11])
-  if test_cxx_flags -std=c++11; then
-    AC_MSG_RESULT([yes])
-  else
-    AC_MSG_RESULT([no])
-    with_libgrpcpp="no (requires C++11 support)"
-  fi
+AC_MSG_CHECKING([whether $CXX accepts -std=c++11])
+if test_cxx_flags -std=c++11; then
+  AC_MSG_RESULT([yes])
+else
+  AC_MSG_RESULT([no])
+  with_libgrpcpp="no (requires C++11 support)"
+fi
 fi
 
 if test "x$with_libgrpcpp" = "xyes"; then
-  AC_LANG_PUSH(C++)
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="-std=c++11 $with_libgrpcpp_cppflags $GRPCPP_CFLAGS $CPPFLAGS"
-  AC_CHECK_HEADERS([grpc++/grpc++.h],
-    [with_libgrpcpp="yes"],
-    [with_libgrpcpp="no (<grpc++/grpc++.h> not found)"]
-  )
-  CPPFLAGS="$SAVE_CPPFLAGS"
-  AC_LANG_POP(C++)
+AC_LANG_PUSH(C++)
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="-std=c++11 $with_libgrpcpp_cppflags $GRPCPP_CFLAGS $CPPFLAGS"
+AC_CHECK_HEADERS([grpc++/grpc++.h],
+  [with_libgrpcpp="yes"],
+  [with_libgrpcpp="no (<grpc++/grpc++.h> not found)"]
+)
+CPPFLAGS="$SAVE_CPPFLAGS"
+AC_LANG_POP(C++)
 fi
 
 if test "x$with_libgrpcpp" = "xyes"; then
-  AC_LANG_PUSH(C++)
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  SAVE_LDFLAGS="$LDFLAGS"
-  SAVE_LIBS="$LIBS"
-  CPPFLAGS="-std=c++11 $with_libgrpcpp_cppflags $GRPCPP_CFLAGS $CPPFLAGS"
-  LDFLAGS="$with_libgrpcpp_ldflags"
-  if test "x$GRPCPP_LIBS" = "x"; then
-    LIBS="-lgrpc++"
-  else
-    LIBS="$GRPCPP_LIBS"
-  fi
-  AC_LINK_IFELSE(
-    [
-      AC_LANG_PROGRAM(
-        [[#include <grpc++/grpc++.h>]],
-        [[grpc::ServerBuilder sb;]]
-      )
-    ],
-    [
-      with_libgrpcpp="yes"
-      if test "x$GRPCPP_LIBS" = "x"; then
-        GRPCPP_LIBS="-lgrpc++"
-      fi
-    ],
-    [with_libgrpcpp="no (libgrpc++ not found)"]
-  )
-  CPPFLAGS="$SAVE_CPPFLAGS"
-  LDFLAGS="$SAVE_LDFLAGS"
-  LIBS="$SAVE_LIBS"
-  AC_LANG_POP(C++)
+AC_LANG_PUSH(C++)
+SAVE_CPPFLAGS="$CPPFLAGS"
+SAVE_LDFLAGS="$LDFLAGS"
+SAVE_LIBS="$LIBS"
+CPPFLAGS="-std=c++11 $with_libgrpcpp_cppflags $GRPCPP_CFLAGS $CPPFLAGS"
+LDFLAGS="$with_libgrpcpp_ldflags"
+if test "x$GRPCPP_LIBS" = "x"; then
+  LIBS="-lgrpc++"
+else
+  LIBS="$GRPCPP_LIBS"
+fi
+AC_LINK_IFELSE(
+  [
+    AC_LANG_PROGRAM(
+      [[#include <grpc++/grpc++.h>]],
+      [[grpc::ServerBuilder sb;]]
+    )
+  ],
+  [
+    with_libgrpcpp="yes"
+    if test "x$GRPCPP_LIBS" = "x"; then
+      GRPCPP_LIBS="-lgrpc++"
+    fi
+  ],
+  [with_libgrpcpp="no (libgrpc++ not found)"]
+)
+CPPFLAGS="$SAVE_CPPFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
+LIBS="$SAVE_LIBS"
+AC_LANG_POP(C++)
 fi
 
 BUILD_WITH_LIBGRPCPP_CPPFLAGS="-std=c++11 $with_libgrpcpp_cppflags $GRPCPP_CFLAGS"
@@ -2790,52 +2790,52 @@ AC_SUBST([BUILD_WITH_LIBGRPCPP_LIBS])
 
 AC_ARG_VAR([GRPC_CPP_PLUGIN], [path to the grpc_cpp_plugin binary])
 if test "x$with_libgrpcpp_bin" = "x"; then
-  AC_PATH_PROG([GRPC_CPP_PLUGIN], [grpc_cpp_plugin])
+AC_PATH_PROG([GRPC_CPP_PLUGIN], [grpc_cpp_plugin])
 else
-  AC_PATH_PROG([GRPC_CPP_PLUGIN], [grpc_cpp_plugin], [], "$with_libgrpcpp_bin:$PATH")
+AC_PATH_PROG([GRPC_CPP_PLUGIN], [grpc_cpp_plugin], [], "$with_libgrpcpp_bin:$PATH")
 fi
 AM_CONDITIONAL([HAVE_GRPC_CPP], [test "x$GRPC_CPP_PLUGIN" != "x"])
 
 # --with-libiptc {{{
 AC_ARG_WITH([libiptc],
-  [AS_HELP_STRING([--with-libiptc@<:@=PREFIX@:>@], [Path to libiptc.])],
-  [
-    if test "x$withval" = "xyes"; then
-      with_libiptc="pkgconfig"
-    else if test "x$withval" = "xno"; then
-      with_libiptc="no"
-    else
-      with_libiptc="yes"
-      with_libiptc_cflags="-I$withval/include"
-      with_libiptc_libs="-L$withval/lib"
-    fi; fi
-  ],
-  [
-    if test "x$ac_system" = "xLinux"; then
-      with_libiptc="pkgconfig"
-    else
-      with_libiptc="no (Linux only)"
-    fi
-  ]
+[AS_HELP_STRING([--with-libiptc@<:@=PREFIX@:>@], [Path to libiptc.])],
+[
+  if test "x$withval" = "xyes"; then
+    with_libiptc="pkgconfig"
+  else if test "x$withval" = "xno"; then
+    with_libiptc="no"
+  else
+    with_libiptc="yes"
+    with_libiptc_cflags="-I$withval/include"
+    with_libiptc_libs="-L$withval/lib"
+  fi; fi
+],
+[
+  if test "x$ac_system" = "xLinux"; then
+    with_libiptc="pkgconfig"
+  else
+    with_libiptc="no (Linux only)"
+  fi
+]
 )
 
 if test "x$with_libiptc" = "xpkgconfig"; then
-  $PKG_CONFIG --exists 'libiptc' 2>/dev/null
-  if test $? -ne 0; then
-    with_libiptc="no (pkg-config doesn't know libiptc)"
-  fi
+$PKG_CONFIG --exists 'libiptc' 2>/dev/null
+if test $? -ne 0; then
+  with_libiptc="no (pkg-config doesn't know libiptc)"
+fi
 fi
 
 if test "x$with_libiptc" = "xpkgconfig"; then
-  with_libiptc_cflags="`$PKG_CONFIG --cflags 'libiptc'`"
-  if test $? -ne 0; then
-    with_libiptc="no ($PKG_CONFIG failed)"
-  fi
+with_libiptc_cflags="`$PKG_CONFIG --cflags 'libiptc'`"
+if test $? -ne 0; then
+  with_libiptc="no ($PKG_CONFIG failed)"
+fi
 
-  with_libiptc_libs="`$PKG_CONFIG --libs 'libiptc'`"
-  if test $? -ne 0; then
-    with_libiptc="no ($PKG_CONFIG failed)"
-  fi
+with_libiptc_libs="`$PKG_CONFIG --libs 'libiptc'`"
+if test $? -ne 0; then
+  with_libiptc="no ($PKG_CONFIG failed)"
+fi
 fi
 
 SAVE_CPPFLAGS="$CPPFLAGS"
@@ -2843,40 +2843,40 @@ CPPFLAGS="$CPPFLAGS $with_libiptc_cflags"
 
 # check whether the header file for libiptc is available.
 if test "x$with_libiptc" = "xpkgconfig"; then
-  AC_CHECK_HEADERS([libiptc/libiptc.h libiptc/libip6tc.h],
-    [],
-    [with_libiptc="no (header file missing)"]
-  )
+AC_CHECK_HEADERS([libiptc/libiptc.h libiptc/libip6tc.h],
+  [],
+  [with_libiptc="no (header file missing)"]
+)
 fi
 
 # If the header file is available, check for the required type declaractions.
 # They may be missing in old versions of libiptc. In that case, they will be
 # declared in the iptables plugin.
 if test "x$with_libiptc" = "xpkgconfig"; then
-  AC_CHECK_TYPES([iptc_handle_t, ip6tc_handle_t], [], [])
+AC_CHECK_TYPES([iptc_handle_t, ip6tc_handle_t], [], [])
 fi
 
 # Check for the iptc_init symbol in the library.
 # This could be in iptc or ip4tc
 if test "x$with_libiptc" = "xpkgconfig"; then
-  SAVE_LIBS="$LIBS"
-  AC_SEARCH_LIBS([iptc_init], [iptc ip4tc],
-    [with_libiptc="pkgconfig"],
-    [with_libiptc="no"],
-    [$with_libiptc_libs]
-  )
-  LIBS="$SAVE_LIBS"
+SAVE_LIBS="$LIBS"
+AC_SEARCH_LIBS([iptc_init], [iptc ip4tc],
+  [with_libiptc="pkgconfig"],
+  [with_libiptc="no"],
+  [$with_libiptc_libs]
+)
+LIBS="$SAVE_LIBS"
 fi
 
 if test "x$with_libiptc" = "xpkgconfig"; then
-  with_libiptc="yes"
+with_libiptc="yes"
 fi
 
 CPPFLAGS="$SAVE_CPPFLAGS"
 
 if test "x$with_libiptc" = "xyes"; then
-  BUILD_WITH_LIBIPTC_CPPFLAGS="$with_libiptc_cflags"
-  BUILD_WITH_LIBIPTC_LDFLAGS="$with_libiptc_libs"
+BUILD_WITH_LIBIPTC_CPPFLAGS="$with_libiptc_cflags"
+BUILD_WITH_LIBIPTC_LDFLAGS="$with_libiptc_libs"
 fi
 AC_SUBST([BUILD_WITH_LIBIPTC_CPPFLAGS])
 AC_SUBST([BUILD_WITH_LIBIPTC_LDFLAGS])
@@ -2885,114 +2885,114 @@ AC_SUBST([BUILD_WITH_LIBIPTC_LDFLAGS])
 # --with-java {{{
 with_java_home="$JAVA_HOME"
 if test "x$with_java_home" = "x"; then
-  with_java_home="/usr/lib/jvm"
+with_java_home="/usr/lib/jvm"
 fi
 
 JAVAC="$JAVAC"
 JAR="$JAR"
 AC_ARG_WITH([java],
-  [AS_HELP_STRING([--with-java@<:@=PREFIX@:>@], [Path to Java home.])],
-  [
-    if test "x$withval" = "xno"; then
-      with_java="no"
-    else if test "x$withval" = "xyes"; then
-      with_java="yes"
-    else
-      with_java_home="$withval"
-      with_java="yes"
-    fi; fi
-  ],
-  [with_java="yes"]
+[AS_HELP_STRING([--with-java@<:@=PREFIX@:>@], [Path to Java home.])],
+[
+  if test "x$withval" = "xno"; then
+    with_java="no"
+  else if test "x$withval" = "xyes"; then
+    with_java="yes"
+  else
+    with_java_home="$withval"
+    with_java="yes"
+  fi; fi
+],
+[with_java="yes"]
 )
 
 AX_COMPARE_VERSION([$am__api_version],[lt],[1.12],
-  [JAVA_TIMESTAMP_FILE="classdist_noinst.stamp"],
-  [JAVA_TIMESTAMP_FILE="classnoinst.stamp"])
+[JAVA_TIMESTAMP_FILE="classdist_noinst.stamp"],
+[JAVA_TIMESTAMP_FILE="classnoinst.stamp"])
 if test "x$with_java" = "xyes"; then
-  if test -d "$with_java_home"; then
-    AC_MSG_CHECKING([for jni.h])
-    TMPVAR=`find -L "$with_java_home" -name jni.h -type f -exec 'dirname' '{}' ';' 2>/dev/null | LC_ALL=C sort | head -n 1`
-    if test "x$TMPVAR" != "x"; then
-      AC_MSG_RESULT([found in $TMPVAR])
-      JAVA_CPPFLAGS="$JAVA_CPPFLAGS -I$TMPVAR"
-    else
-      AC_MSG_RESULT([not found])
-    fi
+if test -d "$with_java_home"; then
+  AC_MSG_CHECKING([for jni.h])
+  TMPVAR=`find -L "$with_java_home" -name jni.h -type f -exec 'dirname' '{}' ';' 2>/dev/null | LC_ALL=C sort | head -n 1`
+  if test "x$TMPVAR" != "x"; then
+    AC_MSG_RESULT([found in $TMPVAR])
+    JAVA_CPPFLAGS="$JAVA_CPPFLAGS -I$TMPVAR"
+  else
+    AC_MSG_RESULT([not found])
+  fi
+
+  AC_MSG_CHECKING([for jni_md.h])
+  TMPVAR=`find -L "$with_java_home" -name jni_md.h -type f -exec 'dirname' '{}' ';' 2>/dev/null | LC_ALL=C sort | head -n 1`
+  if test "x$TMPVAR" != "x"; then
+    AC_MSG_RESULT([found in $TMPVAR])
+    JAVA_CPPFLAGS="$JAVA_CPPFLAGS -I$TMPVAR"
+  else
+    AC_MSG_RESULT([not found])
+  fi
+
+  AC_MSG_CHECKING([for libjvm.so])
+  TMPVAR=`find -L "$with_java_home" -type f \( -name libjvm.so -o -name libjvm.dylib \) -exec 'dirname' '{}' ';' 2>/dev/null | LC_ALL=C sort | head -n 1`
+  if test "x$TMPVAR" != "x"; then
+    AC_MSG_RESULT([found in $TMPVAR])
+    JAVA_LDFLAGS="$JAVA_LDFLAGS -L$TMPVAR -Wl,-rpath -Wl,$TMPVAR"
+  else
+    AC_MSG_RESULT([not found])
+  fi
 
-    AC_MSG_CHECKING([for jni_md.h])
-    TMPVAR=`find -L "$with_java_home" -name jni_md.h -type f -exec 'dirname' '{}' ';' 2>/dev/null | LC_ALL=C sort | head -n 1`
+  if test "x$JAVAC" = "x"; then
+    AC_MSG_CHECKING([for javac])
+    TMPVAR=`find -L "$with_java_home" -name javac -type f 2>/dev/null | LC_ALL=C sort | head -n 1`
     if test "x$TMPVAR" != "x"; then
-      AC_MSG_RESULT([found in $TMPVAR])
-      JAVA_CPPFLAGS="$JAVA_CPPFLAGS -I$TMPVAR"
+      JAVAC="$TMPVAR"
+      AC_MSG_RESULT([$JAVAC])
     else
       AC_MSG_RESULT([not found])
     fi
+  fi
 
-    AC_MSG_CHECKING([for libjvm.so])
-    TMPVAR=`find -L "$with_java_home" -type f \( -name libjvm.so -o -name libjvm.dylib \) -exec 'dirname' '{}' ';' 2>/dev/null | LC_ALL=C sort | head -n 1`
+  if test "x$JAR" = "x"; then
+    AC_MSG_CHECKING([for jar])
+    TMPVAR=`find -L "$with_java_home" -name jar -type f 2>/dev/null | LC_ALL=C sort | head -n 1`
     if test "x$TMPVAR" != "x"; then
-      AC_MSG_RESULT([found in $TMPVAR])
-      JAVA_LDFLAGS="$JAVA_LDFLAGS -L$TMPVAR -Wl,-rpath -Wl,$TMPVAR"
+      JAR="$TMPVAR"
+      AC_MSG_RESULT([$JAR])
     else
       AC_MSG_RESULT([not found])
     fi
-
-    if test "x$JAVAC" = "x"; then
-      AC_MSG_CHECKING([for javac])
-      TMPVAR=`find -L "$with_java_home" -name javac -type f 2>/dev/null | LC_ALL=C sort | head -n 1`
-      if test "x$TMPVAR" != "x"; then
-        JAVAC="$TMPVAR"
-        AC_MSG_RESULT([$JAVAC])
-      else
-        AC_MSG_RESULT([not found])
-      fi
-    fi
-
-    if test "x$JAR" = "x"; then
-      AC_MSG_CHECKING([for jar])
-      TMPVAR=`find -L "$with_java_home" -name jar -type f 2>/dev/null | LC_ALL=C sort | head -n 1`
-      if test "x$TMPVAR" != "x"; then
-        JAR="$TMPVAR"
-        AC_MSG_RESULT([$JAR])
-      else
-        AC_MSG_RESULT([not found])
-      fi
-    fi
-  else if test "x$with_java_home" != "x"; then
-    AC_MSG_WARN([JAVA_HOME: No such directory: $with_java_home])
-  fi; fi
+  fi
+else if test "x$with_java_home" != "x"; then
+  AC_MSG_WARN([JAVA_HOME: No such directory: $with_java_home])
+fi; fi
 fi
 
 if test "x$JAVAC" = "x"; then
-  with_javac_path="$PATH"
-  if test "x$with_java_home" != "x"; then
-    with_javac_path="$with_java_home:with_javac_path"
-    if test -d "$with_java_home/bin"; then
-      with_javac_path="$with_java_home/bin:with_javac_path"
-    fi
+with_javac_path="$PATH"
+if test "x$with_java_home" != "x"; then
+  with_javac_path="$with_java_home:with_javac_path"
+  if test -d "$with_java_home/bin"; then
+    with_javac_path="$with_java_home/bin:with_javac_path"
   fi
+fi
 
-  AC_PATH_PROG([JAVAC], [javac], [], "$with_javac_path")
+AC_PATH_PROG([JAVAC], [javac], [], "$with_javac_path")
 fi
 
 if test "x$JAVAC" = "x"; then
-  with_java="no (javac not found)"
+with_java="no (javac not found)"
 fi
 
 if test "x$JAR" = "x"; then
-  with_jar_path="$PATH"
-  if test "x$with_java_home" != "x"; then
-    with_jar_path="$with_java_home:$with_jar_path"
-    if test -d "$with_java_home/bin"; then
-      with_jar_path="$with_java_home/bin:$with_jar_path"
-    fi
+with_jar_path="$PATH"
+if test "x$with_java_home" != "x"; then
+  with_jar_path="$with_java_home:$with_jar_path"
+  if test -d "$with_java_home/bin"; then
+    with_jar_path="$with_java_home/bin:$with_jar_path"
   fi
+fi
 
-  AC_PATH_PROG([JAR], [jar], [], "$with_jar_path")
+AC_PATH_PROG([JAR], [jar], [], "$with_jar_path")
 fi
 
 if test "x$JAR" = "x"; then
-  with_java="no (jar not found)"
+with_java="no (jar not found)"
 fi
 
 SAVE_CPPFLAGS="$CPPFLAGS"
@@ -3005,21 +3005,21 @@ LDFLAGS="$LDFLAGS $JAVA_LDFLAGS"
 LIBS="$LIBS $JAVA_LIBS"
 
 if test "x$with_java" = "xyes"; then
-  AC_CHECK_HEADERS([jni.h],
-    [with_jave="yes"],
-    [with_java="no (jni.h not found)"])
+AC_CHECK_HEADERS([jni.h],
+  [with_jave="yes"],
+  [with_java="no (jni.h not found)"])
 fi
 
 if test "x$with_java" = "xyes"; then
-  AC_CHECK_LIB([jvm], [JNI_CreateJavaVM],
-    [with_java="yes"],
-    [with_java="no (Symbol 'JNI_CreateJavaVM' not found)"],
-    [$JAVA_LIBS $PTHREAD_LIBS]
-  )
+AC_CHECK_LIB([jvm], [JNI_CreateJavaVM],
+  [with_java="yes"],
+  [with_java="no (Symbol 'JNI_CreateJavaVM' not found)"],
+  [$JAVA_LIBS $PTHREAD_LIBS]
+)
 fi
 
 if test "x$with_java" = "xyes"; then
-  JAVA_LIBS="$JAVA_LIBS -ljvm"
+JAVA_LIBS="$JAVA_LIBS -ljvm"
 fi
 
 CPPFLAGS="$SAVE_CPPFLAGS"
@@ -3037,19 +3037,19 @@ AM_CONDITIONAL([BUILD_WITH_JAVA], [test "x$with_java" = "xyes"])
 
 # --with-libldap {{{
 AC_ARG_WITH([libldap],
-  [AS_HELP_STRING([--with-libldap@<:@=PREFIX@:>@], [Path to libldap.])],
-  [
-    if test "x$withval" = "xyes"; then
-      with_libldap="yes"
-    else if test "x$withval" = "xno"; then
-      with_libldap="no"
-    else
-      with_libldap="yes"
-      LIBLDAP_CPPFLAGS="$LIBLDAP_CPPFLAGS -I$withval/include"
-      LIBLDAP_LDFLAGS="$LIBLDAP_LDFLAGS -L$withval/lib"
-    fi; fi
-  ],
-  [with_libldap="yes"]
+[AS_HELP_STRING([--with-libldap@<:@=PREFIX@:>@], [Path to libldap.])],
+[
+  if test "x$withval" = "xyes"; then
+    with_libldap="yes"
+  else if test "x$withval" = "xno"; then
+    with_libldap="no"
+  else
+    with_libldap="yes"
+    LIBLDAP_CPPFLAGS="$LIBLDAP_CPPFLAGS -I$withval/include"
+    LIBLDAP_LDFLAGS="$LIBLDAP_LDFLAGS -L$withval/lib"
+  fi; fi
+],
+[with_libldap="yes"]
 )
 
 SAVE_CPPFLAGS="$CPPFLAGS"
@@ -3059,17 +3059,17 @@ CPPFLAGS="$CPPFLAGS $LIBLDAP_CPPFLAGS"
 LDFLAGS="$LDFLAGS $LIBLDAP_LDFLAGS"
 
 if test "x$with_libldap" = "xyes"; then
-  AC_CHECK_HEADERS([ldap.h],
-    [with_libldap="yes"],
-    [with_libldap="no ('ldap.h' not found)"]
-  )
+AC_CHECK_HEADERS([ldap.h],
+  [with_libldap="yes"],
+  [with_libldap="no ('ldap.h' not found)"]
+)
 fi
 
 if test "x$with_libldap" = "xyes"; then
-  AC_CHECK_LIB([ldap], [ldap_initialize],
-    [with_libldap="yes"],
-    [with_libldap="no (symbol 'ldap_initialize' not found)"]
-  )
+AC_CHECK_LIB([ldap], [ldap_initialize],
+  [with_libldap="yes"],
+  [with_libldap="no (symbol 'ldap_initialize' not found)"]
+)
 fi
 
 CPPFLAGS="$SAVE_CPPFLAGS"
@@ -3077,8 +3077,8 @@ LDFLAGS="$SAVE_LDFLAGS"
 
 if test "x$with_libldap" = "xyes"
 then
-  BUILD_WITH_LIBLDAP_CPPFLAGS="$LIBLDAP_CPPFLAGS"
-  BUILD_WITH_LIBLDAP_LDFLAGS="$LIBLDAP_LDFLAGS"
+BUILD_WITH_LIBLDAP_CPPFLAGS="$LIBLDAP_CPPFLAGS"
+BUILD_WITH_LIBLDAP_LDFLAGS="$LIBLDAP_LDFLAGS"
 fi
 AC_SUBST([BUILD_WITH_LIBLDAP_CPPFLAGS])
 AC_SUBST([BUILD_WITH_LIBLDAP_LDFLAGS])
@@ -3088,92 +3088,92 @@ AC_SUBST([BUILD_WITH_LIBLDAP_LDFLAGS])
 AC_ARG_VAR([LIBLUA_PKG_CONFIG_NAME], [Name of liblua used by pkg-config])
 if test "x$LIBLUA_PKG_CONFIG_NAME" != "x"
 then
-  PKG_CHECK_MODULES([LUA], [$LIBLUA_PKG_CONFIG_NAME],
-    [with_liblua="yes"],
-    [with_liblua="no"]
-  )
+PKG_CHECK_MODULES([LUA], [$LIBLUA_PKG_CONFIG_NAME],
+  [with_liblua="yes"],
+  [with_liblua="no"]
+)
 else
-  PKG_CHECK_MODULES([LUA], [lua],
-    [with_liblua="yes"],
-    [
-      PKG_CHECK_MODULES([LUA], [lua-5.3],
-        [with_liblua="yes"],
-        [
-          PKG_CHECK_MODULES([LUA], [lua5.3],
-            [with_liblua="yes"],
-            [
-              PKG_CHECK_MODULES([LUA], [lua53],
-                [with_liblua="yes"],
-                [
-                  PKG_CHECK_MODULES([LUA], [lua-5.2],
-                    [with_liblua="yes"],
-                    [
-                      PKG_CHECK_MODULES([LUA], [lua5.2],
-                        [with_liblua="yes"],
-                        [
-                          PKG_CHECK_MODULES([LUA], [lua52],
-                            [with_liblua="yes"],
-                            [
-                              PKG_CHECK_MODULES([LUA], [lua-5.1],
-                                [with_liblua="yes"],
-                                [
-                                  PKG_CHECK_MODULES([LUA], [lua5.1],
-                                    [with_liblua="yes"],
-                                    [
-                                      PKG_CHECK_MODULES([LUA], [lua51],
-                                        [with_liblua="yes"],
-                                        [with_liblua="no (pkg-config cannot find liblua)"]
-                                      )
-                                    ]
-                                  )
-                                ]
-                              )
-                            ]
-                          )
-                        ]
-                      )
-                    ]
-                  )
-                ]
-              )
-            ]
-          )
-        ]
-      )
-    ]
-  )
+PKG_CHECK_MODULES([LUA], [lua],
+  [with_liblua="yes"],
+  [
+    PKG_CHECK_MODULES([LUA], [lua-5.3],
+      [with_liblua="yes"],
+      [
+        PKG_CHECK_MODULES([LUA], [lua5.3],
+          [with_liblua="yes"],
+          [
+            PKG_CHECK_MODULES([LUA], [lua53],
+              [with_liblua="yes"],
+              [
+                PKG_CHECK_MODULES([LUA], [lua-5.2],
+                  [with_liblua="yes"],
+                  [
+                    PKG_CHECK_MODULES([LUA], [lua5.2],
+                      [with_liblua="yes"],
+                      [
+                        PKG_CHECK_MODULES([LUA], [lua52],
+                          [with_liblua="yes"],
+                          [
+                            PKG_CHECK_MODULES([LUA], [lua-5.1],
+                              [with_liblua="yes"],
+                              [
+                                PKG_CHECK_MODULES([LUA], [lua5.1],
+                                  [with_liblua="yes"],
+                                  [
+                                    PKG_CHECK_MODULES([LUA], [lua51],
+                                      [with_liblua="yes"],
+                                      [with_liblua="no (pkg-config cannot find liblua)"]
+                                    )
+                                  ]
+                                )
+                              ]
+                            )
+                          ]
+                        )
+                      ]
+                    )
+                  ]
+                )
+              ]
+            )
+          ]
+        )
+      ]
+    )
+  ]
+)
 fi
 
 if test "x$with_liblua" = "xyes"
 then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $LUA_CFLAGS"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $LUA_CFLAGS"
 
-  AC_CHECK_HEADERS([lua.h lauxlib.h lualib.h],
-    [with_liblua="yes"],
-    [with_liblua="no (header not found)"]
-  )
+AC_CHECK_HEADERS([lua.h lauxlib.h lualib.h],
+  [with_liblua="yes"],
+  [with_liblua="no (header not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_liblua" = "xyes"
 then
-  SAVE_LIBS="$LIBS"
-  LIBS="$LIBS $LUA_LIBS"
+SAVE_LIBS="$LIBS"
+LIBS="$LIBS $LUA_LIBS"
 
-  AC_CHECK_FUNC([lua_settop],
-    [with_liblua="yes"],
-    [with_liblua="no (symbol 'lua_settop' not found)"]
-  )
+AC_CHECK_FUNC([lua_settop],
+  [with_liblua="yes"],
+  [with_liblua="no (symbol 'lua_settop' not found)"]
+)
 
-  LIBS="$SAVE_LIBS"
+LIBS="$SAVE_LIBS"
 fi
 
 if test "x$with_liblua" = "xyes"
 then
-    BUILD_WITH_LIBLUA_CFLAGS="$LUA_CFLAGS"
-    BUILD_WITH_LIBLUA_LIBS="$LUA_LIBS"
+  BUILD_WITH_LIBLUA_CFLAGS="$LUA_CFLAGS"
+  BUILD_WITH_LIBLUA_LIBS="$LUA_LIBS"
 fi
 AC_SUBST(BUILD_WITH_LIBLUA_CFLAGS)
 AC_SUBST(BUILD_WITH_LIBLUA_LIBS)
@@ -3181,58 +3181,58 @@ AC_SUBST(BUILD_WITH_LIBLUA_LIBS)
 
 # --with-liblvm2app {{{
 AC_ARG_WITH([liblvm2app],
-  [AS_HELP_STRING([--with-liblvm2app@<:@=PREFIX@:>@], [Path to liblvm2app.])],
-  [
-    if test "x$withval" = "xno"; then
-      with_liblvm2app="no"
-    else
-      with_liblvm2app="yes"
-      if test "x$withval" != "xyes"; then
-        with_liblvm2app_cppflags="-I$withval/include"
-        with_liblvm2app_ldflags="-L$withval/lib"
-      fi
-    fi
-  ],
-  [
-    if test "x$ac_system" = "xLinux"; then
-      with_liblvm2app="yes"
-    else
-      with_liblvm2app="no (Linux only library)"
+[AS_HELP_STRING([--with-liblvm2app@<:@=PREFIX@:>@], [Path to liblvm2app.])],
+[
+  if test "x$withval" = "xno"; then
+    with_liblvm2app="no"
+  else
+    with_liblvm2app="yes"
+    if test "x$withval" != "xyes"; then
+      with_liblvm2app_cppflags="-I$withval/include"
+      with_liblvm2app_ldflags="-L$withval/lib"
     fi
-  ]
+  fi
+],
+[
+  if test "x$ac_system" = "xLinux"; then
+    with_liblvm2app="yes"
+  else
+    with_liblvm2app="no (Linux only library)"
+  fi
+]
 )
 
 if test "x$with_liblvm2app" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_liblvm2app_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_liblvm2app_cppflags"
 
-  AC_CHECK_HEADERS([lvm2app.h],
-    [with_liblvm2app="yes"],
-    [with_liblvm2app="no (lvm2app.h not found)"]
-  )
+AC_CHECK_HEADERS([lvm2app.h],
+  [with_liblvm2app="yes"],
+  [with_liblvm2app="no (lvm2app.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_liblvm2app" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  SAVE_LDFLAGS="$LDFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_liblvm2app_cppflags"
-  LDFLAGS="$LDFLAGS $with_liblvm2app_ldflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+SAVE_LDFLAGS="$LDFLAGS"
+CPPFLAGS="$CPPFLAGS $with_liblvm2app_cppflags"
+LDFLAGS="$LDFLAGS $with_liblvm2app_ldflags"
 
-  AC_CHECK_LIB([lvm2app], [lvm_lv_get_property],
-    [with_liblvm2app="yes"],
-    [with_liblvm2app="no (Symbol 'lvm_lv_get_property' not found)"]
-  )
+AC_CHECK_LIB([lvm2app], [lvm_lv_get_property],
+  [with_liblvm2app="yes"],
+  [with_liblvm2app="no (Symbol 'lvm_lv_get_property' not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
-  LDFLAGS="$SAVE_LDFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_liblvm2app" = "xyes"; then
-  BUILD_WITH_LIBLVM2APP_CPPFLAGS="$with_liblvm2app_cppflags"
-  BUILD_WITH_LIBLVM2APP_LDFLAGS="$with_liblvm2app_ldflags"
-  BUILD_WITH_LIBLVM2APP_LIBS="-llvm2app"
+BUILD_WITH_LIBLVM2APP_CPPFLAGS="$with_liblvm2app_cppflags"
+BUILD_WITH_LIBLVM2APP_LDFLAGS="$with_liblvm2app_ldflags"
+BUILD_WITH_LIBLVM2APP_LIBS="-llvm2app"
 fi
 
 AC_SUBST([BUILD_WITH_LIBLVM2APP_CPPFLAGS])
@@ -3242,50 +3242,50 @@ AC_SUBST([BUILD_WITH_LIBLVM2APP_LIBS])
 
 # --with-libmemcached {{{
 AC_ARG_WITH([libmemcached],
-  [AS_HELP_STRING([--with-libmemcached@<:@=PREFIX@:>@], [Path to libmemcached.])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      with_libmemcached_cppflags="-I$withval/include"
-      with_libmemcached_ldflags="-L$withval/lib"
-      with_libmemcached="yes"
-    else
-      with_libmemcached="$withval"
-    fi
-  ],
-  [with_libmemcached="yes"]
+[AS_HELP_STRING([--with-libmemcached@<:@=PREFIX@:>@], [Path to libmemcached.])],
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    with_libmemcached_cppflags="-I$withval/include"
+    with_libmemcached_ldflags="-L$withval/lib"
+    with_libmemcached="yes"
+  else
+    with_libmemcached="$withval"
+  fi
+],
+[with_libmemcached="yes"]
 )
 
 if test "x$with_libmemcached" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libmemcached_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libmemcached_cppflags"
 
-  AC_CHECK_HEADERS([libmemcached/memcached.h],
-    [with_libmemcached="yes"],
-    [with_libmemcached="no (libmemcached/memcached.h not found)"]
-  )
+AC_CHECK_HEADERS([libmemcached/memcached.h],
+  [with_libmemcached="yes"],
+  [with_libmemcached="no (libmemcached/memcached.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libmemcached" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  SAVE_LDFLAGS="$LDFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libmemcached_cppflags"
-  LDFLAGS="$LDFLAGS $with_libmemcached_ldflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+SAVE_LDFLAGS="$LDFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libmemcached_cppflags"
+LDFLAGS="$LDFLAGS $with_libmemcached_ldflags"
 
-  AC_CHECK_LIB([memcached], [memcached_create],
-    [with_libmemcached="yes"],
-    [with_libmemcached="no (Symbol 'memcached_create' not found)"]
-  )
+AC_CHECK_LIB([memcached], [memcached_create],
+  [with_libmemcached="yes"],
+  [with_libmemcached="no (Symbol 'memcached_create' not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
-  LDFLAGS="$SAVE_LDFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libmemcached" = "xyes"; then
-  BUILD_WITH_LIBMEMCACHED_CPPFLAGS="$with_libmemcached_cppflags"
-  BUILD_WITH_LIBMEMCACHED_LDFLAGS="$with_libmemcached_ldflags"
-  BUILD_WITH_LIBMEMCACHED_LIBS="-lmemcached"
+BUILD_WITH_LIBMEMCACHED_CPPFLAGS="$with_libmemcached_cppflags"
+BUILD_WITH_LIBMEMCACHED_LDFLAGS="$with_libmemcached_ldflags"
+BUILD_WITH_LIBMEMCACHED_LIBS="-lmemcached"
 fi
 
 AC_SUBST([BUILD_WITH_LIBMEMCACHED_CPPFLAGS])
@@ -3297,27 +3297,27 @@ AC_SUBST([BUILD_WITH_LIBMEMCACHED_LIBS])
 with_libmicrohttpd_cppflags=""
 with_libmicrohttpd_ldflags=""
 AC_ARG_WITH([libmicrohttpd], [AS_HELP_STRING([--with-libmicrohttpd@<:@=PREFIX@:>@], [Path to libmicrohttpd.])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      with_libmicrohttpd_cppflags="-I$withval/include"
-      with_libmicrohttpd_ldflags="-L$withval/lib"
-      with_libmicrohttpd="yes"
-    fi
-    if test "x$withval" = "xno"; then
-      with_libmicrohttpd="no (disabled on command line)"
-    fi
-  ],
-  [withval="yes"]
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    with_libmicrohttpd_cppflags="-I$withval/include"
+    with_libmicrohttpd_ldflags="-L$withval/lib"
+    with_libmicrohttpd="yes"
+  fi
+  if test "x$withval" = "xno"; then
+    with_libmicrohttpd="no (disabled on command line)"
+  fi
+],
+[withval="yes"]
 )
 if test "x$withval" = "xyes"; then
-  PKG_CHECK_MODULES([MICROHTTPD], [libmicrohttpd],
-    [with_libmicrohttpd="yes"],
-    [with_libmicrohttpd="no (pkg-config could not find libmicrohttpd)"]
-  )
+PKG_CHECK_MODULES([MICROHTTPD], [libmicrohttpd],
+  [with_libmicrohttpd="yes"],
+  [with_libmicrohttpd="no (pkg-config could not find libmicrohttpd)"]
+)
 fi
 
 if test "x$MICROHTTPD_LIBS" = "x"; then
-  MICROHTTPD_LIBS="-lmicrohttpd"
+MICROHTTPD_LIBS="-lmicrohttpd"
 fi
 
 SAVE_CPPFLAGS="$CPPFLAGS"
@@ -3328,17 +3328,17 @@ LDFLAGS="$with_libmicrohttpd_ldflags $LDFLAGS"
 LIBS="$LIBS $MICROHTTPD_LIBS"
 
 if test "x$with_libmicrohttpd" = "xyes"; then
-  AC_CHECK_HEADERS([microhttpd.h],
-   [with_libmicrohttpd="yes"],
-   [with_libmicrohttpd="no (<microhttpd.h> not found)"]
-  )
+AC_CHECK_HEADERS([microhttpd.h],
+  [with_libmicrohttpd="yes"],
+  [with_libmicrohttpd="no (<microhttpd.h> not found)"]
+)
 fi
 
 if test "x$with_libmicrohttpd" = "xyes"; then
-  AC_CHECK_LIB([microhttpd], [MHD_start_daemon],
-    [with_libmicrohttpd="yes"],
-    [with_libmicrohttpd="no (libmicrohttpd not found)"]
-  )
+AC_CHECK_LIB([microhttpd], [MHD_start_daemon],
+  [with_libmicrohttpd="yes"],
+  [with_libmicrohttpd="no (libmicrohttpd not found)"]
+)
 fi
 
 CPPFLAGS="$SAVE_CPPFLAGS"
@@ -3355,73 +3355,73 @@ AC_SUBST([BUILD_WITH_LIBMICROHTTPD_LIBS])
 
 # --with-libmodbus {{{
 AC_ARG_WITH([libmodbus],
-  [AS_HELP_STRING([--with-libmodbus@<:@=PREFIX@:>@], [Path to the modbus library.])],
-  [
-    if test "x$withval" = "xno"; then
-      with_libmodbus="no"
-    else if test "x$withval" = "xyes"; then
-      with_libmodbus="use_pkgconfig"
-    else if test -d "$with_libmodbus/lib"; then
-      AC_MSG_NOTICE([Not checking for libmodbus: Manually configured])
-      with_libmodbus_cflags="-I$withval/include"
-      with_libmodbus_libs="-L$withval/lib -lmodbus"
-      with_libmodbus="yes"
-    fi; fi; fi
-  ],
-  [with_libmodbus="use_pkgconfig"]
+[AS_HELP_STRING([--with-libmodbus@<:@=PREFIX@:>@], [Path to the modbus library.])],
+[
+  if test "x$withval" = "xno"; then
+    with_libmodbus="no"
+  else if test "x$withval" = "xyes"; then
+    with_libmodbus="use_pkgconfig"
+  else if test -d "$with_libmodbus/lib"; then
+    AC_MSG_NOTICE([Not checking for libmodbus: Manually configured])
+    with_libmodbus_cflags="-I$withval/include"
+    with_libmodbus_libs="-L$withval/lib -lmodbus"
+    with_libmodbus="yes"
+  fi; fi; fi
+],
+[with_libmodbus="use_pkgconfig"]
 )
 
 # configure using pkg-config
 if test "x$with_libmodbus" = "xuse_pkgconfig"; then
-  $PKG_CONFIG --exists 'libmodbus' 2>/dev/null
-  if test $? -ne 0; then
-    with_libmodbus="no (pkg-config doesn't know libmodbus)"
-  fi
+$PKG_CONFIG --exists 'libmodbus' 2>/dev/null
+if test $? -ne 0; then
+  with_libmodbus="no (pkg-config doesn't know libmodbus)"
+fi
 fi
 
 if test "x$with_libmodbus" = "xuse_pkgconfig"; then
-  with_libmodbus_cflags="`$PKG_CONFIG --cflags 'libmodbus'`"
-  if test $? -ne 0; then
-    with_libmodbus="no ($PKG_CONFIG failed)"
-  fi
+with_libmodbus_cflags="`$PKG_CONFIG --cflags 'libmodbus'`"
+if test $? -ne 0; then
+  with_libmodbus="no ($PKG_CONFIG failed)"
+fi
 
-  with_libmodbus_libs="`$PKG_CONFIG --libs 'libmodbus'`"
-  if test $? -ne 0; then
-    with_libmodbus="no ($PKG_CONFIG failed)"
-  fi
+with_libmodbus_libs="`$PKG_CONFIG --libs 'libmodbus'`"
+if test $? -ne 0; then
+  with_libmodbus="no ($PKG_CONFIG failed)"
+fi
 fi
 
 if test "x$with_libmodbus" = "xuse_pkgconfig"; then
-  with_libmodbus="yes"
+with_libmodbus="yes"
 fi
 
 if test "x$with_libmodbus" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libmodbus_cflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libmodbus_cflags"
 
-  AC_CHECK_HEADERS([modbus.h],
-    [with_libmodbus="yes"],
-    [with_libmodbus="no (modbus.h not found)"]
-  )
+AC_CHECK_HEADERS([modbus.h],
+  [with_libmodbus="yes"],
+  [with_libmodbus="no (modbus.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libmodbus" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_libmodbus_libs"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_libmodbus_libs"
 
-  AC_CHECK_LIB([modbus], [modbus_connect],
-    [with_libmodbus="yes"],
-    [with_libmodbus="no (symbol modbus_connect not found)"]
-  )
+AC_CHECK_LIB([modbus], [modbus_connect],
+  [with_libmodbus="yes"],
+  [with_libmodbus="no (symbol modbus_connect not found)"]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libmodbus" = "xyes"; then
-  BUILD_WITH_LIBMODBUS_CFLAGS="$with_libmodbus_cflags"
-  BUILD_WITH_LIBMODBUS_LIBS="$with_libmodbus_libs"
+BUILD_WITH_LIBMODBUS_CFLAGS="$with_libmodbus_cflags"
+BUILD_WITH_LIBMODBUS_LIBS="$with_libmodbus_libs"
 fi
 
 AC_SUBST([BUILD_WITH_LIBMODBUS_CFLAGS])
@@ -3430,59 +3430,59 @@ AC_SUBST([BUILD_WITH_LIBMODBUS_LIBS])
 
 # --with-libmongoc {{{
 AC_ARG_WITH([libmongoc],
-  [AS_HELP_STRING([--with-libmongoc@<:@=PREFIX@:>@], [Path to libmongoc.])],
-  [
-    if test "x$withval" = "xyes"; then
-      with_libmongoc="yes"
-    else if test "x$withval" = "xno"; then
-      with_libmongoc="no"
-    else
-      with_libmongoc="no"
-    fi; fi
-  ],
-  [with_libmongoc="yes"]
+[AS_HELP_STRING([--with-libmongoc@<:@=PREFIX@:>@], [Path to libmongoc.])],
+[
+  if test "x$withval" = "xyes"; then
+    with_libmongoc="yes"
+  else if test "x$withval" = "xno"; then
+    with_libmongoc="no"
+  else
+    with_libmongoc="no"
+  fi; fi
+],
+[with_libmongoc="yes"]
 )
 
 if test "x$with_libmongoc" = "xyes"; then
-  PKG_CHECK_MODULES([LIBMONGOC], [libmongoc-1.0],
-    [with_libmongoc="yes"],
-    [with_libmongoc="no (pkg-config could not find libmongoc)"]
-  )
+PKG_CHECK_MODULES([LIBMONGOC], [libmongoc-1.0],
+  [with_libmongoc="yes"],
+  [with_libmongoc="no (pkg-config could not find libmongoc)"]
+)
 fi
 
 if test "x$with_libmongoc" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
+SAVE_CPPFLAGS="$CPPFLAGS"
 
-  CPPFLAGS="$CPPFLAGS $LIBMONGOC_CFLAGS"
+CPPFLAGS="$CPPFLAGS $LIBMONGOC_CFLAGS"
 
-  AC_CHECK_HEADERS([mongoc.h],
-    [with_libmongoc="yes"],
-    [with_libmongoc="no ('mongoc.h' not found)"]
-  )
+AC_CHECK_HEADERS([mongoc.h],
+  [with_libmongoc="yes"],
+  [with_libmongoc="no ('mongoc.h' not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libmongoc" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  SAVE_LDFLAGS="$LDFLAGS"
+SAVE_CPPFLAGS="$CPPFLAGS"
+SAVE_LDFLAGS="$LDFLAGS"
 
-  CPPFLAGS="$CPPFLAGS $LIBMONGOC_CFLAGS"
-  LDFLAGS="$LDFLAGS $LIBMONGOC_LDFLAGS"
+CPPFLAGS="$CPPFLAGS $LIBMONGOC_CFLAGS"
+LDFLAGS="$LDFLAGS $LIBMONGOC_LDFLAGS"
 
-  AC_CHECK_LIB([mongoc-1.0], [mongoc_init],
-    [with_libmongoc="yes"],
-    [with_libmongoc="no (symbol 'mongoc_init' not found)"]
-  )
+AC_CHECK_LIB([mongoc-1.0], [mongoc_init],
+  [with_libmongoc="yes"],
+  [with_libmongoc="no (symbol 'mongoc_init' not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
-  LDFLAGS="$SAVE_LDFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libmongoc" = "xyes"; then
-  BUILD_WITH_LIBMONGOC_CFLAGS="$LIBMONGOC_CFLAGS"
-  BUILD_WITH_LIBMONGOC_LDFLAGS="$LIBMONGOC_LDFLAGS"
-  BUILD_WITH_LIBMONGOC_LIBS="$LIBMONGOC_LIBS"
+BUILD_WITH_LIBMONGOC_CFLAGS="$LIBMONGOC_CFLAGS"
+BUILD_WITH_LIBMONGOC_LDFLAGS="$LIBMONGOC_LDFLAGS"
+BUILD_WITH_LIBMONGOC_LIBS="$LIBMONGOC_LIBS"
 fi
 
 AC_SUBST([BUILD_WITH_LIBMONGOC_CFLAGS])
@@ -3492,47 +3492,47 @@ AC_SUBST([BUILD_WITH_LIBMONGOC_LIBS])
 
 # --with-libmosquitto {{{
 AC_ARG_WITH([libmosquitto],
-  [AS_HELP_STRING([--with-libmosquitto@<:@=PREFIX@:>@], [Path to libmosquitto.])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      with_libmosquitto_cppflags="-I$withval/include"
-      with_libmosquitto_ldflags="-L$withval/lib"
-      with_libmosquitto="yes"
-    else
-      with_libmosquitto="$withval"
-    fi
-  ],
-  [with_libmosquitto="yes"]
+[AS_HELP_STRING([--with-libmosquitto@<:@=PREFIX@:>@], [Path to libmosquitto.])],
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    with_libmosquitto_cppflags="-I$withval/include"
+    with_libmosquitto_ldflags="-L$withval/lib"
+    with_libmosquitto="yes"
+  else
+    with_libmosquitto="$withval"
+  fi
+],
+[with_libmosquitto="yes"]
 )
 
 if test "x$with_libmosquitto" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libmosquitto_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libmosquitto_cppflags"
 
-  AC_CHECK_HEADERS([mosquitto.h],
-    [with_libmosquitto="yes"],
-    [with_libmosquitto="no (mosquitto.h not found)"]
-  )
+AC_CHECK_HEADERS([mosquitto.h],
+  [with_libmosquitto="yes"],
+  [with_libmosquitto="no (mosquitto.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libmosquitto" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_libmosquitto_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_libmosquitto_ldflags"
 
-  AC_CHECK_LIB([mosquitto], [mosquitto_connect],
-    [with_libmosquitto="yes"],
-    [with_libmosquitto="no (libmosquitto not found)"]
-  )
+AC_CHECK_LIB([mosquitto], [mosquitto_connect],
+  [with_libmosquitto="yes"],
+  [with_libmosquitto="no (libmosquitto not found)"]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libmosquitto" = "xyes"; then
-  BUILD_WITH_LIBMOSQUITTO_CPPFLAGS="$with_libmosquitto_cppflags"
-  BUILD_WITH_LIBMOSQUITTO_LDFLAGS="$with_libmosquitto_ldflags"
-  BUILD_WITH_LIBMOSQUITTO_LIBS="-lmosquitto"
+BUILD_WITH_LIBMOSQUITTO_CPPFLAGS="$with_libmosquitto_cppflags"
+BUILD_WITH_LIBMOSQUITTO_LDFLAGS="$with_libmosquitto_ldflags"
+BUILD_WITH_LIBMOSQUITTO_LIBS="-lmosquitto"
 fi
 
 AC_SUBST([BUILD_WITH_LIBMOSQUITTO_CPPFLAGS])
@@ -3541,75 +3541,75 @@ AC_SUBST([BUILD_WITH_LIBMOSQUITTO_LIBS])
 # }}}
 
 # --with-libmysql {{{
-with_mysql_config="mysql_config"
-AC_ARG_WITH([libmysql],
-  [AS_HELP_STRING([--with-libmysql@<:@=PREFIX@:>@], [Path to libmysql.])],
-  [
-    if test "x$withval" = "xno"; then
-      with_libmysql="no"
-    else if test "x$withval" = "xyes"; then
-      with_libmysql="yes"
-    else
-      if test -f "$withval" && test -x "$withval"; then
-        with_mysql_config="$withval"
-      else if test -x "$withval/bin/mysql_config"; then
-        with_mysql_config="$withval/bin/mysql_config"
-      fi; fi
-      with_libmysql="yes"
+with_mysql_config="mysql_config"
+AC_ARG_WITH([libmysql],
+[AS_HELP_STRING([--with-libmysql@<:@=PREFIX@:>@], [Path to libmysql.])],
+[
+  if test "x$withval" = "xno"; then
+    with_libmysql="no"
+  else if test "x$withval" = "xyes"; then
+    with_libmysql="yes"
+  else
+    if test -f "$withval" && test -x "$withval"; then
+      with_mysql_config="$withval"
+    else if test -x "$withval/bin/mysql_config"; then
+      with_mysql_config="$withval/bin/mysql_config"
     fi; fi
-  ],
-  [with_libmysql="yes"]
+    with_libmysql="yes"
+  fi; fi
+],
+[with_libmysql="yes"]
 )
 
 if test "x$with_libmysql" = "xyes"; then
-  with_mysql_cflags=`$with_mysql_config --include 2>/dev/null`
-  if test $? -ne 0; then
-    with_libmysql="no ($with_mysql_config failed)"
-  else
-    SAVE_CPPFLAGS="$CPPFLAGS"
-    CPPFLAGS="$CPPFLAGS $with_mysql_cflags"
-
-    AC_CHECK_HEADERS([mysql.h],
-      [have_mysql_h="yes"],
-      [have_mysql_h="no"]
-    )
+with_mysql_cflags=`$with_mysql_config --include 2>/dev/null`
+if test $? -ne 0; then
+  with_libmysql="no ($with_mysql_config failed)"
+else
+  SAVE_CPPFLAGS="$CPPFLAGS"
+  CPPFLAGS="$CPPFLAGS $with_mysql_cflags"
 
-    if test "x$have_mysql_h" != "xyes"; then
-      AC_CHECK_HEADERS([mysql/mysql.h],
-        [have_mysql_mysql_h="yes"],
-        [],
-      )
-    fi
+  AC_CHECK_HEADERS([mysql.h],
+    [have_mysql_h="yes"],
+    [have_mysql_h="no"]
+  )
 
-    if test "x$have_mysql_h" != "xyes" && test "x$have_mysql_mysql_h" != "xyes"; then
-      with_libmysql="no (mysql.h not found)"
-    fi
+  if test "x$have_mysql_h" != "xyes"; then
+    AC_CHECK_HEADERS([mysql/mysql.h],
+      [have_mysql_mysql_h="yes"],
+      [],
+    )
+  fi
 
-    CPPFLAGS="$SAVE_CPPFLAGS"
+  if test "x$have_mysql_h" != "xyes" && test "x$have_mysql_mysql_h" != "xyes"; then
+    with_libmysql="no (mysql.h not found)"
   fi
+
+  CPPFLAGS="$SAVE_CPPFLAGS"
+fi
 fi
 
 if test "x$with_libmysql" = "xyes"; then
-  with_mysql_libs=`$with_mysql_config --libs_r 2>/dev/null`
-  if test $? -ne 0; then
-    with_libmysql="no ($with_mysql_config failed)"
-  else
-    SAVE_LIBS="$LIBS"
-    LIBS="$with_mysql_libs"
+with_mysql_libs=`$with_mysql_config --libs_r 2>/dev/null`
+if test $? -ne 0; then
+  with_libmysql="no ($with_mysql_config failed)"
+else
+  SAVE_LIBS="$LIBS"
+  LIBS="$with_mysql_libs"
 
-    AC_SEARCH_LIBS([mysql_get_server_version],
-      [],
-      [with_libmysql="yes"],
-      [with_libmysql="no (symbol 'mysql_get_server_version' not found in ${LIBS})"],
-      []
-    )
-    LIBS="$SAVE_LIBS"
-  fi
+  AC_SEARCH_LIBS([mysql_get_server_version],
+    [],
+    [with_libmysql="yes"],
+    [with_libmysql="no (symbol 'mysql_get_server_version' not found in ${LIBS})"],
+    []
+  )
+  LIBS="$SAVE_LIBS"
+fi
 fi
 
 if test "x$with_libmysql" = "xyes"; then
-  BUILD_WITH_LIBMYSQL_CFLAGS="$with_mysql_cflags"
-  BUILD_WITH_LIBMYSQL_LIBS="$with_mysql_libs"
+BUILD_WITH_LIBMYSQL_CFLAGS="$with_mysql_cflags"
+BUILD_WITH_LIBMYSQL_LIBS="$with_mysql_libs"
 fi
 
 AC_SUBST([BUILD_WITH_LIBMYSQL_CFLAGS])
@@ -3618,131 +3618,131 @@ AC_SUBST([BUILD_WITH_LIBMYSQL_LIBS])
 
 # --with-libmnl {{{
 AC_ARG_WITH([libmnl],
-  [AS_HELP_STRING([--with-libmnl@<:@=PREFIX@:>@], [Path to libmnl.])],
-  [
-    if test "x$withval" = "xyes"; then
-      with_libmnl="yes"
-     else if test "x$withval" = "xno"; then
-       with_libmnl="no"
-     else
-       if test -d "$withval/include"; then
-         with_libmnl_cflags="-I$withval/include"
-         with_libmnl_libs="-L$withval/lib -lmnl"
-         with_libmnl="yes"
-       else
-         AC_MSG_ERROR("no such directory: $withval/include")
-       fi
-     fi; fi
-  ],
-  [
-    if test "x$ac_system" = "xLinux"; then
-      with_libmnl="yes"
+[AS_HELP_STRING([--with-libmnl@<:@=PREFIX@:>@], [Path to libmnl.])],
+[
+  if test "x$withval" = "xyes"; then
+    with_libmnl="yes"
+    else if test "x$withval" = "xno"; then
+      with_libmnl="no"
     else
-      with_libmnl="no (Linux only library)"
-    fi
-  ]
+      if test -d "$withval/include"; then
+        with_libmnl_cflags="-I$withval/include"
+        with_libmnl_libs="-L$withval/lib -lmnl"
+        with_libmnl="yes"
+      else
+        AC_MSG_ERROR("no such directory: $withval/include")
+      fi
+    fi; fi
+],
+[
+  if test "x$ac_system" = "xLinux"; then
+    with_libmnl="yes"
+  else
+    with_libmnl="no (Linux only library)"
+  fi
+]
 )
 
 if test "x$with_libmnl" = "xyes"; then
-  if $PKG_CONFIG --exists libmnl 2>/dev/null; then
-    with_libmnl_cflags="$with_libmnl_ldflags `$PKG_CONFIG --cflags libmnl`"
-    with_libmnl_libs="$with_libmnl_libs `$PKG_CONFIG --libs libmnl`"
-  fi
+if $PKG_CONFIG --exists libmnl 2>/dev/null; then
+  with_libmnl_cflags="$with_libmnl_ldflags `$PKG_CONFIG --cflags libmnl`"
+  with_libmnl_libs="$with_libmnl_libs `$PKG_CONFIG --libs libmnl`"
+fi
 
-  AC_CHECK_HEADERS([libmnl.h libmnl/libmnl.h],
-    [
-      with_libmnl="yes"
-      break
-    ],
-    [],
-    [[
-      #include <stdio.h>
-      #include <sys/types.h>
-      #include <asm/types.h>
-      #include <sys/socket.h>
-      #include <linux/netlink.h>
-      #include <linux/rtnetlink.h>]]
-  )
+AC_CHECK_HEADERS([libmnl.h libmnl/libmnl.h],
+  [
+    with_libmnl="yes"
+    break
+  ],
+  [],
+  [[
+    #include <stdio.h>
+    #include <sys/types.h>
+    #include <asm/types.h>
+    #include <sys/socket.h>
+    #include <linux/netlink.h>
+    #include <linux/rtnetlink.h>]]
+)
 
-  AC_CHECK_HEADERS([linux/gen_stats.h linux/pkt_sched.h],
-    [],
-    [],
-    [[
-      #include <stdio.h>
-      #include <sys/types.h>
-      #include <asm/types.h>
-      #include <sys/socket.h>
-    ]]
-  )
+AC_CHECK_HEADERS([linux/gen_stats.h linux/pkt_sched.h],
+  [],
+  [],
+  [[
+    #include <stdio.h>
+    #include <sys/types.h>
+    #include <asm/types.h>
+    #include <sys/socket.h>
+  ]]
+)
 
-  AC_COMPILE_IFELSE(
-    [
-      AC_LANG_PROGRAM(
-        [[
-          #include <stdio.h>
-          #include <sys/types.h>
-          #include <asm/types.h>
-          #include <sys/socket.h>
-          #include <linux/netlink.h>
-          #include <linux/rtnetlink.h>
-        ]],
-        [[
-          int retval = TCA_STATS2;
-          return retval;
-        ]]
-      )
-    ],
-    [AC_DEFINE([HAVE_TCA_STATS2], [1], [True if the enum-member TCA_STATS2 exists])]
-  )
+AC_COMPILE_IFELSE(
+  [
+    AC_LANG_PROGRAM(
+      [[
+        #include <stdio.h>
+        #include <sys/types.h>
+        #include <asm/types.h>
+        #include <sys/socket.h>
+        #include <linux/netlink.h>
+        #include <linux/rtnetlink.h>
+      ]],
+      [[
+        int retval = TCA_STATS2;
+        return retval;
+      ]]
+    )
+  ],
+  [AC_DEFINE([HAVE_TCA_STATS2], [1], [True if the enum-member TCA_STATS2 exists])]
+)
 
-  AC_COMPILE_IFELSE(
-    [
-      AC_LANG_PROGRAM(
-        [[
-          #include <stdio.h>
-          #include <sys/types.h>
-          #include <asm/types.h>
-          #include <sys/socket.h>
-          #include <linux/netlink.h>
-          #include <linux/rtnetlink.h>
-        ]],
-        [[
-          int retval = TCA_STATS;
-          return retval;
-        ]]
-      )
-    ],
-    [AC_DEFINE([HAVE_TCA_STATS], 1, [True if the enum-member TCA_STATS exists])]
-  )
+AC_COMPILE_IFELSE(
+  [
+    AC_LANG_PROGRAM(
+      [[
+        #include <stdio.h>
+        #include <sys/types.h>
+        #include <asm/types.h>
+        #include <sys/socket.h>
+        #include <linux/netlink.h>
+        #include <linux/rtnetlink.h>
+      ]],
+      [[
+        int retval = TCA_STATS;
+        return retval;
+      ]]
+    )
+  ],
+  [AC_DEFINE([HAVE_TCA_STATS], 1, [True if the enum-member TCA_STATS exists])]
+)
 
-  AC_CHECK_MEMBERS([struct rtnl_link_stats64.tx_window_errors],
-    [AC_DEFINE(HAVE_RTNL_LINK_STATS64, 1, [Define if struct rtnl_link_stats64 exists and is usable.])],
-    [],
-    [[#include <linux/if_link.h>]]
-  )
+AC_CHECK_MEMBERS([struct rtnl_link_stats64.tx_window_errors],
+  [AC_DEFINE(HAVE_RTNL_LINK_STATS64, 1, [Define if struct rtnl_link_stats64 exists and is usable.])],
+  [],
+  [[#include <linux/if_link.h>]]
+)
 
-  AC_CHECK_MEMBERS([struct rtnl_link_stats.rx_nohandler],
-    [],
-    [],
-    [[#include <linux/if_link.h>]]
-  )
+AC_CHECK_MEMBERS([struct rtnl_link_stats.rx_nohandler],
+  [],
+  [],
+  [[#include <linux/if_link.h>]]
+)
 
-  AC_CHECK_MEMBERS([struct rtnl_link_stats64.rx_nohandler],
-    [],
-    [],
-    [[#include <linux/if_link.h>]]
-  )
+AC_CHECK_MEMBERS([struct rtnl_link_stats64.rx_nohandler],
+  [],
+  [],
+  [[#include <linux/if_link.h>]]
+)
 
-  AC_CHECK_LIB([mnl], [mnl_nlmsg_get_payload],
-    [with_libmnl="yes"],
-    [with_libmnl="no (symbol 'mnl_nlmsg_get_payload' not found)"],
-    [$with_libmnl_libs]
-  )
+AC_CHECK_LIB([mnl], [mnl_nlmsg_get_payload],
+  [with_libmnl="yes"],
+  [with_libmnl="no (symbol 'mnl_nlmsg_get_payload' not found)"],
+  [$with_libmnl_libs]
+)
 fi
 
 if test "x$with_libmnl" = "xyes"; then
-  BUILD_WITH_LIBMNL_CFLAGS="$with_libmnl_cflags"
-  BUILD_WITH_LIBMNL_LIBS="$with_libmnl_libs"
+BUILD_WITH_LIBMNL_CFLAGS="$with_libmnl_cflags"
+BUILD_WITH_LIBMNL_LIBS="$with_libmnl_libs"
 fi
 AC_SUBST([BUILD_WITH_LIBMNL_CFLAGS])
 AC_SUBST([BUILD_WITH_LIBMNL_LIBS])
@@ -3754,17 +3754,17 @@ AC_ARG_VAR([LIBNETAPP_CPPFLAGS], [C preprocessor flags required to build with li
 AC_ARG_VAR([LIBNETAPP_LDFLAGS],  [Linker flags required to build with libnetapp])
 AC_ARG_VAR([LIBNETAPP_LIBS],     [Other libraries required to link against libnetapp])
 AC_ARG_WITH([libnetapp],
-  [AS_HELP_STRING([--with-libnetapp@<:@=PREFIX@:>@], [Path to libnetapp.])],
-  [
-   if test -d "$withval"; then
-     LIBNETAPP_CPPFLAGS="$LIBNETAPP_CPPFLAGS -I$withval/include"
-     LIBNETAPP_LDFLAGS="$LIBNETAPP_LDFLAGS -L$withval/lib"
-     with_libnetapp="yes"
-   else
-     with_libnetapp="$withval"
-   fi
-  ],
-  [with_libnetapp="yes"]
+[AS_HELP_STRING([--with-libnetapp@<:@=PREFIX@:>@], [Path to libnetapp.])],
+[
+  if test -d "$withval"; then
+    LIBNETAPP_CPPFLAGS="$LIBNETAPP_CPPFLAGS -I$withval/include"
+    LIBNETAPP_LDFLAGS="$LIBNETAPP_LDFLAGS -L$withval/lib"
+    with_libnetapp="yes"
+  else
+    with_libnetapp="$withval"
+  fi
+],
+[with_libnetapp="yes"]
 )
 
 SAVE_CPPFLAGS="$CPPFLAGS"
@@ -3773,24 +3773,24 @@ CPPFLAGS="$CPPFLAGS $LIBNETAPP_CPPFLAGS"
 LDFLAGS="$LDFLAGS $LIBNETAPP_LDFLAGS"
 
 if test "x$with_libnetapp" = "xyes"; then
-  AC_CHECK_HEADERS([netapp_api.h],
-    [with_libnetapp="yes"],
-    [with_libnetapp="no (netapp_api.h not found)"]
-  )
+AC_CHECK_HEADERS([netapp_api.h],
+  [with_libnetapp="yes"],
+  [with_libnetapp="no (netapp_api.h not found)"]
+)
 fi
 
 if test "x$with_libnetapp" = "xyes"; then
-  if test "x$LIBNETAPP_LIBS" = "x"; then
-    LIBNETAPP_LIBS="$PTHREAD_LIBS -lxml -ladt -lssl -lm -lcrypto -lz"
-  fi
+if test "x$LIBNETAPP_LIBS" = "x"; then
+  LIBNETAPP_LIBS="$PTHREAD_LIBS -lxml -ladt -lssl -lm -lcrypto -lz"
+fi
 
-  AC_CHECK_LIB([netapp], [na_server_invoke_elem],
-    [with_libnetapp="yes"],
-    [with_libnetapp="no (symbol na_server_invoke_elem not found)"],
-    [$LIBNETAPP_LIBS]
-  )
+AC_CHECK_LIB([netapp], [na_server_invoke_elem],
+  [with_libnetapp="yes"],
+  [with_libnetapp="no (symbol na_server_invoke_elem not found)"],
+  [$LIBNETAPP_LIBS]
+)
 
-  LIBNETAPP_LIBS="-lnetapp $LIBNETAPP_LIBS"
+LIBNETAPP_LIBS="-lnetapp $LIBNETAPP_LIBS"
 fi
 
 CPPFLAGS="$SAVE_CPPFLAGS"
@@ -3803,115 +3803,115 @@ AC_SUBST([LIBNETAPP_LIBS])
 
 # --with-libnetsnmp {{{
 AC_ARG_WITH([libnetsnmp],
-  [AS_HELP_STRING([--with-libnetsnmp@<:@=PREFIX@:>@], [Path to libnetsnmp.])],
-  [
-    if test "x$withval" = "xno"; then
-     with_libnetsnmp="no"
-    else if test "x$withval" = "xyes"; then
-     with_libnetsnmp="yes"
-    else
-      with_libnetsnmp_cppflags="-I$withval/include"
-      with_libnetsnmp_ldflags="-I$withval/lib"
-      with_libnetsnmp="yes"
-    fi; fi
-  ],
-  [with_libnetsnmp="yes"]
+[AS_HELP_STRING([--with-libnetsnmp@<:@=PREFIX@:>@], [Path to libnetsnmp.])],
+[
+  if test "x$withval" = "xno"; then
+    with_libnetsnmp="no"
+  else if test "x$withval" = "xyes"; then
+    with_libnetsnmp="yes"
+  else
+    with_libnetsnmp_cppflags="-I$withval/include"
+    with_libnetsnmp_ldflags="-I$withval/lib"
+    with_libnetsnmp="yes"
+  fi; fi
+],
+[with_libnetsnmp="yes"]
 )
 
 if test "x$with_libnetsnmp" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libnetsnmp_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libnetsnmp_cppflags"
 
-  AC_CHECK_HEADERS([net-snmp/net-snmp-config.h],
-    [with_libnetsnmp="yes"],
-    [with_libnetsnmp="no (net-snmp/net-snmp-config.h not found)"]
-  )
+AC_CHECK_HEADERS([net-snmp/net-snmp-config.h],
+  [with_libnetsnmp="yes"],
+  [with_libnetsnmp="no (net-snmp/net-snmp-config.h not found)"]
+)
 
-  AC_CHECK_HEADERS([net-snmp/net-snmp-includes.h],
-    [with_libnetsnmp="yes"],
-    [with_libnetsnmp="no (net-snmp/net-snmp-includes.h not found)"],
-    [[
-      #if HAVE_NET_SNMP_NET_SNMP_CONFIG_H
-      # include <net-snmp/net-snmp-config.h>
-      #endif
-    ]]
-  )
+AC_CHECK_HEADERS([net-snmp/net-snmp-includes.h],
+  [with_libnetsnmp="yes"],
+  [with_libnetsnmp="no (net-snmp/net-snmp-includes.h not found)"],
+  [[
+    #if HAVE_NET_SNMP_NET_SNMP_CONFIG_H
+    # include <net-snmp/net-snmp-config.h>
+    #endif
+  ]]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libnetsnmp" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_libnetsnmp_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_libnetsnmp_ldflags"
 
-  AC_CHECK_LIB([netsnmp], [init_snmp],
-    [with_libnetsnmp="yes"],
-    [with_libnetsnmp="no (libnetsnmp not found)"]
-  )
+AC_CHECK_LIB([netsnmp], [init_snmp],
+  [with_libnetsnmp="yes"],
+  [with_libnetsnmp="no (libnetsnmp not found)"]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libnetsnmp" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_libnetsnmp_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_libnetsnmp_ldflags"
 
-  AC_CHECK_LIB([netsnmp], [netsnmp_get_version],
-    [with_libnetsnmp="yes"],
-    [with_libnetsnmp="no (couldn't get libnetsnmp version)"]
-  )
+AC_CHECK_LIB([netsnmp], [netsnmp_get_version],
+  [with_libnetsnmp="yes"],
+  [with_libnetsnmp="no (couldn't get libnetsnmp version)"]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libnetsnmp" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  SAVE_LDFLAGS="$LDFLAGS"
-  SAVE_LIBS="$LIBS"
-  CPPFLAGS="$CPPFLAGS $with_libnetsnmp_cppflags -Wall -Werror"
-  LDFLAGS="$LDFLAGS $with_libnetsnmp_ldflags"
-  LIBS="$LIBS -lnetsnmp"
+SAVE_CPPFLAGS="$CPPFLAGS"
+SAVE_LDFLAGS="$LDFLAGS"
+SAVE_LIBS="$LIBS"
+CPPFLAGS="$CPPFLAGS $with_libnetsnmp_cppflags -Wall -Werror"
+LDFLAGS="$LDFLAGS $with_libnetsnmp_ldflags"
+LIBS="$LIBS -lnetsnmp"
 
-  AC_CACHE_CHECK([whether netsnmp library has old API],
-    [c_cv_have_netsnmp_old_api],
-    [
-      AC_LINK_IFELSE(
-        [
-          AC_LANG_PROGRAM(
-            [[
-              #include <net-snmp/net-snmp-config.h>
-              #include <net-snmp/net-snmp-includes.h>
-            ]],
-            [[
-              netsnmp_variable_list *key = SNMP_MALLOC_TYPEDEF(netsnmp_variable_list);;
-              int val;
-              u_char type = ASN_INTEGER;
-              snmp_set_var_value(key, &val, sizeof(val));
-              snmp_set_var_typed_value(key, type, &val, sizeof(val));
-              return 0;
-            ]]
-          )
-        ],
-        [c_cv_have_netsnmp_old_api="no"],
-        [c_cv_have_netsnmp_old_api="yes"]
-      )
-    ]
-  )
+AC_CACHE_CHECK([whether netsnmp library has old API],
+  [c_cv_have_netsnmp_old_api],
+  [
+    AC_LINK_IFELSE(
+      [
+        AC_LANG_PROGRAM(
+          [[
+            #include <net-snmp/net-snmp-config.h>
+            #include <net-snmp/net-snmp-includes.h>
+          ]],
+          [[
+            netsnmp_variable_list *key = SNMP_MALLOC_TYPEDEF(netsnmp_variable_list);;
+            int val;
+            u_char type = ASN_INTEGER;
+            snmp_set_var_value(key, &val, sizeof(val));
+            snmp_set_var_typed_value(key, type, &val, sizeof(val));
+            return 0;
+          ]]
+        )
+      ],
+      [c_cv_have_netsnmp_old_api="no"],
+      [c_cv_have_netsnmp_old_api="yes"]
+    )
+  ]
+)
 
-  if test "x$c_cv_have_netsnmp_old_api" = "xyes"; then
-    AC_DEFINE([HAVE_NETSNMP_OLD_API], [1],
-              ["Define 1 if you have old netsnmp API]")
-  fi
+if test "x$c_cv_have_netsnmp_old_api" = "xyes"; then
+  AC_DEFINE([HAVE_NETSNMP_OLD_API], [1],
+            ["Define 1 if you have old netsnmp API]")
+fi
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
-  LDFLAGS="$SAVE_LDFLAGS"
-  LIBS="$SAVE_LIBS"
+CPPFLAGS="$SAVE_CPPFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
+LIBS="$SAVE_LIBS"
 fi
 
 if test "x$with_libnetsnmp" = "xyes"; then
-  BUILD_WITH_LIBNETSNMP_CPPFLAGS="$with_libnetsnmp_cppflags"
-  BUILD_WITH_LIBNETSNMP_LDFLAGS="$with_libnetsnmp_ldflags"
-  BUILD_WITH_LIBNETSNMP_LIBS="-lnetsnmp"
+BUILD_WITH_LIBNETSNMP_CPPFLAGS="$with_libnetsnmp_cppflags"
+BUILD_WITH_LIBNETSNMP_LDFLAGS="$with_libnetsnmp_ldflags"
+BUILD_WITH_LIBNETSNMP_LIBS="-lnetsnmp"
 fi
 
 AC_SUBST([BUILD_WITH_LIBNETSNMP_CPPFLAGS])
@@ -3921,63 +3921,63 @@ AC_SUBST([BUILD_WITH_LIBNETSNMP_LIBS])
 
 # --with-libnetsnmpagent {{{
 AC_ARG_WITH([libnetsnmpagent],
-  [AS_HELP_STRING([--with-libnetsnmpagent@<:@=PREFIX@:>@], [Path to libnetsnmpagent.])],
-  [
-    if test "x$withval" = "xno"; then
-      with_libnetsnmpagent="no"
-    else if test "x$withval" = "xyes"; then
-      with_libnetsnmpagent="yes"
-    else
-      with_libnetsnmpagent_cppflags="-I$withval/include"
-      with_libnetsnmpagent_ldflags="-I$withval/lib"
-      with_libnetsnmpagent="yes"
-    fi; fi
-  ],
-  [with_libnetsnmpagent="yes"]
+[AS_HELP_STRING([--with-libnetsnmpagent@<:@=PREFIX@:>@], [Path to libnetsnmpagent.])],
+[
+  if test "x$withval" = "xno"; then
+    with_libnetsnmpagent="no"
+  else if test "x$withval" = "xyes"; then
+    with_libnetsnmpagent="yes"
+  else
+    with_libnetsnmpagent_cppflags="-I$withval/include"
+    with_libnetsnmpagent_ldflags="-I$withval/lib"
+    with_libnetsnmpagent="yes"
+  fi; fi
+],
+[with_libnetsnmpagent="yes"]
 )
 
 if test "x$with_libnetsnmpagent" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libnetsnmpagent_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libnetsnmpagent_cppflags"
 
-  AC_CHECK_HEADERS([net-snmp/agent/net-snmp-agent-includes.h],
-    [],
-    [with_libnetsnmpagent="no (net-snmp/agent/net-snmp-agent-includes.h not found)"],
-    [[
-      #if HAVE_NET_SNMP_NET_SNMP_CONFIG_H
-      # include <net-snmp/net-snmp-config.h>
-      #endif
-      #if HAVE_NET_SNMP_NET_SNMP_INCLUDES_H
-      # include <net-snmp/net-snmp-includes.h>
-      #endif
-    ]]
-  )
+AC_CHECK_HEADERS([net-snmp/agent/net-snmp-agent-includes.h],
+  [],
+  [with_libnetsnmpagent="no (net-snmp/agent/net-snmp-agent-includes.h not found)"],
+  [[
+    #if HAVE_NET_SNMP_NET_SNMP_CONFIG_H
+    # include <net-snmp/net-snmp-config.h>
+    #endif
+    #if HAVE_NET_SNMP_NET_SNMP_INCLUDES_H
+    # include <net-snmp/net-snmp-includes.h>
+    #endif
+  ]]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libnetsnmpagent" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_libnetsnmpagent_ldflags"
-
-  # older versions of libnetsnmpagent fail to link
-  # against the helpers library, so do that explicitly
-  AC_CHECK_LIB([netsnmphelpers], [netsnmp_init_helpers],
-    [libnetsnmphelpers="-lnetsnmphelpers"],
-    [libnetsnmphelpers=""]
-  )
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_libnetsnmpagent_ldflags"
 
-  AC_CHECK_LIB([netsnmpagent], [init_agent],
-    [with_libnetsnmpagent="yes"],
-    [with_libnetsnmpagent="no (libnetsnmpagent not found)"],
-    [$libnetsnmphelpers]
-  )
+# older versions of libnetsnmpagent fail to link
+# against the helpers library, so do that explicitly
+AC_CHECK_LIB([netsnmphelpers], [netsnmp_init_helpers],
+  [libnetsnmphelpers="-lnetsnmphelpers"],
+  [libnetsnmphelpers=""]
+)
+
+AC_CHECK_LIB([netsnmpagent], [init_agent],
+  [with_libnetsnmpagent="yes"],
+  [with_libnetsnmpagent="no (libnetsnmpagent not found)"],
+  [$libnetsnmphelpers]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libnetsnmpagent" = "xyes"; then
-  BUILD_WITH_LIBNETSNMPAGENT_LIBS="-lnetsnmpagent $libnetsnmphelpers"
+BUILD_WITH_LIBNETSNMPAGENT_LIBS="-lnetsnmpagent $libnetsnmphelpers"
 fi
 
 AC_SUBST([BUILD_WITH_LIBNETSNMPAGENT_CPPFLAGS])
@@ -3987,19 +3987,19 @@ AC_SUBST([BUILD_WITH_LIBNETSNMPAGENT_LIBS])
 
 # --with-liboping {{{
 AC_ARG_WITH([liboping],
-  [AS_HELP_STRING([--with-liboping@<:@=PREFIX@:>@], [Path to liboping.])],
-  [
-    if test "x$withval" = "xyes"; then
-      with_liboping="yes"
-    else if test "x$withval" = "xno"; then
-      with_liboping="no"
-    else
-      with_liboping="yes"
-      LIBOPING_CPPFLAGS="-I$withval/include"
-      LIBOPING_LDFLAGS="-L$withval/lib"
-    fi; fi
-  ],
-  [with_liboping="yes"]
+[AS_HELP_STRING([--with-liboping@<:@=PREFIX@:>@], [Path to liboping.])],
+[
+  if test "x$withval" = "xyes"; then
+    with_liboping="yes"
+  else if test "x$withval" = "xno"; then
+    with_liboping="no"
+  else
+    with_liboping="yes"
+    LIBOPING_CPPFLAGS="-I$withval/include"
+    LIBOPING_LDFLAGS="-L$withval/lib"
+  fi; fi
+],
+[with_liboping="yes"]
 )
 
 SAVE_CPPFLAGS="$CPPFLAGS"
@@ -4008,25 +4008,25 @@ CPPFLAGS="$CPPFLAGS $LIBOPING_CPPFLAGS"
 LDFLAGS="$LDFLAGS $LIBOPING_LDFLAGS"
 
 if test "x$with_liboping" = "xyes"; then
-  AC_CHECK_HEADERS([oping.h],
-    [with_liboping="yes"],
-    [with_liboping="no (oping.h not found)"]
-  )
+AC_CHECK_HEADERS([oping.h],
+  [with_liboping="yes"],
+  [with_liboping="no (oping.h not found)"]
+)
 fi
 
 if test "x$with_liboping" = "xyes"; then
-  AC_CHECK_LIB([oping], [ping_construct],
-    [with_liboping="yes"],
-    [with_liboping="no (symbol 'ping_construct' not found)"]
-  )
+AC_CHECK_LIB([oping], [ping_construct],
+  [with_liboping="yes"],
+  [with_liboping="no (symbol 'ping_construct' not found)"]
+)
 fi
 
 CPPFLAGS="$SAVE_CPPFLAGS"
 LDFLAGS="$SAVE_LDFLAGS"
 
 if test "x$with_liboping" = "xyes"; then
-  BUILD_WITH_LIBOPING_CPPFLAGS="$LIBOPING_CPPFLAGS"
-  BUILD_WITH_LIBOPING_LDFLAGS="$LIBOPING_LDFLAGS"
+BUILD_WITH_LIBOPING_CPPFLAGS="$LIBOPING_CPPFLAGS"
+BUILD_WITH_LIBOPING_LDFLAGS="$LIBOPING_LDFLAGS"
 fi
 
 AC_SUBST([BUILD_WITH_LIBOPING_CPPFLAGS])
@@ -4035,67 +4035,67 @@ AC_SUBST([BUILD_WITH_LIBOPING_LDFLAGS])
 
 # --with-oracle {{{
 AC_ARG_WITH([oracle],
-  [AS_HELP_STRING([--with-oracle@<:@=ORACLE_HOME@:>@], [Path to Oracle.])],
-  [
-    if test "x$withval" = "xyes"; then
-      if test "x$ORACLE_HOME" = "x"; then
-        AC_MSG_WARN([Use of the Oracle library has been forced, but the environment variable ORACLE_HOME is not set.])
-      fi
-      with_oracle="yes"
-    else if test "x$withval" = "xno"; then
-      with_oracle="no"
-    else
-      with_oracle="yes"
-      ORACLE_HOME="$withval"
-    fi; fi
-  ],
-  [
+[AS_HELP_STRING([--with-oracle@<:@=ORACLE_HOME@:>@], [Path to Oracle.])],
+[
+  if test "x$withval" = "xyes"; then
     if test "x$ORACLE_HOME" = "x"; then
-      with_oracle="no (ORACLE_HOME is not set)"
-    else
-      with_oracle="yes"
+      AC_MSG_WARN([Use of the Oracle library has been forced, but the environment variable ORACLE_HOME is not set.])
     fi
-  ]
+    with_oracle="yes"
+  else if test "x$withval" = "xno"; then
+    with_oracle="no"
+  else
+    with_oracle="yes"
+    ORACLE_HOME="$withval"
+  fi; fi
+],
+[
+  if test "x$ORACLE_HOME" = "x"; then
+    with_oracle="no (ORACLE_HOME is not set)"
+  else
+    with_oracle="yes"
+  fi
+]
 )
 
 if test "x$ORACLE_HOME" != "x"; then
-  with_oracle_cppflags="-I$ORACLE_HOME/rdbms/public"
-  if test -e "$ORACLE_HOME/lib/ldflags"; then
-    with_oracle_libs=`cat "$ORACLE_HOME/lib/ldflags"`
-  fi
-  with_oracle_libs="-L$ORACLE_HOME/lib -lclntsh"
+with_oracle_cppflags="-I$ORACLE_HOME/rdbms/public"
+if test -e "$ORACLE_HOME/lib/ldflags"; then
+  with_oracle_libs=`cat "$ORACLE_HOME/lib/ldflags"`
+fi
+with_oracle_libs="-L$ORACLE_HOME/lib -lclntsh"
 fi
 
 if test "x$with_oracle" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_oracle_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_oracle_cppflags"
 
-  AC_CHECK_HEADERS([oci.h],
-    [with_oracle="yes"],
-    [with_oracle="no (oci.h not found)"]
-  )
+AC_CHECK_HEADERS([oci.h],
+  [with_oracle="yes"],
+  [with_oracle="no (oci.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_oracle" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  SAVE_LIBS="$LIBS"
-  CPPFLAGS="$CPPFLAGS $with_oracle_cppflags"
-  LIBS="$LIBS $with_oracle_libs"
+SAVE_CPPFLAGS="$CPPFLAGS"
+SAVE_LIBS="$LIBS"
+CPPFLAGS="$CPPFLAGS $with_oracle_cppflags"
+LIBS="$LIBS $with_oracle_libs"
 
-  AC_CHECK_FUNC([OCIEnvCreate],
-    [with_oracle="yes"],
-    [with_oracle="no (Symbol 'OCIEnvCreate' not found)"]
-  )
+AC_CHECK_FUNC([OCIEnvCreate],
+  [with_oracle="yes"],
+  [with_oracle="no (Symbol 'OCIEnvCreate' not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
-  LIBS="$SAVE_LIBS"
+CPPFLAGS="$SAVE_CPPFLAGS"
+LIBS="$SAVE_LIBS"
 fi
 
 if test "x$with_oracle" = "xyes"; then
-  BUILD_WITH_ORACLE_CPPFLAGS="$with_oracle_cppflags"
-  BUILD_WITH_ORACLE_LIBS="$with_oracle_libs"
+BUILD_WITH_ORACLE_CPPFLAGS="$with_oracle_cppflags"
+BUILD_WITH_ORACLE_LIBS="$with_oracle_libs"
 fi
 
 AC_SUBST([BUILD_WITH_ORACLE_CPPFLAGS])
@@ -4104,47 +4104,47 @@ AC_SUBST([BUILD_WITH_ORACLE_LIBS])
 
 # --with-libowcapi {{{
 AC_ARG_WITH([libowcapi],
-  [AS_HELP_STRING([--with-libowcapi@<:@=PREFIX@:>@], [Path to libowcapi.])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      with_libowcapi_cppflags="-I$withval/include"
-      with_libowcapi_ldflags="-L$withval/lib"
-      with_libowcapi="yes"
-    else
-      with_libowcapi="$withval"
-    fi
-  ],
-  [with_libowcapi="yes"]
+[AS_HELP_STRING([--with-libowcapi@<:@=PREFIX@:>@], [Path to libowcapi.])],
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    with_libowcapi_cppflags="-I$withval/include"
+    with_libowcapi_ldflags="-L$withval/lib"
+    with_libowcapi="yes"
+  else
+    with_libowcapi="$withval"
+  fi
+],
+[with_libowcapi="yes"]
 )
 
 if test "x$with_libowcapi" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libowcapi_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libowcapi_cppflags"
 
-  AC_CHECK_HEADERS([owcapi.h],
-    [with_libowcapi="yes"],
-    [with_libowcapi="no (owcapi.h not found)"]
-  )
+AC_CHECK_HEADERS([owcapi.h],
+  [with_libowcapi="yes"],
+  [with_libowcapi="no (owcapi.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libowcapi" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_libowcapi_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_libowcapi_ldflags"
 
-  AC_CHECK_LIB([owcapi], [OW_get],
-    [with_libowcapi="yes"],
-    [with_libowcapi="no (libowcapi not found)"]
-  )
+AC_CHECK_LIB([owcapi], [OW_get],
+  [with_libowcapi="yes"],
+  [with_libowcapi="no (libowcapi not found)"]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libowcapi" = "xyes"; then
-  BUILD_WITH_LIBOWCAPI_CPPFLAGS="$with_libowcapi_cppflags"
-  BUILD_WITH_LIBOWCAPI_LDFLAGS="$with_libowcapi_ldflags"
-  BUILD_WITH_LIBOWCAPI_LIBS="-lowcapi"
+BUILD_WITH_LIBOWCAPI_CPPFLAGS="$with_libowcapi_cppflags"
+BUILD_WITH_LIBOWCAPI_LDFLAGS="$with_libowcapi_ldflags"
+BUILD_WITH_LIBOWCAPI_LIBS="-lowcapi"
 fi
 
 AC_SUBST([BUILD_WITH_LIBOWCAPI_CPPFLAGS])
@@ -4154,72 +4154,72 @@ AC_SUBST([BUILD_WITH_LIBOWCAPI_LIBS])
 
 # --with-libpcap {{{
 AC_ARG_WITH([libpcap],
-  [AS_HELP_STRING([--with-libpcap@<:@=PREFIX@:>@], [Path to libpcap.])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      with_libpcap_cppflags="-I$withval/include"
-      with_libpcap_ldflags="$LDFLAGS -L$withval/lib"
-      with_libpcap="yes"
-    else
-      with_libpcap="$withval"
-    fi
-  ],
-  [with_libpcap="yes"]
+[AS_HELP_STRING([--with-libpcap@<:@=PREFIX@:>@], [Path to libpcap.])],
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    with_libpcap_cppflags="-I$withval/include"
+    with_libpcap_ldflags="$LDFLAGS -L$withval/lib"
+    with_libpcap="yes"
+  else
+    with_libpcap="$withval"
+  fi
+],
+[with_libpcap="yes"]
 )
 
 if test "x$with_libpcap" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libpcap_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libpcap_cppflags"
 
-  AC_CHECK_HEADERS([pcap.h],
-    [with_libpcap="yes"],
-    [with_libpcap="no (pcap.h not found)"]
-  )
+AC_CHECK_HEADERS([pcap.h],
+  [with_libpcap="yes"],
+  [with_libpcap="no (pcap.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libpcap" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_libpcap_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_libpcap_ldflags"
 
-  AC_CHECK_LIB([pcap], [pcap_open_live],
-    [with_libpcap="yes"],
-    [with_libpcap="no (libpcap not found)"]
-  )
+AC_CHECK_LIB([pcap], [pcap_open_live],
+  [with_libpcap="yes"],
+  [with_libpcap="no (libpcap not found)"]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libpcap" = "xyes"; then
-  AC_CACHE_CHECK([whether libpcap has PCAP_ERROR_IFACE_NOT_UP],
-    [c_cv_libpcap_have_pcap_error_iface_not_up],
-    [
-      AC_COMPILE_IFELSE(
-        [
-          AC_LANG_PROGRAM(
-            [[#include <pcap.h>]],
-            [[
-              int val = PCAP_ERROR_IFACE_NOT_UP;
-              return val;
-            ]]
-          )
-        ],
-        [c_cv_libpcap_have_pcap_error_iface_not_up="yes"],
-        [c_cv_libpcap_have_pcap_error_iface_not_up="no"]
-      )
-    ]
-  )
+AC_CACHE_CHECK([whether libpcap has PCAP_ERROR_IFACE_NOT_UP],
+  [c_cv_libpcap_have_pcap_error_iface_not_up],
+  [
+    AC_COMPILE_IFELSE(
+      [
+        AC_LANG_PROGRAM(
+          [[#include <pcap.h>]],
+          [[
+            int val = PCAP_ERROR_IFACE_NOT_UP;
+            return val;
+          ]]
+        )
+      ],
+      [c_cv_libpcap_have_pcap_error_iface_not_up="yes"],
+      [c_cv_libpcap_have_pcap_error_iface_not_up="no"]
+    )
+  ]
+)
 fi
 
 if test "x$c_cv_libpcap_have_pcap_error_iface_not_up" != "xyes"; then
-  with_libpcap="no (pcap.h misses PCAP_ERROR_IFACE_NOT_UP)"
+with_libpcap="no (pcap.h misses PCAP_ERROR_IFACE_NOT_UP)"
 fi
 
 if test "x$with_libpcap" = "xyes"; then
-  BUILD_WITH_LIBPCAP_CPPFLAGS="$with_libpcap_cppflags"
-  BUILD_WITH_LIBPCAP_LDFLAGS="$with_libpcap_ldflags"
-  BUILD_WITH_LIBPCAP_LIBS="-lpcap"
+BUILD_WITH_LIBPCAP_CPPFLAGS="$with_libpcap_cppflags"
+BUILD_WITH_LIBPCAP_LDFLAGS="$with_libpcap_ldflags"
+BUILD_WITH_LIBPCAP_LIBS="-lpcap"
 fi
 
 AC_SUBST([BUILD_WITH_LIBPCAP_CPPFLAGS])
@@ -4229,168 +4229,168 @@ AC_SUBST([BUILD_WITH_LIBPCAP_LIBS])
 
 # --with-libperl {{{
 AC_ARG_WITH([libperl],
-  [AS_HELP_STRING([--with-libperl@<:@=PREFIX@:>@], [Path to libperl.])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      LDFLAGS="$LDFLAGS -L$withval/lib"
-      CPPFLAGS="$CPPFLAGS -I$withval/include"
-      with_libperl="yes"
-    else
-      with_libperl="$withval"
-    fi
-  ],
-  [with_libperl="yes"]
+[AS_HELP_STRING([--with-libperl@<:@=PREFIX@:>@], [Path to libperl.])],
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    LDFLAGS="$LDFLAGS -L$withval/lib"
+    CPPFLAGS="$CPPFLAGS -I$withval/include"
+    with_libperl="yes"
+  else
+    with_libperl="$withval"
+  fi
+],
+[with_libperl="yes"]
 )
 
 AC_ARG_VAR([PERL], [path to Perl interpreter])
 AC_PATH_PROG([PERL], [perl])
 
 if test "x$PERL" = "x"; then
-  with_libperl="no (no Perl interpreter found)"
+with_libperl="no (no Perl interpreter found)"
 fi
 
 if test "x$with_libperl" = "xyes"; then
-  SAVE_CFLAGS="$CFLAGS"
-  SAVE_LIBS="$LIBS"
-  dnl ARCHFLAGS="" -> disable multi -arch on OSX (see Config_heavy.pl:fetch_string)
-  PERL_CFLAGS=`ARCHFLAGS="" $PERL -MExtUtils::Embed -e perl_inc`
-  PERL_LIBS=`ARCHFLAGS="" $PERL -MExtUtils::Embed -e ldopts`
-  CFLAGS="$CFLAGS $PERL_CFLAGS"
-  LIBS="$LIBS $PERL_LIBS"
-
-  AC_CACHE_CHECK([for libperl],
-    [c_cv_have_libperl],
-    [
-      AC_LINK_IFELSE(
-        [
-          AC_LANG_PROGRAM(
-            [[
-              #define PERL_NO_GET_CONTEXT
-              #include <EXTERN.h>
-              #include <perl.h>
-              #include <XSUB.h>
-            ]],
-            [[
-              dTHX;
-              load_module (PERL_LOADMOD_NOIMPORT,
-                newSVpv ("Collectd::Plugin::FooBar", 24),
-                Nullsv);
-            ]]
-          )
-        ],
-        [c_cv_have_libperl="yes"],
-        [c_cv_have_libperl="no"]
-      )
-    ]
-  )
+SAVE_CFLAGS="$CFLAGS"
+SAVE_LIBS="$LIBS"
+dnl ARCHFLAGS="" -> disable multi -arch on OSX (see Config_heavy.pl:fetch_string)
+PERL_CFLAGS=`ARCHFLAGS="" $PERL -MExtUtils::Embed -e perl_inc`
+PERL_LIBS=`ARCHFLAGS="" $PERL -MExtUtils::Embed -e ldopts`
+CFLAGS="$CFLAGS $PERL_CFLAGS"
+LIBS="$LIBS $PERL_LIBS"
+
+AC_CACHE_CHECK([for libperl],
+  [c_cv_have_libperl],
+  [
+    AC_LINK_IFELSE(
+      [
+        AC_LANG_PROGRAM(
+          [[
+            #define PERL_NO_GET_CONTEXT
+            #include <EXTERN.h>
+            #include <perl.h>
+            #include <XSUB.h>
+          ]],
+          [[
+            dTHX;
+            load_module (PERL_LOADMOD_NOIMPORT,
+              newSVpv ("Collectd::Plugin::FooBar", 24),
+              Nullsv);
+          ]]
+        )
+      ],
+      [c_cv_have_libperl="yes"],
+      [c_cv_have_libperl="no"]
+    )
+  ]
+)
 
-  CFLAGS="$SAVE_CFLAGS"
-  LIBS="$SAVE_LIBS"
+CFLAGS="$SAVE_CFLAGS"
+LIBS="$SAVE_LIBS"
 
-  if test "x$c_cv_have_libperl" = "xno"; then
-    with_libperl="no"
-  fi
+if test "x$c_cv_have_libperl" = "xno"; then
+  with_libperl="no"
+fi
 fi
 
 if test "x$with_libperl" = "xyes"; then
-  SAVE_CFLAGS="$CFLAGS"
-  SAVE_LIBS="$LIBS"
-  CFLAGS="$CFLAGS $PERL_CFLAGS"
-  LIBS="$LIBS $PERL_LIBS"
+SAVE_CFLAGS="$CFLAGS"
+SAVE_LIBS="$LIBS"
+CFLAGS="$CFLAGS $PERL_CFLAGS"
+LIBS="$LIBS $PERL_LIBS"
 
-  AC_CACHE_CHECK([if Perl supports ithreads],
-    [c_cv_have_perl_ithreads],
-    [
-      AC_LINK_IFELSE(
-        [
-          AC_LANG_PROGRAM(
-            [[
-              #include <EXTERN.h>
-              #include <perl.h>
-              #include <XSUB.h>
-
-              #if !defined(USE_ITHREADS)
-              # error "Perl does not support ithreads!"
-              #endif /* !defined(USE_ITHREADS) */
-            ]],
-            []
-          )
-        ],
-        [c_cv_have_perl_ithreads="yes"],
-        [c_cv_have_perl_ithreads="no"]
-      )
-    ]
-  )
+AC_CACHE_CHECK([if Perl supports ithreads],
+  [c_cv_have_perl_ithreads],
+  [
+    AC_LINK_IFELSE(
+      [
+        AC_LANG_PROGRAM(
+          [[
+            #include <EXTERN.h>
+            #include <perl.h>
+            #include <XSUB.h>
 
-  CFLAGS="$SAVE_CFLAGS"
-  LIBS="$SAVE_LIBS"
+            #if !defined(USE_ITHREADS)
+            # error "Perl does not support ithreads!"
+            #endif /* !defined(USE_ITHREADS) */
+          ]],
+          []
+        )
+      ],
+      [c_cv_have_perl_ithreads="yes"],
+      [c_cv_have_perl_ithreads="no"]
+    )
+  ]
+)
+
+CFLAGS="$SAVE_CFLAGS"
+LIBS="$SAVE_LIBS"
 fi
 
 if test "x$with_libperl" = "xyes"; then
-  # trigger an error if Perl_load_module*() uses __attribute__nonnull__(3)
-  # (see issues #41 and #42)
-  SAVE_CFLAGS="$CFLAGS"
-  SAVE_LIBS="$LIBS"
-  CFLAGS="$CFLAGS $PERL_CFLAGS -Wall -Werror"
-  LIBS="$LIBS $PERL_LIBS"
+# trigger an error if Perl_load_module*() uses __attribute__nonnull__(3)
+# (see issues #41 and #42)
+SAVE_CFLAGS="$CFLAGS"
+SAVE_LIBS="$LIBS"
+CFLAGS="$CFLAGS $PERL_CFLAGS -Wall -Werror"
+LIBS="$LIBS $PERL_LIBS"
 
-  AC_CACHE_CHECK([for broken Perl_load_module()],
-    [c_cv_have_broken_perl_load_module],
-    [
-      AC_LINK_IFELSE(
-        [
-          AC_LANG_PROGRAM(
-            [[
-              #define PERL_NO_GET_CONTEXT
-              #include <EXTERN.h>
-              #include <perl.h>
-              #include <XSUB.h>
-            ]],
-            [[
-              dTHX;
-              load_module (PERL_LOADMOD_NOIMPORT,
-                newSVpv ("Collectd::Plugin::FooBar", 24),
-                Nullsv);
-            ]]
-          )
-        ],
-        [c_cv_have_broken_perl_load_module="no"],
-        [c_cv_have_broken_perl_load_module="yes"]
-      )
-    ]
-  )
+AC_CACHE_CHECK([for broken Perl_load_module()],
+  [c_cv_have_broken_perl_load_module],
+  [
+    AC_LINK_IFELSE(
+      [
+        AC_LANG_PROGRAM(
+          [[
+            #define PERL_NO_GET_CONTEXT
+            #include <EXTERN.h>
+            #include <perl.h>
+            #include <XSUB.h>
+          ]],
+          [[
+            dTHX;
+            load_module (PERL_LOADMOD_NOIMPORT,
+              newSVpv ("Collectd::Plugin::FooBar", 24),
+              Nullsv);
+          ]]
+        )
+      ],
+      [c_cv_have_broken_perl_load_module="no"],
+      [c_cv_have_broken_perl_load_module="yes"]
+    )
+  ]
+)
 
-  CFLAGS="$SAVE_CFLAGS"
-  LIBS="$SAVE_LIBS"
+CFLAGS="$SAVE_CFLAGS"
+LIBS="$SAVE_LIBS"
 fi
 
 if test "x$c_cv_have_broken_perl_load_module" = "xyes"; then
-  PERL_CFLAGS="$PERL_CFLAGS -Wno-nonnull"
+PERL_CFLAGS="$PERL_CFLAGS -Wno-nonnull"
 fi
 
 if test "x$with_libperl" = "xyes"; then
-  SAVE_CFLAGS="$CFLAGS"
-  SAVE_LIBS="$LIBS"
-  CFLAGS="$CFLAGS $PERL_CFLAGS"
-  LIBS="$LIBS $PERL_LIBS"
+SAVE_CFLAGS="$CFLAGS"
+SAVE_LIBS="$LIBS"
+CFLAGS="$CFLAGS $PERL_CFLAGS"
+LIBS="$LIBS $PERL_LIBS"
 
-  AC_CHECK_MEMBER(
-    [struct mgvtbl.svt_local],
-    [have_struct_mgvtbl_svt_local="yes"],
-    [have_struct_mgvtbl_svt_local="no"],
-    [[
-      #include <EXTERN.h>
-      #include <perl.h>
-      #include <XSUB.h>
-    ]]
-  )
+AC_CHECK_MEMBER(
+  [struct mgvtbl.svt_local],
+  [have_struct_mgvtbl_svt_local="yes"],
+  [have_struct_mgvtbl_svt_local="no"],
+  [[
+    #include <EXTERN.h>
+    #include <perl.h>
+    #include <XSUB.h>
+  ]]
+)
 
-  if test "x$have_struct_mgvtbl_svt_local" = "xyes"; then
-    AC_DEFINE([HAVE_PERL_STRUCT_MGVTBL_SVT_LOCAL], [1], [Define if Perls struct mgvtbl has member svt_local.])
-  fi
+if test "x$have_struct_mgvtbl_svt_local" = "xyes"; then
+  AC_DEFINE([HAVE_PERL_STRUCT_MGVTBL_SVT_LOCAL], [1], [Define if Perls struct mgvtbl has member svt_local.])
+fi
 
-  CFLAGS="$SAVE_CFLAGS"
-  LIBS="$SAVE_LIBS"
+CFLAGS="$SAVE_CFLAGS"
+LIBS="$SAVE_LIBS"
 fi
 AC_SUBST([PERL_CFLAGS])
 AC_SUBST([PERL_LIBS])
@@ -4400,76 +4400,76 @@ AC_SUBST([PERL_LIBS])
 # --with-libpq {{{
 with_pg_config="pg_config"
 AC_ARG_WITH([libpq],
-  [AS_HELP_STRING([--with-libpq@<:@=PREFIX@:>@], [Path to libpq.])],
-  [
-    if test "x$withval" = "xno" || test "x$withval" = "xyes"; then
-      with_libpq="$withval"
-    else
-      if test -f "$withval" && test -x "$withval"; then
-        with_pg_config="$withval"
-      else if test -x "$withval/bin/pg_config"; then
-        with_pg_config="$withval/bin/pg_config"
-      fi; fi
-      with_libpq="yes"
-    fi
-  ],
-  [with_libpq="yes"]
+[AS_HELP_STRING([--with-libpq@<:@=PREFIX@:>@], [Path to libpq.])],
+[
+  if test "x$withval" = "xno" || test "x$withval" = "xyes"; then
+    with_libpq="$withval"
+  else
+    if test -f "$withval" && test -x "$withval"; then
+      with_pg_config="$withval"
+    else if test -x "$withval/bin/pg_config"; then
+      with_pg_config="$withval/bin/pg_config"
+    fi; fi
+    with_libpq="yes"
+  fi
+],
+[with_libpq="yes"]
 )
 
 if test "x$with_libpq" = "xyes"; then
-  with_libpq_includedir=`$with_pg_config --includedir 2> /dev/null`
-  pg_config_status=$?
-
-  if test $pg_config_status -eq 0; then
-    if test -n "$with_libpq_includedir"; then
-      for dir in $with_libpq_includedir; do
-        with_libpq_cppflags="$with_libpq_cppflags -I$dir"
-      done
-    fi
-  else
-    AC_MSG_WARN([$with_pg_config returned with status $pg_config_status])
+with_libpq_includedir=`$with_pg_config --includedir 2> /dev/null`
+pg_config_status=$?
+
+if test $pg_config_status -eq 0; then
+  if test -n "$with_libpq_includedir"; then
+    for dir in $with_libpq_includedir; do
+      with_libpq_cppflags="$with_libpq_cppflags -I$dir"
+    done
   fi
+else
+  AC_MSG_WARN([$with_pg_config returned with status $pg_config_status])
+fi
 
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libpq_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libpq_cppflags"
 
-  AC_CHECK_HEADERS([libpq-fe.h],
-    [with_libpq="yes"],
-    [with_libpq="no (libpq-fe.h not found)"]
-  )
+AC_CHECK_HEADERS([libpq-fe.h],
+  [with_libpq="yes"],
+  [with_libpq="no (libpq-fe.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libpq" = "xyes"; then
-  with_libpq_libdir=`$with_pg_config --libdir 2> /dev/null`
-  pg_config_status=$?
-
-  if test $pg_config_status -eq 0
-  then
-    if test -n "$with_libpq_libdir"; then
-      for dir in $with_libpq_libdir; do
-        with_libpq_ldflags="$with_libpq_ldflags -L$dir"
-      done
-    fi
-  else
-    AC_MSG_WARN([$with_pg_config returned with status $pg_config_status])
+with_libpq_libdir=`$with_pg_config --libdir 2> /dev/null`
+pg_config_status=$?
+
+if test $pg_config_status -eq 0
+then
+  if test -n "$with_libpq_libdir"; then
+    for dir in $with_libpq_libdir; do
+      with_libpq_ldflags="$with_libpq_ldflags -L$dir"
+    done
   fi
+else
+  AC_MSG_WARN([$with_pg_config returned with status $pg_config_status])
+fi
 
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_libpq_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_libpq_ldflags"
 
-  AC_CHECK_LIB([pq], [PQserverVersion],
-    [with_libpq="yes"],
-    [with_libpq="no (symbol 'PQserverVersion' not found)"])
+AC_CHECK_LIB([pq], [PQserverVersion],
+  [with_libpq="yes"],
+  [with_libpq="no (symbol 'PQserverVersion' not found)"])
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libpq" = "xyes"; then
-  BUILD_WITH_LIBPQ_CPPFLAGS="$with_libpq_cppflags"
-  BUILD_WITH_LIBPQ_LDFLAGS="$with_libpq_ldflags"
-  BUILD_WITH_LIBPQ_LIBS="-lpq"
+BUILD_WITH_LIBPQ_CPPFLAGS="$with_libpq_cppflags"
+BUILD_WITH_LIBPQ_LDFLAGS="$with_libpq_ldflags"
+BUILD_WITH_LIBPQ_LIBS="-lpq"
 fi
 
 AC_SUBST([BUILD_WITH_LIBPQ_CPPFLAGS])
@@ -4479,68 +4479,68 @@ AC_SUBST([BUILD_WITH_LIBPQ_LIBS])
 
 # --with-libpqos {{{
 AC_ARG_WITH([libpqos],
-  [AS_HELP_STRING([--with-libpqos@<:@=PREFIX@:>@], [Path to libpqos.])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      with_libpqos_cppflags="-I$withval/include"
-      with_libpqos_ldflags="-L$withval/lib"
-      with_libpqos="yes"
-    else
-      with_libpqos="$withval"
-    fi
-  ],
-  [with_libpqos="yes"]
+[AS_HELP_STRING([--with-libpqos@<:@=PREFIX@:>@], [Path to libpqos.])],
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    with_libpqos_cppflags="-I$withval/include"
+    with_libpqos_ldflags="-L$withval/lib"
+    with_libpqos="yes"
+  else
+    with_libpqos="$withval"
+  fi
+],
+[with_libpqos="yes"]
 )
 
 if test "x$with_libpqos" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libpqos_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libpqos_cppflags"
 
-  AC_CHECK_HEADERS([pqos.h],
-    [with_libpqos="yes"],
-    [with_libpqos="no (pqos.h not found)"]
-  )
+AC_CHECK_HEADERS([pqos.h],
+  [with_libpqos="yes"],
+  [with_libpqos="no (pqos.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libpqos" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_libpqos_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_libpqos_ldflags"
 
-  AC_CHECK_LIB([pqos], [pqos_init],
-    [with_libpqos="yes"],
-    [with_libpqos="no (Can't find libpqos)"]
-  )
+AC_CHECK_LIB([pqos], [pqos_init],
+  [with_libpqos="yes"],
+  [with_libpqos="no (Can't find libpqos)"]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libpqos" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libpqos_cppflags"
-  AC_PREPROC_IFELSE(
-    [
-      AC_LANG_SOURCE(
-        [[
-          #include <pqos.h>
-          #if PQOS_VERSION < 106
-          #error "required PQOS version >= 1.06"
-          #endif
-        ]]
-      )
-    ],
-    [with_libpqos="yes"],
-    [with_libpqos="no (pqos library version 1.06 or higher is required)"]
-  )
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libpqos_cppflags"
+AC_PREPROC_IFELSE(
+  [
+    AC_LANG_SOURCE(
+      [[
+        #include <pqos.h>
+        #if PQOS_VERSION < 106
+        #error "required PQOS version >= 1.06"
+        #endif
+      ]]
+    )
+  ],
+  [with_libpqos="yes"],
+  [with_libpqos="no (pqos library version 1.06 or higher is required)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libpqos" = "xyes"; then
-  BUILD_WITH_LIBPQOS_CPPFLAGS="$with_libpqos_cppflags"
-  BUILD_WITH_LIBPQOS_LDFLAGS="$with_libpqos_ldflags"
-  BUILD_WITH_LIBPQOS_LIBS="-lpqos"
+BUILD_WITH_LIBPQOS_CPPFLAGS="$with_libpqos_cppflags"
+BUILD_WITH_LIBPQOS_LDFLAGS="$with_libpqos_ldflags"
+BUILD_WITH_LIBPQOS_LIBS="-lpqos"
 fi
 
 AC_SUBST([BUILD_WITH_LIBPQOS_CPPFLAGS])
@@ -4552,39 +4552,39 @@ AC_SUBST([BUILD_WITH_LIBPQOS_LIBS])
 with_libjevents_cppflags=""
 with_libjevents_ldflags=""
 AC_ARG_WITH([libjevents],
-  [AS_HELP_STRING([--with-libjevents@<:@=PREFIX@:>@], [Path to libjevents.])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      with_libjevents_cppflags="-I$withval/include"
-      with_libjevents_ldflags="-L$withval/lib"
-      with_libjevents="yes"
-    else
-      with_libjevents="$withval"
-    fi
-  ],
-  [with_libjevents="yes"]
+[AS_HELP_STRING([--with-libjevents@<:@=PREFIX@:>@], [Path to libjevents.])],
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    with_libjevents_cppflags="-I$withval/include"
+    with_libjevents_ldflags="-L$withval/lib"
+    with_libjevents="yes"
+  else
+    with_libjevents="$withval"
+  fi
+],
+[with_libjevents="yes"]
 )
 
 if test "x$with_libjevents" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libjevents_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libjevents_cppflags"
 
-  AC_CHECK_HEADERS([jevents.h], [with_libjevents="yes"], [with_libjevents="no (jevents.h not found)"])
+AC_CHECK_HEADERS([jevents.h], [with_libjevents="yes"], [with_libjevents="no (jevents.h not found)"])
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 if test "x$with_libjevents" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_libjevents_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_libjevents_ldflags"
 
-  AC_CHECK_LIB([jevents], [json_events], [with_libjevents="yes"], [with_libjevents="no (Can't find libjevents)"])
+AC_CHECK_LIB([jevents], [json_events], [with_libjevents="yes"], [with_libjevents="no (Can't find libjevents)"])
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 if test "x$with_libjevents" = "xyes"; then
-  BUILD_WITH_LIBJEVENTS_CPPFLAGS="$with_libjevents_cppflags"
-  BUILD_WITH_LIBJEVENTS_LDFLAGS="$with_libjevents_ldflags"
-  BUILD_WITH_LIBJEVENTS_LIBS="-ljevents"
+BUILD_WITH_LIBJEVENTS_CPPFLAGS="$with_libjevents_cppflags"
+BUILD_WITH_LIBJEVENTS_LDFLAGS="$with_libjevents_ldflags"
+BUILD_WITH_LIBJEVENTS_LIBS="-ljevents"
 fi
 AC_SUBST([BUILD_WITH_LIBJEVENTS_CPPFLAGS])
 AC_SUBST([BUILD_WITH_LIBJEVENTS_LDFLAGS])
@@ -4595,52 +4595,52 @@ AC_SUBST([BUILD_WITH_LIBJEVENTS_LIBS])
 with_libprotobuf_cppflags=""
 with_libprotobuf_ldflags=""
 AC_ARG_WITH([libprotobuf],
-  [AS_HELP_STRING([--with-libprotobuf@<:@=PREFIX@:>@], [Path to libprotobuf.])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      with_libprotobuf_cppflags="-I$withval/include"
-      with_libprotobuf_ldflags="-L$withval/lib"
-      with_libprotobuf="yes"
-    fi
-    if test "x$withval" = "xno"; then
-      with_libprotobuf="no (disabled on command line)"
-    fi
-  ],
-  [withval="yes"]
+[AS_HELP_STRING([--with-libprotobuf@<:@=PREFIX@:>@], [Path to libprotobuf.])],
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    with_libprotobuf_cppflags="-I$withval/include"
+    with_libprotobuf_ldflags="-L$withval/lib"
+    with_libprotobuf="yes"
+  fi
+  if test "x$withval" = "xno"; then
+    with_libprotobuf="no (disabled on command line)"
+  fi
+],
+[withval="yes"]
 )
 
 if test "x$withval" = "xyes"; then
-  PKG_CHECK_MODULES([PROTOBUF], [protobuf],
-    [with_libprotobuf="yes"],
-    [with_libprotobuf="no (pkg-config could not find libprotobuf)"]
-  )
+PKG_CHECK_MODULES([PROTOBUF], [protobuf],
+  [with_libprotobuf="yes"],
+  [with_libprotobuf="no (pkg-config could not find libprotobuf)"]
+)
 fi
 
 if test "x$withval" != "xno"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  SAVE_LIBS="$LIBS"
-  LDFLAGS="$with_libprotobuf_ldflags"
-  LIBS="$PROTOBUF_LIBS $LIBS"
-  AC_LANG_PUSH([C++])
-  AC_CHECK_LIB([protobuf], [main],
-    [
-      SAVE_CPPFLAGS="$CPPFLAGS"
-      CPPFLAGS="$with_libprotobuf_cppflags $PROTOBUF_CFLAGS"
-      if test "x$PROTOBUF_LIBS" = "x"
-      then
-        PROTOBUF_LIBS="-lprotobuf"
-      fi
-      AC_CHECK_HEADERS([google/protobuf/util/time_util.h],
-        [with_libprotobuf="yes"],
-        [with_libprotobuf="no (<google/protobuf/util/time_util.h> not found)"]
-      )
-      CPPFLAGS="$SAVE_CPPFLAGS"
-    ],
-    [with_libprotobuf="no (libprotobuf not found)"]
-  )
-  AC_LANG_POP([C++])
-  LDFLAGS="$SAVE_LDFLAGS"
-  LIBS="$SAVE_LIBS"
+SAVE_LDFLAGS="$LDFLAGS"
+SAVE_LIBS="$LIBS"
+LDFLAGS="$with_libprotobuf_ldflags"
+LIBS="$PROTOBUF_LIBS $LIBS"
+AC_LANG_PUSH([C++])
+AC_CHECK_LIB([protobuf], [main],
+  [
+    SAVE_CPPFLAGS="$CPPFLAGS"
+    CPPFLAGS="$with_libprotobuf_cppflags $PROTOBUF_CFLAGS"
+    if test "x$PROTOBUF_LIBS" = "x"
+    then
+      PROTOBUF_LIBS="-lprotobuf"
+    fi
+    AC_CHECK_HEADERS([google/protobuf/util/time_util.h],
+      [with_libprotobuf="yes"],
+      [with_libprotobuf="no (<google/protobuf/util/time_util.h> not found)"]
+    )
+    CPPFLAGS="$SAVE_CPPFLAGS"
+  ],
+  [with_libprotobuf="no (libprotobuf not found)"]
+)
+AC_LANG_POP([C++])
+LDFLAGS="$SAVE_LDFLAGS"
+LIBS="$SAVE_LIBS"
 fi
 
 BUILD_WITH_LIBPROTOBUF_CPPFLAGS="$with_libprotobuf_cppflags $PROTOBUF_CFLAGS"
@@ -4655,68 +4655,68 @@ AC_ARG_VAR([PROTOC], [path to the protoc binary])
 AC_PATH_PROG([PROTOC], [protoc])
 have_protoc3="no"
 if test "x$PROTOC" != "x"; then
-  AC_MSG_CHECKING([for protoc 3.0.0+])
-  if $PROTOC --version | $EGREP libprotoc.3 >/dev/null; then
-    protoc3="yes (`$PROTOC --version`)"
-    have_protoc3="yes"
-  else
-    protoc3="no (`$PROTOC --version`)"
-  fi
-  AC_MSG_RESULT([$protoc3])
+AC_MSG_CHECKING([for protoc 3.0.0+])
+if $PROTOC --version | $EGREP libprotoc.3 >/dev/null; then
+  protoc3="yes (`$PROTOC --version`)"
+  have_protoc3="yes"
+else
+  protoc3="no (`$PROTOC --version`)"
+fi
+AC_MSG_RESULT([$protoc3])
 fi
 AM_CONDITIONAL([HAVE_PROTOC3], [test "x$have_protoc3" = "xyes"])
 
 # --with-libprotobuf-c {{{
 AC_ARG_WITH([libprotobuf-c],
-  [AS_HELP_STRING([--with-libprotobuf-c@<:@=PREFIX@:>@], [Path to libprotobuf-c.])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      with_libprotobuf_c_cppflags="-I$withval/include"
-      with_libprotobuf_c_ldflags="-L$withval/lib"
-      with_libprotobuf_c="yes"
-    fi
+[AS_HELP_STRING([--with-libprotobuf-c@<:@=PREFIX@:>@], [Path to libprotobuf-c.])],
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    with_libprotobuf_c_cppflags="-I$withval/include"
+    with_libprotobuf_c_ldflags="-L$withval/lib"
+    with_libprotobuf_c="yes"
+  fi
 
-    if test "x$withval" = "xno"; then
-      with_libprotobuf_c="no (disabled on command line)"
-    fi
-  ],
-  [withval="yes"]
+  if test "x$withval" = "xno"; then
+    with_libprotobuf_c="no (disabled on command line)"
+  fi
+],
+[withval="yes"]
 )
 
 if test "x$withval" = "xyes"; then
-  PKG_CHECK_MODULES([PROTOBUF_C], [libprotobuf-c],
-    [with_libprotobuf_c="yes"],
-    [with_libprotobuf_c="no (pkg-config could not find libprotobuf-c)"]
-  )
+PKG_CHECK_MODULES([PROTOBUF_C], [libprotobuf-c],
+  [with_libprotobuf_c="yes"],
+  [with_libprotobuf_c="no (pkg-config could not find libprotobuf-c)"]
+)
 fi
 
 if test "x$withval" != "xno"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  SAVE_LIBS="$LIBS"
-  LDFLAGS="$with_libprotobuf_c_ldflags"
-  LIBS="$PROTOBUF_C_LIBS $LIBS"
-  AC_CHECK_LIB([protobuf-c], [protobuf_c_message_pack],
-    [
-      SAVE_CPPFLAGS="$CPPFLAGS"
-      CPPFLAGS="$with_libprotobuf_c_cppflags $PROTOBUF_C_CFLAGS"
-      if test "x$PROTOBUF_C_LIBS" = "x"; then
-        PROTOBUF_C_LIBS="-lprotobuf-c"
-      fi
+SAVE_LDFLAGS="$LDFLAGS"
+SAVE_LIBS="$LIBS"
+LDFLAGS="$with_libprotobuf_c_ldflags"
+LIBS="$PROTOBUF_C_LIBS $LIBS"
+AC_CHECK_LIB([protobuf-c], [protobuf_c_message_pack],
+  [
+    SAVE_CPPFLAGS="$CPPFLAGS"
+    CPPFLAGS="$with_libprotobuf_c_cppflags $PROTOBUF_C_CFLAGS"
+    if test "x$PROTOBUF_C_LIBS" = "x"; then
+      PROTOBUF_C_LIBS="-lprotobuf-c"
+    fi
 
-      AC_CHECK_HEADERS([protobuf-c/protobuf-c.h google/protobuf-c/protobuf-c.h],
-        [
-          with_libprotobuf_c="yes"
-          break
-        ],
-        [with_libprotobuf_c="no (<protobuf-c.h> not found)"]
-      )
+    AC_CHECK_HEADERS([protobuf-c/protobuf-c.h google/protobuf-c/protobuf-c.h],
+      [
+        with_libprotobuf_c="yes"
+        break
+      ],
+      [with_libprotobuf_c="no (<protobuf-c.h> not found)"]
+    )
 
-      CPPFLAGS="$SAVE_CPPFLAGS"
-    ],
-    [with_libprotobuf_c="no (libprotobuf-c not found)"]
-  )
-  LDFLAGS="$SAVE_LDFLAGS"
-  LIBS="$SAVE_LIBS"
+    CPPFLAGS="$SAVE_CPPFLAGS"
+  ],
+  [with_libprotobuf_c="no (libprotobuf-c not found)"]
+)
+LDFLAGS="$SAVE_LDFLAGS"
+LIBS="$SAVE_LIBS"
 fi
 
 BUILD_WITH_LIBPROTOBUF_C_CPPFLAGS="$with_libprotobuf_c_cppflags $PROTOBUF_C_CFLAGS"
@@ -4731,9 +4731,9 @@ AC_ARG_VAR([PROTOC_C], [path to the protoc-c binary])
 AC_PATH_PROG([PROTOC_C], [protoc-c])
 if test "x$PROTOC_C" = "x"
 then
-  have_protoc_c="no (protoc-c compiler not found)"
+have_protoc_c="no (protoc-c compiler not found)"
 else
-  have_protoc_c="yes"
+have_protoc_c="yes"
 fi
 
 # --with-libpython {{{
@@ -4742,112 +4742,112 @@ AC_ARG_VAR([LIBPYTHON_LDFLAGS], [Linker flags for libpython])
 AC_ARG_VAR([LIBPYTHON_LIBS], [Libraries for libpython])
 
 AC_ARG_WITH([libpython],
-  [AS_HELP_STRING([--with-libpython], [if we should build with libpython @<:@default=yes@:>@])],
-  [with_libpython="$withval"],
-  [with_libpython="check"]
+[AS_HELP_STRING([--with-libpython], [if we should build with libpython @<:@default=yes@:>@])],
+[with_libpython="$withval"],
+[with_libpython="check"]
 )
 
 if test "$with_libpython" != "no"; then
-  if test "$LIBPYTHON_CPPFLAGS" = "" && test "$LIBPYTHON_LDFLAGS" = ""; then
-    AC_ARG_VAR([PYTHON_CONFIG], [path to python-config])
-    AC_PATH_PROGS([PYTHON_CONFIG],
-      [python3-config python2-config python-config]
-    )
-    if test "$PYTHON_CONFIG" = ""; then
-      if test "$with_libpython" = "yes"; then
-        AC_MSG_ERROR([Unable to find python-config])
-      fi
-      with_libpython="no"
+if test "$LIBPYTHON_CPPFLAGS" = "" && test "$LIBPYTHON_LDFLAGS" = ""; then
+  AC_ARG_VAR([PYTHON_CONFIG], [path to python-config])
+  AC_PATH_PROGS([PYTHON_CONFIG],
+    [python3-config python2-config python-config]
+  )
+  if test "$PYTHON_CONFIG" = ""; then
+    if test "$with_libpython" = "yes"; then
+      AC_MSG_ERROR([Unable to find python-config])
     fi
+    with_libpython="no"
   fi
 fi
+fi
 
 if test "$PYTHON_CONFIG" != ""; then
-  LIBPYTHON_CPPFLAGS="`${PYTHON_CONFIG} --includes`"
-  if test $? -ne 0; then
-    with_libpython="no"
-  fi
-  LIBPYTHON_LDFLAGS="`${PYTHON_CONFIG} --ldflags`"
-  if test $? -ne 0; then
-    with_libpython="no"
-  fi
-  LIBPYTHON_LIBS="`${PYTHON_CONFIG} --libs --embed`" || LIBPYTHON_LIBS="`${PYTHON_CONFIG} --libs`"
-  if test $? -ne 0; then
-    with_libpython="no"
-  fi
+LIBPYTHON_CPPFLAGS="`${PYTHON_CONFIG} --includes`"
+if test $? -ne 0; then
+  with_libpython="no"
+fi
+LIBPYTHON_LDFLAGS="`${PYTHON_CONFIG} --ldflags`"
+if test $? -ne 0; then
+  with_libpython="no"
+fi
+LIBPYTHON_LIBS="`${PYTHON_CONFIG} --libs --embed`" || LIBPYTHON_LIBS="`${PYTHON_CONFIG} --libs`"
+if test $? -ne 0; then
+  with_libpython="no"
+fi
 fi
 
 if test "$with_libpython" != "xno"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  SAVE_LDFLAGS="$LDFLAGS"
-  SAVE_LIBS="$LIBS"
-  CPPFLAGS="$LIBPYTHON_CPPFLAGS $CPPFLAGS"
-  LDFLAGS="$LIBPYTHON_LDFLAGS $LDFLAGS"
-  LIBS="$LIBPYTHON_LIBS $LIBS"
+SAVE_CPPFLAGS="$CPPFLAGS"
+SAVE_LDFLAGS="$LDFLAGS"
+SAVE_LIBS="$LIBS"
+CPPFLAGS="$LIBPYTHON_CPPFLAGS $CPPFLAGS"
+LDFLAGS="$LIBPYTHON_LDFLAGS $LDFLAGS"
+LIBS="$LIBPYTHON_LIBS $LIBS"
 
-  AC_CHECK_HEADERS([Python.h],
-    [
-      AC_MSG_CHECKING([for libpython])
-      AC_LINK_IFELSE([AC_LANG_PROGRAM(
-          [[#include <Python.h>]],
-          [[Py_Initialize();]])
-        ],
-        [with_libpython="yes"],
-        [with_libpython="no"]
-      )
-      AC_MSG_RESULT([$with_libpython])
-    ],
-    [with_libpython="no"]
-  )
+AC_CHECK_HEADERS([Python.h],
+  [
+    AC_MSG_CHECKING([for libpython])
+    AC_LINK_IFELSE([AC_LANG_PROGRAM(
+        [[#include <Python.h>]],
+        [[Py_Initialize();]])
+      ],
+      [with_libpython="yes"],
+      [with_libpython="no"]
+    )
+    AC_MSG_RESULT([$with_libpython])
+  ],
+  [with_libpython="no"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
-  LDFLAGS="$SAVE_LDFLAGS"
-  LIBS="$SAVE_LIBS"
+CPPFLAGS="$SAVE_CPPFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
+LIBS="$SAVE_LIBS"
 fi
 # }}} --with-libpython
 
 # --with-libqpid_proton {{{
 AC_ARG_WITH([libqpid_proton],
-  [AS_HELP_STRING([--with-libqpid_proton@<:@=PREFIX@:>@], [Path to libqpid_proton.])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      with_libqpid_proton_cppflags="-I$withval/include"
-      with_libqpid_proton_ldflags="-L$withval/lib"
-      with_libqpid_proton="yes"
-    else
-      with_libqpid_proton="$withval"
-    fi
-  ],
-  [with_libqpid_proton="yes"]
+[AS_HELP_STRING([--with-libqpid_proton@<:@=PREFIX@:>@], [Path to libqpid_proton.])],
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    with_libqpid_proton_cppflags="-I$withval/include"
+    with_libqpid_proton_ldflags="-L$withval/lib"
+    with_libqpid_proton="yes"
+  else
+    with_libqpid_proton="$withval"
+  fi
+],
+[with_libqpid_proton="yes"]
 )
 
 if test "x$with_libqpid_proton" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libqpid_proton_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libqpid_proton_cppflags"
 
-  AC_CHECK_HEADERS([proton/proactor.h],
-    [with_libqpid_proton="yes"],
-    [with_libqpid_proton="no (proton/proactor.h not found)"]
-  )
+AC_CHECK_HEADERS([proton/proactor.h],
+  [with_libqpid_proton="yes"],
+  [with_libqpid_proton="no (proton/proactor.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libqpid_proton" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_libqpid_proton_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_libqpid_proton_ldflags"
 
-  AC_CHECK_LIB([qpid-proton], [pn_connection],
-    [with_libqpid_proton="yes"],
-    [with_libqpid_proton="no (Symbol 'pn_connection' not found)"])
+AC_CHECK_LIB([qpid-proton], [pn_connection],
+  [with_libqpid_proton="yes"],
+  [with_libqpid_proton="no (Symbol 'pn_connection' not found)"])
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libqpid_proton" = "xyes"; then
-  BUILD_WITH_LIBQPIDPROTON_CPPFLAGS="$with_libqpid_proton_cppflags"
-  BUILD_WITH_LIBQPIDPROTON_LDFLAGS="$with_libqpid_proton_ldflags"
-  BUILD_WITH_LIBQPIDPROTON_LIBS="-lqpid-proton"
+BUILD_WITH_LIBQPIDPROTON_CPPFLAGS="$with_libqpid_proton_cppflags"
+BUILD_WITH_LIBQPIDPROTON_LDFLAGS="$with_libqpid_proton_ldflags"
+BUILD_WITH_LIBQPIDPROTON_LIBS="-lqpid-proton"
 fi
 
 AC_SUBST(BUILD_WITH_LIBQPIDPROTON_CPPFLAGS)
@@ -4858,102 +4858,102 @@ AC_SUBST(BUILD_WITH_LIBQPIDPROTON_LIBS)
 
 # --with-librabbitmq {{{
 AC_ARG_WITH([librabbitmq],
-  [AS_HELP_STRING([--with-librabbitmq@<:@=PREFIX@:>@], [Path to librabbitmq.])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      with_librabbitmq_cppflags="-I$withval/include"
-      with_librabbitmq_ldflags="-L$withval/lib"
-      with_librabbitmq="yes"
-    else
-      with_librabbitmq="$withval"
-    fi
-  ],
-  [with_librabbitmq="yes"]
+[AS_HELP_STRING([--with-librabbitmq@<:@=PREFIX@:>@], [Path to librabbitmq.])],
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    with_librabbitmq_cppflags="-I$withval/include"
+    with_librabbitmq_ldflags="-L$withval/lib"
+    with_librabbitmq="yes"
+  else
+    with_librabbitmq="$withval"
+  fi
+],
+[with_librabbitmq="yes"]
 )
 
 if test "x$with_librabbitmq" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_librabbitmq_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_librabbitmq_cppflags"
 
-  AC_CHECK_HEADERS([amqp.h],
-    [with_librabbitmq="yes"],
-    [with_librabbitmq="no (amqp.h not found)"]
-  )
+AC_CHECK_HEADERS([amqp.h],
+  [with_librabbitmq="yes"],
+  [with_librabbitmq="no (amqp.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_librabbitmq" = "xyes"; then
-  # librabbitmq up to version 0.9.1 provides "library_errno", later
-  # versions use "library_error". The library does not provide a version
-  # macro :(.
+# librabbitmq up to version 0.9.1 provides "library_errno", later
+# versions use "library_error". The library does not provide a version
+# macro :(.
 
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_librabbitmq_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_librabbitmq_cppflags"
 
-  AC_CHECK_MEMBERS([amqp_rpc_reply_t.library_errno],
-    [],
-    [],
-    [[
-      #include <stdlib.h>
-      #include <stdio.h>
-      #include <stdint.h>
-      #include <inttypes.h>
-      #include <amqp.h>
-    ]]
-  )
-  CPPFLAGS="$SAVE_CPPFLAGS"
+AC_CHECK_MEMBERS([amqp_rpc_reply_t.library_errno],
+  [],
+  [],
+  [[
+    #include <stdlib.h>
+    #include <stdio.h>
+    #include <stdint.h>
+    #include <inttypes.h>
+    #include <amqp.h>
+  ]]
+)
+CPPFLAGS="$SAVE_CPPFLAGS"
 
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_librabbitmq_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_librabbitmq_ldflags"
 
-  AC_CHECK_LIB([rabbitmq], [amqp_basic_publish],
-    [with_librabbitmq="yes"],
-    [with_librabbitmq="no (Symbol 'amqp_basic_publish' not found)"]
-  )
+AC_CHECK_LIB([rabbitmq], [amqp_basic_publish],
+  [with_librabbitmq="yes"],
+  [with_librabbitmq="no (Symbol 'amqp_basic_publish' not found)"]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_librabbitmq" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  SAVE_LDFLAGS="$LDFLAGS"
-  SAVE_LIBS="$LIBS"
-  CPPFLAGS="$CPPFLAGS $with_librabbitmq_cppflags"
-  LDFLAGS="$LDFLAGS $with_librabbitmq_ldflags"
-  LIBS="-lrabbitmq"
+SAVE_CPPFLAGS="$CPPFLAGS"
+SAVE_LDFLAGS="$LDFLAGS"
+SAVE_LIBS="$LIBS"
+CPPFLAGS="$CPPFLAGS $with_librabbitmq_cppflags"
+LDFLAGS="$LDFLAGS $with_librabbitmq_ldflags"
+LIBS="-lrabbitmq"
 
-  AC_CHECK_HEADERS([amqp_tcp_socket.h amqp_socket.h])
-  AC_CHECK_FUNC([amqp_tcp_socket_new],
-    [
-      AC_DEFINE([HAVE_AMQP_TCP_SOCKET], [1],
-        [Define if librabbitmq provides the new TCP socket interface.])
-    ]
-  )
+AC_CHECK_HEADERS([amqp_tcp_socket.h amqp_socket.h])
+AC_CHECK_FUNC([amqp_tcp_socket_new],
+  [
+    AC_DEFINE([HAVE_AMQP_TCP_SOCKET], [1],
+      [Define if librabbitmq provides the new TCP socket interface.])
+  ]
+)
 
-  AC_CHECK_DECLS([amqp_socket_close],
-    [],
-    [],
-    [[
-      #include <amqp.h>
-      #ifdef HAVE_AMQP_TCP_SOCKET_H
-      # include <amqp_tcp_socket.h>
-      #endif
-      #ifdef HAVE_AMQP_SOCKET_H
-      # include <amqp_socket.h>
-      #endif
-    ]]
-  )
+AC_CHECK_DECLS([amqp_socket_close],
+  [],
+  [],
+  [[
+    #include <amqp.h>
+    #ifdef HAVE_AMQP_TCP_SOCKET_H
+    # include <amqp_tcp_socket.h>
+    #endif
+    #ifdef HAVE_AMQP_SOCKET_H
+    # include <amqp_socket.h>
+    #endif
+  ]]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
-  LDFLAGS="$SAVE_LDFLAGS"
-  LIBS="$SAVE_LIBS"
+CPPFLAGS="$SAVE_CPPFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
+LIBS="$SAVE_LIBS"
 fi
 
 if test "x$with_librabbitmq" = "xyes"; then
-  BUILD_WITH_LIBRABBITMQ_CPPFLAGS="$with_librabbitmq_cppflags"
-  BUILD_WITH_LIBRABBITMQ_LDFLAGS="$with_librabbitmq_ldflags"
-  BUILD_WITH_LIBRABBITMQ_LIBS="-lrabbitmq"
+BUILD_WITH_LIBRABBITMQ_CPPFLAGS="$with_librabbitmq_cppflags"
+BUILD_WITH_LIBRABBITMQ_LDFLAGS="$with_librabbitmq_ldflags"
+BUILD_WITH_LIBRABBITMQ_LIBS="-lrabbitmq"
 fi
 
 AC_SUBST(BUILD_WITH_LIBRABBITMQ_CPPFLAGS)
@@ -4964,67 +4964,67 @@ AC_SUBST(BUILD_WITH_LIBRABBITMQ_LIBS)
 
 # --with-librdkafka {{{
 AC_ARG_WITH([librdkafka],
-  [AS_HELP_STRING([--with-librdkafka@<:@=PREFIX@:>@], [Path to librdkafka.])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      with_librdkafka_cppflags="-I$withval/include"
-      with_librdkafka_ldflags="-L$withval/lib"
-      with_librdkafka_rpath="$withval/lib"
-      with_librdkafka="yes"
-    else
-      with_librdkafka="$withval"
-    fi
-  ],
-  [with_librdkafka="yes"]
+[AS_HELP_STRING([--with-librdkafka@<:@=PREFIX@:>@], [Path to librdkafka.])],
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    with_librdkafka_cppflags="-I$withval/include"
+    with_librdkafka_ldflags="-L$withval/lib"
+    with_librdkafka_rpath="$withval/lib"
+    with_librdkafka="yes"
+  else
+    with_librdkafka="$withval"
+  fi
+],
+[with_librdkafka="yes"]
 )
 
 if test "x$with_librdkafka" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_librdkafka_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_librdkafka_cppflags"
 
-  AC_CHECK_HEADERS([librdkafka/rdkafka.h],
-    [with_librdkafka="yes"],
-    [with_librdkafka="no (librdkafka/rdkafka.h not found)"]
-  )
+AC_CHECK_HEADERS([librdkafka/rdkafka.h],
+  [with_librdkafka="yes"],
+  [with_librdkafka="no (librdkafka/rdkafka.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_librdkafka" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_librdkafka_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_librdkafka_ldflags"
 
-  AC_CHECK_LIB([rdkafka], [rd_kafka_new],
-    [with_librdkafka="yes"],
-    [with_librdkafka="no (Symbol 'rd_kafka_new' not found)"])
+AC_CHECK_LIB([rdkafka], [rd_kafka_new],
+  [with_librdkafka="yes"],
+  [with_librdkafka="no (Symbol 'rd_kafka_new' not found)"])
 
-  AC_CHECK_LIB([rdkafka], [rd_kafka_conf_set_log_cb],
-    [with_librdkafka_log_cb="yes"],
-    [with_librdkafka_log_cb="no"])
+AC_CHECK_LIB([rdkafka], [rd_kafka_conf_set_log_cb],
+  [with_librdkafka_log_cb="yes"],
+  [with_librdkafka_log_cb="no"])
 
-  AC_CHECK_LIB([rdkafka], [rd_kafka_set_logger],
-    [with_librdkafka_logger="yes"],
-    [with_librdkafka_logger="no"]
-  )
+AC_CHECK_LIB([rdkafka], [rd_kafka_set_logger],
+  [with_librdkafka_logger="yes"],
+  [with_librdkafka_logger="no"]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_librdkafka" = "xyes"; then
-  BUILD_WITH_LIBRDKAFKA_CPPFLAGS="$with_librdkafka_cppflags"
-  BUILD_WITH_LIBRDKAFKA_LDFLAGS="$with_librdkafka_ldflags"
+BUILD_WITH_LIBRDKAFKA_CPPFLAGS="$with_librdkafka_cppflags"
+BUILD_WITH_LIBRDKAFKA_LDFLAGS="$with_librdkafka_ldflags"
 
-  if test "x$with_librdkafka_rpath" != "x"; then
-    BUILD_WITH_LIBRDKAFKA_LIBS="-Wl,-rpath,$with_librdkafka_rpath -lrdkafka"
-  else
-    BUILD_WITH_LIBRDKAFKA_LIBS="-lrdkafka"
-  fi
+if test "x$with_librdkafka_rpath" != "x"; then
+  BUILD_WITH_LIBRDKAFKA_LIBS="-Wl,-rpath,$with_librdkafka_rpath -lrdkafka"
+else
+  BUILD_WITH_LIBRDKAFKA_LIBS="-lrdkafka"
+fi
 
-  if test "x$with_librdkafka_log_cb" = "xyes"; then
-    AC_DEFINE(HAVE_LIBRDKAFKA_LOG_CB, 1, [Define if librdkafka log facility is present and usable.])
-  else if test "x$with_librdkafka_logger" = "xyes"; then
-    AC_DEFINE(HAVE_LIBRDKAFKA_LOGGER, 1, [Define if librdkafka log facility is present and usable.])
-  fi; fi
+if test "x$with_librdkafka_log_cb" = "xyes"; then
+  AC_DEFINE(HAVE_LIBRDKAFKA_LOG_CB, 1, [Define if librdkafka log facility is present and usable.])
+else if test "x$with_librdkafka_logger" = "xyes"; then
+  AC_DEFINE(HAVE_LIBRDKAFKA_LOGGER, 1, [Define if librdkafka log facility is present and usable.])
+fi; fi
 fi
 
 AC_SUBST([BUILD_WITH_LIBRDKAFKA_CPPFLAGS])
@@ -5034,46 +5034,46 @@ AC_SUBST([BUILD_WITH_LIBRDKAFKA_LIBS])
 
 # --with-librouteros {{{
 AC_ARG_WITH([librouteros],
-  [AS_HELP_STRING([--with-librouteros@<:@=PREFIX@:>@], [Path to librouteros.])],
-  [
-    if test "x$withval" = "xyes" || test "x$withval" = "xno"; then
-      with_librouteros="$witval"
-    else
-      with_librouteros_cppflags="-I$withval/include"
-      with_librouteros_ldflags="-L$withval/lib"
-      with_librouteros="yes"
-   fi
-  ],
-  [with_librouteros="yes"]
+[AS_HELP_STRING([--with-librouteros@<:@=PREFIX@:>@], [Path to librouteros.])],
+[
+  if test "x$withval" = "xyes" || test "x$withval" = "xno"; then
+    with_librouteros="$witval"
+  else
+    with_librouteros_cppflags="-I$withval/include"
+    with_librouteros_ldflags="-L$withval/lib"
+    with_librouteros="yes"
+  fi
+],
+[with_librouteros="yes"]
 )
 
 if test "x$with_librouteros" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_librouteros_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_librouteros_cppflags"
 
-  AC_CHECK_HEADERS([routeros_api.h],
-    [with_librouteros="yes"],
-    [with_librouteros="no (routeros_api.h not found)"]
-  )
+AC_CHECK_HEADERS([routeros_api.h],
+  [with_librouteros="yes"],
+  [with_librouteros="no (routeros_api.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_librouteros" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_librouteros_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_librouteros_ldflags"
 
-  AC_CHECK_LIB([routeros], [ros_interface],
-    [with_librouteros="yes"],
-    [with_librouteros="no (symbol 'ros_interface' not found)"]
-  )
+AC_CHECK_LIB([routeros], [ros_interface],
+  [with_librouteros="yes"],
+  [with_librouteros="no (symbol 'ros_interface' not found)"]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_librouteros" = "xyes"; then
-  BUILD_WITH_LIBROUTEROS_CPPFLAGS="$with_librouteros_cppflags"
-  BUILD_WITH_LIBROUTEROS_LDFLAGS="$with_librouteros_ldflags"
+BUILD_WITH_LIBROUTEROS_CPPFLAGS="$with_librouteros_cppflags"
+BUILD_WITH_LIBROUTEROS_LDFLAGS="$with_librouteros_ldflags"
 fi
 
 AC_SUBST([BUILD_WITH_LIBROUTEROS_CPPFLAGS])
@@ -5084,89 +5084,89 @@ AC_SUBST([BUILD_WITH_LIBROUTEROS_LDFLAGS])
 librrd_threadsafe="no"
 librrd_rrdc_update="no"
 AC_ARG_WITH([librrd],
-  [AS_HELP_STRING([--with-librrd@<:@=PREFIX@:>@], [Path to rrdtool.])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      librrd_cflags="-I$withval/include"
-      librrd_ldflags="-L$withval/lib"
-      with_librrd="yes"
-    else
-      with_librrd="$withval"
-    fi
-  ],
-  [with_librrd="yes"]
+[AS_HELP_STRING([--with-librrd@<:@=PREFIX@:>@], [Path to rrdtool.])],
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    librrd_cflags="-I$withval/include"
+    librrd_ldflags="-L$withval/lib"
+    with_librrd="yes"
+  else
+    with_librrd="$withval"
+  fi
+],
+[with_librrd="yes"]
 )
 
 if test "x$with_librrd" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $librrd_ldflags"
-  PKG_CHECK_MODULES([RRD], [librrd >= 1.6.0],
-    [
-      AC_CHECK_LIB([rrd], [rrd_update_r],
-        [librrd_threadsafe="yes"],
-        [:]
-      )
-      AC_CHECK_LIB([rrd], [rrdc_update],
-        [librrd_rrdc_update="yes"],
-        [:]
-      )
-    ],[:]
-  )
-  LDFLAGS="$SAVE_LDFLAGS"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $librrd_ldflags"
+PKG_CHECK_MODULES([RRD], [librrd >= 1.6.0],
+  [
+    AC_CHECK_LIB([rrd], [rrd_update_r],
+      [librrd_threadsafe="yes"],
+      [:]
+    )
+    AC_CHECK_LIB([rrd], [rrdc_update],
+      [librrd_rrdc_update="yes"],
+      [:]
+    )
+  ],[:]
+)
+LDFLAGS="$SAVE_LDFLAGS"
 
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $RRD_CFLAGS $librrd_cflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $RRD_CFLAGS $librrd_cflags"
 
-  AC_CHECK_HEADERS([rrd.h],, [with_librrd="no (rrd.h not found)"])
+AC_CHECK_HEADERS([rrd.h],, [with_librrd="no (rrd.h not found)"])
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_librrd" = "xyes" && test "x$librrd_threadsafe" = "xno"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $librrd_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $librrd_ldflags"
 
-  AC_CHECK_LIB([rrd_th], [rrd_update_r],
-    [
-      librrd_ldflags="$librrd_ldflags -lrrd_th"
-      librrd_threadsafe="yes"
-      AC_CHECK_LIB([rrd_th], [rrdc_update],
-        [librrd_rrdc_update="yes"],
-        [:],
-      )
-    ],
-    [:]
-  )
-  LDFLAGS="$SAVE_LDFLAGS"
+AC_CHECK_LIB([rrd_th], [rrd_update_r],
+  [
+    librrd_ldflags="$librrd_ldflags -lrrd_th"
+    librrd_threadsafe="yes"
+    AC_CHECK_LIB([rrd_th], [rrdc_update],
+      [librrd_rrdc_update="yes"],
+      [:],
+    )
+  ],
+  [:]
+)
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_librrd" = "xyes" && test "x$librrd_threadsafe" = "xno"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $librrd_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $librrd_ldflags"
 
-  AC_CHECK_LIB([rrd], [rrd_update],
-    [
-      librrd_ldflags="$librrd_ldflags -lrrd"
-      AC_CHECK_LIB([rrd], [rrdc_update],
-        [librrd_rrdc_update="yes"],
-        [:]
-      )
-    ],
-    [with_librrd="no (symbol 'rrd_update' not found)"]
-  )
-  LDFLAGS="$SAVE_LDFLAGS"
+AC_CHECK_LIB([rrd], [rrd_update],
+  [
+    librrd_ldflags="$librrd_ldflags -lrrd"
+    AC_CHECK_LIB([rrd], [rrdc_update],
+      [librrd_rrdc_update="yes"],
+      [:]
+    )
+  ],
+  [with_librrd="no (symbol 'rrd_update' not found)"]
+)
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_librrd" = "xyes"; then
-  BUILD_WITH_LIBRRD_CFLAGS="$RRD_CFLAGS $librrd_cflags"
-  BUILD_WITH_LIBRRD_LDFLAGS="$librrd_ldflags"
-  BUILD_WITH_LIBRRD_LIBS="$RRD_LIBS"
+BUILD_WITH_LIBRRD_CFLAGS="$RRD_CFLAGS $librrd_cflags"
+BUILD_WITH_LIBRRD_LDFLAGS="$librrd_ldflags"
+BUILD_WITH_LIBRRD_LIBS="$RRD_LIBS"
 fi
 
 if test "x$librrd_threadsafe" = "xyes"; then
-  AC_DEFINE([HAVE_THREADSAFE_LIBRRD], [1],
-    [Define to 1 if the rrd library is thread-safe]
-  )
+AC_DEFINE([HAVE_THREADSAFE_LIBRRD], [1],
+  [Define to 1 if the rrd library is thread-safe]
+)
 fi
 
 AC_SUBST([BUILD_WITH_LIBRRD_CFLAGS])
@@ -5176,74 +5176,74 @@ AC_SUBST([BUILD_WITH_LIBRRD_LIBS])
 
 # --with-libsensors {{{
 AC_ARG_WITH([libsensors],
-  [AS_HELP_STRING([--with-libsensors@<:@=PREFIX@:>@], [Path to lm_sensors.])],
-  [
-    if test "x$withval" = "xno" || test "x$withval" = "xyes"; then
-      with_libsensors="$withval"
-    else
-      with_sensors_cppflags="-I$withval/include"
-      with_sensors_ldflags="-L$withval/lib"
-      with_libsensors="yes"
-    fi
-  ],
-  [
-    if test "x$ac_system" = "xLinux"; then
-      with_libsensors="yes"
-    else
-      with_libsensors="no (Linux only library)"
-    fi
-  ]
+[AS_HELP_STRING([--with-libsensors@<:@=PREFIX@:>@], [Path to lm_sensors.])],
+[
+  if test "x$withval" = "xno" || test "x$withval" = "xyes"; then
+    with_libsensors="$withval"
+  else
+    with_sensors_cppflags="-I$withval/include"
+    with_sensors_ldflags="-L$withval/lib"
+    with_libsensors="yes"
+  fi
+],
+[
+  if test "x$ac_system" = "xLinux"; then
+    with_libsensors="yes"
+  else
+    with_libsensors="no (Linux only library)"
+  fi
+]
 )
 
 if test "x$with_libsensors" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_sensors_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_sensors_cppflags"
 
-  AC_CHECK_HEADERS([sensors/sensors.h],
-    [with_libsensors="yes"],
-    [with_libsensors="no (sensors/sensors.h not found)"]
-  )
+AC_CHECK_HEADERS([sensors/sensors.h],
+  [with_libsensors="yes"],
+  [with_libsensors="no (sensors/sensors.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libsensors" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_sensors_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_sensors_ldflags"
 
-  AC_CHECK_LIB([sensors], [sensors_init],
-    [with_libsensors="yes"],
-    [with_libsensors="no (libsensors not found)"]
-  )
+AC_CHECK_LIB([sensors], [sensors_init],
+  [with_libsensors="yes"],
+  [with_libsensors="no (libsensors not found)"]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libsensors" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_sensors_cppflags"
-  AC_PREPROC_IFELSE(
-    [
-      AC_LANG_SOURCE(
-        [[
-          #include <sensors/sensors.h>
-          #if SENSORS_API_VERSION < 0x400
-          #error "required libsensors version >= 3.0"
-          #endif
-        ]]
-      )
-    ],
-    [with_libsensors="yes"],
-    [with_libsensors="no (sensors library version 3.0.0 or higher is required)"]
-  )
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_sensors_cppflags"
+AC_PREPROC_IFELSE(
+  [
+    AC_LANG_SOURCE(
+      [[
+        #include <sensors/sensors.h>
+        #if SENSORS_API_VERSION < 0x400
+        #error "required libsensors version >= 3.0"
+        #endif
+      ]]
+    )
+  ],
+  [with_libsensors="yes"],
+  [with_libsensors="no (sensors library version 3.0.0 or higher is required)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libsensors" = "xyes"; then
-  BUILD_WITH_LIBSENSORS_CPPFLAGS="$with_sensors_cppflags"
-  BUILD_WITH_LIBSENSORS_LDFLAGS="$with_sensors_ldflags"
-  BUILD_WITH_LIBSENSORS_LIBS="-lsensors"
+BUILD_WITH_LIBSENSORS_CPPFLAGS="$with_sensors_cppflags"
+BUILD_WITH_LIBSENSORS_LDFLAGS="$with_sensors_ldflags"
+BUILD_WITH_LIBSENSORS_LIBS="-lsensors"
 fi
 
 AC_SUBST([BUILD_WITH_LIBSENSORS_CPPFLAGS])
@@ -5256,8 +5256,8 @@ AC_SUBST([BUILD_WITH_LIBSENSORS_LIBS])
 AC_SUBST([LIBSIGROK_CFLAGS])
 AC_SUBST([LIBSIGROK_LIBS])
 PKG_CHECK_MODULES([LIBSIGROK], [libsigrok < 0.4],
-  [with_libsigrok="yes"],
-  [with_libsigrok="no (pkg-config could not find libsigrok)"]
+[with_libsigrok="yes"],
+[with_libsigrok="no (pkg-config could not find libsigrok)"]
 )
 # }}}
 
@@ -5266,180 +5266,180 @@ with_libssl_cflags=""
 with_libssl_ldflags=""
 AC_ARG_WITH([libssl], [AS_HELP_STRING([--with-libssl@<:@=PREFIX@:>@], [Path to libssl.])],
 [
-	if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-		with_libssl_cppflags="-I$withval/include"
-		with_libssl_ldflags="-L$withval/lib"
-		with_libssl="yes"
-	else
-		with_libssl="$withval"
-	fi
+if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+  with_libssl_cppflags="-I$withval/include"
+  with_libssl_ldflags="-L$withval/lib"
+  with_libssl="yes"
+else
+  with_libssl="$withval"
+fi
 ],
 [
-	with_libssl="yes"
+with_libssl="yes"
 ])
 if test "x$with_libssl" = "xyes"; then
-	SAVE_CPPFLAGS="$CPPFLAGS"
-	CPPFLAGS="$CPPFLAGS $with_libssl_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libssl_cppflags"
 
-  AC_CHECK_HEADERS([openssl/sha.h openssl/blowfish.h openssl/rand.h],
-    [with_libssl="yes"],
-    [with_libssl="no (ssl header not found)"])
+AC_CHECK_HEADERS([openssl/sha.h openssl/blowfish.h openssl/rand.h],
+  [with_libssl="yes"],
+  [with_libssl="no (ssl header not found)"])
 
-	CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 if test "x$with_libssl" = "xyes"; then
-	SAVE_CPPFLAGS="$CPPFLAGS"
-	SAVE_LDFLAGS="$LDFLAGS"
-	CPPFLAGS="$CPPFLAGS $with_libssl_cppflags"
-	LDFLAGS="$LDFLAGS $with_libssl_ldflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+SAVE_LDFLAGS="$LDFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libssl_cppflags"
+LDFLAGS="$LDFLAGS $with_libssl_ldflags"
 
-	AC_CHECK_LIB([ssl], [OPENSSL_init_ssl], [with_libssl="yes"], [with_libssl="no (Symbol 'SSL_library_init' not found)"])
+AC_CHECK_LIB([ssl], [OPENSSL_init_ssl], [with_libssl="yes"], [with_libssl="no (Symbol 'SSL_library_init' not found)"])
 
-	CPPFLAGS="$SAVE_CPPFLAGS"
-	LDFLAGS="$SAVE_LDFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 if test "x$with_libssl" = "xyes"; then
-	BUILD_WITH_LIBSSL_CFLAGS="$with_libssl_cflags"
-	BUILD_WITH_LIBSSL_LDFLAGS="$with_libssl_ldflags"
-	BUILD_WITH_LIBSSL_LIBS="-lssl -lcrypto"
-	AC_SUBST([BUILD_WITH_LIBSSL_CFLAGS])
-	AC_SUBST([BUILD_WITH_LIBSSL_LDFLAGS])
-	AC_SUBST([BUILD_WITH_LIBSSL_LIBS])
-	AC_DEFINE([HAVE_LIBSSL], [1], [Define if libssl is present and usable.])
+BUILD_WITH_LIBSSL_CFLAGS="$with_libssl_cflags"
+BUILD_WITH_LIBSSL_LDFLAGS="$with_libssl_ldflags"
+BUILD_WITH_LIBSSL_LIBS="-lssl -lcrypto"
+AC_SUBST([BUILD_WITH_LIBSSL_CFLAGS])
+AC_SUBST([BUILD_WITH_LIBSSL_LDFLAGS])
+AC_SUBST([BUILD_WITH_LIBSSL_LIBS])
+AC_DEFINE([HAVE_LIBSSL], [1], [Define if libssl is present and usable.])
 fi
 AM_CONDITIONAL(BUILD_WITH_LIBSSL, test "x$with_libssl" = "xyes")
 # }}}
 
 # --with-libstatgrab {{{
 AC_ARG_WITH([libstatgrab],
-  [AS_HELP_STRING([--with-libstatgrab@<:@=PREFIX@:>@], [Path to libstatgrab.])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      with_libstatgrab_cflags="-I$withval/include"
-      with_libstatgrab_ldflags="-L$withval/lib -lstatgrab"
-      with_libstatgrab="yes"
-      with_libstatgrab_pkg_config="no"
-    else
-      with_libstatgrab="$withval"
-      with_libstatgrab_pkg_config="yes"
-    fi
-  ],
-  [
+[AS_HELP_STRING([--with-libstatgrab@<:@=PREFIX@:>@], [Path to libstatgrab.])],
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    with_libstatgrab_cflags="-I$withval/include"
+    with_libstatgrab_ldflags="-L$withval/lib -lstatgrab"
     with_libstatgrab="yes"
+    with_libstatgrab_pkg_config="no"
+  else
+    with_libstatgrab="$withval"
     with_libstatgrab_pkg_config="yes"
-  ])
+  fi
+],
+[
+  with_libstatgrab="yes"
+  with_libstatgrab_pkg_config="yes"
+])
 
 if test "x$with_libstatgrab" = "xyes" && test "x$with_libstatgrab_pkg_config" = "xyes"; then
-  AC_MSG_CHECKING([pkg-config for libstatgrab])
-  temp_result="found"
-  $PKG_CONFIG --exists libstatgrab 2>/dev/null
-  if test "$?" != "0"; then
-    with_libstatgrab_pkg_config="no"
-    with_libstatgrab="no (pkg-config doesn't know libstatgrab)"
-    temp_result="not found"
-  fi
-  AC_MSG_RESULT([$temp_result])
+AC_MSG_CHECKING([pkg-config for libstatgrab])
+temp_result="found"
+$PKG_CONFIG --exists libstatgrab 2>/dev/null
+if test "$?" != "0"; then
+  with_libstatgrab_pkg_config="no"
+  with_libstatgrab="no (pkg-config doesn't know libstatgrab)"
+  temp_result="not found"
+fi
+AC_MSG_RESULT([$temp_result])
 fi
 
 if test "x$with_libstatgrab" = "xyes" && test "x$with_libstatgrab_pkg_config" = "xyes" && test "x$with_libstatgrab_cflags" = "x"; then
-  AC_MSG_CHECKING([for libstatgrab CFLAGS])
-  temp_result="`$PKG_CONFIG --cflags libstatgrab`"
-  if test "$?" = "0"; then
-    with_libstatgrab_cflags="$temp_result"
-  else
-    with_libstatgrab="no ($PKG_CONFIG --cflags libstatgrab failed)"
-    temp_result="$PKG_CONFIG --cflags libstatgrab failed"
-  fi
-  AC_MSG_RESULT([$temp_result])
+AC_MSG_CHECKING([for libstatgrab CFLAGS])
+temp_result="`$PKG_CONFIG --cflags libstatgrab`"
+if test "$?" = "0"; then
+  with_libstatgrab_cflags="$temp_result"
+else
+  with_libstatgrab="no ($PKG_CONFIG --cflags libstatgrab failed)"
+  temp_result="$PKG_CONFIG --cflags libstatgrab failed"
+fi
+AC_MSG_RESULT([$temp_result])
 fi
 
 if test "x$with_libstatgrab" = "xyes" && test "x$with_libstatgrab_pkg_config" = "xyes" && test "x$with_libstatgrab_ldflags" = "x"; then
-  AC_MSG_CHECKING([for libstatgrab LDFLAGS])
-  temp_result="`$PKG_CONFIG --libs libstatgrab`"
-  if test "$?" = "0"
-  then
-    with_libstatgrab_ldflags="$temp_result"
-  else
-    with_libstatgrab="no ($PKG_CONFIG --libs libstatgrab failed)"
-    temp_result="$PKG_CONFIG --libs libstatgrab failed"
-  fi
-  AC_MSG_RESULT([$temp_result])
+AC_MSG_CHECKING([for libstatgrab LDFLAGS])
+temp_result="`$PKG_CONFIG --libs libstatgrab`"
+if test "$?" = "0"
+then
+  with_libstatgrab_ldflags="$temp_result"
+else
+  with_libstatgrab="no ($PKG_CONFIG --libs libstatgrab failed)"
+  temp_result="$PKG_CONFIG --libs libstatgrab failed"
+fi
+AC_MSG_RESULT([$temp_result])
 fi
 
 if test "x$with_libstatgrab" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libstatgrab_cflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libstatgrab_cflags"
 
-  AC_CHECK_HEADERS([statgrab.h],
-    [with_libstatgrab="yes"],
-    [with_libstatgrab="no (statgrab.h not found)"]
-  )
+AC_CHECK_HEADERS([statgrab.h],
+  [with_libstatgrab="yes"],
+  [with_libstatgrab="no (statgrab.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libstatgrab" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_libstatgrab_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_libstatgrab_ldflags"
 
-  AC_CHECK_LIB([statgrab], [sg_init],
-    [with_libstatgrab="yes"],
-    [with_libstatgrab="no (symbol sg_init not found)"]
-  )
+AC_CHECK_LIB([statgrab], [sg_init],
+  [with_libstatgrab="yes"],
+  [with_libstatgrab="no (symbol sg_init not found)"]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libstatgrab" = "xyes"; then
-  SAVE_CFLAGS="$CFLAGS"
-  SAVE_LDFLAGS="$LDFLAGS"
-  SAVE_LIBS="$LIBS"
+SAVE_CFLAGS="$CFLAGS"
+SAVE_LDFLAGS="$LDFLAGS"
+SAVE_LIBS="$LIBS"
 
-  CFLAGS="$CFLAGS $with_libstatgrab_cflags"
-  LDFLAGS="$LDFLAGS $with_libstatgrab_ldflags"
-  LIBS="-lstatgrab $LIBS"
+CFLAGS="$CFLAGS $with_libstatgrab_cflags"
+LDFLAGS="$LDFLAGS $with_libstatgrab_ldflags"
+LIBS="-lstatgrab $LIBS"
 
-  AC_CACHE_CHECK([if libstatgrab >= 0.90],
-    [c_cv_have_libstatgrab_0_90],
-    [
-      AC_LINK_IFELSE(
-        [
-          AC_LANG_PROGRAM(
-            [[
-              #include <stdio.h>
-              #include <statgrab.h>
-            ]],
-            [[
-              if (sg_init()) return 0;
-            ]]
-          )
-        ],
-        [c_cv_have_libstatgrab_0_90="no"],
-        [c_cv_have_libstatgrab_0_90="yes"]
-      )
-    ]
-  )
+AC_CACHE_CHECK([if libstatgrab >= 0.90],
+  [c_cv_have_libstatgrab_0_90],
+  [
+    AC_LINK_IFELSE(
+      [
+        AC_LANG_PROGRAM(
+          [[
+            #include <stdio.h>
+            #include <statgrab.h>
+          ]],
+          [[
+            if (sg_init()) return 0;
+          ]]
+        )
+      ],
+      [c_cv_have_libstatgrab_0_90="no"],
+      [c_cv_have_libstatgrab_0_90="yes"]
+    )
+  ]
+)
 
-  CFLAGS="$SAVE_CFLAGS"
-  LDFLAGS="$SAVE_LDFLAGS"
-  LIBS="$SAVE_LIBS"
+CFLAGS="$SAVE_CFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
+LIBS="$SAVE_LIBS"
 fi
 
 AM_CONDITIONAL([BUILD_WITH_LIBSTATGRAB], [test "x$with_libstatgrab" = "xyes"])
 
 if test "x$with_libstatgrab" = "xyes"; then
-  AC_DEFINE([HAVE_LIBSTATGRAB], [1],
-    [Define to 1 if you have the 'statgrab' library (-lstatgrab)]
-  )
+AC_DEFINE([HAVE_LIBSTATGRAB], [1],
+  [Define to 1 if you have the 'statgrab' library (-lstatgrab)]
+)
 
-  if test "x$c_cv_have_libstatgrab_0_90" = "xyes"; then
-    AC_DEFINE([HAVE_LIBSTATGRAB_0_90], [1],
-      [Define to 1 if libstatgrab version >= 0.90]
-    )
-  fi
+if test "x$c_cv_have_libstatgrab_0_90" = "xyes"; then
+  AC_DEFINE([HAVE_LIBSTATGRAB_0_90], [1],
+    [Define to 1 if libstatgrab version >= 0.90]
+  )
+fi
 
-  BUILD_WITH_LIBSTATGRAB_CFLAGS="$with_libstatgrab_cflags"
-  BUILD_WITH_LIBSTATGRAB_LDFLAGS="$with_libstatgrab_ldflags"
+BUILD_WITH_LIBSTATGRAB_CFLAGS="$with_libstatgrab_cflags"
+BUILD_WITH_LIBSTATGRAB_LDFLAGS="$with_libstatgrab_ldflags"
 
 fi
 
@@ -5449,57 +5449,57 @@ AC_SUBST([BUILD_WITH_LIBSTATGRAB_LDFLAGS])
 
 # --with-libtokyotyrant {{{
 AC_ARG_WITH([libtokyotyrant],
-  [AS_HELP_STRING([--with-libtokyotyrant@<:@=PREFIX@:>@], [Path to libtokyotyrant.])],
-  [
-    if test "x$withval" = "xno" || test "x$withval" = "xyes"; then
-      with_libtokyotyrant="$withval"
-    else
-      with_libtokyotyrant_cppflags="-I$withval/include"
-      with_libtokyotyrant_ldflags="-L$withval/include"
-      with_libtokyotyrant_libs="-ltokyotyrant"
-      with_libtokyotyrant="yes"
-    fi
-  ],
-  [with_libtokyotyrant="yes"]
+[AS_HELP_STRING([--with-libtokyotyrant@<:@=PREFIX@:>@], [Path to libtokyotyrant.])],
+[
+  if test "x$withval" = "xno" || test "x$withval" = "xyes"; then
+    with_libtokyotyrant="$withval"
+  else
+    with_libtokyotyrant_cppflags="-I$withval/include"
+    with_libtokyotyrant_ldflags="-L$withval/include"
+    with_libtokyotyrant_libs="-ltokyotyrant"
+    with_libtokyotyrant="yes"
+  fi
+],
+[with_libtokyotyrant="yes"]
 )
 
 if test "x$with_libtokyotyrant" = "xyes"; then
-  if $PKG_CONFIG --exists tokyotyrant; then
-    with_libtokyotyrant_cppflags="$with_libtokyotyrant_cppflags `$PKG_CONFIG --cflags tokyotyrant`"
-    with_libtokyotyrant_ldflags="$with_libtokyotyrant_ldflags `$PKG_CONFIG --libs-only-L tokyotyrant`"
-    with_libtokyotyrant_libs="$with_libtokyotyrant_libs `$PKG_CONFIG --libs-only-l tokyotyrant`"
-  fi
+if $PKG_CONFIG --exists tokyotyrant; then
+  with_libtokyotyrant_cppflags="$with_libtokyotyrant_cppflags `$PKG_CONFIG --cflags tokyotyrant`"
+  with_libtokyotyrant_ldflags="$with_libtokyotyrant_ldflags `$PKG_CONFIG --libs-only-L tokyotyrant`"
+  with_libtokyotyrant_libs="$with_libtokyotyrant_libs `$PKG_CONFIG --libs-only-l tokyotyrant`"
+fi
 fi
 
 if test "x$with_libtokyotyrant" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libtokyotyrant_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libtokyotyrant_cppflags"
 
-  AC_CHECK_HEADERS([tcrdb.h],
-    [with_libtokyotyrant="yes"],
-    [with_libtokyotyrant="no (tcrdb.h not found)"]
-  )
+AC_CHECK_HEADERS([tcrdb.h],
+  [with_libtokyotyrant="yes"],
+  [with_libtokyotyrant="no (tcrdb.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libtokyotyrant" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_libtokyotyrant_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_libtokyotyrant_ldflags"
 
-  AC_CHECK_LIB([tokyotyrant], [tcrdbrnum],
-    [with_libtokyotyrant="yes"],
-    [with_libtokyotyrant="no (symbol tcrdbrnum not found)"],
-    [$with_libtokyotyrant_libs]
-  )
+AC_CHECK_LIB([tokyotyrant], [tcrdbrnum],
+  [with_libtokyotyrant="yes"],
+  [with_libtokyotyrant="no (symbol tcrdbrnum not found)"],
+  [$with_libtokyotyrant_libs]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libtokyotyrant" = "xyes"; then
-  BUILD_WITH_LIBTOKYOTYRANT_CPPFLAGS="$with_libtokyotyrant_cppflags"
-  BUILD_WITH_LIBTOKYOTYRANT_LDFLAGS="$with_libtokyotyrant_ldflags"
-  BUILD_WITH_LIBTOKYOTYRANT_LIBS="$with_libtokyotyrant_libs"
+BUILD_WITH_LIBTOKYOTYRANT_CPPFLAGS="$with_libtokyotyrant_cppflags"
+BUILD_WITH_LIBTOKYOTYRANT_LDFLAGS="$with_libtokyotyrant_ldflags"
+BUILD_WITH_LIBTOKYOTYRANT_LIBS="$with_libtokyotyrant_libs"
 fi
 AC_SUBST([BUILD_WITH_LIBTOKYOTYRANT_CPPFLAGS])
 AC_SUBST([BUILD_WITH_LIBTOKYOTYRANT_LDFLAGS])
@@ -5508,53 +5508,53 @@ AC_SUBST([BUILD_WITH_LIBTOKYOTYRANT_LIBS])
 
 # --with-libudev {{{
 AC_ARG_WITH([libudev],
-  [AS_HELP_STRING([--with-libudev@<:@=PREFIX@:>@], [Path to libudev.])],
-  [
-    if test "x$withval" = "xno" || test "x$withval" = "xyes"; then
-      with_libudev="$withval"
-    else
-      with_libudev_cppflags="-I$withval/include"
-      with_libudev_ldflags="-L$withval/lib"
-      with_libudev="yes"
-    fi
-  ],
-  [
-    if test "x$ac_system" = "xLinux"; then
-      with_libudev="yes"
-    else
-      with_libudev="no (Linux only library)"
-    fi
-  ]
+[AS_HELP_STRING([--with-libudev@<:@=PREFIX@:>@], [Path to libudev.])],
+[
+  if test "x$withval" = "xno" || test "x$withval" = "xyes"; then
+    with_libudev="$withval"
+  else
+    with_libudev_cppflags="-I$withval/include"
+    with_libudev_ldflags="-L$withval/lib"
+    with_libudev="yes"
+  fi
+],
+[
+  if test "x$ac_system" = "xLinux"; then
+    with_libudev="yes"
+  else
+    with_libudev="no (Linux only library)"
+  fi
+]
 )
 
 if test "x$with_libudev" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libudev_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libudev_cppflags"
 
-  AC_CHECK_HEADERS([libudev.h],
-    [with_libudev="yes"],
-    [with_libudev="no (libudev.h not found)"]
-  )
+AC_CHECK_HEADERS([libudev.h],
+  [with_libudev="yes"],
+  [with_libudev="no (libudev.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libudev" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_libudev_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_libudev_ldflags"
 
-  AC_CHECK_LIB([udev], [udev_new],
-    [with_libudev="yes"],
-    [with_libudev="no (libudev not found)"]
-  )
+AC_CHECK_LIB([udev], [udev_new],
+  [with_libudev="yes"],
+  [with_libudev="no (libudev not found)"]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libudev" = "xyes"; then
-  BUILD_WITH_LIBUDEV_CPPFLAGS="$with_libudev_cppflags"
-  BUILD_WITH_LIBUDEV_LDFLAGS="$with_libudev_ldflags"
-  BUILD_WITH_LIBUDEV_LIBS="-ludev"
+BUILD_WITH_LIBUDEV_CPPFLAGS="$with_libudev_cppflags"
+BUILD_WITH_LIBUDEV_LDFLAGS="$with_libudev_ldflags"
+BUILD_WITH_LIBUDEV_LIBS="-ludev"
 fi
 
 AC_SUBST([BUILD_WITH_LIBUDEV_CPPFLAGS])
@@ -5567,122 +5567,122 @@ AM_CONDITIONAL([BUILD_WITH_LIBUDEV], [test "x$with_libudev" = "xyes"])
 # --with-libupsclient {{{
 with_libupsclient_config=""
 AC_ARG_WITH([libupsclient],
-  [AS_HELP_STRING([--with-libupsclient@<:@=PREFIX@:>@], [Path to the upsclient library.])],
-  [
-    if test "x$withval" = "xno"; then
-      with_libupsclient="no"
-    else if test "x$withval" = "xyes"; then
-      with_libupsclient="use_pkgconfig"
+[AS_HELP_STRING([--with-libupsclient@<:@=PREFIX@:>@], [Path to the upsclient library.])],
+[
+  if test "x$withval" = "xno"; then
+    with_libupsclient="no"
+  else if test "x$withval" = "xyes"; then
+    with_libupsclient="use_pkgconfig"
+  else
+    if test -x "$withval"; then
+      with_libupsclient_config="$withval"
+      with_libupsclient="use_libupsclient_config"
+    else if test -x "$withval/bin/libupsclient-config"; then
+      with_libupsclient_config="$withval/bin/libupsclient-config"
+      with_libupsclient="use_libupsclient_config"
     else
-      if test -x "$withval"; then
-        with_libupsclient_config="$withval"
-        with_libupsclient="use_libupsclient_config"
-      else if test -x "$withval/bin/libupsclient-config"; then
-        with_libupsclient_config="$withval/bin/libupsclient-config"
-        with_libupsclient="use_libupsclient_config"
-      else
-        AC_MSG_NOTICE([Not checking for libupsclient: Manually configured])
-        with_libupsclient_cflags="-I$withval/include"
-        with_libupsclient_libs="-L$withval/lib -lupsclient"
-        with_libupsclient="yes"
-      fi; fi
+      AC_MSG_NOTICE([Not checking for libupsclient: Manually configured])
+      with_libupsclient_cflags="-I$withval/include"
+      with_libupsclient_libs="-L$withval/lib -lupsclient"
+      with_libupsclient="yes"
     fi; fi
-  ],
-  [with_libupsclient="use_pkgconfig"]
+  fi; fi
+],
+[with_libupsclient="use_pkgconfig"]
 )
 
 # configure using libupsclient-config
 if test "x$with_libupsclient" = "xuse_libupsclient_config"; then
-  with_libupsclient_cflags="`$with_libupsclient_config --cflags`"
-  if test $? -ne 0; then
-    with_libupsclient="no ($with_libupsclient_config failed)"
-  fi
-  with_libupsclient_libs="`$with_libupsclient_config --libs`"
-  if test $? -ne 0; then
-    with_libupsclient="no ($with_libupsclient_config failed)"
-  fi
+with_libupsclient_cflags="`$with_libupsclient_config --cflags`"
+if test $? -ne 0; then
+  with_libupsclient="no ($with_libupsclient_config failed)"
+fi
+with_libupsclient_libs="`$with_libupsclient_config --libs`"
+if test $? -ne 0; then
+  with_libupsclient="no ($with_libupsclient_config failed)"
+fi
 fi
 
 if test "x$with_libupsclient" = "xuse_libupsclient_config"; then
-  with_libupsclient="yes"
+with_libupsclient="yes"
 fi
 
 # configure using pkg-config
 if test "x$with_libupsclient" = "xuse_pkgconfig"; then
-  $PKG_CONFIG --exists 'libupsclient' 2>/dev/null
-  if test $? -ne 0; then
-    with_libupsclient="no (pkg-config doesn't know libupsclient)"
-  fi
+$PKG_CONFIG --exists 'libupsclient' 2>/dev/null
+if test $? -ne 0; then
+  with_libupsclient="no (pkg-config doesn't know libupsclient)"
+fi
 fi
 
 if test "x$with_libupsclient" = "xuse_pkgconfig"; then
-  with_libupsclient_cflags="`$PKG_CONFIG --cflags 'libupsclient'`"
-  if test $? -ne 0; then
-    with_libupsclient="no ($PKG_CONFIG failed)"
-  fi
+with_libupsclient_cflags="`$PKG_CONFIG --cflags 'libupsclient'`"
+if test $? -ne 0; then
+  with_libupsclient="no ($PKG_CONFIG failed)"
+fi
 
-  with_libupsclient_libs="`$PKG_CONFIG --libs 'libupsclient'`"
-  if test $? -ne 0; then
-    with_libupsclient="no ($PKG_CONFIG failed)"
-  fi
+with_libupsclient_libs="`$PKG_CONFIG --libs 'libupsclient'`"
+if test $? -ne 0; then
+  with_libupsclient="no ($PKG_CONFIG failed)"
+fi
 fi
 
 if test "x$with_libupsclient" = "xuse_pkgconfig"; then
-  with_libupsclient="yes"
+with_libupsclient="yes"
 fi
 
 if test "x$with_libupsclient" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libupsclient_cflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libupsclient_cflags"
 
-  AC_CHECK_HEADERS([upsclient.h],
-    [with_libupsclient="yes"],
-    [with_libupsclient="no (upsclient.h not found)"]
-  )
+AC_CHECK_HEADERS([upsclient.h],
+  [with_libupsclient="yes"],
+  [with_libupsclient="no (upsclient.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libupsclient" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_libupsclient_libs"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_libupsclient_libs"
 
-  AC_CHECK_LIB([upsclient], [upscli_connect],
-    [with_libupsclient="yes"],
-    [with_libupsclient="no (symbol upscli_connect not found)"]
-  )
+AC_CHECK_LIB([upsclient], [upscli_connect],
+  [with_libupsclient="yes"],
+  [with_libupsclient="no (symbol upscli_connect not found)"]
+)
 
-  AC_CHECK_LIB([upsclient], [upscli_init],
-    [AC_DEFINE([HAVE_UPSCLI_INIT], [1], [Define when upscli_init() (since version 2-7) is available.])]
-  )
+AC_CHECK_LIB([upsclient], [upscli_init],
+  [AC_DEFINE([HAVE_UPSCLI_INIT], [1], [Define when upscli_init() (since version 2-7) is available.])]
+)
 
-  AC_CHECK_LIB([upsclient], [upscli_tryconnect],
-    [AC_DEFINE([HAVE_UPSCLI_TRYCONNECT], [1], [Define when upscli_tryconnect() (since version 2.6.2) is available.])]
-  )
+AC_CHECK_LIB([upsclient], [upscli_tryconnect],
+  [AC_DEFINE([HAVE_UPSCLI_TRYCONNECT], [1], [Define when upscli_tryconnect() (since version 2.6.2) is available.])]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libupsclient" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libupsclient_cflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libupsclient_cflags"
 
-  AC_CHECK_TYPES([UPSCONN_t, UPSCONN],
-    [],
-    [],
-    [[
-      #include <stdlib.h>
-      #include <stdio.h>
-      #include <upsclient.h>
-    ]]
-  )
+AC_CHECK_TYPES([UPSCONN_t, UPSCONN],
+  [],
+  [],
+  [[
+    #include <stdlib.h>
+    #include <stdio.h>
+    #include <upsclient.h>
+  ]]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libupsclient" = "xyes"; then
-  BUILD_WITH_LIBUPSCLIENT_CFLAGS="$with_libupsclient_cflags"
-  BUILD_WITH_LIBUPSCLIENT_LIBS="$with_libupsclient_libs"
+BUILD_WITH_LIBUPSCLIENT_CFLAGS="$with_libupsclient_cflags"
+BUILD_WITH_LIBUPSCLIENT_LIBS="$with_libupsclient_libs"
 fi
 
 AC_SUBST([BUILD_WITH_LIBUPSCLIENT_CFLAGS])
@@ -5691,42 +5691,42 @@ AC_SUBST([BUILD_WITH_LIBUPSCLIENT_LIBS])
 
 # --with-libxenctrl {{{
 AC_ARG_WITH([libxenctrl],
-  [AS_HELP_STRING([--with-libxenctrl@<:@=PREFIX@:>@], [Path to libxenctrl.])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      with_libxenctrl_cppflags="-I$withval/include"
-      with_libxenctrl_ldflags="-L$withval/lib"
-      with_libxenctrl="yes"
-    else
-      with_libxenctrl="$withval"
-    fi
-  ],
-  [with_libxenctrl="yes"]
+[AS_HELP_STRING([--with-libxenctrl@<:@=PREFIX@:>@], [Path to libxenctrl.])],
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    with_libxenctrl_cppflags="-I$withval/include"
+    with_libxenctrl_ldflags="-L$withval/lib"
+    with_libxenctrl="yes"
+  else
+    with_libxenctrl="$withval"
+  fi
+],
+[with_libxenctrl="yes"]
 )
 
 if test "x$with_libxenctrl" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libxenctrl_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libxenctrl_cppflags"
 
-  AC_CHECK_HEADERS([xenctrl.h],
-    [with_libxenctrl="yes"],
-    [with_libxenctrl="no (xenctrl.h not found)"]
-  )
+AC_CHECK_HEADERS([xenctrl.h],
+  [with_libxenctrl="yes"],
+  [with_libxenctrl="no (xenctrl.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libxenctrl" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_libxenctrl_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_libxenctrl_ldflags"
 
-  #Xen versions older than 3.4 has no xc_getcpuinfo()
-  AC_CHECK_LIB([xenctrl], [xc_getcpuinfo],
-    [with_libxenctrl="yes"],
-    [with_libxenctrl="no (symbol 'xc_getcpuinfo' not found)"]
-  )
+#Xen versions older than 3.4 has no xc_getcpuinfo()
+AC_CHECK_LIB([xenctrl], [xc_getcpuinfo],
+  [with_libxenctrl="yes"],
+  [with_libxenctrl="no (symbol 'xc_getcpuinfo' not found)"]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 LIBXENCTL_CPPFLAGS="$with_libxenctl_cppflags"
@@ -5738,60 +5738,60 @@ AC_SUBST([LIBXENCTL_LDFLAGS])
 # --with-libxmms {{{
 with_xmms_config="xmms-config"
 AC_ARG_WITH([libxmms],
-  [AS_HELP_STRING([--with-libxmms@<:@=PREFIX@:>@], [Path to libxmms.])],
-  [
-    if test "x$withval" = "xno" || test "x$withval" = "xyes"; then
-      with_libxmms="$withval"
-    else
-      if test -f "$withval" && test -x "$withval"; then
-        with_xmms_config="$withval"
-      else if test -x "$withval/bin/xmms-config"; then
-        with_xmms_config="$withval/bin/xmms-config"
-      fi; fi
-      with_libxmms="yes"
-    fi
-  ],
-  [with_libxmms="yes"]
+[AS_HELP_STRING([--with-libxmms@<:@=PREFIX@:>@], [Path to libxmms.])],
+[
+  if test "x$withval" = "xno" || test "x$withval" = "xyes"; then
+    with_libxmms="$withval"
+  else
+    if test -f "$withval" && test -x "$withval"; then
+      with_xmms_config="$withval"
+    else if test -x "$withval/bin/xmms-config"; then
+      with_xmms_config="$withval/bin/xmms-config"
+    fi; fi
+    with_libxmms="yes"
+  fi
+],
+[with_libxmms="yes"]
 )
 
 if test "x$with_libxmms" = "xyes"; then
-  with_xmms_cflags=`$with_xmms_config --cflags 2>/dev/null`
-  if test $? -ne 0; then
-    with_libxmms="no"
-  fi
+with_xmms_cflags=`$with_xmms_config --cflags 2>/dev/null`
+if test $? -ne 0; then
+  with_libxmms="no"
+fi
 fi
 
 if test "x$with_libxmms" = "xyes"; then
-  with_xmms_libs=`$with_xmms_config --libs 2>/dev/null`
-  if test $? -ne 0; then
-    with_libxmms="no"
-  fi
+with_xmms_libs=`$with_xmms_config --libs 2>/dev/null`
+if test $? -ne 0; then
+  with_libxmms="no"
+fi
 fi
 
 if test "x$with_libxmms" = "xyes"; then
-  SAVE_CPPFLAGS="$CFLAGS"
-  CPPFLAGS="$with_xmms_cflags"
+SAVE_CPPFLAGS="$CFLAGS"
+CPPFLAGS="$with_xmms_cflags"
 
-  AC_CHECK_HEADER([xmmsctrl.h],
-    [with_libxmms="yes"],
-    [with_libxmms="no"],
-  )
+AC_CHECK_HEADER([xmmsctrl.h],
+  [with_libxmms="yes"],
+  [with_libxmms="no"],
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libxmms" = "xyes"; then
-  SAVE_LIBS="$LIBS"
-  LIBS="$with_xmms_libs"
+SAVE_LIBS="$LIBS"
+LIBS="$with_xmms_libs"
 
-  AC_CHECK_LIB([xmms], [xmms_remote_get_info],
-    [with_libxmss="yes"],
-    [with_libxmms="no"],
-    [$with_xmms_libs]
+AC_CHECK_LIB([xmms], [xmms_remote_get_info],
+  [with_libxmss="yes"],
+  [with_libxmms="no"],
+  [$with_xmms_libs]
 
-  )
+)
 
-  LIBS="$SAVE_LIBS"
+LIBS="$SAVE_LIBS"
 fi
 
 BUILD_WITH_LIBXMMS_CFLAGS="$with_xmms_cflags"
@@ -5803,60 +5803,60 @@ AC_SUBST([BUILD_WITH_LIBXMMS_LIBS])
 
 # --with-libyajl {{{
 AC_ARG_WITH([libyajl],
-  [AS_HELP_STRING([--with-libyajl@<:@=PREFIX@:>@], [Path to libyajl.])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      with_libyajl_cppflags="-I$withval/include"
-      with_libyajl_ldflags="-L$withval/lib"
-      with_libyajl="yes"
-    else
-      with_libyajl="$withval"
-    fi
-  ],
-  [with_libyajl="yes"]
+[AS_HELP_STRING([--with-libyajl@<:@=PREFIX@:>@], [Path to libyajl.])],
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    with_libyajl_cppflags="-I$withval/include"
+    with_libyajl_ldflags="-L$withval/lib"
+    with_libyajl="yes"
+  else
+    with_libyajl="$withval"
+  fi
+],
+[with_libyajl="yes"]
 )
 
 if test "x$with_libyajl" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libyajl_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libyajl_cppflags"
 
-  AC_CHECK_HEADERS([yajl/yajl_parse.h],
-    [with_libyajl="yes"],
-    [with_libyajl="no (yajl/yajl_parse.h not found)"]
-  )
+AC_CHECK_HEADERS([yajl/yajl_parse.h],
+  [with_libyajl="yes"],
+  [with_libyajl="no (yajl/yajl_parse.h not found)"]
+)
 
-  AC_CHECK_HEADERS([yajl/yajl_tree.h],
-    [with_libyajl2="yes"],
-    [with_libyajl2="no (yajl/yajl_tree.h not found)"]
-  )
+AC_CHECK_HEADERS([yajl/yajl_tree.h],
+  [with_libyajl2="yes"],
+  [with_libyajl2="no (yajl/yajl_tree.h not found)"]
+)
 
-  AC_CHECK_HEADERS([yajl/yajl_version.h])
+AC_CHECK_HEADERS([yajl/yajl_version.h])
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libyajl" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_libyajl_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_libyajl_ldflags"
 
-  AC_CHECK_LIB([yajl], [yajl_alloc],
-    [with_libyajl="yes"],
-    [with_libyajl="no (Symbol 'yajl_alloc' not found)"]
-  )
+AC_CHECK_LIB([yajl], [yajl_alloc],
+  [with_libyajl="yes"],
+  [with_libyajl="no (Symbol 'yajl_alloc' not found)"]
+)
 
-  AC_CHECK_LIB([yajl], [yajl_tree_parse],
-    [with_libyajl2="yes"],
-    [with_libyajl2="no (Symbol 'yajl_tree_parse' not found)"]
-  )
+AC_CHECK_LIB([yajl], [yajl_tree_parse],
+  [with_libyajl2="yes"],
+  [with_libyajl2="no (Symbol 'yajl_tree_parse' not found)"]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libyajl" = "xyes"; then
-  BUILD_WITH_LIBYAJL_CPPFLAGS="$with_libyajl_cppflags"
-  BUILD_WITH_LIBYAJL_LDFLAGS="$with_libyajl_ldflags"
-  BUILD_WITH_LIBYAJL_LIBS="-lyajl"
-  AC_DEFINE([HAVE_LIBYAJL], [1], [Define if libyajl is present and usable.])
+BUILD_WITH_LIBYAJL_CPPFLAGS="$with_libyajl_cppflags"
+BUILD_WITH_LIBYAJL_LDFLAGS="$with_libyajl_ldflags"
+BUILD_WITH_LIBYAJL_LIBS="-lyajl"
+AC_DEFINE([HAVE_LIBYAJL], [1], [Define if libyajl is present and usable.])
 fi
 
 AC_SUBST([BUILD_WITH_LIBYAJL_CPPFLAGS])
@@ -5872,48 +5872,48 @@ with_mic_cppflags="-I/opt/intel/mic/sysmgmt/sdk/include"
 with_mic_ldflags="-L/opt/intel/mic/sysmgmt/sdk/lib/Linux"
 with_mic_libs="-lMicAccessSDK -scif"
 AC_ARG_WITH([mic],
-  [AS_HELP_STRING([--with-mic@<:@=PREFIX@:>@], [Path to Intel MIC Access API.])],
-  [
-    if test "x$withval" = "xno" || test "x$withval" = "xyes"; then
-      with_mic="$withval"
-    else if test -d "$with_mic/lib"; then
-      with_mic_cppflags="-I$withval/include"
-      with_mic_ldflags="-L$withval/lib/Linux"
-      with_mic="yes"
-    fi; fi
-  ],
-  [with_mic="yes"]
+[AS_HELP_STRING([--with-mic@<:@=PREFIX@:>@], [Path to Intel MIC Access API.])],
+[
+  if test "x$withval" = "xno" || test "x$withval" = "xyes"; then
+    with_mic="$withval"
+  else if test -d "$with_mic/lib"; then
+    with_mic_cppflags="-I$withval/include"
+    with_mic_ldflags="-L$withval/lib/Linux"
+    with_mic="yes"
+  fi; fi
+],
+[with_mic="yes"]
 )
 
 if test "x$with_mic" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_mic_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_mic_cppflags"
 
-  AC_CHECK_HEADERS([MicAccessApi.h],
-    [with_mic="yes"],
-    [with_mic="no (MicAccessApi not found)"]
-  )
+AC_CHECK_HEADERS([MicAccessApi.h],
+  [with_mic="yes"],
+  [with_mic="no (MicAccessApi not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_mic" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_mic_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_mic_ldflags"
 
-  AC_CHECK_LIB([MicAccessSDK], [MicInitAPI],
-    [with_mic="yes"],
-    [with_mic="no (symbol MicInitAPI not found)"],
-    [$PTHREAD_LIBS -lscif]
-  )
+AC_CHECK_LIB([MicAccessSDK], [MicInitAPI],
+  [with_mic="yes"],
+  [with_mic="no (symbol MicInitAPI not found)"],
+  [$PTHREAD_LIBS -lscif]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_mic" = "xyes"; then
-  BUILD_WITH_MIC_CPPFLAGS="$with_mic_cppflags"
-  BUILD_WITH_MIC_LDFLAGS="$with_mic_ldflags"
-  BUILD_WITH_MIC_LIBS="$with_mic_libs"
+BUILD_WITH_MIC_CPPFLAGS="$with_mic_cppflags"
+BUILD_WITH_MIC_LDFLAGS="$with_mic_ldflags"
+BUILD_WITH_MIC_LIBS="$with_mic_libs"
 fi
 AC_SUBST([BUILD_WITH_MIC_CPPFLAGS])
 AC_SUBST([BUILD_WITH_MIC_LDFLAGS])
@@ -5922,74 +5922,74 @@ AC_SUBST([BUILD_WITH_MIC_LIBS])
 
 # --with-libvarnish {{{
 AC_ARG_WITH([libvarnish],
-  [AS_HELP_STRING([--with-libvarnish@<:@=PREFIX@:>@], [Path to libvarnish.])],
-  [
-    if test "x$withval" = "xno"; then
-      with_libvarnish="no"
-    else if test "x$withval" = "xyes"; then
-      with_libvarnish="use_pkgconfig"
-    else if test -d "$with_libvarnish/lib"; then
-      with_libvarnish_cflags="-I$withval/include"
-      with_libvarnish_libs="-L$withval/lib -lvarnishapi"
-      with_libvarnish="yes"
-    fi; fi; fi
-  ],
-  [with_libvarnish="use_pkgconfig"]
+[AS_HELP_STRING([--with-libvarnish@<:@=PREFIX@:>@], [Path to libvarnish.])],
+[
+  if test "x$withval" = "xno"; then
+    with_libvarnish="no"
+  else if test "x$withval" = "xyes"; then
+    with_libvarnish="use_pkgconfig"
+  else if test -d "$with_libvarnish/lib"; then
+    with_libvarnish_cflags="-I$withval/include"
+    with_libvarnish_libs="-L$withval/lib -lvarnishapi"
+    with_libvarnish="yes"
+  fi; fi; fi
+],
+[with_libvarnish="use_pkgconfig"]
 )
 
 # configure using pkg-config
 if test "x$with_libvarnish" = "xuse_pkgconfig"; then
-  $PKG_CONFIG --exists 'varnishapi' 2>/dev/null
-  if test $? -ne 0; then
-    with_libvarnish="no (pkg-config doesn't know varnishapi)"
-  fi
+$PKG_CONFIG --exists 'varnishapi' 2>/dev/null
+if test $? -ne 0; then
+  with_libvarnish="no (pkg-config doesn't know varnishapi)"
+fi
 fi
 
 if test "x$with_libvarnish" = "xuse_pkgconfig"; then
-  with_libvarnish_cflags="`$PKG_CONFIG --cflags 'varnishapi'`"
-  if test $? -ne 0; then
-    with_libvarnish="no ($PKG_CONFIG failed)"
-  fi
+with_libvarnish_cflags="`$PKG_CONFIG --cflags 'varnishapi'`"
+if test $? -ne 0; then
+  with_libvarnish="no ($PKG_CONFIG failed)"
+fi
 
-  with_libvarnish_libs="`$PKG_CONFIG --libs 'varnishapi'`"
-  if test $? -ne 0; then
-    with_libvarnish="no ($PKG_CONFIG failed)"
-  fi
+with_libvarnish_libs="`$PKG_CONFIG --libs 'varnishapi'`"
+if test $? -ne 0; then
+  with_libvarnish="no ($PKG_CONFIG failed)"
+fi
 fi
 if test "x$with_libvarnish" = "xuse_pkgconfig"; then
-  with_libvarnish="yes"
+with_libvarnish="yes"
 fi
 
 if test "x$with_libvarnish" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libvarnish_cflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libvarnish_cflags"
 
-  $PKG_CONFIG --atleast-version=5.2 'varnishapi' 2>/dev/null
-  if test $? -eq 0; then
-    AC_DEFINE([HAVE_VARNISH_V5], [1], [Varnish 5 API support])
-  else
-    AC_CHECK_HEADERS([vapi/vsc.h],
-      [AC_DEFINE([HAVE_VARNISH_V4], [1], [Varnish 4 API support])],
-      [
-        AC_CHECK_HEADERS([vsc.h],
-          [AC_DEFINE([HAVE_VARNISH_V3], [1], [Varnish 3 API support]) ],
-          [
-            AC_CHECK_HEADERS([varnishapi.h],
-              [AC_DEFINE([HAVE_VARNISH_V2], [1], [Varnish 2 API support])],
-              [with_libvarnish="no (found none of the varnish header files)"]
-            )
-          ]
-        )
-      ]
-    )
-  fi
+$PKG_CONFIG --atleast-version=5.2 'varnishapi' 2>/dev/null
+if test $? -eq 0; then
+  AC_DEFINE([HAVE_VARNISH_V5], [1], [Varnish 5 API support])
+else
+  AC_CHECK_HEADERS([vapi/vsc.h],
+    [AC_DEFINE([HAVE_VARNISH_V4], [1], [Varnish 4 API support])],
+    [
+      AC_CHECK_HEADERS([vsc.h],
+        [AC_DEFINE([HAVE_VARNISH_V3], [1], [Varnish 3 API support]) ],
+        [
+          AC_CHECK_HEADERS([varnishapi.h],
+            [AC_DEFINE([HAVE_VARNISH_V2], [1], [Varnish 2 API support])],
+            [with_libvarnish="no (found none of the varnish header files)"]
+          )
+        ]
+      )
+    ]
+  )
+fi
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libvarnish" = "xyes"; then
-  BUILD_WITH_LIBVARNISH_CFLAGS="$with_libvarnish_cflags"
-  BUILD_WITH_LIBVARNISH_LIBS="$with_libvarnish_libs"
+BUILD_WITH_LIBVARNISH_CFLAGS="$with_libvarnish_cflags"
+BUILD_WITH_LIBVARNISH_LIBS="$with_libvarnish_libs"
 fi
 
 AC_SUBST([BUILD_WITH_LIBVARNISH_CFLAGS])
@@ -5998,29 +5998,11 @@ AC_SUBST([BUILD_WITH_LIBVARNISH_LIBS])
 
 # --with-libxml2 {{{
 AC_ARG_WITH(libxml2,
-  [AS_HELP_STRING([--with-libxml2@<:@=PREFIX@:>@], [Path to libxml2.])],
-  [
-    if test "x$withval" = "xno"; then
-      with_libxml2="no"
-    else if test "x$withval" = "xyes"; then
-      $PKG_CONFIG --exists 'libxml-2.0' 2>/dev/null
-      if test $? -eq 0; then
-        with_libxml2="yes"
-        with_libxml2_cflags="`$PKG_CONFIG --cflags libxml-2.0`"
-        with_libxml2_ldflags="`$PKG_CONFIG --libs libxml-2.0`"
-      else
-        with_libxml2="no (pkg-config doesn't know libxml-2.0)"
-      fi
-    else
-      with_libxml2="yes"
-      with_libxml2_cflags="-I$withval/include"
-      with_libxml2_ldflags="-L$withval/lib"
-    fi; fi
-  ],
-  dnl  if no argument --with-libxml2 was passed, find the library locations
-  dnl  with pkg-config just like above, when --with-libxml2=yes.
-  [
-    with_libxml2="yes"
+[AS_HELP_STRING([--with-libxml2@<:@=PREFIX@:>@], [Path to libxml2.])],
+[
+  if test "x$withval" = "xno"; then
+    with_libxml2="no"
+  else if test "x$withval" = "xyes"; then
     $PKG_CONFIG --exists 'libxml-2.0' 2>/dev/null
     if test $? -eq 0; then
       with_libxml2="yes"
@@ -6029,36 +6011,54 @@ AC_ARG_WITH(libxml2,
     else
       with_libxml2="no (pkg-config doesn't know libxml-2.0)"
     fi
-  ]
+  else
+    with_libxml2="yes"
+    with_libxml2_cflags="-I$withval/include"
+    with_libxml2_ldflags="-L$withval/lib"
+  fi; fi
+],
+dnl  if no argument --with-libxml2 was passed, find the library locations
+dnl  with pkg-config just like above, when --with-libxml2=yes.
+[
+  with_libxml2="yes"
+  $PKG_CONFIG --exists 'libxml-2.0' 2>/dev/null
+  if test $? -eq 0; then
+    with_libxml2="yes"
+    with_libxml2_cflags="`$PKG_CONFIG --cflags libxml-2.0`"
+    with_libxml2_ldflags="`$PKG_CONFIG --libs libxml-2.0`"
+  else
+    with_libxml2="no (pkg-config doesn't know libxml-2.0)"
+  fi
+]
 )
 
 if test "x$with_libxml2" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libxml2_cflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libxml2_cflags"
 
-  AC_CHECK_HEADERS([libxml/parser.h],
-    [with_libxml2="yes"],
-    [with_libxml2="no (libxml/parser.h not found)"]
-  )
+AC_CHECK_HEADERS([libxml/parser.h],
+  [with_libxml2="yes"],
+  [with_libxml2="no (libxml/parser.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libxml2" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_libxml2_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_libxml2_ldflags"
 
-  AC_CHECK_LIB([xml2], [xmlXPathEval],
-    [with_libxml2="yes"],
-    [with_libxml2="no (symbol xmlXPathEval not found)"]
-  )
+AC_CHECK_LIB([xml2], [xmlXPathEval],
+  [with_libxml2="yes"],
+  [with_libxml2="no (symbol xmlXPathEval not found)"]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libxml2" = "xyes"; then
-  BUILD_WITH_LIBXML2_CFLAGS="$with_libxml2_cflags"
-  BUILD_WITH_LIBXML2_LIBS="$with_libxml2_ldflags"
+BUILD_WITH_LIBXML2_CFLAGS="$with_libxml2_cflags"
+BUILD_WITH_LIBXML2_LIBS="$with_libxml2_ldflags"
 fi
 
 AC_SUBST([BUILD_WITH_LIBXML2_CFLAGS])
@@ -6068,50 +6068,50 @@ AC_SUBST([BUILD_WITH_LIBXML2_LIBS])
 # pkg-config --exists libvirt {{{
 $PKG_CONFIG --exists libvirt 2>/dev/null
 if test $? = 0; then
-  with_libvirt="yes"
+with_libvirt="yes"
 else
-  with_libvirt="no (pkg-config doesn't know libvirt)"
+with_libvirt="no (pkg-config doesn't know libvirt)"
 fi
 
 if test "x$with_libvirt" = "xyes"; then
-  with_libvirt_cflags="`$PKG_CONFIG --cflags libvirt`"
-  if test $? -ne 0; then
-    with_libvirt="no"
-  fi
+with_libvirt_cflags="`$PKG_CONFIG --cflags libvirt`"
+if test $? -ne 0; then
+  with_libvirt="no"
+fi
 
-  with_libvirt_ldflags="`$PKG_CONFIG --libs libvirt`"
-  if test $? -ne 0; then
-    with_libvirt="no"
-  fi
+with_libvirt_ldflags="`$PKG_CONFIG --libs libvirt`"
+if test $? -ne 0; then
+  with_libvirt="no"
+fi
 fi
 
 if test "x$with_libvirt" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libvirt_cflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libvirt_cflags"
 
-  AC_CHECK_HEADERS([libvirt/libvirt.h],
-    [with_libvirt="yes"],
-    [with_libvirt="no (libvirt/libvirt.h not found)"]
-  )
+AC_CHECK_HEADERS([libvirt/libvirt.h],
+  [with_libvirt="yes"],
+  [with_libvirt="no (libvirt/libvirt.h not found)"]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libvirt" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_libvirt_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_libvirt_ldflags"
 
-  AC_CHECK_LIB([virt], [virDomainBlockStats],
-    [with_libvirt="yes"],
-    [with_libvirt="no (symbol virDomainBlockStats not found)"]
-  )
+AC_CHECK_LIB([virt], [virDomainBlockStats],
+  [with_libvirt="yes"],
+  [with_libvirt="no (symbol virDomainBlockStats not found)"]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libvirt" = "xyes"; then
-  BUILD_WITH_LIBVIRT_CFLAGS="$with_libvirt_cflags"
-  BUILD_WITH_LIBVIRT_LIBS="$with_libvirt_ldflags"
+BUILD_WITH_LIBVIRT_CFLAGS="$with_libvirt_cflags"
+BUILD_WITH_LIBVIRT_LIBS="$with_libvirt_ldflags"
 fi
 
 AC_SUBST([BUILD_WITH_LIBVIRT_CFLAGS])
@@ -6123,55 +6123,55 @@ with_libopenipmipthread="yes"
 AC_MSG_CHECKING([for libOpenIPMIpthread])
 $PKG_CONFIG --exists OpenIPMIpthread 2>/dev/null
 if test $? -ne 0; then
-  with_libopenipmipthread="no (pkg-config doesn't know OpenIPMIpthread)"
+with_libopenipmipthread="no (pkg-config doesn't know OpenIPMIpthread)"
 fi
 AC_MSG_RESULT([$with_libopenipmipthread])
 
 if test "x$with_libopenipmipthread" = "xyes"; then
-  AC_MSG_CHECKING([for libOpenIPMIpthread CFLAGS])
-  temp_result="`$PKG_CONFIG --cflags OpenIPMIpthread`"
-  if test $? -eq 0; then
-    with_libopenipmipthread_cflags="$temp_result"
-  else
-    with_libopenipmipthread="no ($PKG_CONFIG --cflags OpenIPMIpthread failed)"
-    temp_result="$PKG_CONFIG --cflags OpenIPMIpthread failed"
-  fi
-  AC_MSG_RESULT([$temp_result])
+AC_MSG_CHECKING([for libOpenIPMIpthread CFLAGS])
+temp_result="`$PKG_CONFIG --cflags OpenIPMIpthread`"
+if test $? -eq 0; then
+  with_libopenipmipthread_cflags="$temp_result"
+else
+  with_libopenipmipthread="no ($PKG_CONFIG --cflags OpenIPMIpthread failed)"
+  temp_result="$PKG_CONFIG --cflags OpenIPMIpthread failed"
+fi
+AC_MSG_RESULT([$temp_result])
 fi
 
 if test "x$with_libopenipmipthread" = "xyes"; then
-  AC_MSG_CHECKING([for libOpenIPMIpthread LDFLAGS])
-  temp_result="`$PKG_CONFIG --libs OpenIPMIpthread`"
-  if test $? -eq 0; then
-    with_libopenipmipthread_ldflags="$temp_result"
-  else
-    with_libopenipmipthread="no ($PKG_CONFIG --libs OpenIPMIpthread failed)"
-    temp_result="$PKG_CONFIG --libs OpenIPMIpthread failed"
-  fi
-  AC_MSG_RESULT([$temp_result])
+AC_MSG_CHECKING([for libOpenIPMIpthread LDFLAGS])
+temp_result="`$PKG_CONFIG --libs OpenIPMIpthread`"
+if test $? -eq 0; then
+  with_libopenipmipthread_ldflags="$temp_result"
+else
+  with_libopenipmipthread="no ($PKG_CONFIG --libs OpenIPMIpthread failed)"
+  temp_result="$PKG_CONFIG --libs OpenIPMIpthread failed"
+fi
+AC_MSG_RESULT([$temp_result])
 fi
 
 if test "x$with_libopenipmipthread" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libopenipmipthread_cflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libopenipmipthread_cflags"
 
-  AC_CHECK_HEADERS([OpenIPMI/ipmi_smi.h],
-    [with_libopenipmipthread="yes"],
-    [with_libopenipmipthread="no (OpenIPMI/ipmi_smi.h not found)"],
-    [[
-      #include <OpenIPMI/ipmiif.h>
-      #include <OpenIPMI/ipmi_err.h>
-      #include <OpenIPMI/ipmi_posix.h>
-      #include <OpenIPMI/ipmi_conn.h>
-    ]]
-  )
+AC_CHECK_HEADERS([OpenIPMI/ipmi_smi.h],
+  [with_libopenipmipthread="yes"],
+  [with_libopenipmipthread="no (OpenIPMI/ipmi_smi.h not found)"],
+  [[
+    #include <OpenIPMI/ipmiif.h>
+    #include <OpenIPMI/ipmi_err.h>
+    #include <OpenIPMI/ipmi_posix.h>
+    #include <OpenIPMI/ipmi_conn.h>
+  ]]
+)
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libopenipmipthread" = "xyes"; then
-  BUILD_WITH_OPENIPMI_CFLAGS="$with_libopenipmipthread_cflags"
-  BUILD_WITH_OPENIPMI_LIBS="$with_libopenipmipthread_ldflags"
+BUILD_WITH_OPENIPMI_CFLAGS="$with_libopenipmipthread_cflags"
+BUILD_WITH_OPENIPMI_LIBS="$with_libopenipmipthread_ldflags"
 fi
 
 AC_SUBST([BUILD_WITH_OPENIPMI_CFLAGS])
@@ -6180,52 +6180,52 @@ AC_SUBST([BUILD_WITH_OPENIPMI_LIBS])
 
 # --with-libatasmart {{{
 AC_ARG_WITH([libatasmart],
-  [AS_HELP_STRING([--with-libatasmart@<:@=PREFIX@:>@], [Path to libatasmart.])],
-  [
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
-      with_libatasmart_cppflags="-I$withval/include"
-      with_libatasmart_ldflags="-L$withval/lib"
-      with_libatasmart="yes"
-    else
-      with_libatasmart="$withval"
-    fi
-  ],
-  [
-    if test "x$ac_system" = "xLinux"; then
-      with_libatasmart="yes"
-    else
-      with_libatasmart="no (Linux only library)"
-    fi
-  ]
+[AS_HELP_STRING([--with-libatasmart@<:@=PREFIX@:>@], [Path to libatasmart.])],
+[
+  if test "x$withval" != "xno" && test "x$withval" != "xyes"; then
+    with_libatasmart_cppflags="-I$withval/include"
+    with_libatasmart_ldflags="-L$withval/lib"
+    with_libatasmart="yes"
+  else
+    with_libatasmart="$withval"
+  fi
+],
+[
+  if test "x$ac_system" = "xLinux"; then
+    with_libatasmart="yes"
+  else
+    with_libatasmart="no (Linux only library)"
+  fi
+]
 )
 
 if test "x$with_libatasmart" = "xyes"; then
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS $with_libatasmart_cppflags"
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libatasmart_cppflags"
 
-  AC_CHECK_HEADERS([atasmart.h],
-    [with_libatasmart="yes"],
-    [with_libatasmart="no (atasmart.h not found)"])
+AC_CHECK_HEADERS([atasmart.h],
+  [with_libatasmart="yes"],
+  [with_libatasmart="no (atasmart.h not found)"])
 
-  CPPFLAGS="$SAVE_CPPFLAGS"
+CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 
 if test "x$with_libatasmart" = "xyes"; then
-  SAVE_LDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDFLAGS $with_libatasmart_ldflags"
+SAVE_LDFLAGS="$LDFLAGS"
+LDFLAGS="$LDFLAGS $with_libatasmart_ldflags"
 
-  AC_CHECK_LIB([atasmart], [sk_disk_open],
-    [with_libatasmart="yes"],
-    [with_libatasmart="no (Symbol 'sk_disk_open' not found)"]
-  )
+AC_CHECK_LIB([atasmart], [sk_disk_open],
+  [with_libatasmart="yes"],
+  [with_libatasmart="no (Symbol 'sk_disk_open' not found)"]
+)
 
-  LDFLAGS="$SAVE_LDFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libatasmart" = "xyes"; then
-  BUILD_WITH_LIBATASMART_CPPFLAGS="$with_libatasmart_cppflags"
-  BUILD_WITH_LIBATASMART_LDFLAGS="$with_libatasmart_ldflags"
-  BUILD_WITH_LIBATASMART_LIBS="-latasmart"
+BUILD_WITH_LIBATASMART_CPPFLAGS="$with_libatasmart_cppflags"
+BUILD_WITH_LIBATASMART_LDFLAGS="$with_libatasmart_ldflags"
+BUILD_WITH_LIBATASMART_LIBS="-latasmart"
 fi
 
 AC_SUBST([BUILD_WITH_LIBATASMART_CPPFLAGS])
@@ -6234,13 +6234,13 @@ AC_SUBST([BUILD_WITH_LIBATASMART_LIBS])
 # }}}
 
 PKG_CHECK_MODULES([LIBNOTIFY], [libnotify],
-  [with_libnotify="yes"],
-  [with_libnotify="no (pkg-config doesn't know libnotify)"]
+[with_libnotify="yes"],
+[with_libnotify="no (pkg-config doesn't know libnotify)"]
 )
 
 PKG_CHECK_MODULES([LIBRIEMANN_CLIENT], [riemann-client >= 1.6.0],
- [with_libriemann_client="yes"],
- [with_libriemann_client="no (pkg-config doesn't know libriemann-client)"]
+[with_libriemann_client="yes"],
+[with_libriemann_client="no (pkg-config doesn't know libriemann-client)"]
 )
 
 # Check for enabled/disabled features
@@ -6252,104 +6252,104 @@ dnl
 m4_define([my_toupper],[m4_translit([$1], m4_defn([m4_cr_letters]), m4_defn([m4_cr_LETTERS]))])
 dnl
 AC_DEFUN(
-  [AC_COLLECTD],
-  [
-  m4_if([$1], [], [AC_FATAL([AC_COLLECTD([$1], [$2], [$3], [$4]): 1st argument must not be empty])])dnl
-  m4_if(
+[AC_COLLECTD],
+[
+m4_if([$1], [], [AC_FATAL([AC_COLLECTD([$1], [$2], [$3], [$4]): 1st argument must not be empty])])dnl
+m4_if(
+  [$2],
+  [enable],
+  [dnl
+  m4_define([EnDis],[disabled])dnl
+  m4_define([YesNo],[no])dnl
+  ],dnl
+  [m4_if(
     [$2],
-    [enable],
+    [disable],
     [dnl
-    m4_define([EnDis],[disabled])dnl
-    m4_define([YesNo],[no])dnl
-    ],dnl
-    [m4_if(
-      [$2],
-      [disable],
-      [dnl
-      m4_define([EnDis],[enabled])dnl
-      m4_define([YesNo],[yes])dnl
-      ],
-      [dnl
-      AC_FATAL([AC_COLLECTD([$1], [$2], [$3], [$4]): 2nd argument must be either enable or disable])dnl
-      ]dnl
-    )]dnl
-  )dnl
-  m4_if([$3], [feature], [],
-    [m4_if(
-      [$3], [module], [],
-      [dnl
-      AC_FATAL([AC_COLLECTD([$1], [$2], [$3], [$4]): 3rd argument must be either feature or disable])dnl
-      ]dnl
-    )]dnl
-  )dnl
-  AC_ARG_ENABLE(
-    [$1],
-    AS_HELP_STRING([--$2-$1], [$2 $4 (EnDis by def)]),
-    [],
-    enable_$1='[YesNo]'dnl
-  )# AC_ARG_ENABLE
-  if test "x$enable_$1" = "xno"; then
-    collectd_$1=0
+    m4_define([EnDis],[enabled])dnl
+    m4_define([YesNo],[yes])dnl
+    ],
+    [dnl
+    AC_FATAL([AC_COLLECTD([$1], [$2], [$3], [$4]): 2nd argument must be either enable or disable])dnl
+    ]dnl
+  )]dnl
+)dnl
+m4_if([$3], [feature], [],
+  [m4_if(
+    [$3], [module], [],
+    [dnl
+    AC_FATAL([AC_COLLECTD([$1], [$2], [$3], [$4]): 3rd argument must be either feature or disable])dnl
+    ]dnl
+  )]dnl
+)dnl
+AC_ARG_ENABLE(
+  [$1],
+  AS_HELP_STRING([--$2-$1], [$2 $4 (EnDis by def)]),
+  [],
+  enable_$1='[YesNo]'dnl
+)# AC_ARG_ENABLE
+if test "x$enable_$1" = "xno"; then
+  collectd_$1=0
+else
+  if test "x$enable_$1" = "xyes"; then
+    collectd_$1=1
   else
-    if test "x$enable_$1" = "xyes"; then
-      collectd_$1=1
-    else
-      AC_MSG_NOTICE([please specify either --enable-$1 or --disable-$1; enabling $1.])
-      collectd_$1=1
-      enable_$1='yes'
-    fi
+    AC_MSG_NOTICE([please specify either --enable-$1 or --disable-$1; enabling $1.])
+    collectd_$1=1
+    enable_$1='yes'
   fi
-  AC_DEFINE_UNQUOTED([COLLECT_]my_toupper([$1]), [$collectd_$1], [whether or not to enable $3 $4])
-  AM_CONDITIONAL([BUILD_]my_toupper([$3])[_]my_toupper([$1]), [test "x$enable_$1" = "xyes"])dnl
-  ]dnl
+fi
+AC_DEFINE_UNQUOTED([COLLECT_]my_toupper([$1]), [$collectd_$1], [whether or not to enable $3 $4])
+AM_CONDITIONAL([BUILD_]my_toupper([$3])[_]my_toupper([$1]), [test "x$enable_$1" = "xyes"])dnl
+]dnl
 )# AC_COLLECTD(name, enable/disable, info-text, feature/module)
 
 # AC_PLUGIN(name, default, info)
 # ------------------------------------------------------------
 dnl
 AC_DEFUN(
-  [AC_PLUGIN],
-  [
-    enable_plugin="no"
-    force="no"
-    AC_ARG_ENABLE([$1],
-      [AS_HELP_STRING([--enable-$1],[$3])],
-      [
-        if test "x$enableval" = "xyes"; then
-          enable_plugin="yes"
-        else if test "x$enableval" = "xforce"; then
+[AC_PLUGIN],
+[
+  enable_plugin="no"
+  force="no"
+  AC_ARG_ENABLE([$1],
+    [AS_HELP_STRING([--enable-$1],[$3])],
+    [
+      if test "x$enableval" = "xyes"; then
+        enable_plugin="yes"
+      else if test "x$enableval" = "xforce"; then
+        enable_plugin="yes"
+        force="yes"
+      else
+        enable_plugin="no (disabled on command line)"
+      fi; fi
+    ],
+    [
+      if test "x$enable_all_plugins" = "xauto"; then
+        if test "x$2" = "xyes"; then
           enable_plugin="yes"
-          force="yes"
-        else
-          enable_plugin="no (disabled on command line)"
-        fi; fi
-      ],
-      [
-        if test "x$enable_all_plugins" = "xauto"; then
-          if test "x$2" = "xyes"; then
-            enable_plugin="yes"
-          else
-            enable_plugin="$2"
-          fi
         else
-          enable_plugin="$enable_all_plugins"
-        fi
-      ]
-    )
-    if test "x$enable_plugin" = "xyes"; then
-      if test "x$2" = "xyes" || test "x$force" = "xyes"; then
-        AC_DEFINE([HAVE_PLUGIN_]my_toupper([$1]), 1, [Define to 1 if the $1 plugin is enabled.])
-        if test "x$2" != "xyes"; then
-          dependency_warning="yes"
+          enable_plugin="$2"
         fi
-      else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
-        dependency_error="yes"
-        enable_plugin="$2 (dependency error)"
+      else
+        enable_plugin="$enable_all_plugins"
+      fi
+    ]
+  )
+  if test "x$enable_plugin" = "xyes"; then
+    if test "x$2" = "xyes" || test "x$force" = "xyes"; then
+      AC_DEFINE([HAVE_PLUGIN_]my_toupper([$1]), 1, [Define to 1 if the $1 plugin is enabled.])
+      if test "x$2" != "xyes"; then
+        dependency_warning="yes"
       fi
+    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
+      dependency_error="yes"
+      enable_plugin="$2 (dependency error)"
     fi
-    AM_CONDITIONAL([BUILD_PLUGIN_]my_toupper([$1]), [test "x$enable_plugin" = "xyes"])
-    enable_$1="$enable_plugin"
-  ]
+  fi
+  AM_CONDITIONAL([BUILD_PLUGIN_]my_toupper([$1]), [test "x$enable_plugin" = "xyes"])
+  enable_$1="$enable_plugin"
+]
 )# AC_PLUGIN(name, default, info)
 
 m4_divert_once([HELP_ENABLE], [
@@ -6409,6 +6409,7 @@ plugin_pcie_errors="no"
 plugin_perl="no"
 plugin_pinba="no"
 plugin_processes="no"
+plugin_procevent="no"
 plugin_protocols="no"
 plugin_python="no"
 plugin_serial="no"
@@ -6435,346 +6436,347 @@ plugin_zookeeper="no"
 
 # Linux
 if test "x$ac_system" = "xLinux"; then
-  plugin_battery="yes"
-  plugin_cgroups="yes"
-  plugin_conntrack="yes"
-  plugin_contextswitch="yes"
-  plugin_cpu="yes"
-  plugin_cpufreq="yes"
-  plugin_disk="yes"
-  plugin_drbd="yes"
-  plugin_entropy="yes"
-  plugin_fhcount="yes"
-  plugin_fscache="yes"
-  plugin_hugepages="yes"
-  plugin_interface="yes"
-  plugin_ipc="yes"
-  plugin_irq="yes"
-  plugin_load="yes"
-  plugin_lvm="yes"
-  plugin_mcelog="yes"
-  plugin_memory="yes"
-  plugin_nfs="yes"
-  plugin_numa="yes"
-  plugin_processes="yes"
-  plugin_protocols="yes"
-  plugin_serial="yes"
-  plugin_swap="yes"
-  plugin_synproxy="yes"
-  plugin_tcpconns="yes"
-  plugin_thermal="yes"
-  plugin_uptime="yes"
-  plugin_vmem="yes"
-  plugin_vserver="yes"
-  plugin_wireless="yes"
-  plugin_zfs_arc="yes"
-
-  if test "x$ac_cv_header_linux_ip_vs_h" = "xyes"; then
-    plugin_ipvs="yes"
-  fi
-
-  if test "x$have_cpuid_h" = "xyes"; then
-    plugin_turbostat="yes"
-  fi
-
-  if test "x$c_cv_have_clock_boottime_monotonic" = "xyes"; then
-    plugin_cpusleep="yes"
-  fi
-
-  if test "x$with_libyajl" = "xyes" && test "x$with_libyajl2" = "xyes"; then
-    plugin_ovs_events="yes"
-    plugin_ovs_stats="yes"
-  fi
-
-  if test "x$have_pci_regs_h" = "xyes"; then
-    plugin_pcie_errors="yes"
-  fi
+plugin_battery="yes"
+plugin_cgroups="yes"
+plugin_conntrack="yes"
+plugin_contextswitch="yes"
+plugin_cpu="yes"
+plugin_cpufreq="yes"
+plugin_disk="yes"
+plugin_drbd="yes"
+plugin_entropy="yes"
+plugin_fhcount="yes"
+plugin_fscache="yes"
+plugin_hugepages="yes"
+plugin_interface="yes"
+plugin_ipc="yes"
+plugin_irq="yes"
+plugin_load="yes"
+plugin_lvm="yes"
+plugin_mcelog="yes"
+plugin_memory="yes"
+plugin_nfs="yes"
+plugin_numa="yes"
+plugin_processes="yes"
+plugin_procevent="yes"
+plugin_protocols="yes"
+plugin_serial="yes"
+plugin_swap="yes"
+plugin_synproxy="yes"
+plugin_tcpconns="yes"
+plugin_thermal="yes"
+plugin_uptime="yes"
+plugin_vmem="yes"
+plugin_vserver="yes"
+plugin_wireless="yes"
+plugin_zfs_arc="yes"
+
+if test "x$ac_cv_header_linux_ip_vs_h" = "xyes"; then
+  plugin_ipvs="yes"
+fi
+
+if test "x$have_cpuid_h" = "xyes"; then
+  plugin_turbostat="yes"
+fi
+
+if test "x$c_cv_have_clock_boottime_monotonic" = "xyes"; then
+  plugin_cpusleep="yes"
+fi
+
+if test "x$with_libyajl" = "xyes" && test "x$with_libyajl2" = "xyes"; then
+  plugin_ovs_events="yes"
+  plugin_ovs_stats="yes"
+fi
+
+if test "x$have_pci_regs_h" = "xyes"; then
+  plugin_pcie_errors="yes"
+fi
 fi
 
 if test "x$ac_system" = "xOpenBSD"; then
-  plugin_tcpconns="yes"
+plugin_tcpconns="yes"
 fi
 
 if test "x$ac_system" = "xNetBSD"; then
-  plugin_disk="yes"
-  plugin_entropy="yes"
-  plugin_irq="yes"
-  plugin_processes="yes"
+plugin_disk="yes"
+plugin_entropy="yes"
+plugin_irq="yes"
+plugin_processes="yes"
 fi
 
 # Mac OS X devices
 if test "x$with_libiokit" = "xyes"; then
-  plugin_battery="yes"
-  plugin_disk="yes"
+plugin_battery="yes"
+plugin_disk="yes"
 fi
 
 # AIX
 
 if test "x$ac_system" = "xAIX"; then
-  plugin_ipc="yes"
-  plugin_tcpconns="yes"
+plugin_ipc="yes"
+plugin_tcpconns="yes"
 fi
 
 # FreeBSD
 
 if test "x$ac_system" = "xFreeBSD"; then
-  plugin_cpufreq="yes"
-  plugin_disk="yes"
-  plugin_zfs_arc="yes"
+plugin_cpufreq="yes"
+plugin_disk="yes"
+plugin_zfs_arc="yes"
 fi
 
 
 if test "x$with_perfstat" = "xyes"; then
-  plugin_contextswitch="yes"
-  plugin_cpu="yes"
-  plugin_disk="yes"
-  plugin_interface="yes"
-  plugin_load="yes"
-  plugin_memory="yes"
-  plugin_swap="yes"
-  plugin_uptime="yes"
+plugin_contextswitch="yes"
+plugin_cpu="yes"
+plugin_disk="yes"
+plugin_interface="yes"
+plugin_load="yes"
+plugin_memory="yes"
+plugin_swap="yes"
+plugin_uptime="yes"
 fi
 
 if test "x$with_procinfo" = "xyes"; then
-  plugin_processes="yes"
+plugin_processes="yes"
 fi
 
 # Solaris
 if test "x$with_kstat" = "xyes"; then
-  plugin_nfs="yes"
-  plugin_processes="yes"
-  plugin_uptime="yes"
-  plugin_zfs_arc="yes"
-  plugin_zone="yes"
+plugin_nfs="yes"
+plugin_processes="yes"
+plugin_uptime="yes"
+plugin_zfs_arc="yes"
+plugin_zone="yes"
 fi
 
 if test "x$with_devinfo" = "xyes" && test "x$with_kstat" = "xyes"; then
-  plugin_cpu="yes"
-  plugin_disk="yes"
-  plugin_interface="yes"
-  plugin_memory="yes"
-  plugin_tape="yes"
+plugin_cpu="yes"
+plugin_disk="yes"
+plugin_interface="yes"
+plugin_memory="yes"
+plugin_tape="yes"
 fi
 
 if test "x$with_libi2c" = "xyes"; then
-  plugin_barometer="yes"
+plugin_barometer="yes"
 fi
 
 
 # libstatgrab
 if test "x$with_libstatgrab" = "xyes"; then
-  plugin_cpu="yes"
-  plugin_disk="yes"
-  plugin_interface="yes"
-  plugin_load="yes"
-  plugin_memory="yes"
-  plugin_swap="yes"
-  plugin_users="yes"
+plugin_cpu="yes"
+plugin_disk="yes"
+plugin_interface="yes"
+plugin_load="yes"
+plugin_memory="yes"
+plugin_swap="yes"
+plugin_users="yes"
 fi
 
 if test "x$with_libcurl" = "xyes" && test "x$with_libxml2" = "xyes"; then
-  plugin_ascent="yes"
-  if test "x$have_strptime" = "xyes"; then
-    plugin_bind="yes"
-  fi
+plugin_ascent="yes"
+if test "x$have_strptime" = "xyes"; then
+  plugin_bind="yes"
+fi
 fi
 
 if test "x$with_libopenipmipthread" = "xyes"; then
-  plugin_ipmi="yes"
+plugin_ipmi="yes"
 fi
 
 if test "x$with_libcurl" = "xyes" && test "x$with_libyajl" = "xyes"; then
-  plugin_curl_json="yes"
+plugin_curl_json="yes"
 fi
 
 if test "x$with_libcurl" = "xyes" && test "x$with_libssl" = "xyes" && test "x$with_libyajl" = "xyes" && test "x$with_libyajl2" = "xyes"; then
-  plugin_write_stackdriver="yes"
+plugin_write_stackdriver="yes"
 fi
 
 if test "x$with_libcurl" = "xyes" && test "x$with_libxml2" = "xyes"; then
-  plugin_curl_xml="yes"
+plugin_curl_xml="yes"
 fi
 
 if test "x$with_libyajl" = "xyes"; then
-  plugin_ceph="yes"
+plugin_ceph="yes"
 fi
 
 if test "x$have_processor_info" = "xyes"; then
-  plugin_cpu="yes"
+plugin_cpu="yes"
 fi
 
 if test "x$have_sysctl" = "xyes"; then
-  plugin_cpu="yes"
-  plugin_memory="yes"
-  plugin_uptime="yes"
-  if test "x$ac_system" = "xDarwin"; then
-    plugin_swap="yes"
-  fi
+plugin_cpu="yes"
+plugin_memory="yes"
+plugin_uptime="yes"
+if test "x$ac_system" = "xDarwin"; then
+  plugin_swap="yes"
+fi
 fi
 
 if test "x$have_sysctlbyname" = "xyes"; then
-  plugin_contextswitch="yes"
-  plugin_cpu="yes"
-  plugin_memory="yes"
-  plugin_tcpconns="yes"
+plugin_contextswitch="yes"
+plugin_cpu="yes"
+plugin_memory="yes"
+plugin_tcpconns="yes"
 fi
 
 if test "x$have_getvfsstat" = "xyes" || test "x$have_getfsstat" = "xyes"; then
-  plugin_df="yes"
+plugin_df="yes"
 fi
 
 if test "x$c_cv_have_two_getmntent" = "xyes" || test "x$have_getmntent" = "xgen" || test "x$have_getmntent" = "xsun"; then
-  plugin_df="yes"
+plugin_df="yes"
 fi
 
 if test "x$c_cv_have_one_getmntent" = "xyes"; then
-  plugin_df="yes"
+plugin_df="yes"
 fi
 
 if test "x$have_getmntent_r" = "xyes"; then
-  plugin_df="yes"
+plugin_df="yes"
 fi
 
 if test "x$plugin_df" = "xyes"; then
-  plugin_df="no"
-  if test "x$have_statfs" = "xyes"; then
-    plugin_df="yes"
-  fi
+plugin_df="no"
+if test "x$have_statfs" = "xyes"; then
+  plugin_df="yes"
+fi
 
-  if test "x$have_statvfs" = "xyes"; then
-    plugin_df="yes"
-  fi
+if test "x$have_statvfs" = "xyes"; then
+  plugin_df="yes"
+fi
 fi
 
 if test "x$have_linux_sockios_h" = "xyes" && test "x$have_linux_ethtool_h" = "xyes"; then
-  plugin_ethstat="yes"
+plugin_ethstat="yes"
 fi
 
 if test "x$with_libgps" = "xyes"; then
-  plugin_gps="yes"
+plugin_gps="yes"
 fi
 
 plugin_grpc="yes"
 if test "x$GRPC_CPP_PLUGIN" = "x"; then
-  plugin_grpc="no (grpc_cpp_plugin not found)"
+plugin_grpc="no (grpc_cpp_plugin not found)"
 fi
 if test "x$have_protoc3" != "xyes"; then
-  plugin_grpc="no (protoc3 not found)"
+plugin_grpc="no (protoc3 not found)"
 fi
 if test "x$with_libprotobuf" != "xyes"; then
-  plugin_grpc="no (libprotobuf not found)"
+plugin_grpc="no (libprotobuf not found)"
 fi
 if test "x$with_libgrpcpp" != "xyes"; then
-  plugin_grpc="no (libgrpc++ not found)"
+plugin_grpc="no (libgrpc++ not found)"
 fi
 
 if test "x$have_getifaddrs" = "xyes"; then
-  plugin_interface="yes"
+plugin_interface="yes"
 fi
 
 if test "x$have_getloadavg" = "xyes"; then
-  plugin_load="yes"
+plugin_load="yes"
 fi
 
 if test "x$with_libyajl" = "xyes"; then
-  plugin_log_logstash="yes"
+plugin_log_logstash="yes"
 fi
 
 if test "x$with_libperl" = "xyes" && test "x$c_cv_have_perl_ithreads" = "xyes"; then
-  plugin_perl="yes"
+plugin_perl="yes"
 fi
 
 if test "x$have_protoc_c" = "xyes" && test "x$with_libprotobuf_c" = "xyes"; then
-  plugin_pinba="yes"
-  if test "x$with_libmicrohttpd" = "xyes"; then
-    plugin_write_prometheus="yes"
-  fi
+plugin_pinba="yes"
+if test "x$with_libmicrohttpd" = "xyes"; then
+  plugin_write_prometheus="yes"
+fi
 fi
 
 # Mac OS X memory interface
 if test "x$have_host_statistics" = "xyes"; then
-  plugin_memory="yes"
+plugin_memory="yes"
 fi
 
 if test "x$have_termios_h" = "xyes"; then
-  if test "x$ac_system" != "xAIX"; then
-    plugin_multimeter="yes"
-  fi
-  plugin_ted="yes"
+if test "x$ac_system" != "xAIX"; then
+  plugin_multimeter="yes"
+fi
+plugin_ted="yes"
 fi
 
 if test "x$have_thread_info" = "xyes"; then
-  plugin_processes="yes"
+plugin_processes="yes"
 fi
 
 if test "x$with_kvm_getprocs" = "xyes" && test "x$have_struct_kinfo_proc_freebsd" = "xyes"; then
-  plugin_processes="yes"
+plugin_processes="yes"
 fi
 
 if test "x$with_kvm_getprocs" = "xyes" && test "x$have_struct_kinfo_proc_openbsd" = "xyes"; then
-  plugin_processes="yes"
+plugin_processes="yes"
 fi
 
 if test "x$with_libpython" != "xno"; then
-  plugin_python="yes"
+plugin_python="yes"
 fi
 
 if test "x$with_libatasmart" = "xyes" && test "x$with_libudev" = "xyes"; then
-  plugin_smart="yes"
+plugin_smart="yes"
 fi
 
 if test "x$with_kvm_getswapinfo" = "xyes"; then
-  plugin_swap="yes"
+plugin_swap="yes"
 fi
 
 if test "x$have_swapctl" = "xyes" && test "x$c_cv_have_swapctl_two_args" = "xyes"; then
-  plugin_swap="yes"
+plugin_swap="yes"
 fi
 
 if test "x$have_swapctl" = "xyes" && test "x$c_cv_have_swapctl_three_args" = "xyes"; then
-  plugin_swap="yes"
+plugin_swap="yes"
 fi
 
 if test "x$with_kvm_openfiles = "xyes" && $with_kvm_nlist" = "xyes"; then
-  plugin_tcpconns="yes"
+plugin_tcpconns="yes"
 fi
 
 if test "x$have_getutent" = "xyes"; then
-  plugin_users="yes"
+plugin_users="yes"
 fi
 
 if test "x$have_getutxent" = "xyes"; then
-  plugin_users="yes"
+plugin_users="yes"
 fi
 
 if test "x$with_libxml2" = "xyes" && test "x$with_libvirt" = "xyes"; then
-  plugin_virt="yes"
+plugin_virt="yes"
 fi
 
 if test "x$with_libxenctrl" = "xyes"; then
-  plugin_xencpu="yes"
+plugin_xencpu="yes"
 fi
 
 if test "x$with_libdpdk" = "xyes"; then
-  plugin_dpdkevents="$dpdk_keepalive"
-  plugin_dpdkstat="yes"
+plugin_dpdkevents="$dpdk_keepalive"
+plugin_dpdkstat="yes"
 fi
 
 m4_divert_once([HELP_ENABLE], [
 collectd plugins:])
 
 AC_ARG_ENABLE([all-plugins],
-  [AS_HELP_STRING([--enable-all-plugins], [enable all plugins @<:@default=yes@:>@])],
-  [
-     if test "x$enableval" = "xyes"; then
-       enable_all_plugins="yes"
-     else if test "x$enableval" = "xauto"; then
-       enable_all_plugins="auto"
-     else
-       enable_all_plugins="no"
-     fi; fi
-  ],
-  [enable_all_plugins="auto"]
+[AS_HELP_STRING([--enable-all-plugins], [enable all plugins @<:@default=yes@:>@])],
+[
+    if test "x$enableval" = "xyes"; then
+      enable_all_plugins="yes"
+    else if test "x$enableval" = "xauto"; then
+      enable_all_plugins="auto"
+    else
+      enable_all_plugins="no"
+    fi; fi
+],
+[enable_all_plugins="auto"]
 )
 
 m4_divert_once([HELP_ENABLE], [])
@@ -6881,6 +6883,7 @@ AC_PLUGIN([ping],                [$with_liboping],            [Network latency s
 AC_PLUGIN([postgresql],          [$with_libpq],               [PostgreSQL database statistics])
 AC_PLUGIN([powerdns],            [yes],                       [PowerDNS statistics])
 AC_PLUGIN([processes],           [$plugin_processes],         [Process statistics])
+AC_PLUGIN([procevent],           [$plugin_procevent],       [Process event (start, stop) statistics])
 AC_PLUGIN([protocols],           [$plugin_protocols],         [Protocol (IP, TCP, ...) statistics])
 AC_PLUGIN([python],              [$plugin_python],            [Embed a Python interpreter])
 AC_PLUGIN([redis],               [$with_libhiredis],          [Redis plugin])
@@ -7307,6 +7310,7 @@ AC_MSG_RESULT([    ping  . . . . . . . . $enable_ping])
 AC_MSG_RESULT([    postgresql  . . . . . $enable_postgresql])
 AC_MSG_RESULT([    powerdns  . . . . . . $enable_powerdns])
 AC_MSG_RESULT([    processes . . . . . . $enable_processes])
+AC_MSG_RESULT([    procevent . . . . . . $enable_procevent])
 AC_MSG_RESULT([    protocols . . . . . . $enable_protocols])
 AC_MSG_RESULT([    python  . . . . . . . $enable_python])
 AC_MSG_RESULT([    redis . . . . . . . . $enable_redis])
diff --git a/src/collectd.conf.in b/src/collectd.conf.in
index f09f373d..5f6ff0cb 100644
--- a/src/collectd.conf.in
+++ b/src/collectd.conf.in
@@ -180,6 +180,7 @@
 #@BUILD_PLUGIN_POSTGRESQL_TRUE@LoadPlugin postgresql
 #@BUILD_PLUGIN_POWERDNS_TRUE@LoadPlugin powerdns
 #@BUILD_PLUGIN_PROCESSES_TRUE@LoadPlugin processes
+#@BUILD_PLUGIN_PROCEVENT_TRUE@LoadPlugin procevent
 #@BUILD_PLUGIN_PROTOCOLS_TRUE@LoadPlugin protocols
 #@BUILD_PLUGIN_PYTHON_TRUE@LoadPlugin python
 #@BUILD_PLUGIN_REDIS_TRUE@LoadPlugin redis
diff --git a/src/collectd.conf.pod b/src/collectd.conf.pod
index ed49195e..0922b216 100644
--- a/src/collectd.conf.pod
+++ b/src/collectd.conf.pod
@@ -7314,6 +7314,40 @@ reporting the corresponding processes only. Outside of B<Process> and
 B<ProcessMatch> blocks these options set the default value for subsequent
 matches.
 
+=head2 Plugin C<procevent>
+ 
+The I<procevent> plugin monitors when processes start (EXEC) and stop (EXIT).
+ 
+B<Synopsis:>
+ 
+  <Plugin procevent>
+    BufferLength 10
+    Process "name"
+    RegexProcess "regex"
+  </Plugin>
+ 
+B<Options:>
+ 
+=over 4
+ 
+=item B<BufferLength> I<length>
+ 
+Maximum number of process events that can be stored in plugin's ring buffer.
+By default, this is set to 10.  Once an event has been read, its location
+becomes available for storing a new event.
+ 
+=item B<Process> I<name>
+ 
+Enumerate a process name to monitor.  All processes that match this exact
+name will be monitored for EXECs and EXITs.
+
+=item B<RegexProcess> I<regex>
+ 
+Enumerate a process pattern to monitor.  All processes that match this 
+regular expression will be monitored for EXECs and EXITs.
+ 
+=back
+
 =head2 Plugin C<protocols>
 
 Collects a lot of information about various network protocols, such as I<IP>,
diff --git a/src/procevent.c b/src/procevent.c
new file mode 100644
index 00000000..e4f473be
--- /dev/null
+++ b/src/procevent.c
@@ -0,0 +1,899 @@
+/**
+ * collectd - src/procevent.c
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a
+ * copy of this software and associated documentation files (the "Software"),
+ * to deal in the Software without restriction, including without limitation
+ * the rights to use, copy, modify, merge, publish, distribute, sublicense,
+ * and/or sell copies of the Software, and to permit persons to whom the
+ * Software is furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
+ * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
+ * DEALINGS IN THE SOFTWARE.
+ *
+ * Authors:
+ *   Red Hat NFVPE
+ *     Andrew Bays <abays at redhat.com>
+ **/
+
+#include "collectd.h"
+
+#include "common.h"
+#include "plugin.h"
+#include "utils_complain.h"
+
+#include <errno.h>
+#include <pthread.h>
+#include <regex.h>
+#include <stdio.h>
+#include <string.h>
+#include <sys/socket.h>
+#include <unistd.h>
+
+#include <dirent.h>
+#include <linux/cn_proc.h>
+#include <linux/connector.h>
+#include <linux/netlink.h>
+#include <linux/rtnetlink.h>
+#include <signal.h>
+#include <stdbool.h>
+#include <stdlib.h>
+#include <string.h>
+
+#define PROCEVENT_EXITED 0
+#define PROCEVENT_STARTED 1
+#define PROCEVENT_FIELDS 3 // pid, status, extra
+#define BUFSIZE 512
+#define PROCDIR "/proc"
+#define PROCEVENT_REGEX_MATCHES 1
+
+/*
+ * Private data types
+ */
+
+typedef struct {
+  int head;
+  int tail;
+  int maxLen;
+  int **buffer;
+} circbuf_t;
+
+struct processlist_s {
+  char *process;
+  char *process_regex;
+
+  regex_t process_regex_obj;
+
+  uint32_t is_regex;
+  uint32_t pid;
+
+  struct processlist_s *next;
+};
+typedef struct processlist_s processlist_t;
+
+/*
+ * Private variables
+ */
+
+static int procevent_thread_loop = 0;
+static int procevent_thread_error = 0;
+static pthread_t procevent_thread_id;
+static pthread_mutex_t procevent_lock = PTHREAD_MUTEX_INITIALIZER;
+static pthread_cond_t procevent_cond = PTHREAD_COND_INITIALIZER;
+static pthread_mutex_t procevent_list_lock = PTHREAD_MUTEX_INITIALIZER;
+static int nl_sock = -1;
+static int buffer_length;
+static circbuf_t ring;
+static processlist_t *processlist_head = NULL;
+
+static const char *config_keys[] = {"BufferLength", "Process", "RegexProcess"};
+static int config_keys_num = STATIC_ARRAY_SIZE(config_keys);
+
+/*
+ * Private functions
+ */
+
+// Does /proc/<pid>/comm contain a process name we are interested in?
+static processlist_t *process_check(int pid) {
+  int len, is_match, status;
+  char file[BUFSIZE];
+  FILE *fh;
+  char buffer[BUFSIZE];
+  regmatch_t matches[PROCEVENT_REGEX_MATCHES];
+
+  len = snprintf(file, sizeof(file), PROCDIR "/%d/comm", pid);
+
+  if ((len < 0) || (len >= BUFSIZE)) {
+    WARNING("procevent process_check: process name too large");
+    return NULL;
+  }
+
+  if (NULL == (fh = fopen(file, "r"))) {
+    // No /proc/<pid>/comm for this pid, just ignore
+    DEBUG("procevent plugin: no comm file available for pid %d", pid);
+    return NULL;
+  }
+
+  fscanf(fh, "%[^\n]", buffer);
+
+  //
+  // Go through the processlist linked list and look for the process name
+  // in /proc/<pid>/comm.  If found:
+  // 1. If pl->pid is -1, then set pl->pid to <pid>
+  // 2. If pl->pid is not -1, then another <process name> process was already
+  //    found.  If <pid> == pl->pid, this is an old match, so do nothing.
+  //    If the <pid> is different, however,  make a new processlist_t and
+  //    associate <pid> with it (with the same process name as the existing).
+  //
+
+  pthread_mutex_lock(&procevent_list_lock);
+
+  processlist_t *pl;
+  processlist_t *match = NULL;
+
+  for (pl = processlist_head; pl != NULL; pl = pl->next) {
+    if (pl->is_regex != 0) {
+      is_match = (regexec(&pl->process_regex_obj, buffer,
+                          PROCEVENT_REGEX_MATCHES, matches, 0) == 0
+                      ? 1
+                      : 0);
+    } else {
+      is_match = (strcmp(buffer, pl->process) == 0 ? 1 : 0);
+    }
+
+    if (is_match == 1) {
+      DEBUG("procevent plugin: process %d name match (pattern: %s) for %s", pid,
+            (pl->is_regex == 0 ? pl->process : pl->process_regex), buffer);
+
+      if (pl->is_regex == 1) {
+        // If this is a regex name, copy the actual process name into the object
+        // for cleaner log reporting
+
+        if (pl->process != NULL)
+          sfree(pl->process);
+        pl->process = strdup(buffer);
+        if (pl->process == NULL) {
+          char errbuf[1024];
+          ERROR("procevent plugin: strdup failed during process_check: %s",
+                sstrerror(errno, errbuf, sizeof(errbuf)));
+          pthread_mutex_unlock(&procevent_list_lock);
+          return NULL;
+        }
+      }
+
+      if (pl->pid == pid) {
+        // this is a match, and we've already stored the exact pid/name combo
+        match = pl;
+        break;
+      } else if (pl->pid == -1) {
+        // this is a match, and we've found a candidate processlist_t to store
+        // this new pid/name combo
+        pl->pid = pid;
+        match = pl;
+        break;
+      } else if (pl->pid != -1) {
+        // this is a match, but another instance of this process has already
+        // claimed this pid/name combo,
+        // so keep looking
+        match = pl;
+        continue;
+      }
+    }
+  }
+
+  if (match != NULL && match->pid != -1 && match->pid != pid) {
+    // if there was a match but the associated processlist_t object already
+    // contained a pid/name combo,
+    // then make a new one and add it to the linked list
+
+    DEBUG(
+        "procevent plugin: allocating new processlist_t object for PID %d (%s)",
+        pid, match->process);
+
+    processlist_t *pl2;
+    char *process;
+    char *process_regex;
+
+    pl2 = malloc(sizeof(*pl2));
+    if (pl2 == NULL) {
+      char errbuf[1024];
+      ERROR("procevent plugin: malloc failed during process_check: %s",
+            sstrerror(errno, errbuf, sizeof(errbuf)));
+      pthread_mutex_unlock(&procevent_list_lock);
+      return NULL;
+    }
+
+    process = strdup(match->process);
+    if (process == NULL) {
+      char errbuf[1024];
+      sfree(pl2);
+      ERROR("procevent plugin: strdup failed during process_check: %s",
+            sstrerror(errno, errbuf, sizeof(errbuf)));
+      pthread_mutex_unlock(&procevent_list_lock);
+      return NULL;
+    }
+
+    if (match->is_regex == 1) {
+      pl2->is_regex = 1;
+      status =
+          regcomp(&pl2->process_regex_obj, match->process_regex, REG_EXTENDED);
+
+      if (status != 0) {
+        ERROR("procevent plugin: invalid regular expression: %s",
+              match->process_regex);
+        return NULL;
+      }
+
+      process_regex = strdup(match->process_regex);
+      if (process_regex == NULL) {
+        char errbuf[1024];
+        sfree(pl);
+        ERROR("procevent plugin: strdup failed during process_check: %s",
+              sstrerror(errno, errbuf, sizeof(errbuf)));
+        return NULL;
+      }
+
+      pl2->process_regex = process_regex;
+    }
+
+    pl2->process = process;
+    pl2->pid = pid;
+    pl2->next = processlist_head;
+    processlist_head = pl2;
+
+    match = pl2;
+  }
+
+  pthread_mutex_unlock(&procevent_list_lock);
+
+  if (fh != NULL) {
+    fclose(fh);
+    fh = NULL;
+  }
+
+  return match;
+}
+
+// Does our map have this PID or name?
+static processlist_t *process_map_check(int pid, char *process) {
+  processlist_t *pl;
+
+  pthread_mutex_lock(&procevent_list_lock);
+
+  for (pl = processlist_head; pl != NULL; pl = pl->next) {
+    int match_pid = 0;
+    int match_process = 0;
+    int match = 0;
+
+    if (pid > 0) {
+      if (pl->pid == pid)
+        match_pid = 1;
+    }
+
+    if (process != NULL) {
+      if (strcmp(pl->process, process) == 0)
+        match_process = 1;
+    }
+
+    if (pid > 0 && process == NULL && match_pid == 1)
+      match = 1;
+    else if (pid < 0 && process != NULL && match_process == 1)
+      match = 1;
+    else if (pid > 0 && process != NULL && match_pid == 1 && match_process == 1)
+      match = 1;
+
+    if (match == 1) {
+      pthread_mutex_unlock(&procevent_list_lock);
+      return pl;
+    }
+  }
+
+  pthread_mutex_unlock(&procevent_list_lock);
+
+  return NULL;
+}
+
+static int process_map_refresh(void) {
+  DIR *proc;
+
+  errno = 0;
+  proc = opendir(PROCDIR);
+  if (proc == NULL) {
+    char errbuf[1024];
+    ERROR("procevent plugin: fopen (%s): %s", PROCDIR,
+          sstrerror(errno, errbuf, sizeof(errbuf)));
+    return -1;
+  }
+
+  while (42) {
+    struct dirent *dent;
+    int len;
+    char file[BUFSIZE];
+
+    struct stat statbuf;
+
+    int status;
+
+    errno = 0;
+    dent = readdir(proc);
+    if (dent == NULL) {
+      char errbuf[4096];
+
+      if (errno == 0) /* end of directory */
+        break;
+
+      ERROR("procevent plugin: failed to read directory %s: %s", PROCDIR,
+            sstrerror(errno, errbuf, sizeof(errbuf)));
+      closedir(proc);
+      return -1;
+    }
+
+    if (dent->d_name[0] == '.')
+      continue;
+
+    len = snprintf(file, sizeof(file), PROCDIR "/%s", dent->d_name);
+    if ((len < 0) || (len >= BUFSIZE))
+      continue;
+
+    status = stat(file, &statbuf);
+    if (status != 0) {
+      char errbuf[4096];
+      WARNING("procevent plugin: stat (%s) failed: %s", file,
+              sstrerror(errno, errbuf, sizeof(errbuf)));
+      continue;
+    }
+
+    if (!S_ISDIR(statbuf.st_mode))
+      continue;
+
+    len = snprintf(file, sizeof(file), PROCDIR "/%s/comm", dent->d_name);
+    if ((len < 0) || (len >= BUFSIZE))
+      continue;
+
+    int not_number = 0;
+
+    for (int i = 0; i < strlen(dent->d_name); i++) {
+      if (!isdigit(dent->d_name[i])) {
+        not_number = 1;
+        break;
+      }
+    }
+
+    if (not_number != 0)
+      continue;
+
+    // Check if we need to store this pid/name combo in our processlist_t linked
+    // list
+    int this_pid = atoi(dent->d_name);
+    processlist_t *pl = process_check(this_pid);
+
+    if (pl != NULL)
+      DEBUG("procevent plugin: process map refreshed for PID %d and name %s",
+            this_pid, pl->process);
+  }
+
+  closedir(proc);
+
+  return 0;
+}
+
+static int nl_connect() {
+  int rc;
+  struct sockaddr_nl sa_nl;
+
+  nl_sock = socket(PF_NETLINK, SOCK_DGRAM, NETLINK_CONNECTOR);
+  if (nl_sock == -1) {
+    ERROR("procevent plugin: socket open failed.");
+    return -1;
+  }
+
+  sa_nl.nl_family = AF_NETLINK;
+  sa_nl.nl_groups = CN_IDX_PROC;
+  sa_nl.nl_pid = getpid();
+
+  rc = bind(nl_sock, (struct sockaddr *)&sa_nl, sizeof(sa_nl));
+  if (rc == -1) {
+    ERROR("procevent plugin: socket bind failed.");
+    close(nl_sock);
+    return -1;
+  }
+
+  return 0;
+}
+
+static int set_proc_ev_listen(bool enable) {
+  int rc;
+  struct __attribute__((aligned(NLMSG_ALIGNTO))) {
+    struct nlmsghdr nl_hdr;
+    struct __attribute__((__packed__)) {
+      struct cn_msg cn_msg;
+      enum proc_cn_mcast_op cn_mcast;
+    };
+  } nlcn_msg;
+
+  memset(&nlcn_msg, 0, sizeof(nlcn_msg));
+  nlcn_msg.nl_hdr.nlmsg_len = sizeof(nlcn_msg);
+  nlcn_msg.nl_hdr.nlmsg_pid = getpid();
+  nlcn_msg.nl_hdr.nlmsg_type = NLMSG_DONE;
+
+  nlcn_msg.cn_msg.id.idx = CN_IDX_PROC;
+  nlcn_msg.cn_msg.id.val = CN_VAL_PROC;
+  nlcn_msg.cn_msg.len = sizeof(enum proc_cn_mcast_op);
+
+  nlcn_msg.cn_mcast = enable ? PROC_CN_MCAST_LISTEN : PROC_CN_MCAST_IGNORE;
+
+  rc = send(nl_sock, &nlcn_msg, sizeof(nlcn_msg), 0);
+  if (rc == -1) {
+    ERROR("procevent plugin: subscribing to netlink process events failed.");
+    return -1;
+  }
+
+  return 0;
+}
+
+static int read_event() {
+  int status;
+  int ret = 0;
+  int proc_id = -1;
+  int proc_status = -1;
+  int proc_extra = -1;
+  struct __attribute__((aligned(NLMSG_ALIGNTO))) {
+    struct nlmsghdr nl_hdr;
+    struct __attribute__((__packed__)) {
+      struct cn_msg cn_msg;
+      struct proc_event proc_ev;
+    };
+  } nlcn_msg;
+
+  if (nl_sock == -1)
+    return ret;
+
+  status = recv(nl_sock, &nlcn_msg, sizeof(nlcn_msg), 0);
+
+  if (status == 0) {
+    return 0;
+  } else if (status == -1) {
+    if (errno != EINTR) {
+      ERROR("procevent plugin: socket receive error: %d", errno);
+      return -1;
+    }
+  }
+
+  switch (nlcn_msg.proc_ev.what) {
+  case PROC_EVENT_NONE:
+    // printf("set mcast listen ok\n");
+    break;
+  case PROC_EVENT_FORK:
+    // printf("fork: parent tid=%d pid=%d -> child tid=%d pid=%d\n",
+    //         nlcn_msg.proc_ev.event_data.fork.parent_pid,
+    //         nlcn_msg.proc_ev.event_data.fork.parent_tgid,
+    //         nlcn_msg.proc_ev.event_data.fork.child_pid,
+    //         nlcn_msg.proc_ev.event_data.fork.child_tgid);
+    // proc_status = PROCEVENT_STARTED;
+    // proc_id = nlcn_msg.proc_ev.event_data.fork.child_pid;
+    break;
+  case PROC_EVENT_EXEC:
+    // printf("exec: tid=%d pid=%d\n",
+    //         nlcn_msg.proc_ev.event_data.exec.process_pid,
+    //         nlcn_msg.proc_ev.event_data.exec.process_tgid);
+    proc_status = PROCEVENT_STARTED;
+    proc_id = nlcn_msg.proc_ev.event_data.exec.process_pid;
+    break;
+  case PROC_EVENT_UID:
+    // printf("uid change: tid=%d pid=%d from %d to %d\n",
+    //         nlcn_msg.proc_ev.event_data.id.process_pid,
+    //         nlcn_msg.proc_ev.event_data.id.process_tgid,
+    //         nlcn_msg.proc_ev.event_data.id.r.ruid,
+    //         nlcn_msg.proc_ev.event_data.id.e.euid);
+    break;
+  case PROC_EVENT_GID:
+    // printf("gid change: tid=%d pid=%d from %d to %d\n",
+    //         nlcn_msg.proc_ev.event_data.id.process_pid,
+    //         nlcn_msg.proc_ev.event_data.id.process_tgid,
+    //         nlcn_msg.proc_ev.event_data.id.r.rgid,
+    //         nlcn_msg.proc_ev.event_data.id.e.egid);
+    break;
+  case PROC_EVENT_EXIT:
+    proc_id = nlcn_msg.proc_ev.event_data.exit.process_pid;
+    proc_status = PROCEVENT_EXITED;
+    proc_extra = nlcn_msg.proc_ev.event_data.exit.exit_code;
+    break;
+  default:
+    break;
+  }
+
+  // If we're interested in this process status event, place the event
+  // in the ring buffer for consumption by the main polling thread.
+
+  if (proc_status != -1) {
+    pthread_mutex_unlock(&procevent_lock);
+
+    int next = ring.head + 1;
+    if (next >= ring.maxLen)
+      next = 0;
+
+    if (next == ring.tail) {
+      WARNING("procevent plugin: ring buffer full");
+    } else {
+      DEBUG("procevent plugin: Process %d status is now %s", proc_id,
+            (proc_status == PROCEVENT_EXITED ? "EXITED" : "STARTED"));
+
+      if (proc_status == PROCEVENT_EXITED) {
+        ring.buffer[ring.head][0] = proc_id;
+        ring.buffer[ring.head][1] = proc_status;
+        ring.buffer[ring.head][2] = proc_extra;
+      } else {
+        ring.buffer[ring.head][0] = proc_id;
+        ring.buffer[ring.head][1] = proc_status;
+        ring.buffer[ring.head][2] = 0;
+      }
+
+      ring.head = next;
+    }
+
+    pthread_mutex_unlock(&procevent_lock);
+  }
+
+  return ret;
+}
+
+static void *procevent_thread(void *arg) /* {{{ */
+{
+  pthread_mutex_lock(&procevent_lock);
+
+  while (procevent_thread_loop > 0) {
+    int status;
+
+    pthread_mutex_unlock(&procevent_lock);
+
+    usleep(1000);
+
+    status = read_event();
+
+    pthread_mutex_lock(&procevent_lock);
+
+    if (status < 0) {
+      procevent_thread_error = 1;
+      break;
+    }
+
+    if (procevent_thread_loop <= 0)
+      break;
+  } /* while (procevent_thread_loop > 0) */
+
+  pthread_mutex_unlock(&procevent_lock);
+
+  return ((void *)0);
+} /* }}} void *procevent_thread */
+
+static int start_thread(void) /* {{{ */
+{
+  int status;
+
+  pthread_mutex_lock(&procevent_lock);
+
+  if (procevent_thread_loop != 0) {
+    pthread_mutex_unlock(&procevent_lock);
+    return (0);
+  }
+
+  if (nl_sock == -1) {
+    status = nl_connect();
+
+    if (status != 0)
+      return status;
+
+    status = set_proc_ev_listen(true);
+    if (status == -1)
+      return status;
+  }
+
+  DEBUG("procevent plugin: socket created and bound");
+
+  procevent_thread_loop = 1;
+  procevent_thread_error = 0;
+
+  status = plugin_thread_create(&procevent_thread_id, /* attr = */ NULL,
+                                procevent_thread,
+                                /* arg = */ (void *)0, "procevent");
+  if (status != 0) {
+    procevent_thread_loop = 0;
+    ERROR("procevent plugin: Starting thread failed.");
+    pthread_mutex_unlock(&procevent_lock);
+    return (-1);
+  }
+
+  pthread_mutex_unlock(&procevent_lock);
+  return (0);
+} /* }}} int start_thread */
+
+static int stop_thread(int shutdown) /* {{{ */
+{
+  int status;
+
+  if (nl_sock != -1) {
+    status = close(nl_sock);
+    if (status != 0) {
+      ERROR("procevent plugin: failed to close socket %d: %d (%s)", nl_sock,
+            status, strerror(errno));
+      return (-1);
+    } else
+      nl_sock = -1;
+  }
+
+  pthread_mutex_lock(&procevent_lock);
+
+  if (procevent_thread_loop == 0) {
+    pthread_mutex_unlock(&procevent_lock);
+    return (-1);
+  }
+
+  procevent_thread_loop = 0;
+  pthread_cond_broadcast(&procevent_cond);
+  pthread_mutex_unlock(&procevent_lock);
+
+  if (shutdown == 1) {
+    // Calling pthread_cancel here in
+    // the case of a shutdown just assures that the thread is
+    // gone and that the process has been fully terminated.
+
+    DEBUG("procevent plugin: Canceling thread for process shutdown");
+
+    status = pthread_cancel(procevent_thread_id);
+
+    if (status != 0) {
+      ERROR("procevent plugin: Unable to cancel thread: %d", status);
+      status = -1;
+    }
+  } else {
+    status = pthread_join(procevent_thread_id, /* return = */ NULL);
+    if (status != 0) {
+      ERROR("procevent plugin: Stopping thread failed.");
+      status = -1;
+    }
+  }
+
+  pthread_mutex_lock(&procevent_lock);
+  memset(&procevent_thread_id, 0, sizeof(procevent_thread_id));
+  procevent_thread_error = 0;
+  pthread_mutex_unlock(&procevent_lock);
+
+  DEBUG("procevent plugin: Finished requesting stop of thread");
+
+  return (status);
+} /* }}} int stop_thread */
+
+static int procevent_init(void) /* {{{ */
+{
+  int status;
+
+  if (processlist_head == NULL) {
+    NOTICE("procevent plugin: No processes have been configured.");
+    return (-1);
+  }
+
+  ring.head = 0;
+  ring.tail = 0;
+  ring.maxLen = buffer_length;
+  ring.buffer = (int **)malloc(buffer_length * sizeof(int *));
+
+  for (int i = 0; i < buffer_length; i++) {
+    ring.buffer[i] = (int *)malloc(PROCEVENT_FIELDS * sizeof(int));
+  }
+
+  status = process_map_refresh();
+
+  if (status == -1) {
+    ERROR("procevent plugin: Initial process mapping failed.");
+    return (-1);
+  }
+
+  return (start_thread());
+} /* }}} int procevent_init */
+
+static int procevent_config(const char *key, const char *value) /* {{{ */
+{
+  int status;
+
+  if (strcasecmp(key, "BufferLength") == 0) {
+    buffer_length = atoi(value);
+  } else if (strcasecmp(key, "Process") == 0 ||
+             strcasecmp(key, "RegexProcess") == 0) {
+
+    processlist_t *pl;
+    char *process;
+    char *process_regex;
+
+    pl = malloc(sizeof(*pl));
+    if (pl == NULL) {
+      char errbuf[1024];
+      ERROR("procevent plugin: malloc failed during procevent_config: %s",
+            sstrerror(errno, errbuf, sizeof(errbuf)));
+      return (1);
+    }
+
+    process = strdup(value);
+    if (process == NULL) {
+      char errbuf[1024];
+      sfree(pl);
+      ERROR("procevent plugin: strdup failed during procevent_config: %s",
+            sstrerror(errno, errbuf, sizeof(errbuf)));
+      return (1);
+    }
+
+    if (strcasecmp(key, "RegexProcess") == 0) {
+      pl->is_regex = 1;
+      status = regcomp(&pl->process_regex_obj, value, REG_EXTENDED);
+
+      if (status != 0) {
+        ERROR("procevent plugin: invalid regular expression: %s", value);
+        return (1);
+      }
+
+      process_regex = strdup(value);
+      if (process_regex == NULL) {
+        char errbuf[1024];
+        sfree(pl);
+        ERROR("procevent plugin: strdup failed during procevent_config: %s",
+              sstrerror(errno, errbuf, sizeof(errbuf)));
+        return (1);
+      }
+
+      pl->process_regex = process_regex;
+    } else {
+      pl->is_regex = 0;
+    }
+
+    pl->process = process;
+    pl->pid = -1;
+    pl->next = processlist_head;
+    processlist_head = pl;
+  } else {
+    return (-1);
+  }
+
+  return (0);
+} /* }}} int procevent_config */
+
+static void submit(int pid, const char *type, /* {{{ */
+                   gauge_t value, const char *process) {
+  value_list_t vl = VALUE_LIST_INIT;
+  char hostname[1024];
+
+  vl.values = &(value_t){.gauge = value};
+  vl.values_len = 1;
+  sstrncpy(vl.plugin, "procevent", sizeof(vl.plugin));
+  sstrncpy(vl.plugin_instance, process, sizeof(vl.plugin_instance));
+  sstrncpy(vl.type, type, sizeof(vl.type));
+
+  DEBUG("procevent plugin: dispatching state %d for PID %d (%s)", (int)value,
+        pid, process);
+
+  // Create metadata to store JSON key-values
+  meta_data_t *meta = meta_data_create();
+
+  vl.meta = meta;
+
+  gethostname(hostname, sizeof(hostname));
+
+  if (value == 1) {
+    meta_data_add_string(meta, "condition", "process_up");
+    meta_data_add_string(meta, "entity", process);
+    meta_data_add_string(meta, "source", hostname);
+    meta_data_add_string(meta, "dest", "process_down");
+  } else {
+    meta_data_add_string(meta, "condition", "process_down");
+    meta_data_add_string(meta, "entity", process);
+    meta_data_add_string(meta, "source", hostname);
+    meta_data_add_string(meta, "dest", "process_up");
+  }
+
+  plugin_dispatch_values(&vl);
+} /* }}} void interface_submit */
+
+static int procevent_read(void) /* {{{ */
+{
+  if (procevent_thread_error != 0) {
+    ERROR(
+        "procevent plugin: The interface thread had a problem. Restarting it.");
+
+    stop_thread(0);
+
+    start_thread();
+
+    return (-1);
+  } /* if (procevent_thread_error != 0) */
+
+  pthread_mutex_lock(&procevent_lock);
+
+  while (ring.head != ring.tail) {
+    int next = ring.tail + 1;
+
+    if (next >= ring.maxLen)
+      next = 0;
+
+    if (ring.buffer[ring.tail][1] == PROCEVENT_EXITED) {
+      processlist_t *pl = process_map_check(ring.buffer[ring.tail][0], NULL);
+
+      if (pl != NULL) {
+        // This process is of interest to us, so publish its EXITED status
+        submit(ring.buffer[ring.tail][0], "gauge", ring.buffer[ring.tail][1],
+               pl->process);
+        DEBUG("procevent plugin: PID %d (%s) EXITED, removing PID from process "
+              "list",
+              pl->pid, pl->process);
+        pl->pid = -1;
+      }
+    } else if (ring.buffer[ring.tail][1] == PROCEVENT_STARTED) {
+      // a new process has started, so check if we should monitor it
+      processlist_t *pl = process_check(ring.buffer[ring.tail][0]);
+
+      if (pl != NULL) {
+        // This process is of interest to us, so publish its STARTED status
+        submit(ring.buffer[ring.tail][0], "gauge", ring.buffer[ring.tail][1],
+               pl->process);
+        DEBUG(
+            "procevent plugin: PID %d (%s) STARTED, adding PID to process list",
+            pl->pid, pl->process);
+      }
+    }
+
+    ring.tail = next;
+  }
+
+  pthread_mutex_unlock(&procevent_lock);
+
+  return (0);
+} /* }}} int procevent_read */
+
+static int procevent_shutdown(void) /* {{{ */
+{
+  // int status = 0;
+  processlist_t *pl;
+
+  DEBUG("procevent plugin: Shutting down thread.");
+
+  if (stop_thread(1) < 0)
+    return (-1);
+
+  for (int i = 0; i < buffer_length; i++) {
+    free(ring.buffer[i]);
+  }
+
+  free(ring.buffer);
+
+  pl = processlist_head;
+  while (pl != NULL) {
+    processlist_t *pl_next;
+
+    pl_next = pl->next;
+
+    if (pl->is_regex == 1) {
+      sfree(pl->process_regex);
+      regfree(&pl->process_regex_obj);
+    }
+
+    sfree(pl->process);
+    sfree(pl);
+
+    pl = pl_next;
+  }
+
+  return (0);
+} /* }}} int procevent_shutdown */
+
+void module_register(void) {
+  plugin_register_config("procevent", procevent_config, config_keys,
+                         config_keys_num);
+  plugin_register_init("procevent", procevent_init);
+  plugin_register_read("procevent", procevent_read);
+  plugin_register_shutdown("procevent", procevent_shutdown);
+} /* void module_register */
\ No newline at end of file
diff --git a/src/types.db b/src/types.db
index 69f59b06..44071a3b 100644
--- a/src/types.db
+++ b/src/types.db
@@ -200,6 +200,7 @@ players                 value:GAUGE:0:1000000
 pools                   value:GAUGE:0:U
 power                   value:GAUGE:U:U
 pressure                value:GAUGE:0:U
+procevent               value:GAUGE:0:1
 protocol_counter        value:DERIVE:0:U
 ps_code                 value:GAUGE:0:9223372036854775807
 ps_count                processes:GAUGE:0:1000000, threads:GAUGE:0:1000000
-- 
2.21.0

